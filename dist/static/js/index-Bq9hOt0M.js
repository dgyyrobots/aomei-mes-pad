/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 10:14:51 
 */
import{d as L,r as y,f as j,b as E,g as d,h as N,c as U,o as s,j as t,m as a,a as l,J as G,w as _,v as i,K as J,k as f,t as T,l as W,M as H,F as O,z as X,N as Y}from"./index-BuFigy1A.js";import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Dq4j5fFx.js";import{_ as ee}from"./index-Bm6lKD5Z.js";import{_ as te}from"./AccountForm.vue_vue_type_script_setup_true_lang-CASjLQ3V.js";import{a as ne,d as ae,b as oe,e as le}from"./index-Bcad97Wp.js";const re=["src"],de=L({name:"MpAccount",__name:"index",setup(se){const m=X(),{t:F}=Y(),k=y(!0),v=y(0),x=y([]),r=j({pageNo:1,pageSize:10,name:null,account:null,appId:null}),$=y(),u=async()=>{k.value=!0;try{const o=await ne(r);x.value=o.list,v.value=o.total}finally{k.value=!1}},w=()=>{r.pageNo=1,u()},Q=()=>{$.value.resetFields(),w()},I=y(),P=(o,e)=>{I.value.open(o,e)},S=async o=>{try{await m.delConfirm(),await ae(o),m.success(F("common.delSuccess")),await u()}catch(e){console.log(e)}},V=async o=>{try{await m.confirm(`是否确认生成公众号账号编号为"${o.name}"的二维码?`),await oe(o.id),m.success("生成二维码成功"),await u()}catch(e){console.log(e)}},R=async o=>{try{await m.confirm(`是否确认清空生成公众号账号编号为"${o.name}"的 API 配额?`),await le(o.id),m.success("清空 API 配额成功")}catch(e){console.log(e)}};return E(()=>{u()}),(o,e)=>{const h=ee,z=d("el-input"),q=d("el-form-item"),C=J,c=d("el-button"),D=d("el-form"),A=Z,p=d("el-table-column"),M=d("el-table"),B=H,g=N("hasPermi"),K=N("loading");return s(),U(O,null,[t(h,{title:"公众号接入",url:"https://doc.iocoder.cn/mp/account/"}),t(A,null,{default:a(()=>[t(D,{ref_key:"queryFormRef",ref:$,class:"-mb-15px",inline:!0,"label-width":"68px",model:l(r)},{default:a(()=>[t(q,{label:"名称",prop:"name"},{default:a(()=>[t(z,{modelValue:l(r).name,"onUpdate:modelValue":e[0]||(e[0]=n=>l(r).name=n),class:"!w-240px",clearable:"",placeholder:"请输入名称",onKeyup:G(w,["enter"])},null,8,["modelValue"])]),_:1}),t(q,null,{default:a(()=>[t(c,{onClick:w},{default:a(()=>[t(C,{class:"mr-5px",icon:"ep:search"}),e[4]||(e[4]=i(" 搜索 "))]),_:1}),t(c,{onClick:Q},{default:a(()=>[t(C,{class:"mr-5px",icon:"ep:refresh"}),e[5]||(e[5]=i(" 重置 "))]),_:1}),_((s(),f(c,{type:"primary",onClick:e[1]||(e[1]=n=>P("create"))},{default:a(()=>[t(C,{class:"mr-5px",icon:"ep:plus"}),e[6]||(e[6]=i(" 新增 "))]),_:1})),[[g,["mp:account:create"]]])]),_:1})]),_:1},8,["model"])]),_:1}),t(A,null,{default:a(()=>[_((s(),f(M,{data:l(x)},{default:a(()=>[t(p,{align:"center",label:"名称",prop:"name"}),t(p,{align:"center",label:"微信号",prop:"account",width:"180"}),t(p,{align:"center",label:"appId",prop:"appId",width:"180"}),t(p,{align:"center",label:"服务器地址(URL)",prop:"appId",width:"360"},{default:a(n=>[i(T("http://服务端地址/mp/open/"+n.row.appId),1)]),_:1}),t(p,{align:"center",label:"二维码",prop:"qrCodeUrl"},{default:a(n=>[n.row.qrCodeUrl?(s(),U("img",{key:0,alt:"二维码",src:n.row.qrCodeUrl,style:{display:"inline-block",height:"100px"}},null,8,re)):W("",!0),_((s(),f(c,{link:"",type:"primary",onClick:b=>V(n.row)},{default:a(()=>e[7]||(e[7]=[i("生成二维码")])),_:2},1032,["onClick"])),[[g,["mp:account:qr-code"]]])]),_:1}),t(p,{align:"center",label:"备注",prop:"remark"}),t(p,{align:"center",label:"操作"},{default:a(n=>[_((s(),f(c,{link:"",type:"primary",onClick:b=>P("update",n.row.id)},{default:a(()=>e[8]||(e[8]=[i("编辑")])),_:2},1032,["onClick"])),[[g,["mp:account:update"]]]),_((s(),f(c,{link:"",type:"danger",onClick:b=>S(n.row.id)},{default:a(()=>e[9]||(e[9]=[i("删除")])),_:2},1032,["onClick"])),[[g,["mp:account:delete"]]]),_((s(),f(c,{link:"",type:"danger",onClick:b=>R(n.row)},{default:a(()=>e[10]||(e[10]=[i(" 清空 API 配额 ")])),_:2},1032,["onClick"])),[[g,["mp:account:clear-quota"]]])]),_:1})]),_:1},8,["data"])),[[K,l(k)]]),t(B,{limit:l(r).pageSize,"onUpdate:limit":e[2]||(e[2]=n=>l(r).pageSize=n),page:l(r).pageNo,"onUpdate:page":e[3]||(e[3]=n=>l(r).pageNo=n),total:l(v),onPagination:u},null,8,["limit","page","total"])]),_:1}),t(te,{ref_key:"formRef",ref:I,onSuccess:u},null,512)],64)}}});export{de as default};
