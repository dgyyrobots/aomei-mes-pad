/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:21:26 
 */
import{W as oe,O as ne,r,f as z,b as ue,g as s,h as T,c as M,o as c,w,k as b,m as a,j as e,l as P,i as F,t as re,a as p,x as se,v as U,$ as de,M as ie,F as pe,n as me,Z as R}from"./index-5TqN_QR1.js";import{_ as ce}from"./DictTag.vue_vue_type_script_lang-cZQMmgs8.js";import{a as ge,b as fe,u as _e}from"./index-DPwoEynk.js";import{l as be}from"./index-B42Chdeu.js";import{D as ve}from"./dict-B2yk4gHf.js";import"./color-B5phLuB-.js";const ye={class:"app-container"},we={class:"dialog-footer"},Te={__name:"line",props:{optType:{type:String,default:null},purchaseId:{type:[String,Number],default:null},warehouseId:{type:[String,Number],default:null},locationId:{type:[String,Number],default:null},areaId:{type:[String,Number],default:null}},setup(N){const A=N,k=oe(),g=ne(()=>k.currentSize==="mini"?"small":k.currentSize),V=r(!0),q=r([]),E=r(!0),$=r(!0);r(!0);const h=r(0),x=r([]),B=r(""),f=r(!1),j=r([]),D=r([]),v=r();r();const _=z({pageNo:1,pageSize:10,purchaseId:A.purchaseId,goodsNumber:null,goodsName:null,goodsSpecs:null,company:null,monovalent:null,quantity:null,taxes:null,total:null,categoryName:null,brandName:null,createTime:[]}),o=z({id:null,issueId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantityIssued:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,remark:null,attr1:null,attr2:null,attr3:null,attr4:null,createBy:null,createTime:null,updateBy:null,updateTime:null}),G=z({itemId:[{required:!0,message:"产品物料不能为空",trigger:"blur"}],quantityIssued:[{required:!0,message:"领料数量不能为空",trigger:"blur"}]}),S=async()=>{V.value=!0;try{const u=await ge(_);x.value=u.list,h.value=u.total}finally{V.value=!1}},L=()=>{f.value=!1,O()},O=()=>{Object.assign(o,{id:null,issueId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantityIssued:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,remark:null,attr1:null,attr2:null,attr3:null,attr4:null,createBy:null,createTime:null,updateBy:null,updateTime:null}),v.value?.resetFields()},H=u=>{j.value=u,q.value=u.map(l=>l.id),E.value=u.length!==1,$.value=!u.length},W=async u=>{O();const l=u.id||q.value;if(console.log(u),u.status===2){R.error("该单据已入库，禁止修改！");return}try{const n=await be();D.value=n;const C=await fe(l);Object.assign(o,C),f.value=!0,B.value="修改采购商品明细"}catch(n){console.error("获取数据失败:",n)}},Y=async()=>{if(v.value)try{await v.value.validate(),o.id!=null&&(await _e(o),R.success("修改成功"),f.value=!1,S())}catch(u){console.error("提交失败:",u)}};return ue(()=>{S()}),(u,l)=>{const n=s("el-table-column"),C=ce,I=s("el-button"),Z=s("el-table"),J=ie,m=s("el-input"),d=s("el-form-item"),i=s("el-col"),y=s("el-row"),K=s("el-option"),Q=s("el-select"),X=s("el-form"),ee=s("el-dialog"),le=T("hasPermi"),te=T("loading"),ae=T("dialogDrag");return c(),M("div",ye,[w((c(),b(Z,{size:p(g),data:x.value,onSelectionChange:H},{default:a(()=>[e(n,{label:"单据编码",align:"center",prop:"id"}),e(n,{"show-overflow-tooltip":!0,label:"采购单号",width:"220",align:"center",prop:"poNo"}),e(n,{"show-overflow-tooltip":!0,label:"商品编号",width:"220",align:"center",prop:"goodsNumber"}),e(n,{"show-overflow-tooltip":!0,label:"商品名称",width:"230",align:"center",prop:"goodsName"}),e(n,{"show-overflow-tooltip":!0,label:"商品规格",width:"150",align:"center",prop:"goodsSpecs"}),e(n,{label:"商品单位",align:"center",prop:"company"}),e(n,{label:"采购数量",align:"center",width:"110",prop:"quantity"}),e(n,{label:"收货数量",align:"center",width:"110",prop:"receiveNum"}),e(n,{label:"创建时间",align:"center",prop:"createTime",width:"180"},{default:a(t=>[F("span",null,re(p(se)(t.row.createTime)),1)]),_:1}),e(n,{label:"入库状态",prop:"status",width:"80"},{default:a(t=>[e(C,{type:p(ve).PURCHASE_STATUS,value:t.row.status},null,8,["type","value"])]),_:1}),N.optType!="view"?(c(),b(n,{key:0,label:"操作",fixed:"right",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:a(t=>[N.optType!="view"?w((c(),b(I,{key:0,size:p(g),type:"text",onClick:Ne=>W(t.row)},{default:a(()=>l[12]||(l[12]=[U("修改 ")])),_:2},1032,["size","onClick"])),[[le,["purchase:goods:update"]]]):P("",!0)]),_:1})):P("",!0)]),_:1},8,["size","data"])),[[te,V.value]]),w(e(J,{size:p(g),total:h.value,page:_.pageNo,"onUpdate:page":l[0]||(l[0]=t=>_.pageNo=t),limit:_.pageSize,"onUpdate:limit":l[1]||(l[1]=t=>_.pageSize=t),onPagination:S},null,8,["size","total","page","limit"]),[[de,h.value>0]]),w((c(),b(ee,{title:B.value,modelValue:f.value,"onUpdate:modelValue":l[11]||(l[11]=t=>f.value=t),width:"90%","append-to-body":""},{footer:a(()=>[F("div",we,[e(I,{size:p(g),type:"primary",onClick:Y},{default:a(()=>l[13]||(l[13]=[U("确 定")])),_:1},8,["size"]),e(I,{size:p(g),onClick:L},{default:a(()=>l[14]||(l[14]=[U("取 消")])),_:1},8,["size"])])]),default:a(()=>[e(X,{size:p(g),ref_key:"formRef",ref:v,model:o,rules:G},{default:a(()=>[e(y,{gutter:20},{default:a(()=>[e(i,{span:12},{default:a(()=>[e(d,{label:"采购单号",prop:"poNo"},{default:a(()=>[e(m,{disabled:"",modelValue:o.poNo,"onUpdate:modelValue":l[2]||(l[2]=t=>o.poNo=t),placeholder:"请输入采购单号"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:a(()=>[e(d,{label:"商品编号",prop:"goodsNumber"},{default:a(()=>[e(m,{disabled:"",modelValue:o.goodsNumber,"onUpdate:modelValue":l[3]||(l[3]=t=>o.goodsNumber=t),placeholder:"请输入商品编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(i,{span:12},{default:a(()=>[e(d,{label:"商品名称",prop:"goodsName"},{default:a(()=>[e(m,{disabled:"",modelValue:o.goodsName,"onUpdate:modelValue":l[4]||(l[4]=t=>o.goodsName=t),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:a(()=>[e(d,{label:"商品规格",prop:"goodsSpecs"},{default:a(()=>[e(m,{disabled:"",modelValue:o.goodsSpecs,"onUpdate:modelValue":l[5]||(l[5]=t=>o.goodsSpecs=t),placeholder:"请输入商品规格"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(i,{span:12},{default:a(()=>[e(d,{label:"商品单位",prop:"company"},{default:a(()=>[e(m,{disabled:"",modelValue:o.company,"onUpdate:modelValue":l[6]||(l[6]=t=>o.company=t),placeholder:"请输入商品单位"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:a(()=>[e(d,{label:"采购数量",prop:"quantity"},{default:a(()=>[e(m,{disabled:"",modelValue:o.quantity,"onUpdate:modelValue":l[7]||(l[7]=t=>o.quantity=t),placeholder:"请输入采购数量"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(i,{span:12},{default:a(()=>[e(d,{label:"收货数量",prop:"receiveNum"},{default:a(()=>[e(m,{modelValue:o.receiveNum,"onUpdate:modelValue":l[8]||(l[8]=t=>o.receiveNum=t),placeholder:"请输入收货数量"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:a(()=>[e(d,{label:"收货单位",width:"100%",prop:"receiveNum"},{default:a(()=>[e(Q,{filterable:"",clearable:"",onFocus:l[9]||(l[9]=t=>t.target.blur()),modelValue:o.unitOfMeasure,"onUpdate:modelValue":l[10]||(l[10]=t=>o.unitOfMeasure=t),placeholder:"请选择"},{default:a(()=>[(c(!0),M(pe,null,me(D.value,t=>(c(),b(K,{key:t.measureCode,label:t.measureName,value:t.measureCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"])]),_:1},8,["title","modelValue"])),[[ae]])])}}};export{Te as default};
