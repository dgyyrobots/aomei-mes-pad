/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 10:14:51 
 */
import{d as fe,r as u,b as pe,e as _e,s as ve,f as ye,g as m,h as ke,c as I,o as _,i as n,j as e,k as S,l as x,w as be,a,m as l,F as E,n as Q,p as U,t as p,q as ge,v as D,x as qe,y as Ce,_ as we,z as Fe,A as Ne}from"./index-BuFigy1A.js";import{_ as Ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Dq4j5fFx.js";import{_ as Se}from"./index-CEzjiIbw.js";import{_ as De}from"./ProductProduceLineList.vue_vue_type_script_setup_true_lang-DxLOTXVc.js";import{_ as Ve}from"./LineList.vue_vue_type_script_setup_true_lang-BlObkauF.js";import{_ as Te}from"./detail.vue_vue_type_script_setup_true_lang-BXAy_rNk.js";import{_ as $e}from"./FeedbackList.vue_vue_type_script_setup_true_lang-BvHHto_t.js";import{_ as he}from"./IssueLineList.vue_vue_type_script_setup_true_lang-Boc_fEda.js";import xe from"./MdProductSopList-ms4Bwa3b.js";import{_ as Ee}from"./IpqcForm.vue_vue_type_style_index_0_lang-BWKXy5or.js";import Ue from"./bom-DccnqTwx.js";import{g as Pe,a as Re,c as Le,u as z,b as Ae}from"./index-CAM3Ef-C.js";import{g as Me}from"./dict-Ve5yp9Dm.js";import{_ as Be}from"./ProductProduceLineForm.vue_vue_type_script_setup_true_lang-DnhBNain.js";import Oe from"./ActionButtons-Cjdo9gvx.js";import"./DictTag.vue_vue_type_script_lang-DcBSip_F.js";import"./color-B5phLuB-.js";import"./TemplateSelect.vue_vue_type_script_setup_true_lang-D-gLnn_h.js";import"./index-BUjSBrqV.js";import"./TemplateForm.vue_vue_type_script_setup_true_lang-BZ6dvsnb.js";import"./TemplateIndexForm.vue_vue_type_script_setup_true_lang-Bge5eAF9.js";import"./TemplateList.vue_vue_type_script_setup_true_lang-BkX1SLas.js";import"./index-4SaFjs3d.js";import"./qmsIndexForm.vue_vue_type_script_setup_true_lang-Dhky1PL3.js";import"./TemplateProductForm.vue_vue_type_script_setup_true_lang-BJKa1xUs.js";import"./TemplateIndexList.vue_vue_type_script_setup_true_lang-Bw68V12i.js";import"./TemplateProductList.vue_vue_type_script_setup_true_lang-DVvLHCC5.js";import"./TaskSelect.vue_vue_type_script_setup_true_lang-2MLTdnlh.js";const He={class:"contnt",style:{"padding-bottom":"120px"}},Qe={class:"tab-nav"},ze=["onClick"],je={key:0,class:"task-list-container"},We={class:"task-card__header"},Ge={class:"material-info"},Je={class:"value"},Ke={class:"value code"},Xe={class:"task-info"},Ye={class:"info-item"},Ze={class:"info-item"},et={class:"info-item"},tt={class:"value highlight"},at={class:"info-item"},ot={class:"value"},st={class:"info-item"},lt={class:"value"},nt={class:"right"},it=fe({__name:"production",setup(rt){const i=u({id:void 0,taskCode:void 0,taskName:void 0,workorderId:void 0,workorderCode:void 0,workorderName:void 0,workstationId:void 0,workstationCode:void 0,workstationName:void 0,processId:void 0,processCode:void 0,processName:void 0,itemId:void 0,itemCode:void 0,itemName:void 0,specification:void 0,unitOfMeasure:void 0,quantity:1,quantityProduced:void 0,quantityQuanlify:void 0,quantityUnquanlify:void 0,quantityChanged:void 0,clientId:void 0,clientCode:void 0,clientName:void 0,clientNick:void 0,startTime:void 0,duration:1,endTime:void 0,colorCode:void 0,requestDate:void 0,status:void 0,remark:void 0}),v=u([]),V=u(0),T=u(0),k=u(1),j=[{label:"待领取0个",value:3},{label:`未完工${T.value}个`,value:0},{label:`已完工${V.value-T.value}个`,value:2},{label:`全部${V.value}个`,value:1}];pe(async()=>{b()});const $=u(!1),W={height:"100%",padding:"16px"},b=async()=>{$.value=!0;try{let r=await Pe({pageSize:100});V.value=r.total;let t=0,w=[],g=[];for(const q of r.list)q.status!=="FINISHED"?(w.push(q),t++):g.push(q);T.value=t,k.value==0?v.value=w:k.value==1?v.value=r.list:k.value==2?v.value=g:v.value=[]}finally{$.value=!1}},G=r=>{k.value=r,b()},P=u(!1),c=u(),y=async r=>{c.value=r,P.value=!0;try{let t=await Re(r);i.value=t}finally{P.value=!1}},J=_e(),{username:R}=ve(J),d=Fe(),L=u(),s=ye({open:!1,form:{quantityUnqualify:0,quantityQualify:1,reportFee:void 0,nickName:R,quantityFeedback:1},row:void 0}),A=()=>{s.form={quantityUnqualify:0,quantityQualify:1,reportFee:void 0,nickName:R,quantityFeedback:1},L.value?.resetFields()},K=()=>{s.open=!1,A()},X=async()=>{s.form.feedbackType="SELF",s.form.reportFee&&(s.form.reportFee=s.form.reportFee*1),delete s.row.id,await Le(Object.assign(s.form,s.row)),s.open=!1,d.success("上报成功"),b(),y(c.value)},C=u("任务详情"),M=u(),B=u(),Y=async r=>{if(!c.value||!i.value)return d.error("请先选择一个任务");if(r==1){if(i.value.status!="NORMAL")return d.error("当前状态不可开工");await d.confirm("确认开工？"),await z({id:c.value,status:"STARTED"}),d.success("开工成功"),b(),y(c.value)}if(r==2)if(i.value.status=="STARTED"||i.value.status=="FINISHED")s.row=i.value,A(),s.open=!0;else return d.error("当前状态不可报工");if(r==3){if(i.value.status!="STARTED")return d.error("当前状态不可完工");await d.confirm("确认完工？"),await z({id:c.value,status:"FINISHED"}),d.success("完工成功"),b(),y(c.value)}if(r==4&&await d.confirm(`确认领取${i.value.taskName}？`),r==5&&(C.value="BOM明细"),r==6){if(i.value.status!="STARTED")return d.error("当前状态不可产出");let t=await Ae({taskCode:i.value.taskCode});t.list&&t.list.length?M.value.open("create",null,t.list[0].id):d.error("没有对应的产出记录无法新增产出明细")}if(r==7){if(i.value.status!="STARTED")return d.error("当前状态不可新增过程检验");B.value.open("create",null,i.value)}},Z=u("var(--el-color-primary-light-9)"),ee=u("var(--el-color-white)"),te=u("rgba(240,2,20,0.098)"),ae=u("var(--el-color-white)"),oe={background:`linear-gradient(to right,${Z.value}, ${ee.value}) no-repeat`,border:0},se={background:`linear-gradient(to right,${te.value}, ${ae.value}) no-repeat`,border:0};return(r,t)=>{const w=m("el-progress"),g=m("el-tag"),q=Se,le=m("el-col"),ne=m("el-row"),F=m("el-empty"),ie=Ie,f=m("el-tab-pane"),re=m("el-tabs"),h=m("el-input-number"),N=m("el-form-item"),ue=m("el-input"),de=m("el-form"),O=m("el-button"),me=we,ce=ke("loading");return _(),I(E,null,[n("div",He,[be((_(),S(ie,{class:"left"},{default:l(()=>[n("div",Qe,[(_(),I(E,null,Q(j,(o,H)=>n("div",{key:H,class:U(["tab-item",a(k)==o.value?"active":""]),onClick:ut=>G(o.value)},p(o.label),11,ze)),64))]),a(v).length?(_(),I("div",je,[e(ne,{gutter:16},{default:l(()=>[(_(!0),I(E,null,Q(a(v),o=>(_(),S(le,{span:6,key:o.id,onClick:H=>y(o.id)},{default:l(()=>[e(q,{class:U(["task-card",{"is-selected":o.id==a(c)}]),"body-style":W,style:ge(o.id==a(c)?se:oe)},{default:l(()=>[n("div",We,[n("div",{class:U(["status-line",o.status==="FINISHED"?"is-finished":""])},null,2),n("div",Ge,[t[7]||(t[7]=n("div",{class:"label"},"产出物料",-1)),n("div",Je,p(o.itemName),1),n("div",Ke,p(o.itemCode),1)])]),e(w,{percentage:Math.round(o.quantityProduced/o.quantity*100),status:o.status==="FINISHED"?"success":"primary",class:"task-progress"},null,8,["percentage","status"]),n("div",Xe,[n("div",Ye,[t[8]||(t[8]=n("span",{class:"label"},"任务状态",-1)),e(g,{size:"small",type:o.status==="FINISHED"?"success":"primary"},{default:l(()=>[D(p(o.status==="FINISHED"?"已完成":"已领取"),1)]),_:2},1032,["type"])]),n("div",Ze,[t[9]||(t[9]=n("span",{class:"label"},"任务进度",-1)),e(g,{size:"small"},{default:l(()=>[D(p(a(Me)("mes_pro_task_status",o.status)),1)]),_:2},1024)]),n("div",et,[t[10]||(t[10]=n("span",{class:"label"},"生产进度",-1)),n("span",tt,p(o.quantityProduced)+"/"+p(o.quantity),1)]),n("div",at,[t[11]||(t[11]=n("span",{class:"label"},"工单编号",-1)),n("span",ot,p(o.workorderCode),1)]),n("div",st,[t[12]||(t[12]=n("span",{class:"label"},"需求日期",-1)),n("span",lt,p(a(qe)(o.requestDate)),1)])])]),_:2},1032,["class","style"])]),_:2},1032,["onClick"]))),128))]),_:1})])):x("",!0),a(v).length?x("",!0):(_(),S(F,{key:1,class:"vab-data-empty",description:"暂无数据"}))]),_:1})),[[ce,a($)]]),n("div",nt,[e(re,{modelValue:a(C),"onUpdate:modelValue":t[0]||(t[0]=o=>Ce(C)?C.value=o:null),type:"border-card"},{default:l(()=>[e(f,{label:"任务详情",name:"任务详情"},{default:l(()=>[e(Te,{"form-data":a(i)},null,8,["form-data"])]),_:1}),e(f,{label:"BOM明细",name:"BOM明细"},{default:l(()=>[e(Ue,{"item-id":a(i).itemId},null,8,["item-id"])]),_:1}),e(f,{label:"SOP",name:"SOP"},{default:l(()=>[e(xe,{"item-id":a(i).itemId},null,8,["item-id"])]),_:1}),e(f,{label:"SIP",name:"SIP",style:{height:"max-content"}},{default:l(()=>[e(F,{description:"暂无数据"})]),_:1}),e(f,{label:"领料明细",name:"领料明细"},{default:l(()=>[e(he,{taskCode:a(i).taskCode},null,8,["taskCode"])]),_:1}),e(f,{label:"投料明细",name:"投料明细"},{default:l(()=>[e(F,{description:"暂无数据"})]),_:1}),e(f,{label:"产出明细",name:"产出明细"},{default:l(()=>[e(De,{taskCode:a(i).taskCode},null,8,["taskCode"])]),_:1}),e(f,{label:"检验明细",name:"检验明细"},{default:l(()=>[e(Ve,{taskCode:a(i).taskCode},null,8,["taskCode"])]),_:1}),e(f,{label:"报工明细",name:"报工明细"},{default:l(()=>[e($e,{taskCode:a(i).taskCode},null,8,["taskCode"])]),_:1}),e(f,{label:"操作日志",name:"操作日志"},{default:l(()=>[e(F,{description:"暂无数据"})]),_:1})]),_:1},8,["modelValue"])])]),e(Oe,{status:a(i)?.status,onAction:Y},null,8,["status"]),a(s).open?(_(),S(me,{key:0,modelValue:a(s).open,"onUpdate:modelValue":t[5]||(t[5]=o=>a(s).open=o),width:"80%",title:"生产报工"},{footer:l(()=>[n("div",null,[e(O,{type:"primary",onClick:X},{default:l(()=>t[13]||(t[13]=[D("提交 ")])),_:1}),e(O,{onClick:K},{default:l(()=>t[14]||(t[14]=[D("取 消")])),_:1})])]),default:l(()=>[e(de,{ref_key:"form",ref:L,model:a(s).form,rules:r.rules},{default:l(()=>[e(N,{prop:"quantityFeedback",label:"报工总数量"},{default:l(()=>[e(h,{modelValue:a(s).form.quantityFeedback,"onUpdate:modelValue":t[1]||(t[1]=o=>a(s).form.quantityFeedback=o),max:a(i).quantity-a(i).quantityProduced,min:1},null,8,["modelValue","max"])]),_:1}),e(N,{prop:"nickName",label:"报工人"},{default:l(()=>[e(ue,{modelValue:a(s).form.nickName,"onUpdate:modelValue":t[2]||(t[2]=o=>a(s).form.nickName=o),placeholder:"请输入报工人姓名",disabled:""},null,8,["modelValue"])]),_:1}),e(N,{prop:"quantityQualify",label:"合格品数量"},{default:l(()=>[e(h,{modelValue:a(s).form.quantityQualify,"onUpdate:modelValue":t[3]||(t[3]=o=>a(s).form.quantityQualify=o),max:a(s).form.quantityFeedback-a(s).form.quantityUnqualify,min:0},null,8,["modelValue","max"])]),_:1}),e(N,{prop:"quantityUnqualify",label:"不良品数量"},{default:l(()=>[e(h,{modelValue:a(s).form.quantityUnqualify,"onUpdate:modelValue":t[4]||(t[4]=o=>a(s).form.quantityUnqualify=o),max:a(s).form.quantityFeedback-a(s).form.quantityQualify,min:0},null,8,["modelValue","max"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])):x("",!0),e(Be,{ref_key:"formRef",ref:M,onSuccess:t[6]||(t[6]=o=>y(a(c).value))},null,512),e(Ee,{ref_key:"formRefs",ref:B,onSuccess:y},null,512)],64)}}}),Lt=Ne(it,[["__scopeId","data-v-12babc5d"]]);export{Lt as default};
