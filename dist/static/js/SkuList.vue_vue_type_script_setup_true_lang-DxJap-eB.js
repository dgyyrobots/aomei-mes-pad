/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{c as Y}from"./index-Bn4cwl4J.js";import{_ as q}from"./UploadImg-CCDcPQew.js";import"./UploadImgs.vue_vue_type_script_setup_true_lang-DPD2ftyX.js";import"./UploadFile.vue_vue_type_script_setup_true_lang-D44NOlWT.js";import{d as G,az as C,r as U,Y as E,g as v,c as k,o as u,F as b,k as g,l as h,a as d,aS as x,m as i,j as t,n as S,v as p,t as m,U as K,c1 as Q,z as X,i as N}from"./index-lcC3l4R2.js";const Z={style:{"font-weight":"bold",color:"#40aaff"}},L={style:{"font-weight":"bold",color:"#40aaff"}},ee={style:{"font-weight":"bold",color:"#40aaff"}},re=G({name:"SkuList",__name:"SkuList",props:{propFormData:{type:Object,default:()=>{}},propertyList:{type:Array,default:()=>[]},ruleConfig:{type:Array,default:()=>[]},isBatch:C.bool.def(!1),isDetail:C.bool.def(!1),isComponent:C.bool.def(!1),isActivityComponent:C.bool.def(!1)},emits:["selectionChange"],setup(f,{expose:O,emit:J}){const $=X(),y=f,c=U(),P=U([{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),T=a=>{Y({zIndex:9999999,urlList:[a]})},j=()=>{c.value.skus.forEach(a=>{Q(a,P.value[0])})},F=a=>{const s=c.value.skus.findIndex(l=>JSON.stringify(l.properties)===JSON.stringify(a.properties));c.value.skus.splice(s,1)},w=U([]),R=()=>{let a="请检查商品各行相关属性配置，",s=!0;for(const l of c.value.skus){if(y?.ruleConfig)for(const o of y.ruleConfig){const r=H(l,o.name);if(!o.rule(r)){s=!1,a+=o.message;break}}if(!s)throw $.warning(a),new Error(a)}},H=(a,s)=>{const l=s.split(".");let o=a;for(const r of l)if(o&&typeof o=="object"&&r in o)o=o[r];else{o=void 0;break}return o},M=J,W=a=>{M("selectionChange",a)};E(()=>y.propFormData,a=>{a&&(c.value=a)},{deep:!0,immediate:!0});const A=a=>{const s=a.map(o=>o.values.map(r=>({propertyId:o.id,propertyName:o.name,valueId:r.id,valueName:r.name}))),l=I(s);D(a)||(c.value.skus=[]);for(const o of l){const r={properties:Array.isArray(o)?o:[o],price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0};c.value.skus.findIndex(V=>JSON.stringify(V.properties)===JSON.stringify(r.properties))===-1&&c.value.skus.push(r)}},D=a=>{const s=[];c.value.skus.forEach(o=>o.properties?.map(r=>r.propertyId)?.forEach(r=>{s.indexOf(r)===-1&&s.push(r)}));const l=a.map(o=>o.id);return s.length===l.length},I=a=>{if(a.length===0)return[];if(a.length===1)return a[0];{const s=[],l=I(a.slice(1));for(let o=0;o<a[0].length;o++)for(let r=0;r<l.length;r++)Array.isArray(l[r])?s.push([a[0][o],...l[r]]):s.push([a[0][o],l[r]]);return s}};E(()=>y.propertyList,a=>{c.value.specType&&(y.isBatch&&(P.value=[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),JSON.stringify(a)!=="[]"&&(w.value=[],a.forEach((s,l)=>{w.value.push({prop:`name${l}`,label:s.name})}),!D(a)&&(a.some(s=>s.values.length===0)||A(a))))},{deep:!0,immediate:!0});const z=U();return O({generateTableData:A,validateSku:R,getSkuTableRef:()=>z.value}),(a,s)=>{const l=v("el-table-column"),o=v("el-input"),r=v("el-input-number"),B=v("el-button"),V=v("el-image");return u(),k(b,null,[!f.isDetail&&!f.isActivityComponent?(u(),g(d(x),{key:0,border:"",class:"tabNumWidth",data:f.isBatch?d(P):d(c).skus,"max-height":"500",size:"small"},{default:i(()=>[t(l,{align:"center",fixed:"left",label:"图片","min-width":"100"},{default:i(({row:e})=>[t(d(q),{modelValue:e.picUrl,"onUpdate:modelValue":n=>e.picUrl=n,height:"80px",width:"100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),d(c).specType&&!f.isBatch?(u(!0),k(b,{key:0},S(d(w),(e,n)=>(u(),g(l,{key:n,align:"center",label:e.label,"min-width":"120"},{default:i(({row:_})=>[N("span",Z,m(_.properties[n]?.valueName),1)]),_:2},1032,["label"]))),128)):h("",!0),t(l,{align:"center",label:"商品条码","min-width":"168"},{default:i(({row:e})=>[t(o,{modelValue:e.barCode,"onUpdate:modelValue":n=>e.barCode=n,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"销售价(元)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.price,"onUpdate:modelValue":n=>e.price=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"市场价(元)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.marketPrice,"onUpdate:modelValue":n=>e.marketPrice=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"成本价(元)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.costPrice,"onUpdate:modelValue":n=>e.costPrice=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"库存","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.stock,"onUpdate:modelValue":n=>e.stock=n,class:"w-100%",min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"重量(kg)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.weight,"onUpdate:modelValue":n=>e.weight=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"体积(m^3)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.volume,"onUpdate:modelValue":n=>e.volume=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),d(c).subCommissionType?(u(),k(b,{key:1},[t(l,{align:"center",label:"一级返佣(元)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.firstBrokeragePrice,"onUpdate:modelValue":n=>e.firstBrokeragePrice=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(l,{align:"center",label:"二级返佣(元)","min-width":"168"},{default:i(({row:e})=>[t(r,{modelValue:e.secondBrokeragePrice,"onUpdate:modelValue":n=>e.secondBrokeragePrice=n,class:"w-100%",min:0,precision:2,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1})],64)):h("",!0),d(c)?.specType?(u(),g(l,{key:2,align:"center",fixed:"right",label:"操作",width:"80"},{default:i(({row:e})=>[f.isBatch?(u(),g(B,{key:0,link:"",size:"small",type:"primary",onClick:j},{default:i(()=>s[0]||(s[0]=[p("批量添加")])),_:1})):(u(),g(B,{key:1,link:"",size:"small",type:"primary",onClick:n=>F(e)},{default:i(()=>s[1]||(s[1]=[p("删除")])),_:2},1032,["onClick"]))]),_:1})):h("",!0)]),_:1},8,["data"])):h("",!0),f.isDetail?(u(),g(d(x),{key:1,ref_key:"activitySkuListRef",ref:z,border:"",data:d(c).skus,"max-height":"500",size:"small",style:{width:"99%"},onSelectionChange:W},{default:i(()=>[f.isComponent?(u(),g(l,{key:0,type:"selection",width:"45"})):h("",!0),t(l,{align:"center",label:"图片","min-width":"80"},{default:i(({row:e})=>[t(V,{class:"h-60px w-60px",src:e.picUrl,onClick:n=>T(e.picUrl)},null,8,["src","onClick"])]),_:1}),d(c).specType&&!f.isBatch?(u(!0),k(b,{key:1},S(d(w),(e,n)=>(u(),g(l,{key:n,align:"center",label:e.label,"min-width":"80"},{default:i(({row:_})=>[N("span",L,m(_.properties[n]?.valueName),1)]),_:2},1032,["label"]))),128)):h("",!0),t(l,{align:"center",label:"商品条码","min-width":"100"},{default:i(({row:e})=>[p(m(e.barCode),1)]),_:1}),t(l,{align:"center",label:"销售价(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.price),1)]),_:1}),t(l,{align:"center",label:"市场价(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.marketPrice),1)]),_:1}),t(l,{align:"center",label:"成本价(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.costPrice),1)]),_:1}),t(l,{align:"center",label:"库存","min-width":"80"},{default:i(({row:e})=>[p(m(e.stock),1)]),_:1}),t(l,{align:"center",label:"重量(kg)","min-width":"80"},{default:i(({row:e})=>[p(m(e.weight),1)]),_:1}),t(l,{align:"center",label:"体积(m^3)","min-width":"80"},{default:i(({row:e})=>[p(m(e.volume),1)]),_:1}),d(c).subCommissionType?(u(),k(b,{key:2},[t(l,{align:"center",label:"一级返佣(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.firstBrokeragePrice),1)]),_:1}),t(l,{align:"center",label:"二级返佣(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.secondBrokeragePrice),1)]),_:1})],64)):h("",!0)]),_:1},8,["data"])):h("",!0),f.isActivityComponent?(u(),g(d(x),{key:2,border:"",data:d(c).skus,"max-height":"500",size:"small",style:{width:"99%"}},{default:i(()=>[f.isComponent?(u(),g(l,{key:0,type:"selection",width:"45"})):h("",!0),t(l,{align:"center",label:"图片","min-width":"80"},{default:i(({row:e})=>[t(V,{class:"h-60px w-60px",src:e.picUrl,onClick:n=>T(e.picUrl)},null,8,["src","onClick"])]),_:1}),d(c).specType?(u(!0),k(b,{key:1},S(d(w),(e,n)=>(u(),g(l,{key:n,align:"center",label:e.label,"min-width":"80"},{default:i(({row:_})=>[N("span",ee,m(_.properties[n]?.valueName),1)]),_:2},1032,["label"]))),128)):h("",!0),t(l,{align:"center",label:"商品条码","min-width":"100"},{default:i(({row:e})=>[p(m(e.barCode),1)]),_:1}),t(l,{align:"center",label:"销售价(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.price),1)]),_:1}),t(l,{align:"center",label:"市场价(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.marketPrice),1)]),_:1}),t(l,{align:"center",label:"成本价(元)","min-width":"80"},{default:i(({row:e})=>[p(m(e.costPrice),1)]),_:1}),t(l,{align:"center",label:"库存","min-width":"80"},{default:i(({row:e})=>[p(m(e.stock),1)]),_:1}),K(a.$slots,"extension")]),_:3},8,["data"])):h("",!0)],64)}}});export{re as _};
