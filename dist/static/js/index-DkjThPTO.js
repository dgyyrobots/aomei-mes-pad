/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:52:22 
 */
import{d as W,r as u,f as h,b as G,g as c,h as L,c as w,o as i,j as e,m as n,a as o,J as z,w as v,v as p,K as H,k as d,F as K,n as O,t as X,L as Y,M as Z,z as ee}from"./index-DMg0mq0e.js";import{_ as te}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DPMk4m5L.js";import{_ as ne}from"./index-B4jjJPyl.js";import{_ as ae}from"./UserForm.vue_vue_type_script_setup_true_lang-DZww46Gr.js";import{b as oe}from"./index-fublNuHh.js";import{a as le,s as se}from"./index-bER2fbWt.js";import{_ as re}from"./main.vue_vue_type_script_setup_true_lang-CrQbzAb1.js";import"./index-CK9h_xGL.js";const be=W({name:"MpUser",__name:"index",setup(ie){const I=ee(),b=u(!0),C=u(0),x=u([]),a=h({pageNo:1,pageSize:10,accountId:-1,openid:"",nickname:""}),S=u(null),V=u([]),M=s=>{a.accountId=s,a.pageNo=1,m()},m=async()=>{try{b.value=!0;const s=await le(a);x.value=s.list,C.value=s.total}finally{b.value=!1}},_=()=>{a.pageNo=1,m()},R=()=>{const s=a.accountId;S.value?.resetFields(),a.accountId=s,_()},F=u(null),q=s=>{F.value?.open(s)},B=async()=>{try{await I.confirm("是否确认同步粉丝？"),await se(a.accountId),I.success("开始从微信公众号同步粉丝信息，同步需要一段时间，建议稍后再查询"),await m()}catch(s){console.log(s)}};return G(async()=>{V.value=await oe()}),(s,t)=>{const D=ne,f=c("el-form-item"),N=c("el-input"),y=H,g=c("el-button"),T=c("el-form"),U=te,r=c("el-table-column"),k=c("el-tag"),Q=c("el-table"),j=Z,P=L("hasPermi"),A=L("loading");return i(),w(K,null,[e(D,{title:"公众号粉丝",url:"https://doc.iocoder.cn/mp/user/"}),e(U,null,{default:n(()=>[e(T,{ref_key:"queryFormRef",ref:S,class:"-mb-15px",inline:!0,"label-width":"68px",model:o(a)},{default:n(()=>[e(f,{label:"公众号",prop:"accountId"},{default:n(()=>[e(o(re),{onChange:M})]),_:1}),e(f,{label:"用户标识",prop:"openid"},{default:n(()=>[e(N,{modelValue:o(a).openid,"onUpdate:modelValue":t[0]||(t[0]=l=>o(a).openid=l),class:"!w-240px",clearable:"",placeholder:"请输入用户标识",onKeyup:z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{label:"昵称",prop:"nickname"},{default:n(()=>[e(N,{modelValue:o(a).nickname,"onUpdate:modelValue":t[1]||(t[1]=l=>o(a).nickname=l),class:"!w-240px",clearable:"",placeholder:"请输入昵称",onKeyup:z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(f,null,{default:n(()=>[e(g,{onClick:_},{default:n(()=>[e(y,{icon:"ep:search"}),t[4]||(t[4]=p(" 搜索 "))]),_:1}),e(g,{onClick:R},{default:n(()=>[e(y,{icon:"ep:refresh"}),t[5]||(t[5]=p(" 重置 "))]),_:1}),v((i(),d(g,{disabled:o(a).accountId===0,plain:"",type:"success",onClick:B},{default:n(()=>[e(y,{class:"mr-5px",icon:"ep:refresh"}),t[6]||(t[6]=p(" 同步 "))]),_:1},8,["disabled"])),[[P,["mp:user:sync"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(U,null,{default:n(()=>[v((i(),d(Q,{data:o(x)},{default:n(()=>[e(r,{align:"center",label:"编号",prop:"id"}),e(r,{align:"center",label:"用户标识",prop:"openid",width:"260"}),e(r,{align:"center",label:"昵称",prop:"nickname"}),e(r,{align:"center",label:"备注",prop:"remark"}),e(r,{align:"center",label:"标签",prop:"tagIds",width:"200"},{default:n(l=>[(i(!0),w(K,null,O(l.row.tagIds,($,E)=>(i(),w("span",{key:E},[e(k,null,{default:n(()=>[p(X(o(V).find(J=>J.tagId===$)?.name),1)]),_:2},1024),t[7]||(t[7]=p("   "))]))),128))]),_:1}),e(r,{align:"center",label:"订阅状态",prop:"subscribeStatus"},{default:n(l=>[l.row.subscribeStatus===0?(i(),d(k,{key:0,type:"success"},{default:n(()=>t[8]||(t[8]=[p("已订阅")])),_:1})):(i(),d(k,{key:1,type:"danger"},{default:n(()=>t[9]||(t[9]=[p("未订阅")])),_:1}))]),_:1}),e(r,{align:"center",formatter:o(Y),label:"订阅时间",prop:"subscribeTime",width:"180"},null,8,["formatter"]),e(r,{align:"center",label:"操作"},{default:n(l=>[v((i(),d(g,{link:"",type:"primary",onClick:$=>q(l.row.id)},{default:n(()=>t[10]||(t[10]=[p("修改")])),_:2},1032,["onClick"])),[[P,["mp:user:update"]]])]),_:1})]),_:1},8,["data"])),[[A,o(b)]]),e(j,{limit:o(a).pageSize,"onUpdate:limit":t[2]||(t[2]=l=>o(a).pageSize=l),page:o(a).pageNo,"onUpdate:page":t[3]||(t[3]=l=>o(a).pageNo=l),total:o(C),onPagination:m},null,8,["limit","page","total"])]),_:1}),e(ae,{ref_key:"formRef",ref:F,onSuccess:m},null,512)],64)}}});export{be as default};
