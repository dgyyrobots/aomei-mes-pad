/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{d as le,az as ae,r as i,b as te,g as d,h as oe,k as h,o as w,_ as ne,a as t,y as I,aG as se,m as n,j as a,v as g,w as ie,J as de,K as ue,i as re,t as me,M as pe,dh as Y}from"./index-lcC3l4R2.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C6z1f3RI.js";import{h as fe,d as ve}from"./tree-vSlcEeQq.js";import{g as _e}from"./category-C1vxv8tw.js";import{d as ge}from"./spu-Cs5jL4YR.js";const Ce=le({name:"SpuTableSelect",__name:"SpuTableSelect",props:{multiple:ae.bool.def(!1)},emits:["change"],setup(T,{expose:B,emit:H}){const U=i(0),f=i([]),C=i(!1),p=i(!1),s=i({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]});B({open:o=>{v.value=[],u.value={},r.value=!1,b.value=!1,o&&o.length>0&&(v.value=[...o],u.value=Object.fromEntries(o.map(e=>[e.id,!0]))),p.value=!0,D()}});const y=async()=>{C.value=!0;try{const o=await ge(s.value);f.value=o.list,U.value=o.total,f.value.forEach(e=>u.value[e.id]=u.value[e.id]||!1),z()}finally{C.value=!1}},N=()=>{s.value.pageNo=1,y()},D=()=>{s.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},y()},r=i(!1),b=i(!1),v=i([]),u=i({}),V=i(),K=o=>{E(Y,o),p.value=!1,V.value=o.id},j=()=>{p.value=!1,E(Y,[...v.value])},E=H,q=o=>{r.value=o,b.value=!1,f.value.forEach(e=>$(o,e,!1))},$=(o,e,S)=>{if(o)v.value.push(e),u.value[e.id]=!0;else{const c=G(e);c>-1&&(v.value.splice(c,1),u.value[e.id]=!1,r.value=!1)}S&&z()},G=o=>v.value.findIndex(e=>e.id===o.id),z=()=>{r.value=f.value.every(o=>u.value[o.id]),b.value=!r.value&&f.value.some(o=>u.value[o.id])},x=i(),P=i();return te(async()=>{await y(),x.value=await _e({}),P.value=fe(x.value,"id","parentId")}),(o,e)=>{const S=d("el-input"),c=d("el-form-item"),O=d("el-tree-select"),Q=d("el-date-picker"),A=ue,k=d("el-button"),R=d("el-form"),M=d("el-checkbox"),_=d("el-table-column"),F=d("el-radio"),J=d("el-image"),L=d("el-table"),W=pe,X=ce,Z=ne,ee=oe("loading");return w(),h(Z,{modelValue:t(p),"onUpdate:modelValue":e[8]||(e[8]=l=>I(p)?p.value=l:null),"append-to-body":!0,title:"选择商品",width:"70%"},se({default:n(()=>[a(X,null,{default:n(()=>[a(R,{ref:"queryFormRef",class:"-mb-15px",inline:!0,"label-width":"68px",model:t(s)},{default:n(()=>[a(c,{label:"商品名称",prop:"name"},{default:n(()=>[a(S,{modelValue:t(s).name,"onUpdate:modelValue":e[0]||(e[0]=l=>t(s).name=l),class:"!w-240px",clearable:"",placeholder:"请输入商品名称",onKeyup:de(N,["enter"])},null,8,["modelValue"])]),_:1}),a(c,{label:"商品分类",prop:"categoryId"},{default:n(()=>[a(O,{modelValue:t(s).categoryId,"onUpdate:modelValue":e[1]||(e[1]=l=>t(s).categoryId=l),"check-strictly":"",class:"!w-240px",data:t(P),"node-key":"id",placeholder:"请选择商品分类",props:t(ve)},null,8,["modelValue","data","props"])]),_:1}),a(c,{label:"创建时间",prop:"createTime"},{default:n(()=>[a(Q,{modelValue:t(s).createTime,"onUpdate:modelValue":e[2]||(e[2]=l=>t(s).createTime=l),class:"!w-240px","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(c,null,{default:n(()=>[a(k,{onClick:N},{default:n(()=>[a(A,{class:"mr-5px",icon:"ep:search"}),e[9]||(e[9]=g(" 搜索 "))]),_:1}),a(k,{onClick:D},{default:n(()=>[a(A,{class:"mr-5px",icon:"ep:refresh"}),e[10]||(e[10]=g(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"]),ie((w(),h(L,{data:t(f),"show-overflow-tooltip":""},{default:n(()=>[T.multiple?(w(),h(_,{key:0,width:"55"},{header:n(()=>[a(M,{modelValue:t(r),"onUpdate:modelValue":e[3]||(e[3]=l=>I(r)?r.value=l:null),indeterminate:t(b),onChange:q},null,8,["modelValue","indeterminate"])]),default:n(({row:l})=>[a(M,{modelValue:t(u)[l.id],"onUpdate:modelValue":m=>t(u)[l.id]=m,onChange:m=>$(m,l,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(w(),h(_,{key:1,label:"#",width:"55"},{default:n(({row:l})=>[a(F,{modelValue:t(V),"onUpdate:modelValue":e[4]||(e[4]=m=>I(V)?V.value=m:null),label:l.id,onChange:m=>K(l)},{default:n(()=>e[11]||(e[11]=[g("   ")])),_:2},1032,["modelValue","label","onChange"])]),_:1})),a(_,{key:"id",align:"center",label:"商品编号","min-width":"60",prop:"id"}),a(_,{label:"商品图","min-width":"80"},{default:n(({row:l})=>[a(J,{class:"h-30px w-30px","preview-src-list":[l.picUrl],"preview-teleported":"",src:l.picUrl},null,8,["preview-src-list","src"])]),_:1}),a(_,{label:"商品名称","min-width":"200",prop:"name"}),a(_,{label:"商品分类","min-width":"100",prop:"categoryId"},{default:n(({row:l})=>[re("span",null,me(t(x)?.find(m=>m.id===l.categoryId)?.name),1)]),_:1})]),_:1},8,["data"])),[[ee,t(C)]]),a(W,{limit:t(s).pageSize,"onUpdate:limit":e[5]||(e[5]=l=>t(s).pageSize=l),page:t(s).pageNo,"onUpdate:page":e[6]||(e[6]=l=>t(s).pageNo=l),total:t(U),onPagination:y},null,8,["limit","page","total"])]),_:1})]),_:2},[T.multiple?{name:"footer",fn:n(()=>[a(k,{type:"primary",onClick:j},{default:n(()=>e[12]||(e[12]=[g("确 定")])),_:1}),a(k,{onClick:e[7]||(e[7]=l=>p.value=!1)},{default:n(()=>e[13]||(e[13]=[g("取 消")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}}});export{Ce as _};
