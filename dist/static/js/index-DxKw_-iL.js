/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{V as g,d as ce,W as _e,O as me,r as n,f as k,b as Te,g as s,h as A,c as fe,o as c,w as f,j as o,$ as B,m as t,J as ve,a as y,D as De,v as _,a0 as Oe,k as v,a1 as Pe,i as M,t as ge,x as Ne,M as ye,l as F,Z as E,T as $}from"./index-BdmDrM2Y.js";import Ee from"./line-JslclvxX.js";import{c as Re}from"./index-DCe4u-nz.js";import"./CLodopfuncs2-DO7GswBP.js";import"./DictTag.vue_vue_type_script_lang-bjcRCBWf.js";import"./color-B5phLuB-.js";import"./dict-Cm-9nniQ.js";import"./index-C_Up_io0.js";const Se=u=>g.post({url:"/purchase/order/create",data:u}),Ie=u=>g.put({url:"/purchase/order/update",data:u}),we=u=>g.delete({url:`/purchase/order/delete?id=${u}`}),Le=u=>g.get({url:`/purchase/order/get?id=${u}`}),be=u=>g.get({url:"/purchase/order/page",params:u}),he={class:"app-container"},ke={class:"dialog-footer"},Be=ce({__name:"index",setup(u){const j=_e(),p=me(()=>j.getBreadcrumb),R=n(!0);n(!1);const S=n(!0),I=n(0),z=n([]),C=n(""),V=n(!0),G=n(!0),P=n(!1),X=n(""),x=n(),N=n(),H=n(),i=k({pageNo:1,pageSize:10,supplierId:null,supplierContact:null,supplierPhone:null,purchaseAmount:null,poNo:null,paymentType:null,returnGoods:null,processType:null,remarks:null,createTime:[]}),r=k({supplierId:void 0,supplierContact:void 0,supplierPhone:void 0,purchaseAmount:void 0,id:void 0,poNo:void 0,paymentType:void 0,returnGoods:void 0,processType:void 0,remarks:void 0}),Q=k({}),D=async()=>{R.value=!0;try{const l=await be(i);z.value=l.list,I.value=l.total}finally{R.value=!1}},w=()=>{i.pageNo=1,D()},W=()=>{x.value?.resetFields(),w()},q=()=>{P.value=!1,Y()},Y=()=>{Object.assign(r,{supplierId:void 0,supplierContact:void 0,supplierPhone:void 0,purchaseAmount:void 0,id:void 0,poNo:void 0,paymentType:void 0,returnGoods:void 0,processType:void 0,remarks:void 0}),N.value?.resetFields()},J=async l=>{Y();const e=l.id;try{const d=await Le(e);Object.assign(r,d),P.value=!0,C.value="修改采购订单",X.value="edit"}catch(d){console.error("获取数据失败:",d)}},K=async()=>{if(N.value)try{await N.value.validate(),r.id!=null?(await Ie(r),E.success("修改成功")):(await Se(r),E.success("新增成功")),P.value=!1,D()}catch(l){console.error("提交失败:",l)}},Z=async l=>{const e=l.id;try{await $.confirm('是否确认删除采购订单编号为"'+e+'"的数据项?'),await we(e),D(),E.success("删除成功")}catch(d){console.error("删除失败:",d)}},ee=l=>{selectedRows.value=l,V.value=l.length!==1,G.value=!l.length},oe=async()=>{try{const l=await Re(selectedRows.value[0].poNo);if(!l){E.error("采购单: "+selectedRows.value[0].poNo+"存在未配置单位与收货数量的明细信息，请先配置后打印！");return}if(!Array.isArray(l.data)){console.error("结果不是一个数组: ",l);return}await $.confirm("确认打印？"),console.log("开始循环: "+l),LODOP.PRINT_INITA(0,0,150,100),LODOP.SET_PRINT_PAGESIZE(2,"","","热敏纸");for(const e of l.data){console.log("数据解析: ",e),LODOP.NEWPAGE(),LODOP.ADD_PRINT_RECT(8,5,150*3.71-10,100*3.71-10,0,1),LODOP.SET_PRINT_STYLE("FontSize",18),LODOP.SET_PRINT_STYLE("FontName","Microsoft YaHei"),LODOP.SET_PRINT_STYLE("Bold",1),LODOP.SET_PRINT_STYLE("Horient",2),LODOP.ADD_PRINT_TEXT(13,0,150,30,"入库单标签"),LODOP.SET_PRINT_STYLE("FontSize",14),LODOP.SET_PRINT_STYLE("Bold",0),LODOP.SET_PRINT_STYLE("Horient",0),LODOP.ADD_PRINT_TEXT(65,15,120,35,"条码编号:"),LODOP.ADD_PRINT_TEXT(65,120,280,35,e.id),LODOP.ADD_PRINT_TEXT(110,15,120,35,"采购料号:"),LODOP.ADD_PRINT_TEXT(110,120,280,35,e.goodsNumber),LODOP.ADD_PRINT_TEXT(155,15,120,35,"物料名称:"),LODOP.ADD_PRINT_TEXT(155,120,280,35,e.goodsName+e.goodsSpecs),LODOP.ADD_PRINT_TEXT(200,15,120,35,"采购单号:"),LODOP.ADD_PRINT_TEXT(200,120,280,35,e.poNo),LODOP.ADD_PRINT_TEXT(245,15,120,35,"收货数量:"),LODOP.ADD_PRINT_TEXT(245,120,280,35,e.receiveNum),LODOP.ADD_PRINT_TEXT(290,15,120,35,"收货单位:"),LODOP.ADD_PRINT_TEXT(290,120,280,35,e.unitOfMeasure),LODOP.ADD_PRINT_TEXT(335,15,120,35,"收货日期:");const d=new Date(e.receiveTime).toISOString().slice(0,19).replace("T"," ");LODOP.ADD_PRINT_TEXT(335,120,280,35,d);const m={id:e.id,type:"purchase",po_no:e.poNo};LODOP.ADD_PRINT_BARCODE(220,390,170,170,"QRCode",JSON.stringify(m))}LODOP.SET_PRINT_MODE("AUTO_CLOSE_PREWINDOW",1),LODOP.PREVIEW(),await batchUpdateStatus(selectedRows.value[0].poNo)}catch(l){console.error("打印失败:",l)}};return Te(()=>{D()}),(l,e)=>{const d=s("el-input"),m=s("el-form-item"),te=s("el-date-picker"),T=s("el-button"),U=s("el-form"),L=s("el-col"),le=s("right-toolbar"),b=s("el-row"),O=s("el-table-column"),ae=s("el-table"),re=ye,ne=s("el-divider"),se=s("el-card"),ie=s("el-dialog"),h=A("hasPermi"),de=A("loading"),ue=A("dialogDrag");return c(),fe("div",he,[f(o(U,{model:i,ref_key:"queryFormRef",ref:x,size:p.value,inline:!0},{default:t(()=>[o(m,{label:"采购单号",prop:"poNo"},{default:t(()=>[o(d,{modelValue:i.poNo,"onUpdate:modelValue":e[0]||(e[0]=a=>i.poNo=a),placeholder:"请输入采购单号",clearable:"",onKeyup:ve(w,["enter"])},null,8,["modelValue"])]),_:1}),o(m,{label:"创建时间",prop:"createTime"},{default:t(()=>[o(te,{modelValue:i.createTime,"onUpdate:modelValue":e[1]||(e[1]=a=>i.createTime=a),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),o(m,null,{default:t(()=>[o(T,{type:"primary",icon:y(De),onClick:w},{default:t(()=>e[8]||(e[8]=[_("搜索")])),_:1},8,["icon"]),o(T,{icon:y(Oe),onClick:W},{default:t(()=>e[9]||(e[9]=[_("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[B,S.value]]),o(b,{gutter:10,class:"mb8"},{default:t(()=>[o(L,{span:1.5},{default:t(()=>[f((c(),v(T,{type:"primary",plain:"",icon:y(Pe),size:p.value,disabled:V.value,onClick:oe},{default:t(()=>e[10]||(e[10]=[_("单据打印")])),_:1},8,["icon","size","disabled"])),[[h,["purchase:goods:print"]]])]),_:1}),o(le,{showSearch:S.value,"onUpdate:showSearch":e[2]||(e[2]=a=>S.value=a),onQueryTable:D},null,8,["showSearch"])]),_:1}),f((c(),v(ae,{size:p.value,data:z.value,onSelectionChange:ee},{default:t(()=>[o(O,{type:"selection",width:"55",align:"center"}),o(O,{label:"ID",align:"center",prop:"id"}),o(O,{label:"采购单号",align:"center",prop:"poNo"}),o(O,{label:"备注",align:"center",prop:"remarks"}),o(O,{label:"创建时间",align:"center",prop:"createTime",width:"180"},{default:t(a=>[M("span",null,ge(y(Ne)(a.row.createTime)),1)]),_:1}),o(O,{fixed:"right",label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:t(a=>[f((c(),v(T,{size:p.value,type:"text",onClick:pe=>J(a.row)},{default:t(()=>e[11]||(e[11]=[_("修改")])),_:2},1032,["size","onClick"])),[[h,["purchase:order:update"]]]),f((c(),v(T,{size:p.value,type:"text",onClick:pe=>Z(a.row)},{default:t(()=>e[12]||(e[12]=[_("删除")])),_:2},1032,["size","onClick"])),[[h,["purchase:order:delete"]]])]),_:1})]),_:1},8,["size","data"])),[[de,R.value]]),f(o(re,{size:"currentSize",total:I.value,page:i.pageNo,"onUpdate:page":e[3]||(e[3]=a=>i.pageNo=a),limit:i.pageSize,"onUpdate:limit":e[4]||(e[4]=a=>i.pageSize=a),onPagination:D},null,8,["total","page","limit"]),[[B,I.value>0]]),f((c(),v(ie,{title:C.value,modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=a=>P.value=a),width:"90%","append-to-body":""},{footer:t(()=>[M("div",ke,[o(T,{size:p.value,type:"primary",onClick:K},{default:t(()=>e[14]||(e[14]=[_("确 定")])),_:1},8,["size"]),o(T,{size:p.value,onClick:q},{default:t(()=>e[15]||(e[15]=[_("取 消")])),_:1},8,["size"])])]),default:t(()=>[o(U,{ref_key:"formRef",ref:N,model:r,rules:Q,size:p.value},{default:t(()=>[o(b,{gutter:20},{default:t(()=>[o(L,{span:12},{default:t(()=>[o(m,{label:"采购单号",prop:"poNo"},{default:t(()=>[o(d,{disabled:"",modelValue:r.poNo,"onUpdate:modelValue":e[5]||(e[5]=a=>r.poNo=a),placeholder:"请输入采购单号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(b,{gutter:20},{default:t(()=>[o(L,{span:24},{default:t(()=>[o(m,{label:"备注",prop:"remarks"},{default:t(()=>[o(d,{modelValue:r.remarks,"onUpdate:modelValue":e[6]||(e[6]=a=>r.remarks=a),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","size"]),r.id!=null?(c(),v(ne,{key:0,"content-position":"center"},{default:t(()=>e[13]||(e[13]=[_("采购明细")])),_:1})):F("",!0),r.id!=null?(c(),v(se,{key:1,shadow:"always",class:"box-card"},{default:t(()=>[o(Ee,{ref_key:"lineRef",ref:H,purchaseId:r.id,optType:X.value},null,8,["purchaseId","optType"])]),_:1})):F("",!0)]),_:1},8,["title","modelValue"])),[[ue]])])}}});export{Be as default};
