/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:52:22 
 */
import{_ as Ol}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DPMk4m5L.js";import{V as H,d as Ye,r,f as _e,b as Oe,g as s,h as Ce,k as h,o as f,m as l,w as S,j as e,J as Z,c as he,F as ze,n as xe,a as N,D as ge,v,a0 as Ee,$ as fe,t as we,M as Ue,i as J,a6 as je,A as qe,l as me,W as Vl,O as Fe,x as Je,X as Ae,R as El,Y as Ll,Z as j,E as $e,G as Wl,a7 as hl,a4 as Ml,a8 as Kl,T as He,a5 as Bl}from"./index-DMg0mq0e.js";import{_ as Sl}from"./DictTag.vue_vue_type_script_lang-sQcOd7JH.js";import{D as Te}from"./dict-BEquckDR.js";import{k as Ql}from"./index-B7Jy2Kg4.js";import"./color-B5phLuB-.js";const $l=async d=>await H.get({url:"/mes/pro/task/page",params:d}),zl=async()=>await H.get({url:"/mes/pro/cess/list-all-simple"}),Hl=async d=>await H.get({url:"/mes/md-workstation/page",params:d}),Yl=async()=>await H.get({url:"/mes/md-workshop/list-all-simple"}),jl={class:"dialog-footer"},Jl=Ye({name:"WorkstationSelect",__name:"simpletableSingle",props:{processId:{}},emits:["onSelected"],setup(d,{expose:c,emit:G}){const g=d,w=r(!1),U=r(!0),t=r(),V=r([]);r(!0),r(!0);const X=r(!0),ae=r(0),re=r([]),q=r([]),W=r([]),M=r(),C=_e({pageNo:1,pageSize:10,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:g.processId,processCode:null,processName:null,enableFlag:null});_e({workstationId:null,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:null,processCode:null,processName:null,enableFlag:"Y",remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null});const P=async()=>{U.value=!0;try{const E=await Hl(C);re.value=E.list,ae.value=E.total}finally{U.value=!1}},se=async()=>{const E=await Yl();q.value=E},T=async()=>{const E=await zl();W.value=E},b=()=>{C.pageNo=1,P()},de=()=>{M.value?.resetFields(),b()},L=E=>{E&&(V.value=E)},k=E=>{E&&(V.value=E)},I=E=>{E&&(V.value=E,ie("onSelected",V.value),w.value=!1)},ee=()=>{if(!t.value){je({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}ie("onSelected",V.value),w.value=!1},ie=G;return Oe(()=>{P(),se(),T()}),c({showFlag:w}),(E,_)=>{const K=s("el-input"),ue=s("el-form-item"),oe=s("el-col"),le=s("el-option"),O=s("el-select"),y=s("el-button"),p=s("el-row"),i=s("el-form"),B=s("el-radio"),Q=s("el-table-column"),te=s("el-table"),A=s("el-dialog"),ne=Ce("loading");return f(),h(A,{title:"工作站选择",modelValue:w.value,"onUpdate:modelValue":_[7]||(_[7]=R=>w.value=R),modal:!1,width:"80%",center:""},{footer:l(()=>[J("div",jl,[e(y,{type:"primary",onClick:ee},{default:l(()=>_[11]||(_[11]=[v("确 定")])),_:1}),e(y,{onClick:_[6]||(_[6]=R=>w.value=!1)},{default:l(()=>_[12]||(_[12]=[v("取 消")])),_:1})])]),default:l(()=>[S(e(i,{model:C,ref_key:"queryFormRef",ref:M,size:"small",inline:!0,"label-width":"90px"},{default:l(()=>[e(p,null,{default:l(()=>[e(oe,{span:7},{default:l(()=>[e(ue,{label:"工作站编号",prop:"workstationCode"},{default:l(()=>[e(K,{modelValue:C.workstationCode,"onUpdate:modelValue":_[0]||(_[0]=R=>C.workstationCode=R),placeholder:"请输入工作站编号",clearable:"",onKeyup:Z(b,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(oe,{span:7},{default:l(()=>[e(ue,{label:"所属工序",prop:"processName"},{default:l(()=>[e(O,{modelValue:C.processId,"onUpdate:modelValue":_[1]||(_[1]=R=>C.processId=R),placeholder:"请选择工序"},{default:l(()=>[(f(!0),he(ze,null,xe(W.value,R=>(f(),h(le,{key:R.id,label:R.name,value:R.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(oe,{span:7},{default:l(()=>[e(ue,{label:"所在车间",prop:"workshopName"},{default:l(()=>[e(O,{modelValue:C.workshopId,"onUpdate:modelValue":_[2]||(_[2]=R=>C.workshopId=R),placeholder:"请选择车间"},{default:l(()=>[(f(!0),he(ze,null,xe(q.value,R=>(f(),h(le,{key:R.id,label:R.name,value:R.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(oe,{span:3},{default:l(()=>[e(ue,null,{default:l(()=>[e(y,{type:"primary",icon:N(ge),size:"small",onClick:b},{default:l(()=>_[8]||(_[8]=[v("搜索")])),_:1},8,["icon"]),e(y,{icon:N(Ee),size:"small",onClick:de},{default:l(()=>_[9]||(_[9]=[v("重置")])),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(oe,{span:24})]),_:1})]),_:1},8,["model"]),[[fe,X.value]]),S((f(),h(te,{data:re.value,onCurrentChange:L,onRowDblclick:I},{default:l(()=>[e(Q,{width:"55",align:"center"},{default:l(R=>[e(B,{modelValue:t.value,"onUpdate:modelValue":_[3]||(_[3]=ve=>t.value=ve),label:R.row.id,onChange:ve=>k(R.row)},{default:l(()=>_[10]||(_[10]=[v(we(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(Q,{label:"工作站编号",align:"center",prop:"workstationCode"}),e(Q,{label:"工作站名称",align:"center",prop:"workstationName"}),e(Q,{label:"工作站地点",align:"center",prop:"workstationAddress"}),e(Q,{label:"所在车间名称",align:"center",prop:"workshopName"}),e(Q,{label:"所属工序",align:"center",prop:"processName"}),e(Q,{label:"备注",align:"center",prop:"remark"})]),_:1},8,["data"])),[[ne,U.value]]),S(e(Ue,{total:ae.value,page:C.pageNo,"onUpdate:page":_[4]||(_[4]=R=>C.pageNo=R),limit:C.pageSize,"onUpdate:limit":_[5]||(_[5]=R=>C.pageSize=R),onPagination:P},null,8,["total","page","limit"]),[[fe,ae.value>0]])]),_:1},8,["modelValue"])}}}),Gl=qe(Jl,[["__scopeId","data-v-848b7f87"]]),Xl={name:"ProtaskSelect",components:{WorkstationSelect:Gl},props:{workorderId:null,workorderCode:null,processId:null,processCode:null,workstationId:null,workstationCode:null},watch:{workorderId(d){this.queryParams.workorderId=d}},data(){return{showFlag:!1,selectedTaskId:void 0,selectedRow:void 0,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,protaskList:[],title:"",open:!1,queryParams:{pageNo:1,pageSize:10,taskCode:null,taskName:null,workorderId:this.workorderId,workorderCode:null,workorderName:null,workstationId:null,workstationCode:null,workstationName:null,processId:this.processId,processCode:null,processName:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,clientId:null,clientCode:null,clientName:null,clientNick:null,startTime:null,duration:null,endTime:null,colorCode:null,requestDate:null},form:{},rules:{workstationId:[{required:!0,message:"工作站不能为空",trigger:"blur"}],quantity:[{required:!0,message:"排产数量不能为空",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始生产日期",trigger:"blur"}],duration:[{required:!0,message:"清输入估算的生产用时",trigger:"blur"}]}}},created(){this.getList(),this.getProcess()},methods:{getList(){this.loading=!0,$l(this.queryParams).then(d=>{this.protaskList=d.list,this.total=d.total,this.loading=!1})},getProcess(){zl().then(d=>{this.processOptions=d})},handleQuery(){this.queryParams.pageNo=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleCurrent(d){d&&(this.selectedRow=d)},handleRowDbClick(d){d&&(this.selectedRow=d,this.$emit("onSelected",this.selectedRow),this.showFlag=!1)},handleRowChange(d){d&&(this.selectedRow=d)},confirmSelect(){if(this.selectedTaskId==null||this.selectedTaskId==0){this.$notify({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}this.$emit("onSelected",this.selectedRow),this.showFlag=!1}}},Zl={"slot-scope":"scope"},ea={"slot-scope":"scope"},la={"slot-scope":"scope"},aa={"slot-scope":"scope"},oa={slot:"footer",class:"dialog-footer"};function ta(d,c,G,g,w,U){const t=s("el-option"),V=s("el-select"),X=s("el-form-item"),ae=s("el-col"),re=s("el-input"),q=s("el-row"),W=s("el-button"),M=s("el-form"),C=s("el-radio"),P=s("el-table-column"),se=s("el-color-picker"),T=s("el-table"),b=Ue,de=s("el-dialog"),L=Ce("hasPermi"),k=Ce("loading");return w.showFlag?(f(),h(de,{key:0,title:"生产任务选择",visible:w.showFlag,modal:!1,width:"80%",center:""},{default:l(()=>[S(e(M,{model:w.queryParams,ref:"queryForm",size:"small",inline:!0,"label-width":"100px"},{default:l(()=>[e(q,null,{default:l(()=>[e(ae,{span:8},{default:l(()=>[e(X,{label:"所属工序",prop:"processName"},{default:l(()=>[e(V,{modelValue:w.queryParams.processId,"onUpdate:modelValue":c[0]||(c[0]=I=>w.queryParams.processId=I),placeholder:"请选择工序"},{default:l(()=>[(f(!0),he(ze,null,xe(d.processOptions,I=>(f(),h(t,{key:I.processId,label:I.processName,value:I.processId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ae,{span:8},{default:l(()=>[e(X,{label:"所属工作站",prop:"workstationCode"},{default:l(()=>[e(re,{modelValue:w.queryParams.workstationCode,"onUpdate:modelValue":c[1]||(c[1]=I=>w.queryParams.workstationCode=I),placeholder:"请输入工作站编号",clearable:"",onKeyup:Z(U.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(ae,{span:8},{default:l(()=>[e(X,{label:"任务编号",prop:"taskCode"},{default:l(()=>[e(re,{modelValue:w.queryParams.taskCode,"onUpdate:modelValue":c[2]||(c[2]=I=>w.queryParams.taskCode=I),placeholder:"请输入生产任务编号",clearable:"",onKeyup:Z(U.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1}),e(q,null,{default:l(()=>[e(ae,{span:8},{default:l(()=>[e(X,null,{default:l(()=>[e(W,{type:"primary",icon:"el-icon-search",size:"mini",onClick:U.handleQuery},{default:l(()=>c[8]||(c[8]=[v("搜索")])),_:1},8,["onClick"]),e(W,{icon:"el-icon-refresh",size:"mini",onClick:U.resetQuery},{default:l(()=>c[9]||(c[9]=[v("重置")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),[[fe,w.showSearch]]),S((f(),h(T,{data:w.protaskList,onCurrentChange:U.handleCurrent,onRowDblclick:U.handleRowDbClick},{default:l(()=>[e(P,{width:"55",align:"center"},{default:l(I=>[e(C,{modelValue:w.selectedTaskId,"onUpdate:modelValue":c[3]||(c[3]=ee=>w.selectedTaskId=ee),label:I.row.id,onChange:ee=>U.handleRowChange(I.row)},{default:l(()=>c[10]||(c[10]=[v(we(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(P,{label:"任务编号",align:"center",width:"100px",prop:"taskCode","show-overflow-tooltip":!0}),e(P,{label:"任务名称",align:"center",width:"120px",prop:"taskName","show-overflow-tooltip":!0}),e(P,{label:"工作站编号",align:"center",width:"150px",prop:"workstationCode","show-overflow-tooltip":!0}),e(P,{label:"工作站名称",align:"center",width:"150px",prop:"workstationName","show-overflow-tooltip":!0}),e(P,{label:"排产数量",align:"center",prop:"quantity"}),e(P,{label:"已生产数量",align:"center",width:"100px",prop:"quantityProduced"}),e(P,{label:"开始生产时间",align:"center",prop:"startTime",width:"180"},{default:l(()=>[J("template",Zl,[J("span",null,we(d.parseTime(d.scope.row.startTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(P,{label:"生产时长",align:"center",prop:"duration"}),e(P,{label:"预计完成时间",align:"center",prop:"endTime",width:"180"},{default:l(()=>[J("template",ea,[J("span",null,we(d.parseTime(d.scope.row.endTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(P,{label:"显示颜色",align:"center",prop:"colorCode"},{default:l(()=>[J("template",la,[e(se,{modelValue:d.scope.row.colorCode,"onUpdate:modelValue":c[4]||(c[4]=I=>d.scope.row.colorCode=I),disabled:""},null,8,["modelValue"])])]),_:1}),e(P,{label:"操作",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:l(()=>[J("template",aa,[S((f(),h(W,{size:"mini",type:"text",icon:"el-icon-edit",onClick:c[5]||(c[5]=I=>d.handleUpdate(d.scope.row))},{default:l(()=>c[11]||(c[11]=[v("修改")])),_:1})),[[L,["pro:protask:edit"]]]),S((f(),h(W,{size:"mini",type:"text",icon:"el-icon-delete",onClick:c[6]||(c[6]=I=>d.handleDelete(d.scope.row))},{default:l(()=>c[12]||(c[12]=[v("删除")])),_:1})),[[L,["pro:protask:remove"]]])])]),_:1})]),_:1},8,["data","onCurrentChange","onRowDblclick"])),[[k,w.loading]]),S(e(b,{total:w.total,page:w.queryParams.pageNo,limit:w.queryParams.pageSize,onPagination:U.getList},null,8,["total","page","limit","onPagination"]),[[fe,w.total>0]]),J("div",oa,[e(W,{type:"primary",onClick:U.confirmSelect},{default:l(()=>c[13]||(c[13]=[v("确 定")])),_:1},8,["onClick"]),e(W,{onClick:c[7]||(c[7]=I=>w.showFlag=!1)},{default:l(()=>c[14]||(c[14]=[v("取 消")])),_:1})])]),_:1},8,["visible"])):me("",!0)}const Il=qe(Xl,[["render",ta]]),na=async d=>await H.get({url:"/mes/wms/material-stock/page",params:d}),ra=async()=>await H.get({url:"/mes/md-item-type/treeselect"}),xl=async()=>await H.get({url:"/wms/warehouse/getTreeList"}).then(d=>(d.data=(d.data||[]).map(c=>(c.children&&(c.children=c.children.map(G=>(G.children&&(G.children=G.children.map(g=>({...g,pId:g.id,pName:g.areaName,lId:g.locationId,areaId:g.id}))),{...G,wId:G.warehouseId,pId:G.id,pName:G.locationName,locationId:G.id}))),{...c,wId:c.id,pId:c.id,pName:c.warehouseName,warehouseId:c.id})),d)),da={class:"head-container"},ua={class:"head-container"},sa={class:"dialog-footer"},ia=Ye({name:"WmstockMultiSelect",__name:"multi",emits:["onSelected"],setup(d,{expose:c,emit:G}){const g=Vl(),w=Fe(()=>g.currentSize==="mini"?"small":g.currentSize),U=r(!1),t=r(!0),V=r([]),X=r([]),ae=r(!0),re=r(!0),q=r(!0),W=r(0),M=r([]),C=r([]),P=r(),se=r(),T=r(),b=_e({pageNo:1,pageSize:10,itemTypeId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,vendorId:null,vendorCode:null,vendorName:null,vendorNick:null,quantityOnhand:null,expireDate:null,warehouse:null}),de={children:"children",label:"label"},L=r([]),k={multiple:!1,value:"pId",label:"pName"},I=async()=>{t.value=!0;try{const p=await na(b);C.value=p.list,W.value=p.total}finally{t.value=!1}},ee=async()=>{const p=await ra();M.value=p},ie=(p,i)=>p?i.label.indexOf(p)!==-1:!0,E=p=>{b.itemTypeId=p.id,_()},_=()=>{b.pageNo=1,I()},K=()=>{T.value?.resetFields(),_()},ue=p=>{V.value=p.map(i=>i.materialStockId),ae.value=p.length!==1,re.value=!p.length,X.value=p},oe=()=>{if(!X.value.length){je({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}y("onSelected",X.value),U.value=!1},le=async()=>{const p=await xl();L.value=p,L.value.map(i=>{i.pId=i.id,i.pName=i.warehouseName,i.children.map(Q=>{let te=JSON.stringify(Q.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");Q.children=JSON.parse(te)});let B=JSON.stringify(i.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");i.children=JSON.parse(B)})},O=p=>{p&&(b.warehouseId=p[0],b.locationId=p[1],b.areaId=p[2])},y=G;return Oe(()=>{I(),ee(),le()}),c({showFlag:U}),(p,i)=>{const B=s("el-input"),Q=s("el-tree"),te=s("el-col"),A=s("el-form-item"),ne=s("el-cascader"),R=s("el-date-picker"),ve=s("el-button"),De=s("el-form"),Le=s("right-toolbar"),Re=s("el-row"),Y=s("el-table-column"),pe=s("el-table"),We=s("el-dialog"),Ie=Ce("loading");return f(),h(We,{title:"物料选择",modelValue:U.value,"onUpdate:modelValue":i[12]||(i[12]=z=>U.value=z),modal:!1,width:"92%",center:""},{footer:l(()=>[J("div",sa,[e(ve,{size:N(w),type:"primary",onClick:oe},{default:l(()=>i[15]||(i[15]=[v("确 定")])),_:1},8,["size"]),e(ve,{size:N(w),onClick:i[11]||(i[11]=z=>U.value=!1)},{default:l(()=>i[16]||(i[16]=[v("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(Re,{gutter:14},{default:l(()=>[e(te,{span:4,xs:24},{default:l(()=>[J("div",da,[e(B,{modelValue:P.value,"onUpdate:modelValue":i[0]||(i[0]=z=>P.value=z),placeholder:"请输入分类名称",clearable:"",":size":N(w),"prefix-icon":N(ge),style:{"margin-bottom":"20px"}},null,8,["modelValue",":size","prefix-icon"])]),J("div",ua,[e(Q,{data:M.value,props:de,"expand-on-click-node":!1,"filter-node-method":ie,ref_key:"treeRef",ref:se,"default-expand-all":"",onNodeClick:E},null,8,["data"])])]),_:1}),e(te,{span:20,xs:24},{default:l(()=>[S(e(De,{model:b,ref_key:"queryFormRef",ref:T,":size":N(w),inline:!0},{default:l(()=>[e(A,{label:"产品物料编码",prop:"itemCode"},{default:l(()=>[e(B,{modelValue:b.itemCode,"onUpdate:modelValue":i[1]||(i[1]=z=>b.itemCode=z),placeholder:"请输入产品物料编码",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"产品物料名称",prop:"itemName"},{default:l(()=>[e(B,{modelValue:b.itemName,"onUpdate:modelValue":i[2]||(i[2]=z=>b.itemName=z),placeholder:"请输入产品物料名称",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"入库批次号",prop:"batchCode"},{default:l(()=>[e(B,{modelValue:b.batchCode,"onUpdate:modelValue":i[3]||(i[3]=z=>b.batchCode=z),placeholder:"请输入入库批次号",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"仓库信息",prop:"warehouse"},{default:l(()=>[e(ne,{modelValue:b.warehouse,"onUpdate:modelValue":i[4]||(i[4]=z=>b.warehouse=z),options:L.value,props:k,onChange:O},null,8,["modelValue","options"])]),_:1}),e(A,{label:"供应商编号",prop:"vendorCode"},{default:l(()=>[e(B,{modelValue:b.vendorCode,"onUpdate:modelValue":i[5]||(i[5]=z=>b.vendorCode=z),placeholder:"请输入供应商编号",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[e(B,{modelValue:b.vendorName,"onUpdate:modelValue":i[6]||(i[6]=z=>b.vendorName=z),placeholder:"请输入供应商名称",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"库存有效期",prop:"expireDate"},{default:l(()=>[e(R,{clearable:"",modelValue:b.expireDate,"onUpdate:modelValue":i[7]||(i[7]=z=>b.expireDate=z),type:"date","value-format":"timestamp",placeholder:"请选择库存有效期"},null,8,["modelValue"])]),_:1}),e(A,null,{default:l(()=>[e(ve,{type:"primary",icon:N(ge),":size":N(w),onClick:_},{default:l(()=>i[13]||(i[13]=[v("搜索")])),_:1},8,["icon",":size"]),e(ve,{icon:N(Ee),":size":N(w),onClick:K},{default:l(()=>i[14]||(i[14]=[v("重置")])),_:1},8,["icon",":size"])]),_:1})]),_:1},8,["model",":size"]),[[fe,q.value]]),e(Re,{gutter:10,class:"mb8"},{default:l(()=>[e(Le,{showSearch:q.value,"onUpdate:showSearch":i[8]||(i[8]=z=>q.value=z),onQueryTable:I},null,8,["showSearch"])]),_:1}),S((f(),h(pe,{size:N(w),data:C.value,onSelectionChange:ue},{default:l(()=>[e(Y,{type:"selection",width:"55",align:"center"}),e(Y,{label:"产品物料编码",width:"120px",align:"center",prop:"itemCode"}),e(Y,{label:"产品物料名称",width:"150px",align:"center",prop:"itemName","show-overflow-tooltip":!0}),e(Y,{label:"规格型号",align:"center",prop:"specification","show-overflow-tooltip":!0}),e(Y,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(Y,{label:"入库批次号",width:"100px",align:"center",prop:"batchCode","show-overflow-tooltip":!0}),e(Y,{label:"仓库",align:"center",prop:"warehouseName"}),e(Y,{label:"库区",align:"center",prop:"locationName"}),e(Y,{label:"库位",align:"center",prop:"areaName"}),e(Y,{label:"供应商编号",width:"100px",align:"center",prop:"vendorCode"}),e(Y,{label:"供应商名称",width:"120px",align:"center",prop:"vendorName","show-overflow-tooltip":!0}),e(Y,{label:"供应商简称",width:"100px",align:"center",prop:"vendorNick"}),e(Y,{label:"在库数量",align:"center",prop:"quantityOnhand"}),e(Y,{label:"库存有效期",align:"center",prop:"expireDate",width:"180"},{default:l(z=>[J("span",null,we(N(Je)(z.row.expireDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["size","data"])),[[Ie,t.value]]),S(e(Ue,{total:W.value,page:b.pageNo,"onUpdate:page":i[9]||(i[9]=z=>b.pageNo=z),limit:b.pageSize,"onUpdate:limit":i[10]||(i[10]=z=>b.pageSize=z),onPagination:I},null,8,["total","page","limit"]),[[fe,W.value>0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),pa=qe(ia,[["__scopeId","data-v-82c195e3"]]),ca=async d=>await H.get({url:"/mes/pro/workorder/page",params:d}),ma={class:"dialog-footer"},fa=Ye({name:"WorkOrderSelectSingle",__name:"single",emits:["onSelected"],setup(d,{expose:c,emit:G}){const g=r(!1),w=r(!0),U=r(),t=r([]);r(!0),r(!0);const V=r(!0),X=r(0),ae=r([]),re=r(),q=_e({pageNo:1,pageSize:10,workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:"CONFIRMED"}),W=async()=>{w.value=!0;try{const L=await ca(q);ae.value=L.list,X.value=L.total}finally{w.value=!1}},M=()=>{W()},C=()=>{re.value?.resetFields(),M()},P=L=>{L&&(t.value=L)},se=L=>{L&&(t.value=L)},T=L=>{L&&(t.value=L,de("onSelected",t.value),g.value=!1)},b=()=>{if(!U.value){je({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}de("onSelected",t.value),g.value=!1},de=G;return Oe(()=>{W()}),c({showFlag:g}),(L,k)=>{const I=s("el-input"),ee=s("el-form-item"),ie=s("el-button"),E=s("el-form"),_=s("el-radio"),K=s("el-table-column"),ue=Sl,oe=s("el-table"),le=s("el-dialog"),O=Ce("loading");return f(),h(le,{title:"工单选择",modelValue:g.value,"onUpdate:modelValue":k[9]||(k[9]=y=>g.value=y),modal:!1,width:"80%",center:""},{footer:l(()=>[J("div",ma,[e(ie,{type:"primary",onClick:b},{default:l(()=>k[13]||(k[13]=[v("确 定")])),_:1}),e(ie,{onClick:k[8]||(k[8]=y=>g.value=!1)},{default:l(()=>k[14]||(k[14]=[v("取 消")])),_:1})])]),default:l(()=>[S(e(E,{model:q,ref_key:"queryFormRef",ref:re,size:"small",inline:!0,"label-width":"68px"},{default:l(()=>[e(ee,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(I,{modelValue:q.workorderCode,"onUpdate:modelValue":k[0]||(k[0]=y=>q.workorderCode=y),placeholder:"请输入工单编码",clearable:"",onKeyup:Z(M,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"工单名称",prop:"workorderName"},{default:l(()=>[e(I,{modelValue:q.workorderName,"onUpdate:modelValue":k[1]||(k[1]=y=>q.workorderName=y),placeholder:"请输入工单名称",clearable:"",onKeyup:Z(M,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"产品编号",prop:"productCode"},{default:l(()=>[e(I,{modelValue:q.productCode,"onUpdate:modelValue":k[2]||(k[2]=y=>q.productCode=y),placeholder:"请输入产品编号",clearable:"",onKeyup:Z(M,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"产品名称",prop:"productName"},{default:l(()=>[e(I,{modelValue:q.productName,"onUpdate:modelValue":k[3]||(k[3]=y=>q.productName=y),placeholder:"请输入产品名称",clearable:"",onKeyup:Z(M,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"客户名称",prop:"clientName"},{default:l(()=>[e(I,{modelValue:q.clientName,"onUpdate:modelValue":k[4]||(k[4]=y=>q.clientName=y),placeholder:"请输入客户名称",clearable:"",onKeyup:Z(M,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,null,{default:l(()=>[e(ie,{type:"primary",icon:N(ge),size:"small",onClick:M},{default:l(()=>k[10]||(k[10]=[v("搜索")])),_:1},8,["icon"]),e(ie,{icon:N(Ee),size:"small",onClick:C},{default:l(()=>k[11]||(k[11]=[v("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),[[fe,V.value]]),S((f(),h(oe,{data:ae.value,onCurrentChange:P,onRowDblclick:T},{default:l(()=>[e(K,{width:"55",align:"center"},{default:l(y=>[e(_,{modelValue:U.value,"onUpdate:modelValue":k[5]||(k[5]=p=>U.value=p),label:y.row.id,onChange:p=>se(y.row)},{default:l(()=>k[12]||(k[12]=[v(we(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(K,{label:"工单编码",width:"180",prop:"workorderCode"}),e(K,{label:"工单名称",width:"200",align:"center",prop:"workorderName","show-overflow-tooltip":!0}),e(K,{label:"工单来源",align:"center",prop:"orderSource"},{default:l(y=>[e(ue,{type:N(Te).MES_WORKORDER_SOURCETYPE,value:y.row.orderSource},null,8,["type","value"])]),_:1}),e(K,{label:"订单编号",width:"140",align:"center",prop:"sourceCode"}),e(K,{label:"产品编号",width:"120",align:"center",prop:"productCode"}),e(K,{label:"产品名称",width:"200",align:"center",prop:"productName","show-overflow-tooltip":!0}),e(K,{label:"规格型号",align:"center",prop:"productSpc","show-overflow-tooltip":!0}),e(K,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(K,{label:"工单数量",align:"center",prop:"quantity"}),e(K,{label:"客户编码",align:"center",prop:"clientCode"}),e(K,{label:"客户名称",align:"center",prop:"clientName","show-overflow-tooltip":!0}),e(K,{label:"需求日期",align:"center",prop:"requestDate",width:"180"},{default:l(y=>[J("span",null,we(N(Je)(y.row.requestDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["data"])),[[O,w.value]]),S(e(Ue,{total:X.value,page:q.pageNo,"onUpdate:page":k[6]||(k[6]=y=>q.pageNo=y),limit:q.pageSize,"onUpdate:limit":k[7]||(k[7]=y=>q.pageSize=y),onPagination:W},null,8,["total","page","limit"]),[[fe,X.value>0]])]),_:1},8,["modelValue"])}}}),va=qe(fa,[["__scopeId","data-v-85cb79ad"]]),ga=async d=>await H.post({url:"/wms/allocated-header/create",data:d}),wa=async d=>await H.put({url:"/wms/allocated-header/update",data:d}),ka=async d=>await H.delete({url:`/wms/allocated-header/delete?id=${d}`}),Nl=async d=>await H.get({url:`/wms/allocated-header/get?id=${d}`}),ba=async d=>await H.get({url:"/wms/allocated-header/page",params:d}),_a=async d=>await H.download({url:"/wms/allocated-header/export-excel",params:d}),Ca=async d=>await H.post({url:"/wms/allocated-header/initBom",data:d}),ya=async d=>await H.put({url:`/wms/allocated-header/${d}`}),ha=async d=>await H.get({url:`/wms/allocated-header/finsh?id=${d}`}),Ia=async d=>await H.post({url:"/wms/allocated-line/updateLine",data:d}),Na=async d=>await H.get({url:`/wms/allocated-header/createIssue?id=${d}`}),Va=async d=>await H.get({url:`/mes/autocode/get/${d}`}),Sa=async d=>await H.get({url:`/wms/allocated-record/getByHeaderId?id=${d}`}),za={class:"app-container"},xa={key:0},Ua={class:"dialog-footer"},qa={class:"dialog-footer"},Da={__name:"allocation",setup(d,{expose:c}){const G=Vl(),g=Fe(()=>G.currentSize==="mini"?"small":G.currentSize),w=r(null),U=r(null),t=r({id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),V=r({bindWorkorder:!1,status:"",allocatedDate:null,workorderCode:"",taskCode:"",clientCode:"",remark:"",workorderId:null,taskId:null}),X=r(null),ae=r(null),re=r(null),q=r(null),W=r(!1),M=r(void 0),C=r([]),P=r([]),se=_e({multiple:!1,value:"pId",label:"pName"}),T=r(!0),b=r(!1),de=r([]),L=r([]),k=r(!0),I=r(!0),ee=r(!0),ie=r(!0),E=r(!1),_=r(!0),K=r(0),ue=r([]),oe=r(""),le=r(!1),O=_e({pageNo:1,pageSize:10,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:[],status:null,remark:null,createTime:[],bindWorkorder:null}),y=r([]),p=r([]),i=_e({allocatedCode:[{required:!0,message:"调拨单编号不能为空",trigger:"blur"}],warehouseId:[{required:!0,message:"请指定调入仓库",trigger:"blur"}],locationId:[{required:!0,message:"请指定调入库区",trigger:"blur"}],areaId:[{required:!0,message:"请指定调入库位",trigger:"blur"}],workorderCode:[],taskCode:[]}),B=r(!1),Q=r(null),te=r(null),A=_e({}),ne=r(null);r(640),r(480),r("");const R=Fe(()=>M.value==="edit");Fe(()=>t.value.bindWorkorder?{workorderCode:[{required:!0,message:"请指定生产工单",trigger:"blur"}],taskCode:[{required:!0,message:"请指定生产任务",trigger:"blur"}]}:{workorderCode:[],taskCode:[]}),Oe(()=>{pe(),We(),window.addEventListener("keydown",De),document.addEventListener("click",()=>{B.value&&Y()}),Ae(()=>{setTimeout(()=>{Q.value&&Q.value.focus()},1e3)})}),El(()=>{ve()}),Ll(()=>B.value,o=>{o?Ae(()=>{setTimeout(()=>{Q.value&&(Q.value.focus(),console.log("设置焦点成功"))},300)}):ne.value=null});const ve=()=>{window.removeEventListener("keydown",De,!1)},De=o=>{if(o.keyCode===13){if(!o.target.value)return;te.value=o.target.value;var u=te.value;if(typeof u=="string"&&u.includes("{")&&u.includes("}")){let m="";u=u.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),console.log(u,"newVal 111"),u=u.replace(/\uFEFF/g,""),u=Re(u);const $=JSON.parse(u);$&&(ne.value=$.id,te.value=null,m=$.type,Y()),Be(m)}else if(typeof u=="object"&&u.id){let m="";ne.value=u.id,m=u.type,te.value=null,Y(),Be(m)}else console.log('输入内容不包含完整的 "{" 和 "}"')}},Le=()=>{ne.value=null,te.value=null,Y()};function Re(o){let a=0,u=!1,m=!1;for(let $=0;$<o.length;$++){const F=o[$];if(m){m=!1;continue}if(F==="\\"){m=!0;continue}if(F==='"'&&(u=!u),!u){if(F==="{")a++;else if(F==="}"&&(a--,a===0)){const ke=o.slice(0,$+1);try{return ke}catch{throw new Error("Invalid JSON object")}}}}throw new Error("No valid JSON object found")}const Y=()=>{B.value&&Q.value&&Ae(()=>{setTimeout(()=>{Q.value&&Q.value.focus()},300)})},pe=()=>{T.value=!0,ba(O).then(o=>{ue.value=o.list,K.value=o.total,T.value=!1})},We=()=>{xl().then(o=>{P.value=o,P.value.map(a=>{a.pId=a.id,a.pName=a.warehouseName,a.children.map(u=>{u.pId=u.id,u.pName=u.locationName,u.children.map(m=>{m.pId=m.id,m.pName=m.areaName})})})})},Ie=()=>{le.value=!1,y.value=[],p.value=[],B.value=!1,z()},z=()=>{Object.assign(t.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bomList:[]}),W.value=!1,y.value=[],C.value=[],U.value&&U.value.resetFields()},ye=()=>{O.pageNo=1,pe()},Ge=()=>{w.value&&w.value.resetFields(),ye()},Xe=o=>{de.value=o.map(a=>a.id),k.value=o.length!==1,ee.value=!o.length},Ze=()=>{z(),le.value=!0,oe.value="添加调拨单",M.value="add",C.value=[]},el=o=>{z();const a=o.id;Nl(a).then(u=>{Object.assign(t.value,u),t.value.bindWorkorder=t.value.bindWorkorder==="true",C.value=[u.warehouseId,u.locationId,u.areaId],y.value=u.bomList,p.value=[],le.value=!0,oe.value="修改调拨单",M.value="edit"})},ll=()=>{U.value.validate(o=>{if(o){if(t.value.bindWorkorder||(t.value.bindWorkorder=!1),t.value.warehouseId==null||t.value.locationId==null||t.value.areaId==null){j.error("请选择调拨仓库、库区、库位信息！");return}if(p.value.length===0&&t.value.bindWorkorder===!0){j.error("请选择需要调拨的BOM信息");return}if(t.value.bomList=p.value.map(a=>({...a,quantityAllocated:parseFloat(a.quantityAllocated)})),t.value.id!=null){wa(t.value).then(a=>{j.success("修改成功"),le.value=!1,pe()});return}t.value.bomList=p.value,ga(t.value).then(a=>{j.success("新增成功"),le.value=!1,pe()})}})},al=o=>{const a=o.id;He.confirm('是否确认删除调拨单头编号为"'+a+'"的数据项?').then(()=>ka(a)).then(()=>{pe(),j.success("删除成功")}).catch(()=>{})},ol=()=>{let o={...O};o.pageNo=void 0,o.pageSize=void 0,He.confirm("是否确认导出所有调拨单头数据项?").then(()=>(E.value=!0,_a(o))).then(a=>{Bl.excel(a,"调拨单头.xls"),j.success("导出成功"),E.value=!1}).catch(()=>{})},Me=o=>{console.log(o,"value"),o!==null?(t.value.warehouseId=o[0],t.value.locationId=o[1],t.value.areaId=o[2]):(t.value.warehouseId=null,t.value.locationId=null,t.value.areaId=null)},Ke=()=>{ae.value.showFlag=!0},Ul=o=>{o!=null&&o!=null&&(t.value.workorderId=o.id,t.value.workorderCode=o.workorderCode,t.value.workorderName=o.workorderName,t.value.clientId=o.clientId,t.value.clientCode=o.clientCode,t.value.clientName=o.clientName),b.value=!0,Ca(t.value.workorderCode).then(a=>{y.value=a,b.value=!1})},tl=o=>{o?(T.value=!0,Va("ALLOCATED_CODE").then(a=>{t.value.allocatedCode=a,T.value=!1})):t.value.allocatedCode=null},nl=o=>{z();const a=o.id||de.value;T.value=!0,ha(a).then(u=>{j.success("成功"),le.value=!1,T.value=!1,pe()})},rl=o=>{p.value=o.map(a=>({...a}))},dl=o=>{ql(o.id)},ql=o=>{A.id=o,Ae(()=>{X.value&&X.value.resetFields()}),Nl(o).then(a=>{Object.assign(A,a),A.bindWorkorder=A.bindWorkorder==="true",C.value=[a.warehouseId,a.locationId,a.areaId],C.value[0]=a.warehouseId,C.value[1]=a.locationId,C.value[2]=a.areaId,y.value=a.bomList}),Sa(o).then(a=>{p.value=a}),B.value=!0},ul=()=>{if(!ne.value){j.error("请扫描正确的单据信息!");return}Be()},sl=()=>{q.value.showFlag=!0,q.value.getList()},il=()=>{const o=L.value;p.value=p.value.filter(a=>!o.includes(a.id))},pl=o=>{L.value=o.map(a=>a.id),I.value=o.length!==1,ie.value=!o.length},Be=o=>{let a="";if(o&&(a=o),C.value[0]===""||C.value[1]===""||C.value[2]===""){j.error("请选择调拨仓库、库区、库位信息！");return}if(!ne.value){j.error("请输入或扫描单据信息!");return}let u={id:parseInt(ne.value),type:a,method:"allocated",warehouseId:C.value[0],locationId:C.value[1],areaId:C.value[2]};T.value=!0,Ql(u).then(m=>{T.value=!1;let $=m;$.quantityAllocated=$.quantityOnhand,p.value.some(ke=>ke.itemCode===$.itemCode&&ke.batchCode===$.batchCode)?j.error("物料唯一码已存在，请勿添加重复项。"):(j.success("新增成功"),p.value.push($))})},cl=async()=>{let o={headerId:A.id,bomList:p.value};T.value=!0;try{await Ia(o),await ya(A.id),T.value=!1,pe(),j.success("出库成功"),B.value=!1}catch{j.error("操作失败"),T.value=!1}},ml=o=>{const a=parseFloat(o.quantityAllocated);if(isNaN(a)||a<=0){j.error("调拨数量必须为大于0的正数"),o.quantityAllocated="";return}const u=p.value.findIndex(m=>m.itemCode===o.itemCode);u!==-1&&(p.value[u]={...p.value[u],quantityAllocated:a})},Qe=()=>{re.value.showFlag=!0,re.value.getList()},Dl=o=>{o!=null&&o!=null&&(t.value.taskId=o.id,t.value.taskCode=o.taskCode,t.value.taskName=o.taskName,t.value.workstationId=o.workstationId,t.value.workstationCode=o.workstationCode,t.value.workstationName=o.workstationName,t.value.processId=o.processId,t.value.processCode=o.processCode,t.value.processName=o.processName)},Rl=o=>{o!=null&&o!=null&&(A.taskId=o.id,A.taskCode=o.taskCode,A.taskName=o.taskName,A.workstationId=o.workstationId,A.workstationCode=o.workstationCode,A.workstationName=o.workstationName,A.processId=o.processId,A.processCode=o.processCode,A.processName=o.processName)},Pl=o=>{if(o!=null&&o!=null)for(let a=0;a<o.length;a++){let u=o[a];u.quantityAllocated=u.quantityOnhand,p.value.some($=>$.itemCode===u.itemCode&&$.batchCode===u.batchCode)?j.error("物料唯一码已存在，请勿添加重复项。"):p.value.push(u)}},fl=o=>{t.value.bindWorkorder=o,U.value&&U.value.validate()},vl=o=>{He.confirm("确认生成领料单吗?").then(()=>{T.value=!0;const a=o.id||de.value;Na(a).then(()=>{T.value=!1,pe(),j.success("领料单创建成功"),B.value=!1}).catch(u=>{j.error("领料单创建失败"),T.value=!1})}).catch(()=>{j.info("已取消")})};return c({queryParams:O,showSearch:_,loading:T,list:ue,total:K,single:k,multiple:ee,exportLoading:E,handleQuery:ye,resetQuery:Ge,handleSelectionChange:Xe,handleAdd:Ze,handleUpdate:el,handleDelete:al,handleExport:ol,handleFinsh:nl,handleIssue:vl,handleExecute:dl,form:t,rules:i,autoGenFlag:W,optType:M,warehouseInfo:C,warehouseOptions:P,warehouseProps:se,bomList:y,allocatedList:p,bomLoadding:b,open:le,title:oe,isEdit:R,handleAutoGenChange:tl,handleWarehouseChanged:Me,handleWorkorderSelect:Ke,handleTaskSelect:Qe,handleBindWorkorderChange:fl,handleBomSelectionChange:rl,handleQuantityChange:ml,submitForm:ll,cancel:Ie,executeDialogVisible:B,executeForm:A,purchaseId:ne,allocatedSingle:I,allocatedHandleAdd:ul,allocatedHandleBatchAdd:sl,allocatedHandleDelete:il,allocatedHandleSelectionChange:pl,executeAllocated:cl}),(o,a)=>{const u=s("el-input"),m=s("el-form-item"),$=s("el-date-picker"),F=s("el-button"),ke=s("el-form"),D=s("el-col"),ce=s("el-row"),x=s("el-table-column"),Al=Sl,Ne=s("el-table"),Fl=Ue,Tl=Ol,gl=s("el-switch"),wl=s("el-cascader"),kl=s("el-option"),bl=s("el-select"),Pe=s("el-divider"),_l=s("el-card"),Cl=s("el-dialog"),be=Ce("hasPermi"),Ve=Ce("loading"),yl=Ce("dialogDrag");return f(),he("div",za,[S(e(ke,{model:O,ref:"queryFormRef",size:g.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(m,{label:"调拨单号",prop:"allocatedCode"},{default:l(()=>[e(u,{modelValue:O.allocatedCode,"onUpdate:modelValue":a[0]||(a[0]=n=>O.allocatedCode=n),placeholder:"请输入调拨单编号",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(u,{modelValue:O.allocatedName,"onUpdate:modelValue":a[1]||(a[1]=n=>O.allocatedName=n),placeholder:"请输入调拨单名称",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(u,{modelValue:O.workorderCode,"onUpdate:modelValue":a[2]||(a[2]=n=>O.workorderCode=n),placeholder:"请输入生产工单编码",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"仓库名称",prop:"warehouseName"},{default:l(()=>[e(u,{modelValue:O.warehouseName,"onUpdate:modelValue":a[3]||(a[3]=n=>O.warehouseName=n),placeholder:"请输入仓库名称",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e($,{modelValue:O.allocatedDate,"onUpdate:modelValue":a[4]||(a[4]=n=>O.allocatedDate=n),style:{width:"240px"},"value-format":"yyyy-MM-dd HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(F,{type:"primary",icon:N(ge),onClick:ye},{default:l(()=>a[30]||(a[30]=[v("搜索")])),_:1},8,["icon"]),e(F,{icon:N(Ee),onClick:Ge},{default:l(()=>a[31]||(a[31]=[v("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[fe,_.value]]),e(ce,{gutter:10,class:"mb8"},{default:l(()=>[e(D,{span:1.5},{default:l(()=>[S((f(),h(F,{type:"primary",icon:N($e),size:g.value,onClick:Ze},{default:l(()=>a[32]||(a[32]=[v("新增 ")])),_:1},8,["icon","size"])),[[be,["wms:allocated-header:create"]]])]),_:1}),e(D,{span:1.5},{default:l(()=>[S((f(),h(F,{type:"warning",plain:"",icon:N(Wl),size:g.value,onClick:ol,loading:E.value},{default:l(()=>a[33]||(a[33]=[v("导出 ")])),_:1},8,["icon","size","loading"])),[[be,["wms:allocated-header:export"]]])]),_:1}),e(D,{span:1.5},{default:l(()=>[S((f(),h(F,{type:"success",plain:"",icon:N(hl),size:g.value,onClick:nl,disabled:k.value},{default:l(()=>a[34]||(a[34]=[v("完成 ")])),_:1},8,["icon","size","disabled"])),[[be,["wms:allocated-header:finsh"]]])]),_:1}),e(D,{span:1.5},{default:l(()=>[S((f(),h(F,{plain:"",icon:N(hl),size:g.value,onClick:vl,disabled:k.value},{default:l(()=>a[35]||(a[35]=[v("生成领料单 ")])),_:1},8,["icon","size","disabled"])),[[be,["wms:allocated-header:createIssue"]]])]),_:1})]),_:1}),e(Tl,null,{default:l(()=>[S((f(),h(Ne,{data:ue.value,size:g.value,onSelectionChange:Xe},{default:l(()=>[e(x,{type:"selection",width:"55",align:"center"}),e(x,{label:"调拨单编号",align:"center",prop:"allocatedCode"}),e(x,{label:"调拨单名称",align:"center",prop:"allocatedName"}),e(x,{label:"生产工单",align:"center",prop:"workorderCode"}),e(x,{label:"调拨日期",align:"center",prop:"allocatedDate",width:"180"},{default:l(n=>[J("span",null,we(N(Je)(n.row.allocatedDate,"YYYY-MM-DD")),1)]),_:1}),e(x,{label:"单据状态",align:"center",prop:"status"},{default:l(n=>[e(Al,{type:N(Te).MES_ALLOCATED_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),e(x,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(n=>[n.row.status!="FINISHED"?S((f(),h(F,{key:0,size:g.value,type:"text",onClick:Se=>dl(n.row)},{default:l(()=>a[36]||(a[36]=[v("执行领出")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:allocated"]]]):me("",!0),S((f(),h(F,{size:g.value,type:"text",onClick:Se=>el(n.row)},{default:l(()=>a[37]||(a[37]=[v("修改 ")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:update"]]]),S((f(),h(F,{size:g.value,type:"text",onClick:Se=>al(n.row)},{default:l(()=>a[38]||(a[38]=[v("删除 ")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:delete"]]])]),_:1})]),_:1},8,["data","size"])),[[Ve,T.value]]),S(e(Fl,{total:K.value,page:O.pageNo,"onUpdate:page":a[5]||(a[5]=n=>O.pageNo=n),limit:O.pageSize,"onUpdate:limit":a[6]||(a[6]=n=>O.pageSize=n),onPagination:pe},null,8,["total","page","limit"]),[[fe,K.value>0]])]),_:1}),S((f(),h(Cl,{title:oe.value,modelValue:le.value,"onUpdate:modelValue":a[17]||(a[17]=n=>le.value=n),width:"80%","append-to-body":""},{footer:l(()=>[J("div",Ua,[e(F,{size:g.value,type:"primary",onClick:ll},{default:l(()=>a[41]||(a[41]=[v("确 定")])),_:1},8,["size"]),e(F,{size:g.value,onClick:Ie},{default:l(()=>a[42]||(a[42]=[v("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(ke,{ref_key:"formRef",ref:U,size:g.value,model:t.value,rules:i},{default:l(()=>[e(ce,null,{default:l(()=>[e(D,{span:8},{default:l(()=>[e(m,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(u,{disabled:R.value,modelValue:t.value.allocatedCode,"onUpdate:modelValue":a[7]||(a[7]=n=>t.value.allocatedCode=n),placeholder:"请输入调拨单编号"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(D,{span:4},{default:l(()=>[e(m,null,{default:l(()=>[M.value!="view"&&t.value.status=="PREPARE"?(f(),h(gl,{key:0,modelValue:W.value,"onUpdate:modelValue":a[8]||(a[8]=n=>W.value=n),"active-color":"#13ce66","active-text":"自动生成",onChange:tl},null,8,["modelValue"])):me("",!0)]),_:1})]),_:1}),e(D,{span:12},{default:l(()=>[e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(u,{disabled:"",modelValue:t.value.allocatedName,"onUpdate:modelValue":a[9]||(a[9]=n=>t.value.allocatedName=n),placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ce,null,{default:l(()=>[e(D,{span:8},{default:l(()=>[e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e($,{clearable:"",modelValue:t.value.allocatedDate,"onUpdate:modelValue":a[10]||(a[10]=n=>t.value.allocatedDate=n),type:"date","value-format":"timestamp",placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:8},{default:l(()=>[e(m,{label:"领料仓库"},{default:l(()=>[e(wl,{modelValue:C.value,"onUpdate:modelValue":a[11]||(a[11]=n=>C.value=n),options:P.value,props:se,placeholder:"请选择",onChange:Me},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(D,{span:8},{default:l(()=>[e(m,{label:"单据状态",prop:"status"},{default:l(()=>[e(bl,{modelValue:t.value.status,"onUpdate:modelValue":a[12]||(a[12]=n=>t.value.status=n),disabled:""},{default:l(()=>[(f(!0),he(ze,null,xe(N(Te).MES_ALLOCATED_STATUS,n=>(f(),h(kl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ce,null,{default:l(()=>[e(D,{span:2}),e(D,{span:6},{default:l(()=>[e(m,{"label-width":"80"},{default:l(()=>[M.value!="view"&&t.value.status=="PREPARE"?(f(),h(gl,{key:0,style:{"margin-left":"10%"},modelValue:t.value.bindWorkorder,"onUpdate:modelValue":a[13]||(a[13]=n=>t.value.bindWorkorder=n),"active-color":"#13ce66","inactive-text":"绑定工单",onChange:fl},null,8,["modelValue"])):me("",!0)]),_:1})]),_:1}),t.value&&t.value.bindWorkorder?(f(),h(D,{key:0,span:8},{default:l(()=>[e(m,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(u,{modelValue:t.value.workorderCode,"onUpdate:modelValue":a[14]||(a[14]=n=>t.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(F,{icon:N(ge),onClick:Ke},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(va,{ref:"woSelectRef",onOnSelected:Ul},null,512)]),_:1})):me("",!0),t.value&&t.value.bindWorkorder?(f(),h(D,{key:1,span:8},{default:l(()=>[e(m,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(u,{modelValue:t.value.taskCode,"onUpdate:modelValue":a[15]||(a[15]=n=>t.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(F,{icon:N(ge),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Il,{ref:"taskSelectRef",workorderId:t.value.workorderId,onOnSelected:Dl},null,8,["workorderId"])]),_:1})):me("",!0)]),_:1}),e(ce,null,{default:l(()=>[e(D,{span:24},{default:l(()=>[e(m,{label:"备注",prop:"remark"},{default:l(()=>[e(u,{modelValue:t.value.remark,"onUpdate:modelValue":a[16]||(a[16]=n=>t.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"]),t.value&&t.value.bindWorkorder?(f(),he("div",xa,[e(Pe,{"content-position":"center"},{default:l(()=>a[39]||(a[39]=[v("物料信息")])),_:1}),e(_l,{shadow:"always",class:"box-card"},{default:l(()=>[S((f(),h(Ne,{size:g.value,"max-height":"300",data:y.value,onSelectionChange:rl},{default:l(()=>[e(x,{type:"selection",width:"65",align:"center"}),e(x,{label:"物料编码",align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{width:"210",label:"需求数量",align:"center",prop:"quantityAllocated"}),e(x,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,b.value]])]),_:1}),e(Pe,{"content-position":"center"},{default:l(()=>a[40]||(a[40]=[v("调拨信息")])),_:1}),e(_l,{shadow:"always",class:"box-card"},{default:l(()=>[S((f(),h(Ne,{size:g.value,"max-height":"300",data:p.value,"row-key":"itemCode"},{default:l(()=>[e(x,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{width:"220",label:"调拨数量",align:"center",prop:"quantityAllocated"},{default:l(n=>[e(u,{modelValue:n.row.quantityAllocated,"onUpdate:modelValue":Se=>n.row.quantityAllocated=Se,type:"number",placeholder:"请输入数量",onBlur:Se=>ml(n.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(x,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,b.value]])]),_:1})])):me("",!0)]),_:1},8,["title","modelValue"])),[[yl]]),S((f(),h(Cl,{title:"执行出库",class:"execute-dialog",modelValue:B.value,"onUpdate:modelValue":a[29]||(a[29]=n=>B.value=n),width:"92%","append-to-body":""},{footer:l(()=>[J("span",qa,[e(F,{size:g.value,onClick:Ie},{default:l(()=>a[50]||(a[50]=[v("取 消")])),_:1},8,["size"]),e(F,{size:g.value,type:"primary",onClick:cl},{default:l(()=>a[51]||(a[51]=[v("确 定")])),_:1},8,["size"])])]),default:l(()=>[e(ke,{size:g.value,ref_key:"executeFormRef",ref:X,model:V.value,"label-width":"100px"},{default:l(()=>[e(ce,null,{default:l(()=>[e(D,{span:8},{default:l(()=>[e(m,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(u,{modelValue:V.value.allocatedCode,"onUpdate:modelValue":a[18]||(a[18]=n=>V.value.allocatedCode=n),disabled:"",placeholder:"请输入调拨单编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:12},{default:l(()=>[e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(u,{modelValue:V.value.allocatedName,"onUpdate:modelValue":a[19]||(a[19]=n=>V.value.allocatedName=n),disabled:"",placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ce,null,{default:l(()=>[e(D,{span:8},{default:l(()=>[e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e($,{clearable:"",modelValue:V.value.allocatedDate,"onUpdate:modelValue":a[20]||(a[20]=n=>V.value.allocatedDate=n),disabled:"",type:"date","value-format":"timestamp",placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:8},{default:l(()=>[e(m,{label:"领料仓库"},{default:l(()=>[e(wl,{disabled:"",modelValue:C.value,"onUpdate:modelValue":a[21]||(a[21]=n=>C.value=n),options:P.value,props:se,onChange:Me},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(D,{span:8},{default:l(()=>[e(m,{label:"单据状态",prop:"status"},{default:l(()=>[e(bl,{disabled:"",modelValue:V.value.status,"onUpdate:modelValue":a[22]||(a[22]=n=>V.value.status=n)},{default:l(()=>[(f(!0),he(ze,null,xe(N(Te).MES_ALLOCATED_STATUS,n=>(f(),h(kl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),V.value.bindWorkorder?(f(),h(ce,{key:0},{default:l(()=>[e(D,{span:8},{default:l(()=>[e(m,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(u,{disabled:"",modelValue:V.value.workorderCode,"onUpdate:modelValue":a[23]||(a[23]=n=>V.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(F,{disabled:"",icon:N(ge),onClick:Ke},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(D,{span:8},{default:l(()=>[e(m,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(u,{disabled:"",modelValue:V.value.taskCode,"onUpdate:modelValue":a[24]||(a[24]=n=>V.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(F,{disabled:"",icon:N(ge),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Il,{ref:"taskSelectRef",workorderId:V.value.workorderId,onOnSelected:Rl},null,8,["workorderId"])]),_:1}),e(D,{span:8},{default:l(()=>[e(m,{label:"客户编号"},{default:l(()=>[e(u,{disabled:"",modelValue:V.value.clientCode,"onUpdate:modelValue":a[25]||(a[25]=n=>V.value.clientCode=n),placeholder:"请选择生产工单"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):me("",!0),e(ce,null,{default:l(()=>[e(D,{span:24},{default:l(()=>[e(m,{label:"备注",prop:"remark"},{default:l(()=>[e(u,{disabled:"",modelValue:V.value.remark,"onUpdate:modelValue":a[26]||(a[26]=n=>V.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),V.value.bindWorkorder?(f(),h(Pe,{key:1,"content-position":"center"},{default:l(()=>a[43]||(a[43]=[v("BOM信息")])),_:1})):me("",!0),V.value.bindWorkorder?S((f(),h(Ne,{key:2,size:g.value,"max-height":"200",data:y.value,style:{width:"100%"}},{default:l(()=>[e(x,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{label:"需求数量",align:"center",prop:"quantityAllocated"}),e(x,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,b.value]]):me("",!0),e(Pe,{"content-position":"center"},{default:l(()=>a[44]||(a[44]=[v("调拨信息")])),_:1}),e(ce,{gutter:10},{default:l(()=>[e(D,{span:8},{default:l(()=>[e(m,{label:"单据信息",prop:"purchaseId"},{default:l(()=>[e(u,{readonly:"",modelValue:ne.value,"onUpdate:modelValue":a[27]||(a[27]=n=>ne.value=n),placeholder:"请输入"},null,8,["modelValue"]),S(J("input",{ref_key:"scannerInput",ref:Q,"onUpdate:modelValue":a[28]||(a[28]=n=>te.value=n),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"1",height:"1","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[Ml,te.value]]),a[45]||(a[45]=J("span",null,"支持扫码枪扫描, 无法扫码时点击重置按钮",-1))]),_:1})]),_:1}),e(D,{span:4},{default:l(()=>[e(F,{type:"primary",round:"",onClick:Le},{default:l(()=>a[46]||(a[46]=[v("重置")])),_:1})]),_:1}),e(D,{span:2.5},{default:l(()=>[e(F,{type:"primary",style:{"margin-right":"10px"},icon:N($e),size:g.value,onClick:ul},{default:l(()=>a[47]||(a[47]=[v("新增")])),_:1},8,["icon","size"])]),_:1}),e(D,{span:2.5},{default:l(()=>[S((f(),h(F,{type:"primary",style:{"margin-right":"10px"},icon:N($e),size:g.value,onClick:sl},{default:l(()=>a[48]||(a[48]=[v("批量新增")])),_:1},8,["icon","size"])),[[be,["wms:allocated-header:batchAdd"]]])]),_:1}),e(pa,{ref_key:"stockSelectRef",ref:q,onOnSelected:Pl},null,512),e(D,{span:2.5},{default:l(()=>[e(F,{type:"danger",plain:"",icon:N(Kl),size:g.value,disabled:I.value,onClick:il},{default:l(()=>a[49]||(a[49]=[v("删除")])),_:1},8,["icon","size","disabled"])]),_:1})]),_:1}),S((f(),h(Ne,{size:g.value,data:p.value,onSelectionChange:pl},{default:l(()=>[e(x,{type:"selection",width:"55",align:"center"}),e(x,{label:"序号",width:"55",align:"center"},{default:l(n=>[v(we(n.$index+1),1)]),_:1}),e(x,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{label:"调拨数量","show-overflow-tooltip":!0,align:"center",prop:"quantityAllocated"}),e(x,{width:"70",label:"单位",align:"center",prop:"unitOfMeasure"}),e(x,{label:"批次号","show-overflow-tooltip":!0,align:"center",prop:"batchCode"}),e(x,{label:"调拨标识","show-overflow-tooltip":!0,width:"90",align:"center",prop:"allocatedFlag"}),e(x,{label:"仓库名称","show-overflow-tooltip":!0,align:"center",prop:"warehouseName"}),e(x,{label:"库区名称","show-overflow-tooltip":!0,align:"center",prop:"locationName"}),e(x,{label:"库位名称","show-overflow-tooltip":!0,align:"center",prop:"areaName"})]),_:1},8,["size","data"])),[[Ve,T.value]])]),_:1},8,["size","model"])]),_:1},8,["modelValue"])),[[yl]])])}}},Ea=qe(Da,[["__scopeId","data-v-56cfc9aa"]]);export{Ea as default};
