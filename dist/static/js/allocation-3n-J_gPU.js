/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 13:49:10 
 */
import{_ as Fl}from"./ContentWrap.vue_vue_type_script_setup_true_lang-58zNwBTb.js";import{V as H,d as He,r,f as ke,b as Te,g as u,h as be,k as y,o as m,m as l,w as z,j as e,J as X,c as _e,F as Se,n as ze,a as V,D as ve,v as f,$ as Fe,Z as me,t as ge,M as xe,i as J,a6 as Ye,A as Ue,l as ce,W as Vl,O as Ae,x as Je,X as Pe,R as Ll,Y as yl,E as Qe,G as El,a7 as hl,a3 as Wl,a8 as Ml,a4 as Y,T as $e,a5 as Kl}from"./index-BW9ifGp0.js";import{_ as Sl}from"./DictTag.vue_vue_type_script_lang-CGh0XIVR.js";import{D as Oe}from"./dict-BcQRoIPV.js";import{k as Bl}from"./index-CVhkFS6I.js";import"./color-B5phLuB-.js";const Ql=async d=>await H.get({url:"/mes/pro/task/page",params:d}),zl=async()=>await H.get({url:"/mes/pro/cess/list-all-simple"}),$l=async d=>await H.get({url:"/mes/md-workstation/page",params:d}),Hl=async()=>await H.get({url:"/mes/md-workshop/list-all-simple"}),Yl={class:"dialog-footer"},Jl=He({name:"WorkstationSelect",__name:"simpletableSingle",props:{processId:{}},emits:["onSelected"],setup(d,{expose:p,emit:j}){const v=d,g=r(!1),q=r(!0),t=r(),S=r([]);r(!0),r(!0);const G=r(!0),le=r(0),ne=r([]),D=r([]),M=r([]),W=r(),w=ke({pageNo:1,pageSize:10,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:v.processId,processCode:null,processName:null,enableFlag:null});ke({workstationId:null,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:null,processCode:null,processName:null,enableFlag:"Y",remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null});const x=async()=>{q.value=!0;try{const F=await $l(w);ne.value=F.list,le.value=F.total}finally{q.value=!1}},se=async()=>{const F=await Hl();D.value=F},O=async()=>{const F=await zl();M.value=F},b=()=>{w.pageNo=1,x()},re=()=>{W.value?.resetFields(),b()},L=F=>{F&&(S.value=F)},k=F=>{F&&(S.value=F)},h=F=>{F&&(S.value=F,ie("onSelected",S.value),g.value=!1)},Z=()=>{if(!t.value){Ye({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}ie("onSelected",S.value),g.value=!1},ie=j;return Te(()=>{x(),se(),O()}),p({showFlag:g}),(F,_)=>{const K=u("el-input"),de=u("el-form-item"),ae=u("el-col"),ee=u("el-option"),T=u("el-select"),C=u("el-button"),i=u("el-row"),s=u("el-form"),Q=u("el-radio"),$=u("el-table-column"),ue=u("el-table"),A=u("el-dialog"),oe=be("loading");return m(),y(A,{title:"工作站选择",modelValue:g.value,"onUpdate:modelValue":_[7]||(_[7]=P=>g.value=P),modal:!1,width:"80%",center:""},{footer:l(()=>[J("div",Yl,[e(C,{type:"primary",onClick:Z},{default:l(()=>_[11]||(_[11]=[f("确 定")])),_:1}),e(C,{onClick:_[6]||(_[6]=P=>g.value=!1)},{default:l(()=>_[12]||(_[12]=[f("取 消")])),_:1})])]),default:l(()=>[z(e(s,{model:w,ref_key:"queryFormRef",ref:W,size:"small",inline:!0,"label-width":"90px"},{default:l(()=>[e(i,null,{default:l(()=>[e(ae,{span:7},{default:l(()=>[e(de,{label:"工作站编号",prop:"workstationCode"},{default:l(()=>[e(K,{modelValue:w.workstationCode,"onUpdate:modelValue":_[0]||(_[0]=P=>w.workstationCode=P),placeholder:"请输入工作站编号",clearable:"",onKeyup:X(b,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(ae,{span:7},{default:l(()=>[e(de,{label:"所属工序",prop:"processName"},{default:l(()=>[e(T,{modelValue:w.processId,"onUpdate:modelValue":_[1]||(_[1]=P=>w.processId=P),placeholder:"请选择工序"},{default:l(()=>[(m(!0),_e(Se,null,ze(M.value,P=>(m(),y(ee,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ae,{span:7},{default:l(()=>[e(de,{label:"所在车间",prop:"workshopName"},{default:l(()=>[e(T,{modelValue:w.workshopId,"onUpdate:modelValue":_[2]||(_[2]=P=>w.workshopId=P),placeholder:"请选择车间"},{default:l(()=>[(m(!0),_e(Se,null,ze(D.value,P=>(m(),y(ee,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ae,{span:3},{default:l(()=>[e(de,null,{default:l(()=>[e(C,{type:"primary",icon:V(ve),size:"small",onClick:b},{default:l(()=>_[8]||(_[8]=[f("搜索")])),_:1},8,["icon"]),e(C,{icon:V(Fe),size:"small",onClick:re},{default:l(()=>_[9]||(_[9]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(ae,{span:24})]),_:1})]),_:1},8,["model"]),[[me,G.value]]),z((m(),y(ue,{data:ne.value,onCurrentChange:L,onRowDblclick:h},{default:l(()=>[e($,{width:"55",align:"center"},{default:l(P=>[e(Q,{modelValue:t.value,"onUpdate:modelValue":_[3]||(_[3]=fe=>t.value=fe),label:P.row.id,onChange:fe=>k(P.row)},{default:l(()=>_[10]||(_[10]=[f(ge(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e($,{label:"工作站编号",align:"center",prop:"workstationCode"}),e($,{label:"工作站名称",align:"center",prop:"workstationName"}),e($,{label:"工作站地点",align:"center",prop:"workstationAddress"}),e($,{label:"所在车间名称",align:"center",prop:"workshopName"}),e($,{label:"所属工序",align:"center",prop:"processName"}),e($,{label:"备注",align:"center",prop:"remark"})]),_:1},8,["data"])),[[oe,q.value]]),z(e(xe,{total:le.value,page:w.pageNo,"onUpdate:page":_[4]||(_[4]=P=>w.pageNo=P),limit:w.pageSize,"onUpdate:limit":_[5]||(_[5]=P=>w.pageSize=P),onPagination:x},null,8,["total","page","limit"]),[[me,le.value>0]])]),_:1},8,["modelValue"])}}}),jl=Ue(Jl,[["__scopeId","data-v-848b7f87"]]),Gl={name:"ProtaskSelect",components:{WorkstationSelect:jl},props:{workorderId:null,workorderCode:null,processId:null,processCode:null,workstationId:null,workstationCode:null},watch:{workorderId(d){this.queryParams.workorderId=d}},data(){return{showFlag:!1,selectedTaskId:void 0,selectedRow:void 0,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,protaskList:[],title:"",open:!1,queryParams:{pageNo:1,pageSize:10,taskCode:null,taskName:null,workorderId:this.workorderId,workorderCode:null,workorderName:null,workstationId:null,workstationCode:null,workstationName:null,processId:this.processId,processCode:null,processName:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,clientId:null,clientCode:null,clientName:null,clientNick:null,startTime:null,duration:null,endTime:null,colorCode:null,requestDate:null},form:{},rules:{workstationId:[{required:!0,message:"工作站不能为空",trigger:"blur"}],quantity:[{required:!0,message:"排产数量不能为空",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始生产日期",trigger:"blur"}],duration:[{required:!0,message:"清输入估算的生产用时",trigger:"blur"}]}}},created(){this.getList(),this.getProcess()},methods:{getList(){this.loading=!0,Ql(this.queryParams).then(d=>{this.protaskList=d.list,this.total=d.total,this.loading=!1})},getProcess(){zl().then(d=>{this.processOptions=d})},handleQuery(){this.queryParams.pageNo=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleCurrent(d){d&&(this.selectedRow=d)},handleRowDbClick(d){d&&(this.selectedRow=d,this.$emit("onSelected",this.selectedRow),this.showFlag=!1)},handleRowChange(d){d&&(this.selectedRow=d)},confirmSelect(){if(this.selectedTaskId==null||this.selectedTaskId==0){this.$notify({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}this.$emit("onSelected",this.selectedRow),this.showFlag=!1}}},Xl={"slot-scope":"scope"},Zl={"slot-scope":"scope"},ea={"slot-scope":"scope"},la={"slot-scope":"scope"},aa={slot:"footer",class:"dialog-footer"};function oa(d,p,j,v,g,q){const t=u("el-option"),S=u("el-select"),G=u("el-form-item"),le=u("el-col"),ne=u("el-input"),D=u("el-row"),M=u("el-button"),W=u("el-form"),w=u("el-radio"),x=u("el-table-column"),se=u("el-color-picker"),O=u("el-table"),b=xe,re=u("el-dialog"),L=be("hasPermi"),k=be("loading");return g.showFlag?(m(),y(re,{key:0,title:"生产任务选择",visible:g.showFlag,modal:!1,width:"80%",center:""},{default:l(()=>[z(e(W,{model:g.queryParams,ref:"queryForm",size:"small",inline:!0,"label-width":"100px"},{default:l(()=>[e(D,null,{default:l(()=>[e(le,{span:8},{default:l(()=>[e(G,{label:"所属工序",prop:"processName"},{default:l(()=>[e(S,{modelValue:g.queryParams.processId,"onUpdate:modelValue":p[0]||(p[0]=h=>g.queryParams.processId=h),placeholder:"请选择工序"},{default:l(()=>[(m(!0),_e(Se,null,ze(d.processOptions,h=>(m(),y(t,{key:h.processId,label:h.processName,value:h.processId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(le,{span:8},{default:l(()=>[e(G,{label:"所属工作站",prop:"workstationCode"},{default:l(()=>[e(ne,{modelValue:g.queryParams.workstationCode,"onUpdate:modelValue":p[1]||(p[1]=h=>g.queryParams.workstationCode=h),placeholder:"请输入工作站编号",clearable:"",onKeyup:X(q.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(le,{span:8},{default:l(()=>[e(G,{label:"任务编号",prop:"taskCode"},{default:l(()=>[e(ne,{modelValue:g.queryParams.taskCode,"onUpdate:modelValue":p[2]||(p[2]=h=>g.queryParams.taskCode=h),placeholder:"请输入生产任务编号",clearable:"",onKeyup:X(q.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:l(()=>[e(le,{span:8},{default:l(()=>[e(G,null,{default:l(()=>[e(M,{type:"primary",icon:"el-icon-search",size:"mini",onClick:q.handleQuery},{default:l(()=>p[8]||(p[8]=[f("搜索")])),_:1},8,["onClick"]),e(M,{icon:"el-icon-refresh",size:"mini",onClick:q.resetQuery},{default:l(()=>p[9]||(p[9]=[f("重置")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),[[me,g.showSearch]]),z((m(),y(O,{data:g.protaskList,onCurrentChange:q.handleCurrent,onRowDblclick:q.handleRowDbClick},{default:l(()=>[e(x,{width:"55",align:"center"},{default:l(h=>[e(w,{modelValue:g.selectedTaskId,"onUpdate:modelValue":p[3]||(p[3]=Z=>g.selectedTaskId=Z),label:h.row.id,onChange:Z=>q.handleRowChange(h.row)},{default:l(()=>p[10]||(p[10]=[f(ge(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(x,{label:"任务编号",align:"center",width:"100px",prop:"taskCode","show-overflow-tooltip":!0}),e(x,{label:"任务名称",align:"center",width:"120px",prop:"taskName","show-overflow-tooltip":!0}),e(x,{label:"工作站编号",align:"center",width:"150px",prop:"workstationCode","show-overflow-tooltip":!0}),e(x,{label:"工作站名称",align:"center",width:"150px",prop:"workstationName","show-overflow-tooltip":!0}),e(x,{label:"排产数量",align:"center",prop:"quantity"}),e(x,{label:"已生产数量",align:"center",width:"100px",prop:"quantityProduced"}),e(x,{label:"开始生产时间",align:"center",prop:"startTime",width:"180"},{default:l(()=>[J("template",Xl,[J("span",null,ge(d.parseTime(d.scope.row.startTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(x,{label:"生产时长",align:"center",prop:"duration"}),e(x,{label:"预计完成时间",align:"center",prop:"endTime",width:"180"},{default:l(()=>[J("template",Zl,[J("span",null,ge(d.parseTime(d.scope.row.endTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(x,{label:"显示颜色",align:"center",prop:"colorCode"},{default:l(()=>[J("template",ea,[e(se,{modelValue:d.scope.row.colorCode,"onUpdate:modelValue":p[4]||(p[4]=h=>d.scope.row.colorCode=h),disabled:""},null,8,["modelValue"])])]),_:1}),e(x,{label:"操作",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:l(()=>[J("template",la,[z((m(),y(M,{size:"mini",type:"text",icon:"el-icon-edit",onClick:p[5]||(p[5]=h=>d.handleUpdate(d.scope.row))},{default:l(()=>p[11]||(p[11]=[f("修改")])),_:1})),[[L,["pro:protask:edit"]]]),z((m(),y(M,{size:"mini",type:"text",icon:"el-icon-delete",onClick:p[6]||(p[6]=h=>d.handleDelete(d.scope.row))},{default:l(()=>p[12]||(p[12]=[f("删除")])),_:1})),[[L,["pro:protask:remove"]]])])]),_:1})]),_:1},8,["data","onCurrentChange","onRowDblclick"])),[[k,g.loading]]),z(e(b,{total:g.total,page:g.queryParams.pageNo,limit:g.queryParams.pageSize,onPagination:q.getList},null,8,["total","page","limit","onPagination"]),[[me,g.total>0]]),J("div",aa,[e(M,{type:"primary",onClick:q.confirmSelect},{default:l(()=>p[13]||(p[13]=[f("确 定")])),_:1},8,["onClick"]),e(M,{onClick:p[7]||(p[7]=h=>g.showFlag=!1)},{default:l(()=>p[14]||(p[14]=[f("取 消")])),_:1})])]),_:1},8,["visible"])):ce("",!0)}const Il=Ue(Gl,[["render",oa]]),ta=async d=>await H.get({url:"/mes/wms/material-stock/page",params:d}),na=async()=>await H.get({url:"/mes/md-item-type/treeselect"}),xl=async()=>await H.get({url:"/wms/warehouse/getTreeList"}).then(d=>(d.data=(d.data||[]).map(p=>(p.children&&(p.children=p.children.map(j=>(j.children&&(j.children=j.children.map(v=>({...v,pId:v.id,pName:v.areaName,lId:v.locationId,areaId:v.id}))),{...j,wId:j.warehouseId,pId:j.id,pName:j.locationName,locationId:j.id}))),{...p,wId:p.id,pId:p.id,pName:p.warehouseName,warehouseId:p.id})),d)),ra={class:"head-container"},da={class:"head-container"},ua={class:"dialog-footer"},sa=He({name:"WmstockMultiSelect",__name:"multi",emits:["onSelected"],setup(d,{expose:p,emit:j}){const v=Vl(),g=Ae(()=>v.currentSize==="mini"?"small":v.currentSize),q=r(!1),t=r(!0),S=r([]),G=r([]),le=r(!0),ne=r(!0),D=r(!0),M=r(0),W=r([]),w=r([]),x=r(),se=r(),O=r(),b=ke({pageNo:1,pageSize:10,itemTypeId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,vendorId:null,vendorCode:null,vendorName:null,vendorNick:null,quantityOnhand:null,expireDate:null,warehouse:null}),re={children:"children",label:"label"},L=r([]),k={multiple:!1,value:"pId",label:"pName"},h=async()=>{t.value=!0;try{const i=await ta(b);w.value=i.list,M.value=i.total}finally{t.value=!1}},Z=async()=>{const i=await na();W.value=i},ie=(i,s)=>i?s.label.indexOf(i)!==-1:!0,F=i=>{b.itemTypeId=i.id,_()},_=()=>{b.pageNo=1,h()},K=()=>{O.value?.resetFields(),_()},de=i=>{S.value=i.map(s=>s.materialStockId),le.value=i.length!==1,ne.value=!i.length,G.value=i},ae=()=>{if(!G.value.length){Ye({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}C("onSelected",G.value),q.value=!1},ee=async()=>{const i=await xl();L.value=i,L.value.map(s=>{s.pId=s.id,s.pName=s.warehouseName,s.children.map($=>{let ue=JSON.stringify($.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");$.children=JSON.parse(ue)});let Q=JSON.stringify(s.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");s.children=JSON.parse(Q)})},T=i=>{i&&(b.warehouseId=i[0],b.locationId=i[1],b.areaId=i[2])},C=j;return Te(()=>{h(),Z(),ee()}),p({showFlag:q}),(i,s)=>{const Q=u("el-input"),$=u("el-tree"),ue=u("el-col"),A=u("el-form-item"),oe=u("el-cascader"),P=u("el-date-picker"),fe=u("el-button"),qe=u("el-form"),Le=u("right-toolbar"),De=u("el-row"),E=u("el-table-column"),Ee=u("el-table"),he=u("el-dialog"),Ce=be("loading");return m(),y(he,{title:"物料选择",modelValue:q.value,"onUpdate:modelValue":s[12]||(s[12]=I=>q.value=I),modal:!1,width:"92%",center:""},{footer:l(()=>[J("div",ua,[e(fe,{size:V(g),type:"primary",onClick:ae},{default:l(()=>s[15]||(s[15]=[f("确 定")])),_:1},8,["size"]),e(fe,{size:V(g),onClick:s[11]||(s[11]=I=>q.value=!1)},{default:l(()=>s[16]||(s[16]=[f("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(De,{gutter:14},{default:l(()=>[e(ue,{span:4,xs:24},{default:l(()=>[J("div",ra,[e(Q,{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=I=>x.value=I),placeholder:"请输入分类名称",clearable:"",":size":V(g),"prefix-icon":V(ve),style:{"margin-bottom":"20px"}},null,8,["modelValue",":size","prefix-icon"])]),J("div",da,[e($,{data:W.value,props:re,"expand-on-click-node":!1,"filter-node-method":ie,ref_key:"treeRef",ref:se,"default-expand-all":"",onNodeClick:F},null,8,["data"])])]),_:1}),e(ue,{span:20,xs:24},{default:l(()=>[z(e(qe,{model:b,ref_key:"queryFormRef",ref:O,":size":V(g),inline:!0},{default:l(()=>[e(A,{label:"产品物料编码",prop:"itemCode"},{default:l(()=>[e(Q,{modelValue:b.itemCode,"onUpdate:modelValue":s[1]||(s[1]=I=>b.itemCode=I),placeholder:"请输入产品物料编码",clearable:"",onKeyup:X(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"产品物料名称",prop:"itemName"},{default:l(()=>[e(Q,{modelValue:b.itemName,"onUpdate:modelValue":s[2]||(s[2]=I=>b.itemName=I),placeholder:"请输入产品物料名称",clearable:"",onKeyup:X(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"入库批次号",prop:"batchCode"},{default:l(()=>[e(Q,{modelValue:b.batchCode,"onUpdate:modelValue":s[3]||(s[3]=I=>b.batchCode=I),placeholder:"请输入入库批次号",clearable:"",onKeyup:X(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"仓库信息",prop:"warehouse"},{default:l(()=>[e(oe,{modelValue:b.warehouse,"onUpdate:modelValue":s[4]||(s[4]=I=>b.warehouse=I),options:L.value,props:k,onChange:T},null,8,["modelValue","options"])]),_:1}),e(A,{label:"供应商编号",prop:"vendorCode"},{default:l(()=>[e(Q,{modelValue:b.vendorCode,"onUpdate:modelValue":s[5]||(s[5]=I=>b.vendorCode=I),placeholder:"请输入供应商编号",clearable:"",onKeyup:X(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[e(Q,{modelValue:b.vendorName,"onUpdate:modelValue":s[6]||(s[6]=I=>b.vendorName=I),placeholder:"请输入供应商名称",clearable:"",onKeyup:X(_,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"库存有效期",prop:"expireDate"},{default:l(()=>[e(P,{clearable:"",modelValue:b.expireDate,"onUpdate:modelValue":s[7]||(s[7]=I=>b.expireDate=I),type:"date","value-format":"timestamp",placeholder:"请选择库存有效期"},null,8,["modelValue"])]),_:1}),e(A,null,{default:l(()=>[e(fe,{type:"primary",icon:V(ve),":size":V(g),onClick:_},{default:l(()=>s[13]||(s[13]=[f("搜索")])),_:1},8,["icon",":size"]),e(fe,{icon:V(Fe),":size":V(g),onClick:K},{default:l(()=>s[14]||(s[14]=[f("重置")])),_:1},8,["icon",":size"])]),_:1})]),_:1},8,["model",":size"]),[[me,D.value]]),e(De,{gutter:10,class:"mb8"},{default:l(()=>[e(Le,{showSearch:D.value,"onUpdate:showSearch":s[8]||(s[8]=I=>D.value=I),onQueryTable:h},null,8,["showSearch"])]),_:1}),z((m(),y(Ee,{size:V(g),data:w.value,onSelectionChange:de},{default:l(()=>[e(E,{type:"selection",width:"55",align:"center"}),e(E,{label:"产品物料编码",width:"120px",align:"center",prop:"itemCode"}),e(E,{label:"产品物料名称",width:"150px",align:"center",prop:"itemName","show-overflow-tooltip":!0}),e(E,{label:"规格型号",align:"center",prop:"specification","show-overflow-tooltip":!0}),e(E,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(E,{label:"入库批次号",width:"100px",align:"center",prop:"batchCode","show-overflow-tooltip":!0}),e(E,{label:"仓库",align:"center",prop:"warehouseName"}),e(E,{label:"库区",align:"center",prop:"locationName"}),e(E,{label:"库位",align:"center",prop:"areaName"}),e(E,{label:"供应商编号",width:"100px",align:"center",prop:"vendorCode"}),e(E,{label:"供应商名称",width:"120px",align:"center",prop:"vendorName","show-overflow-tooltip":!0}),e(E,{label:"供应商简称",width:"100px",align:"center",prop:"vendorNick"}),e(E,{label:"在库数量",align:"center",prop:"quantityOnhand"}),e(E,{label:"库存有效期",align:"center",prop:"expireDate",width:"180"},{default:l(I=>[J("span",null,ge(V(Je)(I.row.expireDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["size","data"])),[[Ce,t.value]]),z(e(xe,{total:M.value,page:b.pageNo,"onUpdate:page":s[9]||(s[9]=I=>b.pageNo=I),limit:b.pageSize,"onUpdate:limit":s[10]||(s[10]=I=>b.pageSize=I),onPagination:h},null,8,["total","page","limit"]),[[me,M.value>0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),ia=Ue(sa,[["__scopeId","data-v-82c195e3"]]),pa=async d=>await H.get({url:"/mes/pro/workorder/page",params:d}),ca={class:"dialog-footer"},ma=He({name:"WorkOrderSelectSingle",__name:"single",emits:["onSelected"],setup(d,{expose:p,emit:j}){const v=r(!1),g=r(!0),q=r(),t=r([]);r(!0),r(!0);const S=r(!0),G=r(0),le=r([]),ne=r(),D=ke({pageNo:1,pageSize:10,workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:"CONFIRMED"}),M=async()=>{g.value=!0;try{const L=await pa(D);le.value=L.list,G.value=L.total}finally{g.value=!1}},W=()=>{M()},w=()=>{ne.value?.resetFields(),W()},x=L=>{L&&(t.value=L)},se=L=>{L&&(t.value=L)},O=L=>{L&&(t.value=L,re("onSelected",t.value),v.value=!1)},b=()=>{if(!q.value){Ye({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}re("onSelected",t.value),v.value=!1},re=j;return Te(()=>{M()}),p({showFlag:v}),(L,k)=>{const h=u("el-input"),Z=u("el-form-item"),ie=u("el-button"),F=u("el-form"),_=u("el-radio"),K=u("el-table-column"),de=Sl,ae=u("el-table"),ee=u("el-dialog"),T=be("loading");return m(),y(ee,{title:"工单选择",modelValue:v.value,"onUpdate:modelValue":k[9]||(k[9]=C=>v.value=C),modal:!1,width:"80%",center:""},{footer:l(()=>[J("div",ca,[e(ie,{type:"primary",onClick:b},{default:l(()=>k[13]||(k[13]=[f("确 定")])),_:1}),e(ie,{onClick:k[8]||(k[8]=C=>v.value=!1)},{default:l(()=>k[14]||(k[14]=[f("取 消")])),_:1})])]),default:l(()=>[z(e(F,{model:D,ref_key:"queryFormRef",ref:ne,size:"small",inline:!0,"label-width":"68px"},{default:l(()=>[e(Z,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(h,{modelValue:D.workorderCode,"onUpdate:modelValue":k[0]||(k[0]=C=>D.workorderCode=C),placeholder:"请输入工单编码",clearable:"",onKeyup:X(W,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"工单名称",prop:"workorderName"},{default:l(()=>[e(h,{modelValue:D.workorderName,"onUpdate:modelValue":k[1]||(k[1]=C=>D.workorderName=C),placeholder:"请输入工单名称",clearable:"",onKeyup:X(W,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"产品编号",prop:"productCode"},{default:l(()=>[e(h,{modelValue:D.productCode,"onUpdate:modelValue":k[2]||(k[2]=C=>D.productCode=C),placeholder:"请输入产品编号",clearable:"",onKeyup:X(W,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"产品名称",prop:"productName"},{default:l(()=>[e(h,{modelValue:D.productName,"onUpdate:modelValue":k[3]||(k[3]=C=>D.productName=C),placeholder:"请输入产品名称",clearable:"",onKeyup:X(W,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"客户名称",prop:"clientName"},{default:l(()=>[e(h,{modelValue:D.clientName,"onUpdate:modelValue":k[4]||(k[4]=C=>D.clientName=C),placeholder:"请输入客户名称",clearable:"",onKeyup:X(W,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,null,{default:l(()=>[e(ie,{type:"primary",icon:V(ve),size:"small",onClick:W},{default:l(()=>k[10]||(k[10]=[f("搜索")])),_:1},8,["icon"]),e(ie,{icon:V(Fe),size:"small",onClick:w},{default:l(()=>k[11]||(k[11]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),[[me,S.value]]),z((m(),y(ae,{data:le.value,onCurrentChange:x,onRowDblclick:O},{default:l(()=>[e(K,{width:"55",align:"center"},{default:l(C=>[e(_,{modelValue:q.value,"onUpdate:modelValue":k[5]||(k[5]=i=>q.value=i),label:C.row.id,onChange:i=>se(C.row)},{default:l(()=>k[12]||(k[12]=[f(ge(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(K,{label:"工单编码",width:"180",prop:"workorderCode"}),e(K,{label:"工单名称",width:"200",align:"center",prop:"workorderName","show-overflow-tooltip":!0}),e(K,{label:"工单来源",align:"center",prop:"orderSource"},{default:l(C=>[e(de,{type:V(Oe).MES_WORKORDER_SOURCETYPE,value:C.row.orderSource},null,8,["type","value"])]),_:1}),e(K,{label:"订单编号",width:"140",align:"center",prop:"sourceCode"}),e(K,{label:"产品编号",width:"120",align:"center",prop:"productCode"}),e(K,{label:"产品名称",width:"200",align:"center",prop:"productName","show-overflow-tooltip":!0}),e(K,{label:"规格型号",align:"center",prop:"productSpc","show-overflow-tooltip":!0}),e(K,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(K,{label:"工单数量",align:"center",prop:"quantity"}),e(K,{label:"客户编码",align:"center",prop:"clientCode"}),e(K,{label:"客户名称",align:"center",prop:"clientName","show-overflow-tooltip":!0}),e(K,{label:"需求日期",align:"center",prop:"requestDate",width:"180"},{default:l(C=>[J("span",null,ge(V(Je)(C.row.requestDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["data"])),[[T,g.value]]),z(e(xe,{total:G.value,page:D.pageNo,"onUpdate:page":k[6]||(k[6]=C=>D.pageNo=C),limit:D.pageSize,"onUpdate:limit":k[7]||(k[7]=C=>D.pageSize=C),onPagination:M},null,8,["total","page","limit"]),[[me,G.value>0]])]),_:1},8,["modelValue"])}}}),fa=Ue(ma,[["__scopeId","data-v-85cb79ad"]]),va=async d=>await H.post({url:"/wms/allocated-header/create",data:d}),ga=async d=>await H.put({url:"/wms/allocated-header/update",data:d}),wa=async d=>await H.delete({url:`/wms/allocated-header/delete?id=${d}`}),Nl=async d=>await H.get({url:`/wms/allocated-header/get?id=${d}`}),ka=async d=>await H.get({url:"/wms/allocated-header/page",params:d}),ba=async d=>await H.download({url:"/wms/allocated-header/export-excel",params:d}),_a=async d=>await H.post({url:"/wms/allocated-header/initBom",data:d}),Ca=async d=>await H.put({url:`/wms/allocated-header/${d}`}),ya=async d=>await H.get({url:`/wms/allocated-header/finsh?id=${d}`}),ha=async d=>await H.post({url:"/wms/allocated-line/updateLine",data:d}),Ia=async d=>await H.get({url:`/wms/allocated-header/createIssue?id=${d}`}),Na=async d=>await H.get({url:`/mes/autocode/get/${d}`}),Va=async d=>await H.get({url:`/wms/allocated-record/getByHeaderId?id=${d}`}),Sa={class:"app-container"},za={key:0},xa={class:"dialog-footer"},Ua={class:"dialog-footer"},qa={__name:"allocation",setup(d,{expose:p}){const j=Vl(),v=Ae(()=>j.currentSize==="mini"?"small":j.currentSize),g=r(null),q=r(null),t=r({id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),S=r({bindWorkorder:!1,status:"",allocatedDate:null,workorderCode:"",taskCode:"",clientCode:"",remark:"",workorderId:null,taskId:null}),G=r(null),le=r(null),ne=r(null),D=r(null),M=r(!1),W=r(void 0),w=r([]),x=r([]),se=ke({multiple:!1,value:"pId",label:"pName"}),O=r(!0),b=r(!1),re=r([]),L=r([]),k=r(!0),h=r(!0),Z=r(!0),ie=r(!0),F=r(!1),_=r(!0),K=r(0),de=r([]),ae=r(""),ee=r(!1),T=ke({pageNo:1,pageSize:10,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:[],status:null,remark:null,createTime:[],bindWorkorder:null}),C=r([]),i=r([]),s=ke({allocatedCode:[{required:!0,message:"调拨单编号不能为空",trigger:"blur"}],warehouseId:[{required:!0,message:"请指定调入仓库",trigger:"blur"}],locationId:[{required:!0,message:"请指定调入库区",trigger:"blur"}],areaId:[{required:!0,message:"请指定调入库位",trigger:"blur"}],workorderCode:[],taskCode:[]}),Q=r(!1),$=r(null),ue=r(null),A=ke({}),oe=r(null);r(640),r(480),r("");const P=Ae(()=>W.value==="edit");Ae(()=>t.value.bindWorkorder?{workorderCode:[{required:!0,message:"请指定生产工单",trigger:"blur"}],taskCode:[{required:!0,message:"请指定生产任务",trigger:"blur"}]}:{workorderCode:[],taskCode:[]}),Te(()=>{E(),Ee(),window.addEventListener("keydown",qe),document.addEventListener("click",()=>{Q.value&&De()}),Pe(()=>{setTimeout(()=>{$.value&&$.value.focus()},1e3)})}),Ll(()=>{fe()}),yl(()=>ue.value,o=>{if(typeof o=="string"&&o.includes("{")&&o.includes("}")){let a="";o=o.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),o=o.replace(/\uFEFF/g,"");const c=JSON.parse(o);c&&(oe.value=c.id,a=c.type),Ke(a)}else if(typeof o=="object"&&o.id){let a="";oe.value=o.id,a=o.type,Ke(a)}else console.log('输入内容不包含完整的 "{" 和 "}"')}),yl(()=>Q.value,o=>{o&&Pe(()=>{setTimeout(()=>{$.value&&($.value.focus(),console.log("设置焦点成功"))},300)})});const fe=()=>{window.removeEventListener("keydown",qe,!1)},qe=o=>{o.keyCode===13&&(ue.value=o.target.value)},Le=()=>{oe.value=null,ue.value=null},De=()=>{Q.value&&$.value&&!oe.value&&Pe(()=>{setTimeout(()=>{$.value&&$.value.focus()},300)})},E=()=>{O.value=!0,ka(T).then(o=>{de.value=o.list,K.value=o.total,O.value=!1})},Ee=()=>{xl().then(o=>{x.value=o,x.value.map(a=>{a.pId=a.id,a.pName=a.warehouseName,a.children.map(N=>{let te=JSON.stringify(N.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");N.children=JSON.parse(te)});let c=JSON.stringify(a.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");a.children=JSON.parse(c)}),W.value==="add"&&w.value.length===0&&x.value.length>0&&(w.value=[x.value[0].value,x.value[0].children[0].value,x.value[0].children[0].children[0].value])})},he=()=>{ee.value=!1,C.value=[],i.value=[],Q.value=!1,Ce()},Ce=()=>{Object.assign(t.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bomList:[]}),M.value=!1,C.value=[],w.value=[],q.value&&q.value.resetFields()},I=()=>{T.pageNo=1,E()},je=()=>{g.value&&g.value.resetFields(),I()},Ge=o=>{re.value=o.map(a=>a.id),k.value=o.length!==1,Z.value=!o.length},Xe=()=>{Ce(),ee.value=!0,ae.value="添加调拨单",W.value="add",w.value=[]},Ze=o=>{Ce();const a=o.id;Nl(a).then(c=>{Object.assign(t.value,c),t.value.bindWorkorder=t.value.bindWorkorder==="true",w.value=[c.warehouseId,c.locationId,c.areaId],C.value=c.bomList,i.value=[],ee.value=!0,ae.value="修改调拨单",W.value="edit"})},el=()=>{q.value.validate(o=>{if(o){if(t.value.bindWorkorder||(t.value.bindWorkorder=!1),t.value.warehouseId==null||t.value.locationId==null||t.value.areaId==null){Y.error("请选择调拨仓库、库区、库位信息！");return}if(i.value.length===0&&t.value.bindWorkorder===!0){Y.error("请选择需要调拨的BOM信息");return}if(t.value.bomList=i.value.map(a=>({...a,quantityAllocated:parseFloat(a.quantityAllocated)})),t.value.id!=null){ga(t.value).then(a=>{Y.success("修改成功"),ee.value=!1,E()});return}t.value.bomList=i.value,va(t.value).then(a=>{Y.success("新增成功"),ee.value=!1,E()})}})},ll=o=>{const a=o.id;$e.confirm('是否确认删除调拨单头编号为"'+a+'"的数据项?').then(()=>wa(a)).then(()=>{E(),Y.success("删除成功")}).catch(()=>{})},al=()=>{let o={...T};o.pageNo=void 0,o.pageSize=void 0,$e.confirm("是否确认导出所有调拨单头数据项?").then(()=>(F.value=!0,ba(o))).then(a=>{Kl.excel(a,"调拨单头.xls"),Y.success("导出成功"),F.value=!1}).catch(()=>{})},We=o=>{o!==null?(t.value.warehouseId=o[0],t.value.locationId=o[1],t.value.areaId=o[2]):(t.value.warehouseId=null,t.value.locationId=null,t.value.areaId=null)},Me=()=>{le.value.showFlag=!0},Ul=o=>{o!=null&&o!=null&&(t.value.workorderId=o.id,t.value.workorderCode=o.workorderCode,t.value.workorderName=o.workorderName,t.value.clientId=o.clientId,t.value.clientCode=o.clientCode,t.value.clientName=o.clientName),b.value=!0,_a(t.value.workorderCode).then(a=>{C.value=a,b.value=!1})},ol=o=>{o?(O.value=!0,Na("ALLOCATED_CODE").then(a=>{t.value.allocatedCode=a,O.value=!1})):t.value.allocatedCode=null},tl=o=>{Ce();const a=o.id||re.value;O.value=!0,ya(a).then(c=>{Y.success("成功"),ee.value=!1,O.value=!1,E()})},nl=o=>{i.value=o.map(a=>({...a}))},rl=o=>{ql(o.id)},ql=o=>{A.id=o,Pe(()=>{G.value&&G.value.resetFields()}),Nl(o).then(a=>{Object.assign(A,a),A.bindWorkorder=A.bindWorkorder==="true",w.value=[a.warehouseId,a.locationId,a.areaId],w.value[0]=a.warehouseId,w.value[1]=a.locationId,w.value[2]=a.areaId,C.value=a.bomList}),Va(o).then(a=>{i.value=a}),Q.value=!0},dl=()=>{if(!oe.value){Y.error("请扫描正确的单据信息!");return}Ke()},ul=()=>{D.value.showFlag=!0,D.value.getList()},sl=()=>{const o=L.value;i.value=i.value.filter(a=>!o.includes(a.id))},il=o=>{L.value=o.map(a=>a.id),h.value=o.length!==1,ie.value=!o.length},Ke=o=>{let a="";if(o&&(a=o),w.value[0]===""||w.value[1]===""||w.value[2]===""){Y.error("请选择调拨仓库、库区、库位信息！");return}if(!oe.value){Y.error("请输入或扫描单据信息!");return}let c={id:parseInt(oe.value),type:a,method:"allocated",warehouseId:w.value[0],locationId:w.value[1],areaId:w.value[2]};O.value=!0,Bl(c).then(N=>{O.value=!1;let te=N;te.quantityAllocated=te.quantityOnhand,i.value.some(ye=>ye.itemCode===te.itemCode&&ye.batchCode===te.batchCode)?Y.error("物料唯一码已存在，请勿添加重复项。"):(Y.success("新增成功"),i.value.push(te))})},pl=async()=>{let o={headerId:A.id,bomList:i.value};O.value=!0;try{await ha(o),await Ca(A.id),O.value=!1,E(),Y.success("出库成功"),Q.value=!1}catch{Y.error("操作失败"),O.value=!1}},cl=o=>{const a=parseFloat(o.quantityAllocated);if(isNaN(a)||a<=0){Y.error("调拨数量必须为大于0的正数"),o.quantityAllocated="";return}const c=i.value.findIndex(N=>N.itemCode===o.itemCode);c!==-1&&(i.value[c]={...i.value[c],quantityAllocated:a})},Be=()=>{ne.value.showFlag=!0,ne.value.getList()},Dl=o=>{o!=null&&o!=null&&(t.value.taskId=o.id,t.value.taskCode=o.taskCode,t.value.taskName=o.taskName,t.value.workstationId=o.workstationId,t.value.workstationCode=o.workstationCode,t.value.workstationName=o.workstationName,t.value.processId=o.processId,t.value.processCode=o.processCode,t.value.processName=o.processName)},Rl=o=>{o!=null&&o!=null&&(A.taskId=o.id,A.taskCode=o.taskCode,A.taskName=o.taskName,A.workstationId=o.workstationId,A.workstationCode=o.workstationCode,A.workstationName=o.workstationName,A.processId=o.processId,A.processCode=o.processCode,A.processName=o.processName)},Pl=o=>{if(o!=null&&o!=null)for(let a=0;a<o.length;a++){let c=o[a];c.quantityAllocated=c.quantityOnhand,i.value.some(te=>te.itemCode===c.itemCode&&te.batchCode===c.batchCode)?Y.error("物料唯一码已存在，请勿添加重复项。"):i.value.push(c)}},ml=o=>{t.value.bindWorkorder=o,q.value&&q.value.validate()},fl=o=>{$e.confirm("确认生成领料单吗?").then(()=>{O.value=!0;const a=o.id||re.value;Ia(a).then(()=>{O.value=!1,E(),Y.success("领料单创建成功"),Q.value=!1}).catch(c=>{Y.error("领料单创建失败"),O.value=!1})}).catch(()=>{Y.info("已取消")})};return p({queryParams:T,showSearch:_,loading:O,list:de,total:K,single:k,multiple:Z,exportLoading:F,handleQuery:I,resetQuery:je,handleSelectionChange:Ge,handleAdd:Xe,handleUpdate:Ze,handleDelete:ll,handleExport:al,handleFinsh:tl,handleIssue:fl,handleExecute:rl,form:t,rules:s,autoGenFlag:M,optType:W,warehouseInfo:w,warehouseOptions:x,warehouseProps:se,bomList:C,allocatedList:i,bomLoadding:b,open:ee,title:ae,isEdit:P,handleAutoGenChange:ol,handleWarehouseChanged:We,handleWorkorderSelect:Me,handleTaskSelect:Be,handleBindWorkorderChange:ml,handleBomSelectionChange:nl,handleQuantityChange:cl,submitForm:el,cancel:he,executeDialogVisible:Q,executeForm:A,purchaseId:oe,allocatedSingle:h,allocatedHandleAdd:dl,allocatedHandleBatchAdd:ul,allocatedHandleDelete:sl,allocatedHandleSelectionChange:il,executeAllocated:pl}),(o,a)=>{const c=u("el-input"),N=u("el-form-item"),te=u("el-date-picker"),B=u("el-button"),ye=u("el-form"),R=u("el-col"),pe=u("el-row"),U=u("el-table-column"),Al=Sl,Ie=u("el-table"),Ol=xe,Tl=Fl,vl=u("el-switch"),gl=u("el-cascader"),wl=u("el-option"),kl=u("el-select"),Re=u("el-divider"),bl=u("el-card"),_l=u("el-dialog"),we=be("hasPermi"),Ne=be("loading"),Cl=be("dialogDrag");return m(),_e("div",Sa,[z(e(ye,{model:T,ref:"queryFormRef",size:v.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(N,{label:"调拨单号",prop:"allocatedCode"},{default:l(()=>[e(c,{modelValue:T.allocatedCode,"onUpdate:modelValue":a[0]||(a[0]=n=>T.allocatedCode=n),placeholder:"请输入调拨单编号",clearable:"",onKeyup:X(I,["enter"])},null,8,["modelValue"])]),_:1}),e(N,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(c,{modelValue:T.allocatedName,"onUpdate:modelValue":a[1]||(a[1]=n=>T.allocatedName=n),placeholder:"请输入调拨单名称",clearable:"",onKeyup:X(I,["enter"])},null,8,["modelValue"])]),_:1}),e(N,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(c,{modelValue:T.workorderCode,"onUpdate:modelValue":a[2]||(a[2]=n=>T.workorderCode=n),placeholder:"请输入生产工单编码",clearable:"",onKeyup:X(I,["enter"])},null,8,["modelValue"])]),_:1}),e(N,{label:"仓库名称",prop:"warehouseName"},{default:l(()=>[e(c,{modelValue:T.warehouseName,"onUpdate:modelValue":a[3]||(a[3]=n=>T.warehouseName=n),placeholder:"请输入仓库名称",clearable:"",onKeyup:X(I,["enter"])},null,8,["modelValue"])]),_:1}),e(N,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(te,{modelValue:T.allocatedDate,"onUpdate:modelValue":a[4]||(a[4]=n=>T.allocatedDate=n),style:{width:"240px"},"value-format":"yyyy-MM-dd HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),e(N,null,{default:l(()=>[e(B,{type:"primary",icon:V(ve),onClick:I},{default:l(()=>a[30]||(a[30]=[f("搜索")])),_:1},8,["icon"]),e(B,{icon:V(Fe),onClick:je},{default:l(()=>a[31]||(a[31]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[me,_.value]]),e(pe,{gutter:10,class:"mb8"},{default:l(()=>[e(R,{span:1.5},{default:l(()=>[z((m(),y(B,{type:"primary",icon:V(Qe),size:v.value,onClick:Xe},{default:l(()=>a[32]||(a[32]=[f("新增 ")])),_:1},8,["icon","size"])),[[we,["wms:allocated-header:create"]]])]),_:1}),e(R,{span:1.5},{default:l(()=>[z((m(),y(B,{type:"warning",plain:"",icon:V(El),size:v.value,onClick:al,loading:F.value},{default:l(()=>a[33]||(a[33]=[f("导出 ")])),_:1},8,["icon","size","loading"])),[[we,["wms:allocated-header:export"]]])]),_:1}),e(R,{span:1.5},{default:l(()=>[z((m(),y(B,{type:"success",plain:"",icon:V(hl),size:v.value,onClick:tl,disabled:k.value},{default:l(()=>a[34]||(a[34]=[f("完成 ")])),_:1},8,["icon","size","disabled"])),[[we,["wms:allocated-header:finsh"]]])]),_:1}),e(R,{span:1.5},{default:l(()=>[z((m(),y(B,{plain:"",icon:V(hl),size:v.value,onClick:fl,disabled:k.value},{default:l(()=>a[35]||(a[35]=[f("生成领料单 ")])),_:1},8,["icon","size","disabled"])),[[we,["wms:allocated-header:createIssue"]]])]),_:1})]),_:1}),e(Tl,null,{default:l(()=>[z((m(),y(Ie,{data:de.value,size:v.value,onSelectionChange:Ge},{default:l(()=>[e(U,{type:"selection",width:"55",align:"center"}),e(U,{label:"调拨单编号",align:"center",prop:"allocatedCode"}),e(U,{label:"调拨单名称",align:"center",prop:"allocatedName"}),e(U,{label:"生产工单",align:"center",prop:"workorderCode"}),e(U,{label:"调拨日期",align:"center",prop:"allocatedDate",width:"180"},{default:l(n=>[J("span",null,ge(V(Je)(n.row.allocatedDate,"YYYY-MM-DD")),1)]),_:1}),e(U,{label:"单据状态",align:"center",prop:"status"},{default:l(n=>[e(Al,{type:V(Oe).MES_ALLOCATED_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),e(U,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(n=>[n.row.status!="FINISHED"?z((m(),y(B,{key:0,size:v.value,type:"text",onClick:Ve=>rl(n.row)},{default:l(()=>a[36]||(a[36]=[f("执行领出")])),_:2},1032,["size","onClick"])),[[we,["wms:allocated-header:allocated"]]]):ce("",!0),z((m(),y(B,{size:v.value,type:"text",onClick:Ve=>Ze(n.row)},{default:l(()=>a[37]||(a[37]=[f("修改 ")])),_:2},1032,["size","onClick"])),[[we,["wms:allocated-header:update"]]]),z((m(),y(B,{size:v.value,type:"text",onClick:Ve=>ll(n.row)},{default:l(()=>a[38]||(a[38]=[f("删除 ")])),_:2},1032,["size","onClick"])),[[we,["wms:allocated-header:delete"]]])]),_:1})]),_:1},8,["data","size"])),[[Ne,O.value]]),z(e(Ol,{total:K.value,page:T.pageNo,"onUpdate:page":a[5]||(a[5]=n=>T.pageNo=n),limit:T.pageSize,"onUpdate:limit":a[6]||(a[6]=n=>T.pageSize=n),onPagination:E},null,8,["total","page","limit"]),[[me,K.value>0]])]),_:1}),z((m(),y(_l,{title:ae.value,modelValue:ee.value,"onUpdate:modelValue":a[17]||(a[17]=n=>ee.value=n),width:"80%","append-to-body":""},{footer:l(()=>[J("div",xa,[e(B,{size:v.value,type:"primary",onClick:el},{default:l(()=>a[41]||(a[41]=[f("确 定")])),_:1},8,["size"]),e(B,{size:v.value,onClick:he},{default:l(()=>a[42]||(a[42]=[f("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(ye,{ref_key:"formRef",ref:q,size:v.value,model:t.value,rules:s},{default:l(()=>[e(pe,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(N,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(c,{disabled:P.value,modelValue:t.value.allocatedCode,"onUpdate:modelValue":a[7]||(a[7]=n=>t.value.allocatedCode=n),placeholder:"请输入调拨单编号"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(R,{span:4},{default:l(()=>[e(N,null,{default:l(()=>[W.value!="view"&&t.value.status=="PREPARE"?(m(),y(vl,{key:0,modelValue:M.value,"onUpdate:modelValue":a[8]||(a[8]=n=>M.value=n),"active-color":"#13ce66","active-text":"自动生成",onChange:ol},null,8,["modelValue"])):ce("",!0)]),_:1})]),_:1}),e(R,{span:12},{default:l(()=>[e(N,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(c,{disabled:"",modelValue:t.value.allocatedName,"onUpdate:modelValue":a[9]||(a[9]=n=>t.value.allocatedName=n),placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(pe,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(N,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(te,{clearable:"",modelValue:t.value.allocatedDate,"onUpdate:modelValue":a[10]||(a[10]=n=>t.value.allocatedDate=n),type:"date","value-format":"timestamp",placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(N,{label:"领料仓库"},{default:l(()=>[e(gl,{modelValue:w.value,"onUpdate:modelValue":a[11]||(a[11]=n=>w.value=n),options:x.value,props:se,placeholder:"请选择",onChange:We},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(N,{label:"单据状态",prop:"status"},{default:l(()=>[e(kl,{modelValue:t.value.status,"onUpdate:modelValue":a[12]||(a[12]=n=>t.value.status=n),disabled:""},{default:l(()=>[(m(!0),_e(Se,null,ze(V(Oe).MES_ALLOCATED_STATUS,n=>(m(),y(wl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(pe,null,{default:l(()=>[e(R,{span:2}),e(R,{span:6},{default:l(()=>[e(N,{"label-width":"80"},{default:l(()=>[W.value!="view"&&t.value.status=="PREPARE"?(m(),y(vl,{key:0,style:{"margin-left":"10%"},modelValue:t.value.bindWorkorder,"onUpdate:modelValue":a[13]||(a[13]=n=>t.value.bindWorkorder=n),"active-color":"#13ce66","inactive-text":"绑定工单",onChange:ml},null,8,["modelValue"])):ce("",!0)]),_:1})]),_:1}),t.value&&t.value.bindWorkorder?(m(),y(R,{key:0,span:8},{default:l(()=>[e(N,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(c,{modelValue:t.value.workorderCode,"onUpdate:modelValue":a[14]||(a[14]=n=>t.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(B,{icon:V(ve),onClick:Me},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(fa,{ref:"woSelectRef",onOnSelected:Ul},null,512)]),_:1})):ce("",!0),t.value&&t.value.bindWorkorder?(m(),y(R,{key:1,span:8},{default:l(()=>[e(N,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(c,{modelValue:t.value.taskCode,"onUpdate:modelValue":a[15]||(a[15]=n=>t.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(B,{icon:V(ve),onClick:Be},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Il,{ref:"taskSelectRef",workorderId:t.value.workorderId,onOnSelected:Dl},null,8,["workorderId"])]),_:1})):ce("",!0)]),_:1}),e(pe,null,{default:l(()=>[e(R,{span:24},{default:l(()=>[e(N,{label:"备注",prop:"remark"},{default:l(()=>[e(c,{modelValue:t.value.remark,"onUpdate:modelValue":a[16]||(a[16]=n=>t.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"]),t.value&&t.value.bindWorkorder?(m(),_e("div",za,[e(Re,{"content-position":"center"},{default:l(()=>a[39]||(a[39]=[f("物料信息")])),_:1}),e(bl,{shadow:"always",class:"box-card"},{default:l(()=>[z((m(),y(Ie,{size:v.value,"max-height":"300",data:C.value,onSelectionChange:nl},{default:l(()=>[e(U,{type:"selection",width:"65",align:"center"}),e(U,{label:"物料编码",align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{width:"210",label:"需求数量",align:"center",prop:"quantityAllocated"}),e(U,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ne,b.value]])]),_:1}),e(Re,{"content-position":"center"},{default:l(()=>a[40]||(a[40]=[f("调拨信息")])),_:1}),e(bl,{shadow:"always",class:"box-card"},{default:l(()=>[z((m(),y(Ie,{size:v.value,"max-height":"300",data:i.value,"row-key":"itemCode"},{default:l(()=>[e(U,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{width:"220",label:"调拨数量",align:"center",prop:"quantityAllocated"},{default:l(n=>[e(c,{modelValue:n.row.quantityAllocated,"onUpdate:modelValue":Ve=>n.row.quantityAllocated=Ve,type:"number",placeholder:"请输入数量",onBlur:Ve=>cl(n.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(U,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ne,b.value]])]),_:1})])):ce("",!0)]),_:1},8,["title","modelValue"])),[[Cl]]),z((m(),y(_l,{title:"执行出库",class:"execute-dialog",modelValue:Q.value,"onUpdate:modelValue":a[29]||(a[29]=n=>Q.value=n),width:"92%","append-to-body":""},{footer:l(()=>[J("span",Ua,[e(B,{size:v.value,onClick:he},{default:l(()=>a[50]||(a[50]=[f("取 消")])),_:1},8,["size"]),e(B,{size:v.value,type:"primary",onClick:pl},{default:l(()=>a[51]||(a[51]=[f("确 定")])),_:1},8,["size"])])]),default:l(()=>[e(ye,{size:v.value,ref_key:"executeFormRef",ref:G,model:S.value,"label-width":"100px"},{default:l(()=>[e(pe,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(N,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(c,{modelValue:S.value.allocatedCode,"onUpdate:modelValue":a[18]||(a[18]=n=>S.value.allocatedCode=n),disabled:"",placeholder:"请输入调拨单编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:12},{default:l(()=>[e(N,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(c,{modelValue:S.value.allocatedName,"onUpdate:modelValue":a[19]||(a[19]=n=>S.value.allocatedName=n),disabled:"",placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(pe,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(N,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(te,{clearable:"",modelValue:S.value.allocatedDate,"onUpdate:modelValue":a[20]||(a[20]=n=>S.value.allocatedDate=n),disabled:"",type:"date","value-format":"timestamp",placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(N,{label:"领料仓库"},{default:l(()=>[e(gl,{disabled:"",modelValue:w.value,"onUpdate:modelValue":a[21]||(a[21]=n=>w.value=n),options:x.value,props:se,onChange:We},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(N,{label:"单据状态",prop:"status"},{default:l(()=>[e(kl,{disabled:"",modelValue:S.value.status,"onUpdate:modelValue":a[22]||(a[22]=n=>S.value.status=n)},{default:l(()=>[(m(!0),_e(Se,null,ze(V(Oe).MES_ALLOCATED_STATUS,n=>(m(),y(wl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),S.value.bindWorkorder?(m(),y(pe,{key:0},{default:l(()=>[e(R,{span:8},{default:l(()=>[e(N,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(c,{disabled:"",modelValue:S.value.workorderCode,"onUpdate:modelValue":a[23]||(a[23]=n=>S.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(B,{disabled:"",icon:V(ve),onClick:Me},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(N,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(c,{disabled:"",modelValue:S.value.taskCode,"onUpdate:modelValue":a[24]||(a[24]=n=>S.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(B,{disabled:"",icon:V(ve),onClick:Be},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Il,{ref:"taskSelectRef",workorderId:S.value.workorderId,onOnSelected:Rl},null,8,["workorderId"])]),_:1}),e(R,{span:8},{default:l(()=>[e(N,{label:"客户编号"},{default:l(()=>[e(c,{disabled:"",modelValue:S.value.clientCode,"onUpdate:modelValue":a[25]||(a[25]=n=>S.value.clientCode=n),placeholder:"请选择生产工单"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):ce("",!0),e(pe,null,{default:l(()=>[e(R,{span:24},{default:l(()=>[e(N,{label:"备注",prop:"remark"},{default:l(()=>[e(c,{disabled:"",modelValue:S.value.remark,"onUpdate:modelValue":a[26]||(a[26]=n=>S.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S.value.bindWorkorder?(m(),y(Re,{key:1,"content-position":"center"},{default:l(()=>a[43]||(a[43]=[f("BOM信息")])),_:1})):ce("",!0),S.value.bindWorkorder?z((m(),y(Ie,{key:2,size:v.value,"max-height":"200",data:C.value,style:{width:"100%"}},{default:l(()=>[e(U,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{label:"需求数量",align:"center",prop:"quantityAllocated"}),e(U,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ne,b.value]]):ce("",!0),e(Re,{"content-position":"center"},{default:l(()=>a[44]||(a[44]=[f("调拨信息")])),_:1}),e(pe,{gutter:10},{default:l(()=>[e(R,{span:8},{default:l(()=>[e(N,{label:"单据信息",prop:"purchaseId"},{default:l(()=>[e(c,{readonly:"",modelValue:oe.value,"onUpdate:modelValue":a[27]||(a[27]=n=>oe.value=n),placeholder:"请输入"},null,8,["modelValue"]),z(J("input",{ref_key:"scannerInput",ref:$,"onUpdate:modelValue":a[28]||(a[28]=n=>ue.value=n),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"1",height:"1","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[Wl,ue.value]]),a[45]||(a[45]=J("span",null,"支持扫码枪扫描",-1))]),_:1})]),_:1}),e(R,{span:4},{default:l(()=>[e(B,{type:"primary",round:"",onClick:Le},{default:l(()=>a[46]||(a[46]=[f("重置")])),_:1})]),_:1}),e(R,{span:2.5},{default:l(()=>[e(B,{type:"primary",style:{"margin-right":"10px"},icon:V(Qe),size:v.value,onClick:dl},{default:l(()=>a[47]||(a[47]=[f("新增")])),_:1},8,["icon","size"])]),_:1}),e(R,{span:2.5},{default:l(()=>[z((m(),y(B,{type:"primary",style:{"margin-right":"10px"},icon:V(Qe),size:v.value,onClick:ul},{default:l(()=>a[48]||(a[48]=[f("批量新增")])),_:1},8,["icon","size"])),[[we,["wms:allocated-header:batchAdd"]]])]),_:1}),e(ia,{ref_key:"stockSelectRef",ref:D,onOnSelected:Pl},null,512),e(R,{span:2.5},{default:l(()=>[e(B,{type:"danger",plain:"",icon:V(Ml),size:v.value,disabled:h.value,onClick:sl},{default:l(()=>a[49]||(a[49]=[f("删除")])),_:1},8,["icon","size","disabled"])]),_:1})]),_:1}),z((m(),y(Ie,{size:v.value,data:i.value,onSelectionChange:il},{default:l(()=>[e(U,{type:"selection",width:"55",align:"center"}),e(U,{label:"序号",width:"55",align:"center"},{default:l(n=>[f(ge(n.$index+1),1)]),_:1}),e(U,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{label:"调拨数量","show-overflow-tooltip":!0,align:"center",prop:"quantityAllocated"}),e(U,{width:"70",label:"单位",align:"center",prop:"unitOfMeasure"}),e(U,{label:"批次号","show-overflow-tooltip":!0,align:"center",prop:"batchCode"}),e(U,{label:"调拨标识","show-overflow-tooltip":!0,width:"90",align:"center",prop:"allocatedFlag"}),e(U,{label:"仓库名称","show-overflow-tooltip":!0,align:"center",prop:"warehouseName"}),e(U,{label:"库区名称","show-overflow-tooltip":!0,align:"center",prop:"locationName"}),e(U,{label:"库位名称","show-overflow-tooltip":!0,align:"center",prop:"areaName"})]),_:1},8,["size","data"])),[[Ne,O.value]])]),_:1},8,["size","model"])]),_:1},8,["modelValue"])),[[Cl]])])}}},Fa=Ue(qa,[["__scopeId","data-v-931b9592"]]);export{Fa as default};
