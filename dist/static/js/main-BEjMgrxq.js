/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 13:38:04 
 */
import{_ as D}from"./ContentWrap.vue_vue_type_script_setup_true_lang-32ziCa0j.js";import{R as w}from"./TabNews-BfsExiD9.js";import P from"./main-CkzthxEZ.js";import q from"./MsgList-C1u9Wbk2.js";import{V as R,d as O,r as o,f as M,b as E,g as L,h as U,k as A,o as d,m as T,i as v,w as z,c as f,l as b,j as I,a as t,y as J,v as X,z as $,X as C,A as F}from"./index-FPuwcz_Y.js";import{g as G}from"./index-B2rHlKDK.js";const K=i=>R.get({url:"/mp/message/page",params:i}),Q=i=>R.post({url:"/mp/message/send",data:i}),Y="/m/pad/static/jpg/profile-BiJdjH9E.jpg",Z={key:0},ee={key:1,class:"el-table__empty-block"},ae={class:"msg-send"},te=O({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(i){const V=$(),_=i,p=o(-1),m=o(!1),y=o(!0),u=o([]),n=M({pageNo:1,pageSize:14,accountId:p}),r=M({nickname:"用户",avatar:Y,accountId:p}),N=o(!1),a=o({type:w.Text,accountId:-1,articles:[]}),h=o(null),l=o(null);E(async()=>{const e=await G(_.userId);r.nickname=e.nickname?.length>0?e.nickname:r.nickname,r.avatar=r.avatar?.length>0?e.avatar:r.avatar,p.value=e.accountId,a.value.accountId=e.accountId,H()});const j=async()=>{if(!t(a))return;a.value.type===w.News&&a.value.articles&&a.value.articles.length>1&&(a.value.articles=[a.value.articles[0]],V.success("图文消息条数限制在 1 条以内，已默认发送第一条"));const e=await Q({userId:_.userId,...a.value});N.value=!1,u.value=[...u.value,e],await S(),h.value?.clear()},B=()=>{n.pageNo++,x(n,null)},x=async(e,s=null)=>{m.value=!0;const k=await K(Object.assign({pageNo:e.pageNo,pageSize:e.pageSize,userId:_.userId,accountId:e.accountId},s)),g=l.value?.scrollHeight??0,c=k.list.reverse();u.value=[...c,...u.value],m.value=!1,(c.length<n.pageSize||c.length===0)&&(y.value=!1),n.pageNo=e.pageNo,n.pageSize=e.pageSize,n.pageNo===1?await S():c.length!==0&&(await C(),g!==0&&l.value&&(l.value.scrollTop=l.value.scrollHeight-g-100))},H=()=>{x(n)},S=async()=>{await C(),l.value&&(l.value.scrollTop=l.value.scrollHeight)};return(e,s)=>{const k=L("el-button"),g=D,c=U("loading");return d(),A(g,null,{default:T(()=>[v("div",{ref_key:"msgDivRef",ref:l,class:"msg-div"},[z(v("div",null,null,512),[[c,t(m)]]),t(m)?b("",!0):(d(),f("div",Z,[t(y)?(d(),f("div",{key:0,class:"el-table__empty-block",onClick:B},s[1]||(s[1]=[v("span",{class:"el-table__empty-text"},"点击加载更多",-1)]))):b("",!0),t(y)?b("",!0):(d(),f("div",ee,s[2]||(s[2]=[v("span",{class:"el-table__empty-text"},"没有更多了",-1)])))])),I(q,{"account-id":t(p),list:t(u),user:t(r)},null,8,["account-id","list","user"])],512),z((d(),f("div",ae,[I(t(P),{ref_key:"replySelectRef",ref:h,modelValue:t(a),"onUpdate:modelValue":s[0]||(s[0]=W=>J(a)?a.value=W:null)},null,8,["modelValue"]),I(k,{class:"send-but",type:"success",onClick:j},{default:T(()=>s[3]||(s[3]=[X("发送(S)")])),_:1})])),[[c,t(N)]])]),_:1})}}}),se=F(te,[["__scopeId","data-v-c16b3155"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as W,K as g,ue as m};
