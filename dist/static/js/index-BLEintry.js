/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:10:14 
 */
import{d as O,r as i,f as Q,b as j,g as m,h as V,c as J,o as d,j as e,m as o,a,J as $,w as f,v as p,K as W,k as _,cL as Y,t as G,L as H,M as X,F as Z,z as ee,N as te}from"./index-BdC40rFX.js";import{_ as ae}from"./DictTag.vue_vue_type_script_lang-BKaaD_BY.js";import{_ as le}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CdI9J0YF.js";import{_ as oe,a as ne,d as re,e as se}from"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-BmVVy2kQ.js";import{g as ie}from"./index-CRfpNMbL.js";import{D as L}from"./dict-D4wjFrBa.js";import{d as pe}from"./download-U6qaYcnP.js";import"./color-B5phLuB-.js";const we=O({name:"ReceivablePlan",__name:"index",setup(ce){const w=ee(),{t:M}=te(),y=i(!0),I=i(0),S=i([]),P=i([]),r=Q({pageNo:1,pageSize:10,customerId:null,contractId:null}),T=i(),x=i(!1),u=async()=>{y.value=!0;try{const s=await ne(r);S.value=s.list,I.value=s.total}finally{y.value=!1}},g=()=>{r.pageNo=1,u()},h=()=>{T.value.resetFields(),g()},U=i(),R=(s,t)=>{U.value.open(s,t)},z=async s=>{try{await w.delConfirm(),await re(s),w.success(M("common.delSuccess")),await u()}catch(t){console.log(t)}},K=async()=>{try{await w.exportConfirm(),x.value=!0;const s=await se(r);pe.excel(s,"回款计划.xls")}catch(s){console.log(s)}finally{x.value=!1}};return j(async()=>{await u(),P.value=await ie()}),(s,t)=>{const D=m("el-input"),k=m("el-form-item"),b=W,c=m("el-button"),q=m("el-form"),F=le,n=m("el-table-column"),N=ae,A=m("el-table"),B=X,v=V("hasPermi"),E=V("loading");return d(),J(Z,null,[e(F,null,{default:o(()=>[e(q,{ref_key:"queryFormRef",ref:T,class:"-mb-15px",inline:!0,"label-width":"68px",model:a(r)},{default:o(()=>[e(k,{label:"客户",prop:"customerId"},{default:o(()=>[e(D,{modelValue:a(r).customerId,"onUpdate:modelValue":t[0]||(t[0]=l=>a(r).customerId=l),class:"!w-240px",clearable:"",placeholder:"请输入客户",onKeyup:$(g,["enter"])},null,8,["modelValue"])]),_:1}),e(k,{label:"合同",prop:"contractId"},{default:o(()=>[e(D,{modelValue:a(r).contractId,"onUpdate:modelValue":t[1]||(t[1]=l=>a(r).contractId=l),class:"!w-240px",clearable:"",placeholder:"请输入合同",onKeyup:$(g,["enter"])},null,8,["modelValue"])]),_:1}),e(k,null,{default:o(()=>[e(c,{onClick:g},{default:o(()=>[e(b,{class:"mr-5px",icon:"ep:search"}),t[5]||(t[5]=p(" 搜索 "))]),_:1}),e(c,{onClick:h},{default:o(()=>[e(b,{class:"mr-5px",icon:"ep:refresh"}),t[6]||(t[6]=p(" 重置 "))]),_:1}),f((d(),_(c,{plain:"",type:"primary",onClick:t[2]||(t[2]=l=>R("create"))},{default:o(()=>[e(b,{class:"mr-5px",icon:"ep:plus"}),t[7]||(t[7]=p(" 新增 "))]),_:1})),[[v,["crm:receivable-plan:create"]]]),f((d(),_(c,{loading:a(x),plain:"",type:"success",onClick:K},{default:o(()=>[e(b,{class:"mr-5px",icon:"ep:download"}),t[8]||(t[8]=p(" 导出 "))]),_:1},8,["loading"])),[[v,["crm:receivable-plan:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(F,null,{default:o(()=>[f((d(),_(A,{data:a(S),"show-overflow-tooltip":!0,stripe:!0},{default:o(()=>[e(n,{align:"center",label:"客户名称",prop:"customerId",width:"150px"}),e(n,{align:"center",label:"合同名称",prop:"contractId",width:"150px"}),e(n,{align:"center",label:"期数",prop:"period"}),e(n,{align:"center",label:"计划回款",prop:"price"}),e(n,{align:"center",formatter:a(Y),label:"计划回款日期",prop:"returnTime",width:"180px"},null,8,["formatter"]),e(n,{align:"center",label:"提前几天提醒",prop:"remindDays"}),e(n,{align:"center",label:"完成状态",prop:"status"},{default:o(l=>[e(N,{type:a(L).COMMON_STATUS,value:l.row.status},null,8,["type","value"])]),_:1}),e(n,{align:"center",label:"审批状态",prop:"checkStatus",width:"130px"},{default:o(l=>[e(N,{type:a(L).CRM_AUDIT_STATUS,value:l.row.checkStatus},null,8,["type","value"])]),_:1}),e(n,{label:"负责人",prop:"ownerUserId",width:"120"},{default:o(l=>[p(G(a(P).find(C=>C.id===l.row.ownerUserId)?.nickname),1)]),_:1}),e(n,{align:"center",label:"显示顺序",prop:"sort"}),e(n,{align:"center",label:"备注",prop:"remark"}),e(n,{align:"center",formatter:a(H),label:"创建时间",prop:"createTime",width:"180px"},null,8,["formatter"]),e(n,{align:"center",label:"操作",width:"130px"},{default:o(l=>[f((d(),_(c,{link:"",type:"primary",onClick:C=>R("update",l.row.id)},{default:o(()=>t[9]||(t[9]=[p(" 编辑 ")])),_:2},1032,["onClick"])),[[v,["crm:receivable-plan:update"]]]),f((d(),_(c,{link:"",type:"danger",onClick:C=>z(l.row.id)},{default:o(()=>t[10]||(t[10]=[p("删除")])),_:2},1032,["onClick"])),[[v,["crm:receivable-plan:delete"]]])]),_:1})]),_:1},8,["data"])),[[E,a(y)]]),e(B,{limit:a(r).pageSize,"onUpdate:limit":t[3]||(t[3]=l=>a(r).pageSize=l),page:a(r).pageNo,"onUpdate:page":t[4]||(t[4]=l=>a(r).pageNo=l),total:a(I),onPagination:u},null,8,["limit","page","total"])]),_:1}),e(oe,{ref_key:"formRef",ref:U,onSuccess:u},null,512)],64)}}});export{we as default};
