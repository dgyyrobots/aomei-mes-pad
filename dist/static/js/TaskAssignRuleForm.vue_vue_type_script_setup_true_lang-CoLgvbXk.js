/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{V as D,d as j,r as p,f as z,g as d,k as r,o,m as a,j as u,a as s,l as g,c as I,F as v,n as b,v as x,y as H,_ as J,z as Q,N as W}from"./index-lcC3l4R2.js";import{c as C,D as F}from"./dict-B7jb0IEc.js";import{d as X,h as Z}from"./tree-vSlcEeQq.js";import{g as ee}from"./index-D2sXn1rt.js";import{g as te}from"./index-DhibROQM.js";import{g as se}from"./index-dnbb54u8.js";import{g as le}from"./index-DNzgPDZI.js";import{g as ae}from"./index-MRnS6Log.js";const ge=async i=>await D.get({url:"/bpm/task-assign-rule/list",params:i}),oe=async i=>await D.post({url:"/bpm/task-assign-rule/create",data:i}),ue=async i=>await D.put({url:"/bpm/task-assign-rule/update",data:i}),Ie=j({name:"BpmTaskAssignRuleForm",__name:"TaskAssignRuleForm",emits:["success"],setup(i,{expose:O,emit:P}){const{t:S}=W(),T=Q(),m=p(!1),k=p(!1),l=p({type:NaN,modelId:"",options:[],roleIds:[],deptIds:[],postIds:[],userIds:[],userGroupIds:[],scripts:[]}),w=z({type:[{required:!0,message:"规则类型不能为空",trigger:"change"}],roleIds:[{required:!0,message:"指定角色不能为空",trigger:"change"}],deptIds:[{required:!0,message:"指定部门不能为空",trigger:"change"}],postIds:[{required:!0,message:"指定岗位不能为空",trigger:"change"}],userIds:[{required:!0,message:"指定用户不能为空",trigger:"change"}],userGroupIds:[{required:!0,message:"指定用户组不能为空",trigger:"change"}],scripts:[{required:!0,message:"指定脚本不能为空",trigger:"change"}]}),_=p(),G=p([]),R=p([]),U=p(),N=p([]),A=p([]),L=p([]),B=C(F.BPM_TASK_ASSIGN_SCRIPT);O({open:async(V,e)=>{h(),l.value={...e,modelId:V,options:[],roleIds:[],deptIds:[],postIds:[],userIds:[],userGroupIds:[],scripts:[]},e.type===10?l.value.roleIds.push(...e.options):e.type===20||e.type===21?l.value.deptIds.push(...e.options):e.type===22?l.value.postIds.push(...e.options):e.type===30||e.type===31||e.type===32?l.value.userIds.push(...e.options):e.type===40?l.value.userGroupIds.push(...e.options):e.type===50&&l.value.scripts.push(...e.options),m.value=!0,G.value=await ee(),R.value=await te(),U.value=Z(R.value,"id"),N.value=await se(),A.value=await le(),L.value=await ae()}});const K=P,E=async()=>{if(!_||!await _.value.validate())return;const e={...l.value,taskDefinitionName:void 0};e.type===10?e.options=e.roleIds:e.type===20||e.type===21?e.options=e.deptIds:e.type===22?e.options=e.postIds:e.type===30||e.type===31||e.type===32?e.options=e.userIds:e.type===40?e.options=e.userGroupIds:e.type===50&&(e.options=e.scripts),e.roleIds=void 0,e.deptIds=void 0,e.postIds=void 0,e.userIds=void 0,e.userGroupIds=void 0,e.scripts=void 0,k.value=!0;try{const f=e;f.id?(await ue(f),T.success(S("common.updateSuccess"))):(await oe(f),T.success(S("common.createSuccess"))),m.value=!1,K("success")}finally{k.value=!1}},h=()=>{_.value?.resetFields()};return(V,e)=>{const f=d("el-input"),n=d("el-form-item"),y=d("el-option"),c=d("el-select"),M=d("el-tree-select"),Y=d("el-form"),q=d("el-button"),$=J;return o(),r($,{modelValue:s(m),"onUpdate:modelValue":e[10]||(e[10]=t=>H(m)?m.value=t:null),title:"修改任务规则",width:"600"},{footer:a(()=>[u(q,{disabled:s(k),type:"primary",onClick:E},{default:a(()=>e[11]||(e[11]=[x("确 定")])),_:1},8,["disabled"]),u(q,{onClick:e[9]||(e[9]=t=>m.value=!1)},{default:a(()=>e[12]||(e[12]=[x("取 消")])),_:1})]),default:a(()=>[u(Y,{ref_key:"formRef",ref:_,"label-width":"80px",model:s(l),rules:s(w)},{default:a(()=>[u(n,{label:"任务名称",prop:"taskDefinitionName"},{default:a(()=>[u(f,{modelValue:s(l).taskDefinitionName,"onUpdate:modelValue":e[0]||(e[0]=t=>s(l).taskDefinitionName=t),disabled:"",placeholder:"请输入流标标识"},null,8,["modelValue"])]),_:1}),u(n,{label:"任务标识",prop:"taskDefinitionKey"},{default:a(()=>[u(f,{modelValue:s(l).taskDefinitionKey,"onUpdate:modelValue":e[1]||(e[1]=t=>s(l).taskDefinitionKey=t),disabled:"",placeholder:"请输入任务标识"},null,8,["modelValue"])]),_:1}),u(n,{label:"规则类型",prop:"type"},{default:a(()=>[u(c,{modelValue:s(l).type,"onUpdate:modelValue":e[2]||(e[2]=t=>s(l).type=t),clearable:"",style:{width:"100%"}},{default:a(()=>[(o(!0),I(v,null,b(s(C)(s(F).BPM_TASK_ASSIGN_RULE_TYPE),t=>(o(),r(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(l).type===10?(o(),r(n,{key:0,label:"指定角色",prop:"roleIds"},{default:a(()=>[u(c,{modelValue:s(l).roleIds,"onUpdate:modelValue":e[3]||(e[3]=t=>s(l).roleIds=t),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(o(!0),I(v,null,b(s(G),t=>(o(),r(y,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),s(l).type===20||s(l).type===21?(o(),r(n,{key:1,label:"指定部门",prop:"deptIds",span:"24"},{default:a(()=>[u(M,{ref:"treeRef",modelValue:s(l).deptIds,"onUpdate:modelValue":e[4]||(e[4]=t=>s(l).deptIds=t),data:s(U),"empty-text":"加载中，请稍后",multiple:"","node-key":"id",props:s(X),"show-checkbox":""},null,8,["modelValue","data","props"])]),_:1})):g("",!0),s(l).type===22?(o(),r(n,{key:2,label:"指定岗位",prop:"postIds",span:"24"},{default:a(()=>[u(c,{modelValue:s(l).postIds,"onUpdate:modelValue":e[5]||(e[5]=t=>s(l).postIds=t),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(o(!0),I(v,null,b(s(N),t=>(o(),r(y,{key:parseInt(t.id),label:t.name,value:parseInt(t.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),s(l).type===30||s(l).type===31||s(l).type===32?(o(),r(n,{key:3,label:"指定用户",prop:"userIds",span:"24"},{default:a(()=>[u(c,{modelValue:s(l).userIds,"onUpdate:modelValue":e[6]||(e[6]=t=>s(l).userIds=t),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(o(!0),I(v,null,b(s(A),t=>(o(),r(y,{key:parseInt(t.id),label:t.nickname,value:parseInt(t.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),s(l).type===40?(o(),r(n,{key:4,label:"指定用户组",prop:"userGroupIds"},{default:a(()=>[u(c,{modelValue:s(l).userGroupIds,"onUpdate:modelValue":e[7]||(e[7]=t=>s(l).userGroupIds=t),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(o(!0),I(v,null,b(s(L),t=>(o(),r(y,{key:parseInt(t.id),label:t.name,value:parseInt(t.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),s(l).type===50?(o(),r(n,{key:5,label:"指定脚本",prop:"scripts"},{default:a(()=>[u(c,{modelValue:s(l).scripts,"onUpdate:modelValue":e[8]||(e[8]=t=>s(l).scripts=t),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(o(!0),I(v,null,b(s(B),t=>(o(),r(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});export{Ie as _,ge as g};
