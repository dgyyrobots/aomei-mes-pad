/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 13:38:04 
 */
import{_ as N}from"./ContentWrap.vue_vue_type_script_setup_true_lang-32ziCa0j.js";import{_ as D}from"./DictTag.vue_vue_type_script_lang-o_bnFpkw.js";import{d as R,r as m,cC as B,Y as F,g as d,h as U,c as $,o as y,F as M,j as e,m as o,v as u,K as O,w as V,a as _,k as W,L as j,z as Y}from"./index-FPuwcz_Y.js";import{_ as K}from"./PermissionForm.vue_vue_type_script_setup_true_lang-URusGgZk.js";import{g as Q,d as q,P as A,a as G}from"./index-7t7iIeoF.js";import{D as H}from"./dict-C9lD-gwA.js";const ae=R({name:"CrmPermissionList",__name:"PermissionList",props:{bizType:{},bizId:{}},setup(z){const n=z,r=Y(),f=m(!0),c=m([]),g=async()=>{f.value=!0;try{c.value=await Q({bizType:n.bizType,bizId:n.bizId})}finally{f.value=!1}},l=m([]),w=s=>{l.value=s},b=m(),C=()=>{b.value?.open("create",n.bizType,n.bizId)},I=()=>{if(l.value?.length===0){r.warning("请先选择团队成员后操作！");return}const s=l.value?.map(t=>t.id);b.value?.open("update",n.bizType,n.bizId,s)},T=async()=>{if(l.value?.length===0){r.warning("请先选择团队成员后操作！");return}await r.delConfirm();const s=l.value?.map(t=>t.id);await q({bizType:n.bizType,bizId:n.bizId,ids:s})},v=B(),k=async()=>{if(c.value.find(a=>a.userId===v.getUser.id&&a.level===A.OWNER)){r.warning("负责人不能退出团队！");return}const t=c.value.find(a=>a.userId===v.getUser.id);await G(t?.id)};return F(()=>[n.bizId,n.bizType],()=>{g()},{immediate:!0,deep:!0}),(s,t)=>{const a=O,p=d("el-button"),P=d("el-row"),i=d("el-table-column"),h=D,S=d("el-table"),x=N,L=U("loading");return y(),$(M,null,[e(P,{justify:"end"},{default:o(()=>[e(p,{onClick:C},{default:o(()=>[e(a,{class:"mr-5px",icon:"fluent:people-team-add-20-filled"}),t[0]||(t[0]=u(" 添加团队成员 "))]),_:1}),e(p,{onClick:I},{default:o(()=>[e(a,{class:"mr-5px",icon:"ep:edit"}),t[1]||(t[1]=u(" 编辑 "))]),_:1}),e(p,{onClick:T},{default:o(()=>[e(a,{class:"mr-5px",icon:"ep:delete"}),t[2]||(t[2]=u(" 移除 "))]),_:1}),e(p,{type:"danger",onClick:k},{default:o(()=>t[3]||(t[3]=[u("退出团队")])),_:1})]),_:1}),e(x,{class:"mt-10px"},{default:o(()=>[V((y(),W(S,{data:_(c),"show-overflow-tooltip":!0,stripe:!0,onSelectionChange:w},{default:o(()=>[e(i,{type:"selection",width:"55"}),e(i,{align:"center",label:"姓名",prop:"nickname"}),e(i,{align:"center",label:"部门",prop:"deptName"}),e(i,{align:"center",label:"岗位",prop:"postNames"}),e(i,{align:"center",label:"权限",prop:"level"},{default:o(({row:E})=>[e(h,{type:_(H).CRM_PERMISSION_LEVEL,value:E.level},null,8,["type","value"])]),_:1}),e(i,{align:"center",formatter:_(j),label:"加入时间",prop:"createTime"},null,8,["formatter"])]),_:1},8,["data"])),[[L,_(f)]])]),_:1}),e(K,{ref_key:"formRef",ref:b,onSuccess:g},null,512)],64)}}});export{ae as _};
