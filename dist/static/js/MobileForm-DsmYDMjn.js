/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 14:15:15 
 */
import{_ as H}from"./XButton-BayVP5lM.js";import{d as W,aw as X,u as Y,r as f,O as Z,a as e,f as N,Y as G,g as p,w as J,Z as K,o as _,k as S,m as n,j as o,l as y,N as Q,c as F,t as I,bV as ee,z as oe,aq as ne,ar as te,am as V,bW as ae,ap as le,A as se}from"./index-D3eRVKjp.js";import{u as h}from"./useIcon-DHObHGE9.js";import{u as ie,L as re,_ as me,a as de}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-CbdWh4hv.js";import{r as x}from"./formRules-Dx7KOm_Z.js";const ce={key:1,class:"getMobileCode",style:{cursor:"pointer"}},pe=W({name:"MobileForm",__name:"MobileForm",setup(ue){const{t:l}=Q(),L=oe(),M=X(),{currentRoute:B,push:E}=Y(),v=f(),u=f(!1),T=h({icon:"ep:house"}),P=h({icon:"ep:cellphone"}),q=h({icon:"ep:circle-check"}),{validForm:D}=de(v),{handleBackLogin:O,getLoginState:R}=ie(),U=Z(()=>e(R)===re.MOBILE),$={tenantName:[x],mobileNumber:[x],code:[x]},t=N({codeImg:"",tenantEnable:"true",token:"",loading:{signIn:!1},loginForm:{uuid:"",tenantName:"芋道源码",mobileNumber:"",code:""}}),c=N({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),s=f(0),g=f(""),j=async()=>{await w(),c.smsCode.mobile=t.loginForm.mobileNumber,await ee(c.smsCode).then(async()=>{L.success(l("login.SmsSendMsg")),s.value=60;const i=setInterval(()=>{s.value=s.value-1,s.value<=0&&clearInterval(i)},1e3)})};G(()=>B.value,i=>{g.value=i?.query?.redirect},{immediate:!0});const w=async()=>{if(t.tenantEnable==="true"){const i=await ne(t.loginForm.tenantName);te(i)}},z=async()=>{await w(),await D()&&(V.service({lock:!0,text:"正在加载系统中...",background:"rgba(0, 0, 0, 0.7)"}),u.value=!0,c.loginSms.mobile=t.loginForm.mobileNumber,c.loginSms.code=t.loginForm.code,await ae(c.loginSms).then(async a=>{le(a),g.value||(g.value="/"),E({path:g.value||M.addRouters[0].path})}).catch(()=>{}).finally(()=>{u.value=!1,setTimeout(()=>{V.service().close()},400)}))};return(i,a)=>{const d=p("el-form-item"),r=p("el-col"),b=p("el-input"),k=p("el-row"),C=H,A=p("el-form");return J((_(),S(A,{ref_key:"formSmsLogin",ref:v,class:"login-form","label-position":"top","label-width":"120px",model:e(t).loginForm,rules:$,size:"large"},{default:n(()=>[o(k,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:n(()=>[o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(me,{style:{width:"100%"}})]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[e(t).tenantEnable==="true"?(_(),S(d,{key:0,prop:"tenantName"},{default:n(()=>[o(b,{modelValue:e(t).loginForm.tenantName,"onUpdate:modelValue":a[0]||(a[0]=m=>e(t).loginForm.tenantName=m),link:"",placeholder:e(l)("login.tenantNamePlaceholder"),"prefix-icon":e(T),type:"primary"},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):y("",!0)]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,{prop:"mobileNumber"},{default:n(()=>[o(b,{modelValue:e(t).loginForm.mobileNumber,"onUpdate:modelValue":a[1]||(a[1]=m=>e(t).loginForm.mobileNumber=m),placeholder:e(l)("login.mobileNumberPlaceholder"),"prefix-icon":e(P)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,{prop:"code"},{default:n(()=>[o(k,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:n(()=>[o(r,{span:24},{default:n(()=>[o(b,{modelValue:e(t).loginForm.code,"onUpdate:modelValue":a[2]||(a[2]=m=>e(t).loginForm.code=m),placeholder:e(l)("login.codePlaceholder"),"prefix-icon":e(q)},{append:n(()=>[e(s)<=0?(_(),F("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:j},I(e(l)("login.getSmsCode")),1)):y("",!0),e(s)>0?(_(),F("span",ce,I(e(s))+"秒后可重新获取",1)):y("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(C,{class:"w-[100%]",loading:e(u),title:e(l)("login.login"),type:"primary",onClick:a[3]||(a[3]=m=>z())},null,8,["loading","title"])]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(C,{class:"w-[100%]",loading:e(u),title:e(l)("login.backLogin"),onClick:a[4]||(a[4]=m=>e(O)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[K,e(U)]])}}}),he=se(pe,[["__scopeId","data-v-808218b5"]]);export{he as default};
