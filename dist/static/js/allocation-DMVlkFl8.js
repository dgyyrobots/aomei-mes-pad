/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{_ as Bl}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C6z1f3RI.js";import{V as Y,d as Xe,r as d,f as _e,b as Le,g as i,h as Ce,k as b,o as p,m as l,w as z,j as e,J as X,c as he,F as Se,n as ze,a as V,D as we,v as f,a0 as We,$ as ve,t as ke,M as xe,i as H,a6 as Ze,A as De,l as oe,W as Dl,O as Oe,x as el,X as Fe,R as Yl,Y as $l,Z as Q,E as Je,G as Ql,a7 as Sl,a4 as Hl,a8 as jl,T as Ge,a5 as Jl}from"./index-lcC3l4R2.js";import{_ as Ul}from"./DictTag.vue_vue_type_script_lang-G_4C17ZW.js";import{D as Ee}from"./dict-B7jb0IEc.js";import{k as Gl}from"./index-aLvMrSQ5.js";import"./color-B5phLuB-.js";const Xl=async u=>await Y.get({url:"/mes/pro/task/page",params:u}),ql=async()=>await Y.get({url:"/mes/pro/cess/list-all-simple"}),Zl=async u=>await Y.get({url:"/mes/md-workstation/page",params:u}),ea=async()=>await Y.get({url:"/mes/md-workshop/list-all-simple"}),la={class:"dialog-footer"},aa=Xe({name:"WorkstationSelect",__name:"simpletableSingle",props:{processId:{}},emits:["onSelected"],setup(u,{expose:c,emit:j}){const v=u,w=d(!1),D=d(!0),o=d(),I=d([]);d(!0),d(!0);const J=d(!0),ae=d(0),ne=d([]),U=d([]),W=d([]),M=d(),y=_e({pageNo:1,pageSize:10,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:v.processId,processCode:null,processName:null,enableFlag:null});_e({workstationId:null,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:null,processCode:null,processName:null,enableFlag:"Y",remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null});const P=async()=>{D.value=!0;try{const O=await Zl(y);ne.value=O.list,ae.value=O.total}finally{D.value=!1}},ie=async()=>{const O=await ea();U.value=O},A=async()=>{const O=await ql();W.value=O},_=()=>{y.pageNo=1,P()},ue=()=>{M.value?.resetFields(),_()},E=O=>{O&&(I.value=O)},k=O=>{O&&(I.value=O)},N=O=>{O&&(I.value=O,pe("onSelected",I.value),w.value=!1)},Z=()=>{if(!o.value){Ze({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}pe("onSelected",I.value),w.value=!1},pe=j;return Le(()=>{P(),ie(),A()}),c({showFlag:w}),(O,C)=>{const K=i("el-input"),se=i("el-form-item"),te=i("el-col"),ee=i("el-option"),F=i("el-select"),S=i("el-button"),h=i("el-row"),s=i("el-form"),re=i("el-radio"),L=i("el-table-column"),de=i("el-table"),$=i("el-dialog"),ce=Ce("loading");return p(),b($,{title:"工作站选择",modelValue:w.value,"onUpdate:modelValue":C[7]||(C[7]=g=>w.value=g),modal:!1,width:"80%",center:""},{footer:l(()=>[H("div",la,[e(S,{type:"primary",onClick:Z},{default:l(()=>C[11]||(C[11]=[f("确 定")])),_:1}),e(S,{onClick:C[6]||(C[6]=g=>w.value=!1)},{default:l(()=>C[12]||(C[12]=[f("取 消")])),_:1})])]),default:l(()=>[z(e(s,{model:y,ref_key:"queryFormRef",ref:M,size:"small",inline:!0,"label-width":"90px"},{default:l(()=>[e(h,null,{default:l(()=>[e(te,{span:7},{default:l(()=>[e(se,{label:"工作站编号",prop:"workstationCode"},{default:l(()=>[e(K,{modelValue:y.workstationCode,"onUpdate:modelValue":C[0]||(C[0]=g=>y.workstationCode=g),placeholder:"请输入工作站编号",clearable:"",onKeyup:X(_,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(te,{span:7},{default:l(()=>[e(se,{label:"所属工序",prop:"processName"},{default:l(()=>[e(F,{modelValue:y.processId,"onUpdate:modelValue":C[1]||(C[1]=g=>y.processId=g),placeholder:"请选择工序"},{default:l(()=>[(p(!0),he(Se,null,ze(W.value,g=>(p(),b(ee,{key:g.id,label:g.name,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(te,{span:7},{default:l(()=>[e(se,{label:"所在车间",prop:"workshopName"},{default:l(()=>[e(F,{modelValue:y.workshopId,"onUpdate:modelValue":C[2]||(C[2]=g=>y.workshopId=g),placeholder:"请选择车间"},{default:l(()=>[(p(!0),he(Se,null,ze(U.value,g=>(p(),b(ee,{key:g.id,label:g.name,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(te,{span:3},{default:l(()=>[e(se,null,{default:l(()=>[e(S,{type:"primary",icon:V(we),size:"small",onClick:_},{default:l(()=>C[8]||(C[8]=[f("搜索")])),_:1},8,["icon"]),e(S,{icon:V(We),size:"small",onClick:ue},{default:l(()=>C[9]||(C[9]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(h,null,{default:l(()=>[e(te,{span:24})]),_:1})]),_:1},8,["model"]),[[ve,J.value]]),z((p(),b(de,{data:ne.value,onCurrentChange:E,onRowDblclick:N},{default:l(()=>[e(L,{width:"55",align:"center"},{default:l(g=>[e(re,{modelValue:o.value,"onUpdate:modelValue":C[3]||(C[3]=G=>o.value=G),label:g.row.id,onChange:G=>k(g.row)},{default:l(()=>C[10]||(C[10]=[f(ke(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(L,{label:"工作站编号",align:"center",prop:"workstationCode"}),e(L,{label:"工作站名称",align:"center",prop:"workstationName"}),e(L,{label:"工作站地点",align:"center",prop:"workstationAddress"}),e(L,{label:"所在车间名称",align:"center",prop:"workshopName"}),e(L,{label:"所属工序",align:"center",prop:"processName"}),e(L,{label:"备注",align:"center",prop:"remark"})]),_:1},8,["data"])),[[ce,D.value]]),z(e(xe,{total:ae.value,page:y.pageNo,"onUpdate:page":C[4]||(C[4]=g=>y.pageNo=g),limit:y.pageSize,"onUpdate:limit":C[5]||(C[5]=g=>y.pageSize=g),onPagination:P},null,8,["total","page","limit"]),[[ve,ae.value>0]])]),_:1},8,["modelValue"])}}}),ta=De(aa,[["__scopeId","data-v-848b7f87"]]),oa={name:"ProtaskSelect",components:{WorkstationSelect:ta},props:{workorderId:null,workorderCode:null,processId:null,processCode:null,workstationId:null,workstationCode:null},watch:{workorderId(u){this.queryParams.workorderId=u}},data(){return{showFlag:!1,selectedTaskId:void 0,selectedRow:void 0,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,protaskList:[],title:"",open:!1,queryParams:{pageNo:1,pageSize:10,taskCode:null,taskName:null,workorderId:this.workorderId,workorderCode:null,workorderName:null,workstationId:null,workstationCode:null,workstationName:null,processId:this.processId,processCode:null,processName:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,clientId:null,clientCode:null,clientName:null,clientNick:null,startTime:null,duration:null,endTime:null,colorCode:null,requestDate:null},form:{},rules:{workstationId:[{required:!0,message:"工作站不能为空",trigger:"blur"}],quantity:[{required:!0,message:"排产数量不能为空",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始生产日期",trigger:"blur"}],duration:[{required:!0,message:"清输入估算的生产用时",trigger:"blur"}]}}},created(){this.getList(),this.getProcess()},methods:{getList(){this.loading=!0,Xl(this.queryParams).then(u=>{this.protaskList=u.list,this.total=u.total,this.loading=!1})},getProcess(){ql().then(u=>{this.processOptions=u})},handleQuery(){this.queryParams.pageNo=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleCurrent(u){u&&(this.selectedRow=u)},handleRowDbClick(u){u&&(this.selectedRow=u,this.$emit("onSelected",this.selectedRow),this.showFlag=!1)},handleRowChange(u){u&&(this.selectedRow=u)},confirmSelect(){if(this.selectedTaskId==null||this.selectedTaskId==0){this.$notify({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}this.$emit("onSelected",this.selectedRow),this.showFlag=!1}}},na={"slot-scope":"scope"},ra={"slot-scope":"scope"},da={"slot-scope":"scope"},ua={"slot-scope":"scope"},sa={slot:"footer",class:"dialog-footer"};function ia(u,c,j,v,w,D){const o=i("el-option"),I=i("el-select"),J=i("el-form-item"),ae=i("el-col"),ne=i("el-input"),U=i("el-row"),W=i("el-button"),M=i("el-form"),y=i("el-radio"),P=i("el-table-column"),ie=i("el-color-picker"),A=i("el-table"),_=xe,ue=i("el-dialog"),E=Ce("hasPermi"),k=Ce("loading");return w.showFlag?(p(),b(ue,{key:0,title:"生产任务选择",visible:w.showFlag,modal:!1,width:"80%",center:""},{default:l(()=>[z(e(M,{model:w.queryParams,ref:"queryForm",size:"small",inline:!0,"label-width":"100px"},{default:l(()=>[e(U,null,{default:l(()=>[e(ae,{span:8},{default:l(()=>[e(J,{label:"所属工序",prop:"processName"},{default:l(()=>[e(I,{modelValue:w.queryParams.processId,"onUpdate:modelValue":c[0]||(c[0]=N=>w.queryParams.processId=N),placeholder:"请选择工序"},{default:l(()=>[(p(!0),he(Se,null,ze(u.processOptions,N=>(p(),b(o,{key:N.processId,label:N.processName,value:N.processId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ae,{span:8},{default:l(()=>[e(J,{label:"所属工作站",prop:"workstationCode"},{default:l(()=>[e(ne,{modelValue:w.queryParams.workstationCode,"onUpdate:modelValue":c[1]||(c[1]=N=>w.queryParams.workstationCode=N),placeholder:"请输入工作站编号",clearable:"",onKeyup:X(D.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(ae,{span:8},{default:l(()=>[e(J,{label:"任务编号",prop:"taskCode"},{default:l(()=>[e(ne,{modelValue:w.queryParams.taskCode,"onUpdate:modelValue":c[2]||(c[2]=N=>w.queryParams.taskCode=N),placeholder:"请输入生产任务编号",clearable:"",onKeyup:X(D.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1}),e(U,null,{default:l(()=>[e(ae,{span:8},{default:l(()=>[e(J,null,{default:l(()=>[e(W,{type:"primary",icon:"el-icon-search",size:"mini",onClick:D.handleQuery},{default:l(()=>c[8]||(c[8]=[f("搜索")])),_:1},8,["onClick"]),e(W,{icon:"el-icon-refresh",size:"mini",onClick:D.resetQuery},{default:l(()=>c[9]||(c[9]=[f("重置")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),[[ve,w.showSearch]]),z((p(),b(A,{data:w.protaskList,onCurrentChange:D.handleCurrent,onRowDblclick:D.handleRowDbClick},{default:l(()=>[e(P,{width:"55",align:"center"},{default:l(N=>[e(y,{modelValue:w.selectedTaskId,"onUpdate:modelValue":c[3]||(c[3]=Z=>w.selectedTaskId=Z),label:N.row.id,onChange:Z=>D.handleRowChange(N.row)},{default:l(()=>c[10]||(c[10]=[f(ke(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(P,{label:"任务编号",align:"center",width:"100px",prop:"taskCode","show-overflow-tooltip":!0}),e(P,{label:"任务名称",align:"center",width:"120px",prop:"taskName","show-overflow-tooltip":!0}),e(P,{label:"工作站编号",align:"center",width:"150px",prop:"workstationCode","show-overflow-tooltip":!0}),e(P,{label:"工作站名称",align:"center",width:"150px",prop:"workstationName","show-overflow-tooltip":!0}),e(P,{label:"排产数量",align:"center",prop:"quantity"}),e(P,{label:"已生产数量",align:"center",width:"100px",prop:"quantityProduced"}),e(P,{label:"开始生产时间",align:"center",prop:"startTime",width:"180"},{default:l(()=>[H("template",na,[H("span",null,ke(u.parseTime(u.scope.row.startTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(P,{label:"生产时长",align:"center",prop:"duration"}),e(P,{label:"预计完成时间",align:"center",prop:"endTime",width:"180"},{default:l(()=>[H("template",ra,[H("span",null,ke(u.parseTime(u.scope.row.endTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(P,{label:"显示颜色",align:"center",prop:"colorCode"},{default:l(()=>[H("template",da,[e(ie,{modelValue:u.scope.row.colorCode,"onUpdate:modelValue":c[4]||(c[4]=N=>u.scope.row.colorCode=N),disabled:""},null,8,["modelValue"])])]),_:1}),e(P,{label:"操作",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:l(()=>[H("template",ua,[z((p(),b(W,{size:"mini",type:"text",icon:"el-icon-edit",onClick:c[5]||(c[5]=N=>u.handleUpdate(u.scope.row))},{default:l(()=>c[11]||(c[11]=[f("修改")])),_:1})),[[E,["pro:protask:edit"]]]),z((p(),b(W,{size:"mini",type:"text",icon:"el-icon-delete",onClick:c[6]||(c[6]=N=>u.handleDelete(u.scope.row))},{default:l(()=>c[12]||(c[12]=[f("删除")])),_:1})),[[E,["pro:protask:remove"]]])])]),_:1})]),_:1},8,["data","onCurrentChange","onRowDblclick"])),[[k,w.loading]]),z(e(_,{total:w.total,page:w.queryParams.pageNo,limit:w.queryParams.pageSize,onPagination:D.getList},null,8,["total","page","limit","onPagination"]),[[ve,w.total>0]]),H("div",sa,[e(W,{type:"primary",onClick:D.confirmSelect},{default:l(()=>c[13]||(c[13]=[f("确 定")])),_:1},8,["onClick"]),e(W,{onClick:c[7]||(c[7]=N=>w.showFlag=!1)},{default:l(()=>c[14]||(c[14]=[f("取 消")])),_:1})])]),_:1},8,["visible"])):oe("",!0)}const zl=De(oa,[["render",ia]]),pa=async u=>await Y.get({url:"/mes/wms/material-stock/page",params:u}),ca=async()=>await Y.get({url:"/mes/md-item-type/treeselect"}),Rl=async()=>await Y.get({url:"/wms/warehouse/getTreeList"}).then(u=>(u.data=(u.data||[]).map(c=>(c.children&&(c.children=c.children.map(j=>(j.children&&(j.children=j.children.map(v=>({...v,pId:v.id,pName:v.areaName,lId:v.locationId,areaId:v.id}))),{...j,wId:j.warehouseId,pId:j.id,pName:j.locationName,locationId:j.id}))),{...c,wId:c.id,pId:c.id,pName:c.warehouseName,warehouseId:c.id})),u)),ma={class:"head-container"},fa={class:"head-container"},va={class:"dialog-footer"},ga=Xe({name:"WmstockMultiSelect",__name:"multi",emits:["onSelected"],setup(u,{expose:c,emit:j}){const v=Dl(),w=Oe(()=>v.currentSize==="mini"?"small":v.currentSize),D=d(!1),o=d(!0),I=d([]),J=d([]),ae=d(!0),ne=d(!0),U=d(!0),W=d(0),M=d([]),y=d([]),P=d(),ie=d(),A=d(),_=_e({pageNo:1,pageSize:10,itemTypeId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,vendorId:null,vendorCode:null,vendorName:null,vendorNick:null,quantityOnhand:null,expireDate:null,warehouse:null}),ue={children:"children",label:"label"},E=d([]),k={multiple:!1,value:"pId",label:"pName"},N=async()=>{o.value=!0;try{const h=await pa(_);y.value=h.list,W.value=h.total}finally{o.value=!1}},Z=async()=>{const h=await ca();M.value=h},pe=(h,s)=>h?s.label.indexOf(h)!==-1:!0,O=h=>{_.itemTypeId=h.id,C()},C=()=>{_.pageNo=1,N()},K=()=>{A.value?.resetFields(),C()},se=h=>{I.value=h.map(s=>s.materialStockId),ae.value=h.length!==1,ne.value=!h.length,J.value=h},te=()=>{if(!J.value.length){Ze({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}S("onSelected",J.value),D.value=!1},ee=async()=>{const h=await Rl();E.value=h,E.value.map(s=>{s.pId=s.id,s.pName=s.warehouseName,s.children.map(L=>{let de=JSON.stringify(L.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");L.children=JSON.parse(de)});let re=JSON.stringify(s.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");s.children=JSON.parse(re)})},F=h=>{h&&(_.warehouseId=h[0],_.locationId=h[1],_.areaId=h[2])},S=j;return Le(()=>{N(),Z(),ee()}),c({showFlag:D}),(h,s)=>{const re=i("el-input"),L=i("el-tree"),de=i("el-col"),$=i("el-form-item"),ce=i("el-cascader"),g=i("el-date-picker"),G=i("el-button"),Ue=i("el-form"),Me=i("right-toolbar"),qe=i("el-row"),le=i("el-table-column"),Re=i("el-table"),Ke=i("el-dialog"),Be=Ce("loading");return p(),b(Ke,{title:"物料选择",modelValue:D.value,"onUpdate:modelValue":s[12]||(s[12]=R=>D.value=R),modal:!1,width:"92%",center:""},{footer:l(()=>[H("div",va,[e(G,{size:V(w),type:"primary",onClick:te},{default:l(()=>s[15]||(s[15]=[f("确 定")])),_:1},8,["size"]),e(G,{size:V(w),onClick:s[11]||(s[11]=R=>D.value=!1)},{default:l(()=>s[16]||(s[16]=[f("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(qe,{gutter:14},{default:l(()=>[e(de,{span:4,xs:24},{default:l(()=>[H("div",ma,[e(re,{modelValue:P.value,"onUpdate:modelValue":s[0]||(s[0]=R=>P.value=R),placeholder:"请输入分类名称",clearable:"",":size":V(w),"prefix-icon":V(we),style:{"margin-bottom":"20px"}},null,8,["modelValue",":size","prefix-icon"])]),H("div",fa,[e(L,{data:M.value,props:ue,"expand-on-click-node":!1,"filter-node-method":pe,ref_key:"treeRef",ref:ie,"default-expand-all":"",onNodeClick:O},null,8,["data"])])]),_:1}),e(de,{span:20,xs:24},{default:l(()=>[z(e(Ue,{model:_,ref_key:"queryFormRef",ref:A,":size":V(w),inline:!0},{default:l(()=>[e($,{label:"产品物料编码",prop:"itemCode"},{default:l(()=>[e(re,{modelValue:_.itemCode,"onUpdate:modelValue":s[1]||(s[1]=R=>_.itemCode=R),placeholder:"请输入产品物料编码",clearable:"",onKeyup:X(C,["enter"])},null,8,["modelValue"])]),_:1}),e($,{label:"产品物料名称",prop:"itemName"},{default:l(()=>[e(re,{modelValue:_.itemName,"onUpdate:modelValue":s[2]||(s[2]=R=>_.itemName=R),placeholder:"请输入产品物料名称",clearable:"",onKeyup:X(C,["enter"])},null,8,["modelValue"])]),_:1}),e($,{label:"入库批次号",prop:"batchCode"},{default:l(()=>[e(re,{modelValue:_.batchCode,"onUpdate:modelValue":s[3]||(s[3]=R=>_.batchCode=R),placeholder:"请输入入库批次号",clearable:"",onKeyup:X(C,["enter"])},null,8,["modelValue"])]),_:1}),e($,{label:"仓库信息",prop:"warehouse"},{default:l(()=>[e(ce,{modelValue:_.warehouse,"onUpdate:modelValue":s[4]||(s[4]=R=>_.warehouse=R),options:E.value,props:k,onChange:F},null,8,["modelValue","options"])]),_:1}),e($,{label:"供应商编号",prop:"vendorCode"},{default:l(()=>[e(re,{modelValue:_.vendorCode,"onUpdate:modelValue":s[5]||(s[5]=R=>_.vendorCode=R),placeholder:"请输入供应商编号",clearable:"",onKeyup:X(C,["enter"])},null,8,["modelValue"])]),_:1}),e($,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[e(re,{modelValue:_.vendorName,"onUpdate:modelValue":s[6]||(s[6]=R=>_.vendorName=R),placeholder:"请输入供应商名称",clearable:"",onKeyup:X(C,["enter"])},null,8,["modelValue"])]),_:1}),e($,{label:"库存有效期",prop:"expireDate"},{default:l(()=>[e(g,{clearable:"",modelValue:_.expireDate,"onUpdate:modelValue":s[7]||(s[7]=R=>_.expireDate=R),type:"date","value-format":"timestamp",placeholder:"请选择库存有效期"},null,8,["modelValue"])]),_:1}),e($,null,{default:l(()=>[e(G,{type:"primary",icon:V(we),":size":V(w),onClick:C},{default:l(()=>s[13]||(s[13]=[f("搜索")])),_:1},8,["icon",":size"]),e(G,{icon:V(We),":size":V(w),onClick:K},{default:l(()=>s[14]||(s[14]=[f("重置")])),_:1},8,["icon",":size"])]),_:1})]),_:1},8,["model",":size"]),[[ve,U.value]]),e(qe,{gutter:10,class:"mb8"},{default:l(()=>[e(Me,{showSearch:U.value,"onUpdate:showSearch":s[8]||(s[8]=R=>U.value=R),onQueryTable:N},null,8,["showSearch"])]),_:1}),z((p(),b(Re,{size:V(w),data:y.value,onSelectionChange:se},{default:l(()=>[e(le,{type:"selection",width:"55",align:"center"}),e(le,{label:"产品物料编码",width:"120px",align:"center",prop:"itemCode"}),e(le,{label:"产品物料名称",width:"150px",align:"center",prop:"itemName","show-overflow-tooltip":!0}),e(le,{label:"规格型号",align:"center",prop:"specification","show-overflow-tooltip":!0}),e(le,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(le,{label:"入库批次号",width:"100px",align:"center",prop:"batchCode","show-overflow-tooltip":!0}),e(le,{label:"仓库",align:"center",prop:"warehouseName"}),e(le,{label:"库区",align:"center",prop:"locationName"}),e(le,{label:"库位",align:"center",prop:"areaName"}),e(le,{label:"供应商编号",width:"100px",align:"center",prop:"vendorCode"}),e(le,{label:"供应商名称",width:"120px",align:"center",prop:"vendorName","show-overflow-tooltip":!0}),e(le,{label:"供应商简称",width:"100px",align:"center",prop:"vendorNick"}),e(le,{label:"在库数量",align:"center",prop:"quantityOnhand"}),e(le,{label:"库存有效期",align:"center",prop:"expireDate",width:"180"},{default:l(R=>[H("span",null,ke(V(el)(R.row.expireDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["size","data"])),[[Be,o.value]]),z(e(xe,{total:W.value,page:_.pageNo,"onUpdate:page":s[9]||(s[9]=R=>_.pageNo=R),limit:_.pageSize,"onUpdate:limit":s[10]||(s[10]=R=>_.pageSize=R),onPagination:N},null,8,["total","page","limit"]),[[ve,W.value>0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),wa=De(ga,[["__scopeId","data-v-82c195e3"]]),ka=async u=>await Y.get({url:"/mes/pro/workorder/page",params:u}),ba={class:"dialog-footer"},_a=Xe({name:"WorkOrderSelectSingle",__name:"single",emits:["onSelected"],setup(u,{expose:c,emit:j}){const v=d(!1),w=d(!0),D=d(),o=d([]);d(!0),d(!0);const I=d(!0),J=d(0),ae=d([]),ne=d(),U=_e({pageNo:1,pageSize:10,workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:"CONFIRMED"}),W=async()=>{w.value=!0;try{const E=await ka(U);ae.value=E.list,J.value=E.total}finally{w.value=!1}},M=()=>{W()},y=()=>{ne.value?.resetFields(),M()},P=E=>{E&&(o.value=E)},ie=E=>{E&&(o.value=E)},A=E=>{E&&(o.value=E,ue("onSelected",o.value),v.value=!1)},_=()=>{if(!D.value){Ze({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}ue("onSelected",o.value),v.value=!1},ue=j;return Le(()=>{W()}),c({showFlag:v}),(E,k)=>{const N=i("el-input"),Z=i("el-form-item"),pe=i("el-button"),O=i("el-form"),C=i("el-radio"),K=i("el-table-column"),se=Ul,te=i("el-table"),ee=i("el-dialog"),F=Ce("loading");return p(),b(ee,{title:"工单选择",modelValue:v.value,"onUpdate:modelValue":k[9]||(k[9]=S=>v.value=S),modal:!1,width:"80%",center:""},{footer:l(()=>[H("div",ba,[e(pe,{type:"primary",onClick:_},{default:l(()=>k[13]||(k[13]=[f("确 定")])),_:1}),e(pe,{onClick:k[8]||(k[8]=S=>v.value=!1)},{default:l(()=>k[14]||(k[14]=[f("取 消")])),_:1})])]),default:l(()=>[z(e(O,{model:U,ref_key:"queryFormRef",ref:ne,size:"small",inline:!0,"label-width":"68px"},{default:l(()=>[e(Z,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(N,{modelValue:U.workorderCode,"onUpdate:modelValue":k[0]||(k[0]=S=>U.workorderCode=S),placeholder:"请输入工单编码",clearable:"",onKeyup:X(M,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"工单名称",prop:"workorderName"},{default:l(()=>[e(N,{modelValue:U.workorderName,"onUpdate:modelValue":k[1]||(k[1]=S=>U.workorderName=S),placeholder:"请输入工单名称",clearable:"",onKeyup:X(M,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"产品编号",prop:"productCode"},{default:l(()=>[e(N,{modelValue:U.productCode,"onUpdate:modelValue":k[2]||(k[2]=S=>U.productCode=S),placeholder:"请输入产品编号",clearable:"",onKeyup:X(M,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"产品名称",prop:"productName"},{default:l(()=>[e(N,{modelValue:U.productName,"onUpdate:modelValue":k[3]||(k[3]=S=>U.productName=S),placeholder:"请输入产品名称",clearable:"",onKeyup:X(M,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,{label:"客户名称",prop:"clientName"},{default:l(()=>[e(N,{modelValue:U.clientName,"onUpdate:modelValue":k[4]||(k[4]=S=>U.clientName=S),placeholder:"请输入客户名称",clearable:"",onKeyup:X(M,["enter"])},null,8,["modelValue"])]),_:1}),e(Z,null,{default:l(()=>[e(pe,{type:"primary",icon:V(we),size:"small",onClick:M},{default:l(()=>k[10]||(k[10]=[f("搜索")])),_:1},8,["icon"]),e(pe,{icon:V(We),size:"small",onClick:y},{default:l(()=>k[11]||(k[11]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),[[ve,I.value]]),z((p(),b(te,{data:ae.value,onCurrentChange:P,onRowDblclick:A},{default:l(()=>[e(K,{width:"55",align:"center"},{default:l(S=>[e(C,{modelValue:D.value,"onUpdate:modelValue":k[5]||(k[5]=h=>D.value=h),label:S.row.id,onChange:h=>ie(S.row)},{default:l(()=>k[12]||(k[12]=[f(ke(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(K,{label:"工单编码",width:"180",prop:"workorderCode"}),e(K,{label:"工单名称",width:"200",align:"center",prop:"workorderName","show-overflow-tooltip":!0}),e(K,{label:"工单来源",align:"center",prop:"orderSource"},{default:l(S=>[e(se,{type:V(Ee).MES_WORKORDER_SOURCETYPE,value:S.row.orderSource},null,8,["type","value"])]),_:1}),e(K,{label:"订单编号",width:"140",align:"center",prop:"sourceCode"}),e(K,{label:"产品编号",width:"120",align:"center",prop:"productCode"}),e(K,{label:"产品名称",width:"200",align:"center",prop:"productName","show-overflow-tooltip":!0}),e(K,{label:"规格型号",align:"center",prop:"productSpc","show-overflow-tooltip":!0}),e(K,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(K,{label:"工单数量",align:"center",prop:"quantity"}),e(K,{label:"客户编码",align:"center",prop:"clientCode"}),e(K,{label:"客户名称",align:"center",prop:"clientName","show-overflow-tooltip":!0}),e(K,{label:"需求日期",align:"center",prop:"requestDate",width:"180"},{default:l(S=>[H("span",null,ke(V(el)(S.row.requestDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["data"])),[[F,w.value]]),z(e(xe,{total:J.value,page:U.pageNo,"onUpdate:page":k[6]||(k[6]=S=>U.pageNo=S),limit:U.pageSize,"onUpdate:limit":k[7]||(k[7]=S=>U.pageSize=S),onPagination:W},null,8,["total","page","limit"]),[[ve,J.value>0]])]),_:1},8,["modelValue"])}}}),Ca=De(_a,[["__scopeId","data-v-85cb79ad"]]),ya=async u=>await Y.post({url:"/wms/allocated-header/create",data:u}),ha=async u=>await Y.put({url:"/wms/allocated-header/update",data:u}),Ia=async u=>await Y.delete({url:`/wms/allocated-header/delete?id=${u}`}),xl=async u=>await Y.get({url:`/wms/allocated-header/get?id=${u}`}),Na=async u=>await Y.get({url:"/wms/allocated-header/page",params:u}),Va=async u=>await Y.download({url:"/wms/allocated-header/export-excel",params:u}),Sa=async u=>await Y.post({url:"/wms/allocated-header/initBom",data:u}),za=async u=>await Y.put({url:`/wms/allocated-header/${u}`}),xa=async u=>await Y.get({url:`/wms/allocated-header/finsh?id=${u}`}),Da=async u=>await Y.post({url:"/wms/allocated-line/updateLine",data:u}),Ua=async u=>await Y.get({url:`/wms/allocated-header/createIssue?id=${u}`}),qa=async u=>await Y.get({url:`/mes/autocode/get/${u}`}),Ra=async u=>await Y.get({url:`/wms/allocated-record/getByHeaderId?id=${u}`}),Ta={class:"app-container"},Pa={key:0},Aa={class:"dialog-footer"},Fa={class:"dialog-footer"},Oa={__name:"allocation",setup(u,{expose:c}){const j=Dl(),v=Oe(()=>j.currentSize==="mini"?"small":j.currentSize),w=d(null),D=d(null),o=d({id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),I=d({bindWorkorder:!1,status:"",allocatedDate:null,workorderCode:"",taskCode:"",clientCode:"",remark:"",workorderId:null,taskId:null}),J=d(null),ae=d(null),ne=d(null),U=d(null),W=d(!1),M=d(void 0),y=d([]),P=d([]),ie=_e({multiple:!1,value:"pId",label:"pName"}),A=d(!0),_=d(!1),ue=d([]),E=d([]),k=d(!0),N=d(!0),Z=d(!0),pe=d(!0),O=d(!1),C=d(!0),K=d(0),se=d([]),te=d(""),ee=d(!1),F=_e({pageNo:1,pageSize:10,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:[],status:null,remark:null,createTime:[],bindWorkorder:null}),S=d(null),h=d([]),s=d([]),re=_e({allocatedCode:[{required:!0,message:"调拨单编号不能为空",trigger:"blur"}],warehouseId:[{required:!0,message:"请指定调入仓库",trigger:"blur"}],locationId:[{required:!0,message:"请指定调入库区",trigger:"blur"}],areaId:[{required:!0,message:"请指定调入库位",trigger:"blur"}],workorderCode:[],taskCode:[]}),L=d(!1),de=d(!1),$=d(null),ce=d(null),g=_e({}),G=d(null);d(640),d(480),d("");const Ue=Oe(()=>M.value==="edit");Oe(()=>o.value.bindWorkorder?{workorderCode:[{required:!0,message:"请指定生产工单",trigger:"blur"}],taskCode:[{required:!0,message:"请指定生产任务",trigger:"blur"}]}:{workorderCode:[],taskCode:[]}),Le(()=>{me(),Pl(),window.addEventListener("keydown",Re),document.addEventListener("click",()=>{L.value&&$.value&&Te()}),Fe(()=>{setTimeout(()=>{$.value&&$.value.focus()},1e3)})}),Yl(()=>{le()}),$l(()=>L.value,t=>{t?Fe(()=>{setTimeout(()=>{$.value&&($.value.focus(),console.log("设置焦点成功"))},300)}):G.value=null});const Me=t=>{t?o.value.allocatedDate=new Date(t).getTime():t===null&&(o.value.allocatedDate=null)},qe=t=>{t?I.value.allocatedDate=new Date(t).getTime():t===null&&(I.value.allocatedDate=null)},le=()=>{window.removeEventListener("keydown",Re,!1)},Re=t=>{if(t.keyCode===13){if(!t.target.value)return;ce.value=t.target.value;var r=ce.value;if(typeof r=="string"&&r.includes("{")&&r.includes("}")){let m="";r=r.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),console.log(r,"newVal 111"),r=r.replace(/\uFEFF/g,""),r=Tl(r);const B=JSON.parse(r);B&&(G.value=B.id,ce.value=null,m=B.type,Te()),He(m)}else if(typeof r=="object"&&r.id){let m="";G.value=r.id,m=r.type,ce.value=null,Te(),He(m)}else console.log('输入内容不包含完整的 "{" 和 "}"')}},Ke=()=>{G.value=null,ce.value=null,Te()},Be=t=>{ue.value=t.map(a=>a.id),k.value=t.length!==1,Z.value=!t.length},R=t=>{S.value?.toggleRowSelection(t)};function Tl(t){let a=0,r=!1,m=!1;for(let B=0;B<t.length;B++){const T=t[B];if(m){m=!1;continue}if(T==="\\"){m=!0;continue}if(T==='"'&&(r=!r),!r){if(T==="{")a++;else if(T==="}"&&(a--,a===0)){const be=t.slice(0,B+1);try{return be}catch{throw new Error("Invalid JSON object")}}}}throw new Error("No valid JSON object found")}const Te=()=>{L.value&&$.value&&Fe(()=>{setTimeout(()=>{$.value&&$.value.focus()},300)})},me=()=>{A.value=!0,Na(F).then(t=>{se.value=t.list,K.value=t.total,A.value=!1})},Pl=()=>{Rl().then(t=>{P.value=t,P.value.map(a=>{a.pId=a.id,a.pName=a.warehouseName,a.children.map(r=>{r.pId=r.id,r.pName=r.locationName,r.children.map(m=>{m.pId=m.id,m.pName=m.areaName})})})})},Ye=()=>{ee.value=!1,h.value=[],s.value=[],L.value=!1,Pe()},Pe=()=>{Object.assign(o.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bomList:[]}),W.value=!1,h.value=[],y.value=[],D.value&&D.value.resetFields()},ye=()=>{F.pageNo=1,me()},ll=()=>{w.value&&w.value.resetFields(),ye()},al=()=>{Pe(),ee.value=!0,te.value="添加调拨单",M.value="add",y.value=[]},tl=t=>{Pe();const a=t.id;xl(a).then(r=>{Object.assign(o.value,r),o.value.bindWorkorder=o.value.bindWorkorder==="true",y.value=[r.warehouseId,r.locationId,r.areaId],h.value=r.bomList,s.value=[],ee.value=!0,te.value="修改调拨单",M.value="edit"})},ol=()=>{D.value.validate(t=>{if(t){if(o.value.bindWorkorder||(o.value.bindWorkorder=!1),o.value.warehouseId==null||o.value.locationId==null||o.value.areaId==null){Q.error("请选择调拨仓库、库区、库位信息！");return}if(s.value.length===0&&o.value.bindWorkorder===!0){Q.error("请选择需要调拨的BOM信息");return}if(o.value.bomList=s.value.map(a=>({...a,quantityAllocated:parseFloat(a.quantityAllocated)})),o.value.id!=null){ha(o.value).then(a=>{Q.success("修改成功"),ee.value=!1,me()});return}o.value.bomList=s.value,ya(o.value).then(a=>{Q.success("新增成功"),ee.value=!1,me()})}})},nl=t=>{const a=t.id;Ge.confirm('是否确认删除调拨单头编号为"'+a+'"的数据项?').then(()=>Ia(a)).then(()=>{me(),Q.success("删除成功")}).catch(()=>{})},rl=()=>{let t={...F};t.pageNo=void 0,t.pageSize=void 0,Ge.confirm("是否确认导出所有调拨单头数据项?").then(()=>(O.value=!0,Va(t))).then(a=>{Jl.excel(a,"调拨单头.xls"),Q.success("导出成功"),O.value=!1}).catch(()=>{})},$e=t=>{console.log(t,"value"),t!==null?(o.value.warehouseId=t[0],o.value.locationId=t[1],o.value.areaId=t[2]):(o.value.warehouseId=null,o.value.locationId=null,o.value.areaId=null)},Qe=()=>{ae.value.showFlag=!0},Al=t=>{t!=null&&t!=null&&(o.value.workorderId=t.id,o.value.workorderCode=t.workorderCode,o.value.workorderName=t.workorderName,o.value.clientId=t.clientId,o.value.clientCode=t.clientCode,o.value.clientName=t.clientName),_.value=!0,Sa(o.value.workorderCode).then(a=>{h.value=a,_.value=!1})},dl=t=>{t?(A.value=!0,qa("ALLOCATED_CODE").then(a=>{o.value.allocatedCode=a,A.value=!1})):o.value.allocatedCode=null},ul=t=>{Pe();const a=t.id||ue.value;A.value=!0,xa(a).then(r=>{Q.success("成功"),ee.value=!1,A.value=!1,me()}).catch(()=>{A.value=!1,me()})},sl=t=>{s.value=t.map(a=>({...a}))},il=t=>{pl(t.id,!1)},Fl=t=>{pl(t.id,!0)},pl=(t,a)=>{g.id=t,Fe(()=>{J.value&&J.value.resetFields()}),xl(t).then(r=>{Object.assign(g,r),g.bindWorkorder=g.bindWorkorder==="true",y.value=[r.warehouseId,r.locationId,r.areaId],y.value[0]=r.warehouseId,y.value[1]=r.locationId,y.value[2]=r.areaId,h.value=r.bomList}),Ra(t).then(r=>{s.value=r}),de.value=a,L.value=!0},cl=()=>{if(!G.value){Q.error("请扫描正确的单据信息!");return}He()},ml=()=>{U.value.showFlag=!0,U.value.getList()},fl=()=>{const t=E.value;s.value=s.value.filter(a=>!t.includes(a.id))},vl=t=>{E.value=t.map(a=>a.id),N.value=t.length!==1,pe.value=!t.length},He=t=>{let a="";if(t&&(a=t),y.value[0]===""||y.value[1]===""||y.value[2]===""){Q.error("请选择调拨仓库、库区、库位信息！");return}if(!G.value){Q.error("请输入或扫描单据信息!");return}let r={id:parseInt(G.value),type:a,method:"allocated",warehouseId:y.value[0],locationId:y.value[1],areaId:y.value[2]};A.value=!0,Gl(r).then(m=>{A.value=!1;let B=m;B.quantityAllocated=B.quantityOnhand,s.value.some(be=>be.itemCode===B.itemCode&&be.batchCode===B.batchCode)?Q.error("物料唯一码已存在，请勿添加重复项。"):(Q.success("新增成功"),s.value.push(B))})},gl=async()=>{let t={headerId:g.id,bomList:s.value};A.value=!0;try{await Da(t),await za(g.id),A.value=!1,me(),Q.success("出库成功"),L.value=!1}catch{Q.error("操作失败"),A.value=!1}},wl=t=>{const a=parseFloat(t.quantityAllocated);if(isNaN(a)||a<=0){Q.error("调拨数量必须为大于0的正数"),t.quantityAllocated="";return}const r=s.value.findIndex(m=>m.itemCode===t.itemCode);r!==-1&&(s.value[r]={...s.value[r],quantityAllocated:a})},je=()=>{ne.value.showFlag=!0,ne.value.getList()},Ol=t=>{t!=null&&t!=null&&(o.value.taskId=t.id,o.value.taskCode=t.taskCode,o.value.taskName=t.taskName,o.value.workstationId=t.workstationId,o.value.workstationCode=t.workstationCode,o.value.workstationName=t.workstationName,o.value.processId=t.processId,o.value.processCode=t.processCode,o.value.processName=t.processName)},El=t=>{t!=null&&t!=null&&(g.taskId=t.id,g.taskCode=t.taskCode,g.taskName=t.taskName,g.workstationId=t.workstationId,g.workstationCode=t.workstationCode,g.workstationName=t.workstationName,g.processId=t.processId,g.processCode=t.processCode,g.processName=t.processName)},Ll=t=>{if(t!=null&&t!=null)for(let a=0;a<t.length;a++){let r=t[a];r.quantityAllocated=r.quantityOnhand,s.value.some(B=>B.itemCode===r.itemCode&&B.batchCode===r.batchCode)?Q.error("物料唯一码已存在，请勿添加重复项。"):s.value.push(r)}},kl=t=>{o.value.bindWorkorder=t,D.value&&D.value.validate()},bl=t=>{Ge.confirm("确认生成领料单吗?").then(()=>{A.value=!0;const a=t.id||ue.value;Ua(a).then(()=>{A.value=!1,me(),Q.success("领料单创建成功"),L.value=!1}).catch(r=>{Q.error("领料单创建失败"),A.value=!1})}).catch(()=>{Q.info("已取消")})};return c({queryParams:F,showSearch:C,loading:A,list:se,total:K,single:k,multiple:Z,exportLoading:O,handleQuery:ye,resetQuery:ll,handleAdd:al,handleUpdate:tl,handleDelete:nl,handleExport:rl,handleFinsh:ul,handleIssue:bl,handleExecute:il,form:o,rules:re,autoGenFlag:W,optType:M,warehouseInfo:y,warehouseOptions:P,warehouseProps:ie,bomList:h,allocatedList:s,bomLoadding:_,open:ee,title:te,isEdit:Ue,handleAutoGenChange:dl,handleWarehouseChanged:$e,handleWorkorderSelect:Qe,handleTaskSelect:je,handleBindWorkorderChange:kl,handleBomSelectionChange:sl,handleQuantityChange:wl,submitForm:ol,cancel:Ye,executeDialogVisible:L,executeForm:g,purchaseId:G,allocatedSingle:N,allocatedHandleAdd:cl,allocatedHandleBatchAdd:ml,allocatedHandleDelete:fl,allocatedHandleSelectionChange:vl,executeAllocated:gl}),(t,a)=>{const r=i("el-input"),m=i("el-form-item"),B=i("el-date-picker"),T=i("el-button"),be=i("el-form"),q=i("el-col"),fe=i("el-row"),x=i("el-table-column"),Wl=Ul,Ne=i("el-table"),Ml=xe,Kl=Bl,_l=i("el-switch"),Cl=i("el-cascader"),yl=i("el-option"),hl=i("el-select"),Ae=i("el-divider"),Il=i("el-card"),Nl=i("el-dialog"),ge=Ce("hasPermi"),Ve=Ce("loading"),Vl=Ce("dialogDrag");return p(),he("div",Ta,[z(e(be,{model:F,ref:"queryFormRef",size:v.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(m,{label:"调拨单号",prop:"allocatedCode"},{default:l(()=>[e(r,{modelValue:F.allocatedCode,"onUpdate:modelValue":a[0]||(a[0]=n=>F.allocatedCode=n),placeholder:"请输入调拨单编号",clearable:"",onKeyup:X(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(r,{modelValue:F.allocatedName,"onUpdate:modelValue":a[1]||(a[1]=n=>F.allocatedName=n),placeholder:"请输入调拨单名称",clearable:"",onKeyup:X(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(r,{modelValue:F.workorderCode,"onUpdate:modelValue":a[2]||(a[2]=n=>F.workorderCode=n),placeholder:"请输入生产工单编码",clearable:"",onKeyup:X(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"仓库名称",prop:"warehouseName"},{default:l(()=>[e(r,{modelValue:F.warehouseName,"onUpdate:modelValue":a[3]||(a[3]=n=>F.warehouseName=n),placeholder:"请输入仓库名称",clearable:"",onKeyup:X(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(B,{modelValue:F.allocatedDate,"onUpdate:modelValue":a[4]||(a[4]=n=>F.allocatedDate=n),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),e(m,null,{default:l(()=>[e(T,{type:"primary",icon:V(we),onClick:ye},{default:l(()=>a[30]||(a[30]=[f("搜索")])),_:1},8,["icon"]),e(T,{icon:V(We),onClick:ll},{default:l(()=>a[31]||(a[31]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[ve,C.value]]),e(fe,{gutter:10,class:"mb8"},{default:l(()=>[e(q,{span:1.5},{default:l(()=>[z((p(),b(T,{type:"primary",icon:V(Je),size:v.value,onClick:al},{default:l(()=>a[32]||(a[32]=[f("新增 ")])),_:1},8,["icon","size"])),[[ge,["wms:allocated-header:create"]]])]),_:1}),e(q,{span:1.5},{default:l(()=>[z((p(),b(T,{type:"warning",plain:"",icon:V(Ql),size:v.value,onClick:rl,loading:O.value},{default:l(()=>a[33]||(a[33]=[f("导出 ")])),_:1},8,["icon","size","loading"])),[[ge,["wms:allocated-header:export"]]])]),_:1}),e(q,{span:1.5},{default:l(()=>[z((p(),b(T,{type:"success",plain:"",icon:V(Sl),size:v.value,onClick:ul,disabled:k.value},{default:l(()=>a[34]||(a[34]=[f("完成 ")])),_:1},8,["icon","size","disabled"])),[[ge,["wms:allocated-header:finsh"]]])]),_:1}),e(q,{span:1.5},{default:l(()=>[z((p(),b(T,{plain:"",icon:V(Sl),size:v.value,onClick:bl,disabled:k.value},{default:l(()=>a[35]||(a[35]=[f("生成领料单 ")])),_:1},8,["icon","size","disabled"])),[[ge,["wms:allocated-header:createIssue"]]])]),_:1})]),_:1}),e(Kl,null,{default:l(()=>[z((p(),b(Ne,{ref_key:"multipleTableRef",ref:S,data:se.value,size:v.value,onSelectionChange:Be,onRowClick:R},{default:l(()=>[de.value?oe("",!0):(p(),b(x,{key:0,type:"selection",width:"55",align:"center"})),e(x,{label:"调拨单编号",align:"center",prop:"allocatedCode"}),e(x,{label:"调拨单名称",align:"center",prop:"allocatedName"}),e(x,{label:"生产工单",align:"center",prop:"workorderCode"}),e(x,{label:"调拨日期",align:"center",prop:"allocatedDate",width:"180"},{default:l(n=>[H("span",null,ke(V(el)(n.row.allocatedDate,"YYYY-MM-DD")),1)]),_:1}),e(x,{label:"单据状态",align:"center",prop:"status"},{default:l(n=>[e(Wl,{type:V(Ee).MES_ALLOCATED_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),e(x,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(n=>[n.row.status!="FINISHED"?z((p(),b(T,{key:0,size:v.value,type:"text",onClick:Ie=>il(n.row)},{default:l(()=>a[36]||(a[36]=[f("执行领出")])),_:2},1032,["size","onClick"])),[[ge,["wms:allocated-header:allocated"]]]):oe("",!0),z((p(),b(T,{size:v.value,type:"text",onClick:Ie=>tl(n.row)},{default:l(()=>a[37]||(a[37]=[f("修改 ")])),_:2},1032,["size","onClick"])),[[ge,["wms:allocated-header:update"]]]),z((p(),b(T,{size:v.value,type:"text",onClick:Ie=>nl(n.row)},{default:l(()=>a[38]||(a[38]=[f("删除 ")])),_:2},1032,["size","onClick"])),[[ge,["wms:allocated-header:delete"]]]),z((p(),b(T,{size:v.value,type:"text",onClick:Ie=>Fl(n.row)},{default:l(()=>a[39]||(a[39]=[f("详情")])),_:2},1032,["size","onClick"])),[[ge,["wms:allocated-header:allocated"]]])]),_:1})]),_:1},8,["data","size"])),[[Ve,A.value]]),z(e(Ml,{total:K.value,page:F.pageNo,"onUpdate:page":a[5]||(a[5]=n=>F.pageNo=n),limit:F.pageSize,"onUpdate:limit":a[6]||(a[6]=n=>F.pageSize=n),onPagination:me},null,8,["total","page","limit"]),[[ve,K.value>0]])]),_:1}),z((p(),b(Nl,{title:te.value,modelValue:ee.value,"onUpdate:modelValue":a[17]||(a[17]=n=>ee.value=n),width:"80%","append-to-body":""},{footer:l(()=>[H("div",Aa,[e(T,{size:v.value,type:"primary",onClick:ol},{default:l(()=>a[42]||(a[42]=[f("确 定")])),_:1},8,["size"]),e(T,{size:v.value,onClick:Ye},{default:l(()=>a[43]||(a[43]=[f("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(be,{ref_key:"formRef",ref:D,size:v.value,model:o.value,rules:re},{default:l(()=>[e(fe,null,{default:l(()=>[e(q,{span:8},{default:l(()=>[e(m,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(r,{disabled:Ue.value,modelValue:o.value.allocatedCode,"onUpdate:modelValue":a[7]||(a[7]=n=>o.value.allocatedCode=n),placeholder:"请输入调拨单编号"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(q,{span:4},{default:l(()=>[e(m,null,{default:l(()=>[M.value!="view"&&o.value.status=="PREPARE"?(p(),b(_l,{key:0,modelValue:W.value,"onUpdate:modelValue":a[8]||(a[8]=n=>W.value=n),"active-color":"#13ce66","active-text":"自动生成",onChange:dl},null,8,["modelValue"])):oe("",!0)]),_:1})]),_:1}),e(q,{span:12},{default:l(()=>[e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(r,{disabled:"",modelValue:o.value.allocatedName,"onUpdate:modelValue":a[9]||(a[9]=n=>o.value.allocatedName=n),placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(fe,null,{default:l(()=>[e(q,{span:8},{default:l(()=>[e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(B,{clearable:"",modelValue:o.value.allocatedDate,"onUpdate:modelValue":a[10]||(a[10]=n=>o.value.allocatedDate=n),type:"date",onChange:Me,placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{span:8},{default:l(()=>[e(m,{label:"领料仓库"},{default:l(()=>[e(Cl,{modelValue:y.value,"onUpdate:modelValue":a[11]||(a[11]=n=>y.value=n),options:P.value,props:ie,placeholder:"请选择",onChange:$e},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(q,{span:8},{default:l(()=>[e(m,{label:"单据状态",prop:"status"},{default:l(()=>[e(hl,{modelValue:o.value.status,"onUpdate:modelValue":a[12]||(a[12]=n=>o.value.status=n),disabled:""},{default:l(()=>[(p(!0),he(Se,null,ze(V(Ee).MES_ALLOCATED_STATUS,n=>(p(),b(yl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(fe,null,{default:l(()=>[e(q,{span:2}),e(q,{span:6},{default:l(()=>[e(m,{"label-width":"80"},{default:l(()=>[M.value!="view"&&o.value.status=="PREPARE"?(p(),b(_l,{key:0,style:{"margin-left":"10%"},modelValue:o.value.bindWorkorder,"onUpdate:modelValue":a[13]||(a[13]=n=>o.value.bindWorkorder=n),"active-color":"#13ce66","inactive-text":"绑定工单",onChange:kl},null,8,["modelValue"])):oe("",!0)]),_:1})]),_:1}),o.value&&o.value.bindWorkorder?(p(),b(q,{key:0,span:8},{default:l(()=>[e(m,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(r,{modelValue:o.value.workorderCode,"onUpdate:modelValue":a[14]||(a[14]=n=>o.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(T,{icon:V(we),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Ca,{ref:"woSelectRef",onOnSelected:Al},null,512)]),_:1})):oe("",!0),o.value&&o.value.bindWorkorder?(p(),b(q,{key:1,span:8},{default:l(()=>[e(m,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(r,{modelValue:o.value.taskCode,"onUpdate:modelValue":a[15]||(a[15]=n=>o.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(T,{icon:V(we),onClick:je},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(zl,{ref:"taskSelectRef",workorderId:o.value.workorderId,onOnSelected:Ol},null,8,["workorderId"])]),_:1})):oe("",!0)]),_:1}),e(fe,null,{default:l(()=>[e(q,{span:24},{default:l(()=>[e(m,{label:"备注",prop:"remark"},{default:l(()=>[e(r,{modelValue:o.value.remark,"onUpdate:modelValue":a[16]||(a[16]=n=>o.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"]),o.value&&o.value.bindWorkorder?(p(),he("div",Pa,[e(Ae,{"content-position":"center"},{default:l(()=>a[40]||(a[40]=[f("物料信息")])),_:1}),e(Il,{shadow:"always",class:"box-card"},{default:l(()=>[z((p(),b(Ne,{size:v.value,"max-height":"300",data:h.value,onSelectionChange:sl},{default:l(()=>[e(x,{type:"selection",width:"65",align:"center"}),e(x,{label:"物料编码",align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{width:"210",label:"需求数量",align:"center",prop:"quantityAllocated"}),e(x,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,_.value]])]),_:1}),e(Ae,{"content-position":"center"},{default:l(()=>a[41]||(a[41]=[f("调拨信息")])),_:1}),e(Il,{shadow:"always",class:"box-card"},{default:l(()=>[z((p(),b(Ne,{size:v.value,"max-height":"300",data:s.value,"row-key":"itemCode"},{default:l(()=>[e(x,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{width:"220",label:"调拨数量",align:"center",prop:"quantityAllocated"},{default:l(n=>[e(r,{modelValue:n.row.quantityAllocated,"onUpdate:modelValue":Ie=>n.row.quantityAllocated=Ie,type:"number",placeholder:"请输入数量",onBlur:Ie=>wl(n.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(x,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,_.value]])]),_:1})])):oe("",!0)]),_:1},8,["title","modelValue"])),[[Vl]]),z((p(),b(Nl,{title:de.value?"详情":"执行出库",class:"execute-dialog",modelValue:L.value,"onUpdate:modelValue":a[29]||(a[29]=n=>L.value=n),width:"92%","append-to-body":""},{footer:l(()=>[H("span",Fa,[e(T,{size:v.value,onClick:Ye},{default:l(()=>a[51]||(a[51]=[f("取 消")])),_:1},8,["size"]),de.value?oe("",!0):(p(),b(T,{key:0,size:v.value,type:"primary",onClick:gl},{default:l(()=>a[52]||(a[52]=[f("确 定")])),_:1},8,["size"]))])]),default:l(()=>[e(be,{size:v.value,ref_key:"executeFormRef",ref:J,model:I.value,"label-width":"100px"},{default:l(()=>[e(fe,null,{default:l(()=>[e(q,{span:8},{default:l(()=>[e(m,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(r,{modelValue:I.value.allocatedCode,"onUpdate:modelValue":a[18]||(a[18]=n=>I.value.allocatedCode=n),disabled:"",placeholder:"请输入调拨单编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{span:12},{default:l(()=>[e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(r,{modelValue:I.value.allocatedName,"onUpdate:modelValue":a[19]||(a[19]=n=>I.value.allocatedName=n),disabled:"",placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(fe,null,{default:l(()=>[e(q,{span:8},{default:l(()=>[e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(B,{clearable:"",modelValue:I.value.allocatedDate,"onUpdate:modelValue":a[20]||(a[20]=n=>I.value.allocatedDate=n),disabled:"",type:"date",onChange:qe,placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{span:8},{default:l(()=>[e(m,{label:"领料仓库"},{default:l(()=>[e(Cl,{disabled:"",modelValue:y.value,"onUpdate:modelValue":a[21]||(a[21]=n=>y.value=n),options:P.value,props:ie,onChange:$e},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(q,{span:8},{default:l(()=>[e(m,{label:"单据状态",prop:"status"},{default:l(()=>[e(hl,{disabled:"",modelValue:I.value.status,"onUpdate:modelValue":a[22]||(a[22]=n=>I.value.status=n)},{default:l(()=>[(p(!0),he(Se,null,ze(V(Ee).MES_ALLOCATED_STATUS,n=>(p(),b(yl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),I.value.bindWorkorder?(p(),b(fe,{key:0},{default:l(()=>[e(q,{span:8},{default:l(()=>[e(m,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(r,{disabled:"",modelValue:I.value.workorderCode,"onUpdate:modelValue":a[23]||(a[23]=n=>I.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(T,{disabled:"",icon:V(we),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(q,{span:8},{default:l(()=>[e(m,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(r,{disabled:"",modelValue:I.value.taskCode,"onUpdate:modelValue":a[24]||(a[24]=n=>I.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(T,{disabled:"",icon:V(we),onClick:je},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(zl,{ref:"taskSelectRef",workorderId:I.value.workorderId,onOnSelected:El},null,8,["workorderId"])]),_:1}),e(q,{span:8},{default:l(()=>[e(m,{label:"客户编号"},{default:l(()=>[e(r,{disabled:"",modelValue:I.value.clientCode,"onUpdate:modelValue":a[25]||(a[25]=n=>I.value.clientCode=n),placeholder:"请选择生产工单"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):oe("",!0),e(fe,null,{default:l(()=>[e(q,{span:24},{default:l(()=>[e(m,{label:"备注",prop:"remark"},{default:l(()=>[e(r,{disabled:"",modelValue:I.value.remark,"onUpdate:modelValue":a[26]||(a[26]=n=>I.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),I.value.bindWorkorder?(p(),b(Ae,{key:1,"content-position":"center"},{default:l(()=>a[44]||(a[44]=[f("BOM信息")])),_:1})):oe("",!0),I.value.bindWorkorder?z((p(),b(Ne,{key:2,size:v.value,"max-height":"200",data:h.value,style:{width:"100%"}},{default:l(()=>[e(x,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{label:"需求数量",align:"center",prop:"quantityAllocated"}),e(x,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,_.value]]):oe("",!0),e(Ae,{"content-position":"center"},{default:l(()=>a[45]||(a[45]=[f("调拨信息")])),_:1}),de.value?oe("",!0):(p(),b(fe,{key:3,gutter:10},{default:l(()=>[e(q,{span:8},{default:l(()=>[e(m,{label:"单据信息",prop:"purchaseId"},{default:l(()=>[e(r,{readonly:"",modelValue:G.value,"onUpdate:modelValue":a[27]||(a[27]=n=>G.value=n),placeholder:"请输入"},null,8,["modelValue"]),z(H("input",{ref_key:"scannerInput",ref:$,"onUpdate:modelValue":a[28]||(a[28]=n=>ce.value=n),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"1",height:"1","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[Hl,ce.value]]),a[46]||(a[46]=H("span",null,"支持扫码枪扫描, 无法扫码时点击重置按钮",-1))]),_:1})]),_:1}),e(q,{span:4},{default:l(()=>[e(T,{type:"primary",round:"",onClick:Ke},{default:l(()=>a[47]||(a[47]=[f("重置")])),_:1})]),_:1}),e(q,{span:2.5},{default:l(()=>[e(T,{type:"primary",style:{"margin-right":"10px"},icon:V(Je),size:v.value,onClick:cl},{default:l(()=>a[48]||(a[48]=[f("新增")])),_:1},8,["icon","size"])]),_:1}),e(q,{span:2.5},{default:l(()=>[z((p(),b(T,{type:"primary",style:{"margin-right":"10px"},icon:V(Je),size:v.value,onClick:ml},{default:l(()=>a[49]||(a[49]=[f("批量新增")])),_:1},8,["icon","size"])),[[ge,["wms:allocated-header:batchAdd"]]])]),_:1}),e(wa,{ref_key:"stockSelectRef",ref:U,onOnSelected:Ll},null,512),e(q,{span:2.5},{default:l(()=>[e(T,{type:"danger",icon:V(jl),size:v.value,disabled:N.value,onClick:fl},{default:l(()=>a[50]||(a[50]=[f("删除")])),_:1},8,["icon","size","disabled"])]),_:1})]),_:1})),z((p(),b(Ne,{size:v.value,data:s.value,onSelectionChange:vl},{default:l(()=>[de.value?oe("",!0):(p(),b(x,{key:0,type:"selection",width:"55",align:"center"})),e(x,{label:"序号",width:"55",align:"center"},{default:l(n=>[f(ke(n.$index+1),1)]),_:1}),e(x,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(x,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(x,{label:"调拨数量","show-overflow-tooltip":!0,align:"center",prop:"quantityAllocated"}),e(x,{width:"70",label:"单位",align:"center",prop:"unitOfMeasure"}),e(x,{label:"批次号","show-overflow-tooltip":!0,align:"center",prop:"batchCode"}),e(x,{label:"调拨标识","show-overflow-tooltip":!0,width:"90",align:"center",prop:"allocatedFlag"}),e(x,{label:"仓库名称","show-overflow-tooltip":!0,align:"center",prop:"warehouseName"}),e(x,{label:"库区名称","show-overflow-tooltip":!0,align:"center",prop:"locationName"}),e(x,{label:"库位名称","show-overflow-tooltip":!0,align:"center",prop:"areaName"})]),_:1},8,["size","data"])),[[Ve,A.value]])]),_:1},8,["size","model"])]),_:1},8,["title","modelValue"])),[[Vl]])])}}},Ya=De(Oa,[["__scopeId","data-v-088cff33"]]);export{Ya as default};
