/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 13:38:04 
 */
import{f as Y,cK as R,V as y,d as B,r as l,g as k,h as q,c as X,o as A,F as j,j as i,_ as z,a,y as K,m as u,w as G,k as H,v as S,N as J,bX as Q,z as W,X as Z}from"./index-FPuwcz_Y.js";import{_ as ee}from"./Form-Cd9E2IP0.js";import{_ as te}from"./SpuAndSkuList.vue_vue_type_script_setup_true_lang-vN4SBVkU.js";import{_ as oe}from"./SpuSelect.vue_vue_type_script_setup_true_lang-QlmBqxoC.js";import{r as _}from"./formRules-D6WFlqPs.js";import{D as se}from"./dict-C9lD-gwA.js";import{u as ae}from"./useCrudSchemas-Cjh2V3XS.js";import{b as ne}from"./spu-C0bMceak.js";import{g as ie}from"./index-LZ5b6W3x.js";const re=Y({spuId:[_],name:[_],startTime:[_],endTime:[_],discountType:[_]}),ce=Y([{label:"活动名称",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"活动开始时间",field:"startTime",formatter:R,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"活动结束时间",field:"endTime",formatter:R,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"优惠类型",field:"discountType",dictType:se.PROMOTION_DISCOUNT_TYPE,dictClass:"number",isSearch:!0,form:{component:"Radio",value:1}},{label:"活动商品",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"备注",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:le}=ae(ce),ke=async s=>await y.get({url:"/promotion/discount-activity/page",params:s}),ue=async s=>await y.get({url:`/promotion/discount-activity/get?id=${s}`}),pe=async s=>await y.post({url:"/promotion/discount-activity/create",data:s}),de=async s=>await y.put({url:"/promotion/discount-activity/update",data:s}),Se=async s=>await y.put({url:`/promotion/discount-activity/close?id=${s}`}),Te=async s=>await y.delete({url:`/promotion/discount-activity/delete?id=${s}`}),he=B({name:"PromotionDiscountActivityForm",__name:"DiscountActivityForm",emits:["success"],setup(s,{expose:x,emit:$}){const{t:D}=J(),T=W(),f=l(!1),h=l(""),v=l(!1),C=l(""),p=l(),V=l(),F=l(),L=[],g=l([]),P=l([]),E=(r,e)=>{p.value.setValues({spuId:r}),I(r,e)},I=async(r,e,t)=>{const c=[],d=await ne([r]);if(d.length==0)return;g.value=[];const n=d[0],w=typeof e>"u"?n?.skus:n?.skus?.filter(m=>e.includes(m.id));w?.forEach(m=>{let o={skuId:m.id,spuId:n.id,discountType:1,discountPercent:0,discountPrice:0};typeof t<"u"&&(o=t.find(O=>O.skuId===m.id)||o),m.productConfig=o}),n.skus=w,c.push({spuId:n.id,spuDetail:n,propertyList:ie(n)}),g.value.push(n),P.value=c};x({open:async(r,e)=>{if(f.value=!0,h.value=D(`action.${r}`),C.value=r,await N(),e){v.value=!0;try{const t=await ue(e),c=t.products[0].spuId;await I(c,t.products?.map(d=>d.skuId),t.products),p.value.setValues(t)}finally{v.value=!1}}}});const M=$,U=async()=>{if(!(!p||!await p.value.getElFormRef().validate())){v.value=!0;try{const e=p.value.formModel,t=Q(F.value.getSkuConfigs("productConfig"));t.forEach(c=>{c.discountType=e.discountType}),e.products=t,C.value==="create"?(await pe(e),T.success(D("common.createSuccess"))):(await de(e),T.success(D("common.updateSuccess"))),f.value=!1,M("success")}finally{v.value=!1}}},N=async()=>{g.value=[],P.value=[],await Z(),p.value.getElFormRef().resetFields()};return(r,e)=>{const t=k("el-button"),c=k("el-input-number"),d=k("el-table-column"),n=ee,w=z,m=q("loading");return A(),X(j,null,[i(w,{modelValue:a(f),"onUpdate:modelValue":e[2]||(e[2]=o=>K(f)?f.value=o:null),title:a(h),width:"65%"},{footer:u(()=>[i(t,{disabled:a(v),type:"primary",onClick:U},{default:u(()=>e[4]||(e[4]=[S("确 定")])),_:1},8,["disabled"]),i(t,{onClick:e[1]||(e[1]=o=>f.value=!1)},{default:u(()=>e[5]||(e[5]=[S("取 消")])),_:1})]),default:u(()=>[G((A(),H(n,{ref_key:"formRef",ref:p,"is-col":!0,rules:a(re),schema:a(le).formSchema},{spuId:u(()=>[i(t,{onClick:e[0]||(e[0]=o=>a(V).open())},{default:u(()=>e[3]||(e[3]=[S("选择商品")])),_:1}),i(a(te),{ref_key:"spuAndSkuListRef",ref:F,"rule-config":L,"spu-list":a(g),"spu-property-list-p":a(P)},{default:u(()=>[i(d,{align:"center",label:"优惠金额","min-width":"168"},{default:u(({row:o})=>[i(c,{modelValue:o.productConfig.discountPrice,"onUpdate:modelValue":b=>o.productConfig.discountPrice=b,class:"w-100%",min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(d,{align:"center",label:"折扣百分比(%)","min-width":"168"},{default:u(({row:o})=>[i(c,{modelValue:o.productConfig.discountPercent,"onUpdate:modelValue":b=>o.productConfig.discountPercent=b,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[m,a(v)]])]),_:1},8,["modelValue","title"]),i(a(oe),{ref_key:"spuSelectRef",ref:V,"is-select-sku":!0,onConfirm:E},null,512)],64)}}});export{he as _,Se as c,Te as d,ke as g};
