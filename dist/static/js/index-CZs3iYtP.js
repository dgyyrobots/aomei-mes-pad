/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:10:14 
 */
import{d as O,r as l,f as R,g,h as S,c as T,o as x,j as o,m as n,a as t,w as P,k as j,v as b,K,M as W,y as V,F as G,z as H,aL as Q,A as X}from"./index-BdC40rFX.js";import{_ as Y}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CdI9J0YF.js";import{_ as Z}from"./index-Cen3Pl2s.js";import{N as ee,c as te}from"./NewsForm-CUuAExVe.js";import ae from"./DraftTable-m2hyaJff.js";import{g as oe,c as ne,u as le,d as se}from"./main-C5bHu-zA.js";import{s as ie}from"./index-BwfJs7Qg.js";import{_ as re}from"./main.vue_vue_type_script_setup_true_lang-BGIv95fq.js";import"./CoverSelect-BoGV6l1N.js";import"./useUpload-ClxgNmfW.js";import"./main-CXq0p58Y.js";import"./main-BLBDUrM9.js";import"./main.vue_vue_type_script_setup_true_lang-CVKiCGxc.js";import"./index-DlWFSVCk.js";import"./style.css_vue_type_style_index_0_src_true_lang-BD-Jc5v5.js";import"./locale-SYpyG3Sh.js";import"./index-DRRwHKFp.js";const ce=O({name:"MpDraft",__name:"index",setup(me){const r=H(),s=l(-1);Q("accountId",s);const v=l(!0),I=l([]),N=l(0),c=R({pageNo:1,pageSize:10,accountId:s}),m=l(!1),u=l([]),C=l(""),f=l(!0),y=l(!1),k=a=>{s.value=a,c.pageNo=1,_()},U=async a=>{try{await r.confirm("修改内容可能还未保存，确定关闭吗?"),a()}catch(e){console.log(e)}},_=async()=>{v.value=!0;try{const a=await oe(c);a.list.forEach(e=>{e.content.newsItem.forEach(d=>{d.picUrl=d.thumbUrl})}),I.value=a.list,N.value=a.total}finally{v.value=!1}},h=()=>{f.value=!0,u.value=[te()],m.value=!0},F=a=>{C.value=a.mediaId,u.value=JSON.parse(JSON.stringify(a.content.newsItem)),f.value=!1,m.value=!0},L=async()=>{y.value=!0;try{f.value?(await ne(s.value,u.value),r.notifySuccess("新增成功")):(await le(s.value,C.value,u.value),r.notifySuccess("更新成功"))}finally{m.value=!1,y.value=!1,await _()}},$=async a=>{const e=a.mediaId,p="你正在通过发布的方式发表内容。 发布不占用群发次数，一天可多次发布。已发布内容不会推送给用户，也不会展示在公众号主页中。 发布后，你可以前往发表记录获取链接，也可以将发布内容添加到自定义菜单、自动回复、话题和页面模板中。";try{await r.confirm(p),await ie(s.value,e),r.notifySuccess("发布成功"),await _()}catch(d){console.log(d)}},z=async a=>{const e=a.mediaId;try{await r.confirm("此操作将永久删除该草稿, 是否继续?"),await se(s.value,e),r.notifySuccess("删除成功"),await _()}catch(p){console.log(p)}};return(a,e)=>{const p=Z,d=g("el-form-item"),B=K,w=g("el-button"),E=g("el-form"),D=Y,A=W,M=g("el-dialog"),q=S("hasPermi"),J=S("loading");return x(),T(G,null,[o(p,{title:"公众号图文",url:"https://doc.iocoder.cn/mp/article/"}),o(D,null,{default:n(()=>[o(E,{ref:"queryFormRef",class:"-mb-15px",inline:!0,"label-width":"68px",model:t(c)},{default:n(()=>[o(d,{label:"公众号",prop:"accountId"},{default:n(()=>[o(t(re),{onChange:k})]),_:1}),o(d,null,{default:n(()=>[P((x(),j(w,{disabled:t(s)===0,plain:"",type:"primary",onClick:h},{default:n(()=>[o(B,{icon:"ep:plus"}),e[5]||(e[5]=b(" 新增 "))]),_:1},8,["disabled"])),[[q,["mp:draft:create"]]])]),_:1})]),_:1},8,["model"])]),_:1}),o(D,null,{default:n(()=>[o(t(ae),{list:t(I),loading:t(v),onDelete:z,onPublish:$,onUpdate:F},null,8,["list","loading"]),o(A,{limit:t(c).pageSize,"onUpdate:limit":e[0]||(e[0]=i=>t(c).pageSize=i),page:t(c).pageNo,"onUpdate:page":e[1]||(e[1]=i=>t(c).pageNo=i),total:t(N),onPagination:_},null,8,["limit","page","total"])]),_:1}),o(M,{modelValue:t(m),"onUpdate:modelValue":e[4]||(e[4]=i=>V(m)?m.value=i:null),"before-close":U,"destroy-on-close":"",title:t(f)?"新建图文":"修改图文",width:"90%"},{footer:n(()=>[o(w,{onClick:e[3]||(e[3]=i=>m.value=!1)},{default:n(()=>e[6]||(e[6]=[b("取 消")])),_:1}),o(w,{type:"primary",onClick:L},{default:n(()=>e[7]||(e[7]=[b("提 交")])),_:1})]),default:n(()=>[P(o(t(ee),{modelValue:t(u),"onUpdate:modelValue":e[2]||(e[2]=i=>V(u)?u.value=i:null),"is-creating":t(f)},null,8,["modelValue","is-creating"]),[[J,t(y)]])]),_:1},8,["modelValue","title"])],64)}}}),Ve=X(ce,[["__scopeId","data-v-71ee2958"]]);export{Ve as default};
