/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 13:38:04 
 */
import{d as H,r as d,f as K,g as u,h as $,k as b,o as V,m as t,w as j,a as s,j as a,v as f,t as R,y as x,_ as z,z as O,N as P,A as q}from"./index-FPuwcz_Y.js";import{g as G}from"./index-QYyDTjyL.js";import{g as J,a as Q}from"./index-CzJg_5_G.js";import{d as W,h as X}from"./tree-vSlcEeQq.js";const Y=H({name:"SystemRoleAssignMenuForm",__name:"RoleAssignMenuForm",emits:["success"],setup(Z,{expose:h,emit:w}){const{t:I}=P(),M=O(),i=d(!1),r=d(!1),l=K({id:0,name:"",code:"",menuIds:[]}),v=d(),_=d([]),m=d(!1),n=d(),p=d(!1);h({open:async o=>{i.value=!0,F(),_.value=X(await G()),l.id=o.id,l.name=o.name,l.code=o.code,r.value=!0;try{l.value.menuIds=await J(o.id),l.value.menuIds.forEach(e=>{n.value.setChecked(e,!0,!1)})}finally{r.value=!1}}});const N=w,A=async()=>{if(!(!v||!await v.value.validate())){r.value=!0;try{const e={roleId:l.id,menuIds:[...n.value.getCheckedKeys(!1),...n.value.getHalfCheckedKeys()]};await Q(e),M.success(I("common.updateSuccess")),i.value=!1,N("success")}finally{r.value=!1}}},F=()=>{p.value=!1,m.value=!1,l.value={id:0,name:"",code:"",menuIds:[]},n.value?.setCheckedNodes([]),v.value?.resetFields()},D=()=>{n.value.setCheckedNodes(p.value?_.value:[])},S=()=>{const o=n.value?.store.nodesMap;for(const e in o)o[e].expanded!==m.value&&(o[e].expanded=m.value)};return(o,e)=>{const y=u("el-tag"),g=u("el-form-item"),k=u("el-switch"),T=u("el-tree"),E=u("el-card"),L=u("el-form"),C=u("el-button"),U=z,B=$("loading");return V(),b(U,{modelValue:s(i),"onUpdate:modelValue":e[3]||(e[3]=c=>x(i)?i.value=c:null),title:"菜单权限"},{footer:t(()=>[a(C,{disabled:s(r),type:"primary",onClick:A},{default:t(()=>e[6]||(e[6]=[f("确 定")])),_:1},8,["disabled"]),a(C,{onClick:e[2]||(e[2]=c=>i.value=!1)},{default:t(()=>e[7]||(e[7]=[f("取 消")])),_:1})]),default:t(()=>[j((V(),b(L,{ref_key:"formRef",ref:v,"label-width":"80px",model:s(l)},{default:t(()=>[a(g,{label:"角色名称"},{default:t(()=>[a(y,null,{default:t(()=>[f(R(s(l).name),1)]),_:1})]),_:1}),a(g,{label:"角色标识"},{default:t(()=>[a(y,null,{default:t(()=>[f(R(s(l).code),1)]),_:1})]),_:1}),a(g,{label:"菜单权限"},{default:t(()=>[a(E,{class:"cardHeight"},{header:t(()=>[e[4]||(e[4]=f(" 全选/全不选: ")),a(k,{modelValue:s(p),"onUpdate:modelValue":e[0]||(e[0]=c=>x(p)?p.value=c:null),"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:D},null,8,["modelValue"]),e[5]||(e[5]=f(" 全部展开/折叠: ")),a(k,{modelValue:s(m),"onUpdate:modelValue":e[1]||(e[1]=c=>x(m)?m.value=c:null),"active-text":"展开","inactive-text":"折叠","inline-prompt":"",onChange:S},null,8,["modelValue"])]),default:t(()=>[a(T,{ref_key:"treeRef",ref:n,data:s(_),"empty-text":"加载中，请稍候","node-key":"id",props:s(W),"show-checkbox":""},null,8,["data","props"])]),_:1})]),_:1})]),_:1},8,["model"])),[[B,s(r)]])]),_:1},8,["modelValue"])}}}),se=q(Y,[["__scopeId","data-v-e78059b5"]]);export{se as default};
