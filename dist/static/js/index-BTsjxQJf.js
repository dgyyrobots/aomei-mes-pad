/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:10:14 
 */
import{d as re,u as ie,r as y,f as de,b as ue,g as u,h as A,c as U,o as r,j as t,m as a,a as l,J as M,F as z,n as me,k as i,w as p,v as d,K as pe,t as ce,l as $,d7 as P,M as fe,z as _e,N as be}from"./index-BdC40rFX.js";import{_ as ge}from"./DictTag.vue_vue_type_script_lang-BKaaD_BY.js";import{_ as ye}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CdI9J0YF.js";import{_ as ke}from"./index-Cen3Pl2s.js";import{_ as ve}from"./JobDetail.vue_vue_type_script_setup_true_lang-BO_jw3IM.js";import{_ as we}from"./JobForm.vue_vue_type_script_setup_true_lang-uLvnSkl3.js";import{b as xe,e as Ce,d as Ne,f as Se,r as je}from"./index-c0tibizP.js";import{c}from"./constants-BPQb3nxh.js";import{c as Re,D as B}from"./dict-D4wjFrBa.js";import{d as $e}from"./download-U6qaYcnP.js";import"./color-B5phLuB-.js";const Ue=re({name:"InfraJob",__name:"index",setup(Pe){const{t:N}=be(),f=_e(),{push:J}=ie(),S=y(!0),O=y(0),T=y([]),s=de({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),V=y(),j=y(!1),_=async()=>{S.value=!0;try{const o=await xe(s);T.value=o.list,O.value=o.total}finally{S.value=!1}},w=()=>{s.pageNo=1,_()},E=()=>{V.value.resetFields(),w()},K=async()=>{try{await f.exportConfirm(),j.value=!0;const o=await Ce(s);$e.excel(o,"定时任务.xls")}catch(o){console.log(o)}finally{j.value=!1}},D=y(),L=(o,e)=>{D.value.open(o,e)},Q=async o=>{try{const e=o.status===c.STOP?"开启":"关闭";await f.confirm(`确认要${e}定时任务编号为"${o.id}"的数据项?`,N("common.reminder"));const v=o.status===c.STOP?c.NORMAL:c.STOP;await Ne(o.id,v),f.success(`${e}成功`),await _()}catch{o.status=o.status===c.NORMAL?c.STOP:c.NORMAL}},W=async o=>{try{await f.delConfirm(),await Se(o),f.success(N("common.delSuccess")),await _()}catch(e){console.log(e)}},Y=(o,e)=>{switch(o){case"handleRun":G(e);break;case"openDetail":H(e.id);break;case"handleJobLog":F(e?.id);break}},G=async o=>{try{await f.confirm(`确认要立即执行一次${o.name}?`,N("common.reminder")),await je(o.id),f.success("执行成功"),await _()}catch(e){console.log(e)}},q=y(),H=o=>{q.value.open(o)},F=o=>{o&&o>0?J(`/job/job-log?id=${o}`):J("/job/job-log")};return ue(()=>{_()}),(o,e)=>{const v=ke,I=u("el-input"),x=u("el-form-item"),X=u("el-option"),Z=u("el-select"),k=pe,m=u("el-button"),ee=u("el-form"),h=ye,b=u("el-table-column"),te=ge,R=u("el-dropdown-item"),oe=u("el-dropdown-menu"),ae=u("el-dropdown"),ne=u("el-table"),le=fe,g=A("hasPermi"),se=A("loading");return r(),U(z,null,[t(v,{title:"定时任务",url:"https://doc.iocoder.cn/job/"}),t(v,{title:"异步任务",url:"https://doc.iocoder.cn/async-task/"}),t(v,{title:"消息队列",url:"https://doc.iocoder.cn/message-queue/"}),t(h,null,{default:a(()=>[t(ee,{ref_key:"queryFormRef",ref:V,class:"-mb-15px",inline:!0,"label-width":"100px",model:l(s)},{default:a(()=>[t(x,{label:"任务名称",prop:"name"},{default:a(()=>[t(I,{modelValue:l(s).name,"onUpdate:modelValue":e[0]||(e[0]=n=>l(s).name=n),class:"!w-240px",clearable:"",placeholder:"请输入任务名称",onKeyup:M(w,["enter"])},null,8,["modelValue"])]),_:1}),t(x,{label:"任务状态",prop:"status"},{default:a(()=>[t(Z,{modelValue:l(s).status,"onUpdate:modelValue":e[1]||(e[1]=n=>l(s).status=n),class:"!w-240px",clearable:"",placeholder:"请选择任务状态"},{default:a(()=>[(r(!0),U(z,null,me(l(Re)(l(B).INFRA_JOB_STATUS),n=>(r(),i(X,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"处理器的名字",prop:"handlerName"},{default:a(()=>[t(I,{modelValue:l(s).handlerName,"onUpdate:modelValue":e[2]||(e[2]=n=>l(s).handlerName=n),class:"!w-240px",clearable:"",placeholder:"请输入处理器的名字",onKeyup:M(w,["enter"])},null,8,["modelValue"])]),_:1}),t(x,null,{default:a(()=>[t(m,{onClick:w},{default:a(()=>[t(k,{class:"mr-5px",icon:"ep:search"}),e[7]||(e[7]=d(" 搜索 "))]),_:1}),t(m,{onClick:E},{default:a(()=>[t(k,{class:"mr-5px",icon:"ep:refresh"}),e[8]||(e[8]=d(" 重置 "))]),_:1}),p((r(),i(m,{plain:"",type:"primary",onClick:e[3]||(e[3]=n=>L("create"))},{default:a(()=>[t(k,{class:"mr-5px",icon:"ep:plus"}),e[9]||(e[9]=d(" 新增 "))]),_:1})),[[g,["infra:job:create"]]]),p((r(),i(m,{loading:l(j),plain:"",type:"success",onClick:K},{default:a(()=>[t(k,{class:"mr-5px",icon:"ep:download"}),e[10]||(e[10]=d(" 导出 "))]),_:1},8,["loading"])),[[g,["infra:job:export"]]]),p((r(),i(m,{plain:"",type:"info",onClick:e[4]||(e[4]=n=>F())},{default:a(()=>[t(k,{class:"mr-5px",icon:"ep:zoom-in"}),e[11]||(e[11]=d(" 执行日志 "))]),_:1})),[[g,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),t(h,null,{default:a(()=>[p((r(),i(ne,{data:l(T)},{default:a(()=>[t(b,{align:"center",label:"任务编号",prop:"id"}),t(b,{align:"center",label:"任务名称",prop:"name"}),t(b,{align:"center",label:"任务状态",prop:"status"},{default:a(n=>[t(te,{type:l(B).INFRA_JOB_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),t(b,{align:"center",label:"处理器的名字",prop:"handlerName"}),t(b,{align:"center",label:"处理器的参数",prop:"handlerParam"}),t(b,{align:"center",label:"CRON 表达式",prop:"cronExpression"}),t(b,{align:"center",label:"操作",width:"200"},{default:a(n=>[p((r(),i(m,{link:"",type:"primary",onClick:C=>L("update",n.row.id)},{default:a(()=>e[12]||(e[12]=[d("修改")])),_:2},1032,["onClick"])),[[g,["infra:job:update"]]]),p((r(),i(m,{link:"",type:"primary",onClick:C=>Q(n.row)},{default:a(()=>[d(ce(n.row.status===l(c).STOP?"开启":"暂停"),1)]),_:2},1032,["onClick"])),[[g,["infra:job:update"]]]),p((r(),i(m,{link:"",type:"danger",onClick:C=>W(n.row.id)},{default:a(()=>e[13]||(e[13]=[d("删除")])),_:2},1032,["onClick"])),[[g,["infra:job:delete"]]]),p((r(),i(ae,{onCommand:C=>Y(C,n.row)},{dropdown:a(()=>[t(oe,null,{default:a(()=>[l(P)(["infra:job:trigger"])?(r(),i(R,{key:0,command:"handleRun"},{default:a(()=>e[15]||(e[15]=[d("执行一次")])),_:1})):$("",!0),l(P)(["infra:job:query"])?(r(),i(R,{key:1,command:"openDetail"},{default:a(()=>e[16]||(e[16]=[d("任务详细")])),_:1})):$("",!0),l(P)(["infra:job:query"])?(r(),i(R,{key:2,command:"handleJobLog"},{default:a(()=>e[17]||(e[17]=[d("调度日志")])),_:1})):$("",!0)]),_:1})]),default:a(()=>[t(m,{link:"",type:"primary"},{default:a(()=>[t(k,{icon:"ep:d-arrow-right"}),e[14]||(e[14]=d(" 更多 "))]),_:1})]),_:2},1032,["onCommand"])),[[g,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[se,l(S)]]),t(le,{limit:l(s).pageSize,"onUpdate:limit":e[5]||(e[5]=n=>l(s).pageSize=n),page:l(s).pageNo,"onUpdate:page":e[6]||(e[6]=n=>l(s).pageNo=n),total:l(O),onPagination:_},null,8,["limit","page","total"])]),_:1}),t(we,{ref_key:"formRef",ref:D,onSuccess:_},null,512),t(ve,{ref_key:"detailRef",ref:q},null,512)],64)}}});export{Ue as default};
