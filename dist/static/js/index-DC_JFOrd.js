/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 13:49:10 
 */
import{d as ce,u as _e,r as d,f as ye,b as ge,g as f,h as Y,c as S,o as i,j as o,m as l,a as n,J as j,F as G,n as ke,k as r,w as _,v as p,K as we,i as R,t as b,L as ve,l as X,x as be,M as Ce,y as B,_ as De,Q as Ve,z as $e,N as xe}from"./index-BW9ifGp0.js";import{_ as Me}from"./DictTag.vue_vue_type_script_lang-CGh0XIVR.js";import{_ as Se}from"./ContentWrap.vue_vue_type_script_setup_true_lang-58zNwBTb.js";import{_ as Fe}from"./ModelForm.vue_vue_type_script_setup_true_lang-CmFqqt5a.js";import{g as Pe}from"./index-vBE7BjiY.js";import{a as Te,d as Re,b as Be,e as Ne,g as Ue}from"./index-CRn4wYbm.js";import{j as he}from"./bpmn-embedded-XYc-Nd5X.js";import{c as qe,D as J}from"./dict-BcQRoIPV.js";import{b as Ie}from"./formCreate-CdOY-8fL.js";import{_ as Le}from"./ModelImportForm.vue_vue_type_script_setup_true_lang-DSj6qS28.js";import"./color-B5phLuB-.js";import"./XTextButton-wOb7MTWD.js";import"./XButton-CjZTMAJk.js";const Ee={key:2},Ae={key:0},ot=ce({name:"BpmModel",__name:"index",setup(Oe){const k=$e(),{t:N}=xe(),{push:C}=_e(),F=d(!0),U=d(0),h=d([]),s=ye({pageNo:1,pageSize:10,key:void 0,name:void 0,category:void 0}),q=d(),y=async()=>{F.value=!0;try{const a=await Te(s);h.value=a.list,U.value=a.total}finally{F.value=!1}},D=()=>{s.pageNo=1,y()},W=()=>{q.value.resetFields(),D()},I=d(),L=(a,e)=>{I.value.open(a,e)},E=d(),H=()=>{E.value.open()},Z=async a=>{try{await k.delConfirm(),await Re(a),k.success(N("common.delSuccess")),await y()}catch(e){console.log(e)}},ee=async a=>{const e=a.processDefinition.suspensionState;try{const x=a.id,T=`是否确认${e===1?"激活":"挂起"}流程名字为"${a.name}"的数据项?`;await k.confirm(T),await Be(x,e),await y()}catch{a.processDefinition.suspensionState=e===1?2:1}},te=a=>{C({name:"BpmModelEditor",query:{modelId:a.id}})},oe=async a=>{try{await k.confirm("是否部署该流程！！"),await Ne(a.id),k.success(N("部署成功")),await y()}catch(e){console.log(e)}},le=a=>{C({name:"BpmTaskAssignRuleList",query:{modelId:a.id}})},ne=a=>{C({name:"BpmProcessDefinition",query:{key:a.key}})},V=d(!1),P=d({rule:[],option:{}}),A=async a=>{if(a.formType==10){const e=await Pe(a.formId);Ie(P,e.conf,e.fields),V.value=!0}else await C({path:a.formCustomCreatePath})},$=d(!1),w=d(null),O=d({prefix:"flowable"}),ae=async a=>{const e=await Ue(a.id);w.value=e.bpmnXml||"",$.value=!0};return ge(()=>{y()}),(a,e)=>{const x=f("el-input"),v=f("el-form-item"),T=f("el-option"),ie=f("el-select"),M=we,m=f("el-button"),re=f("el-form"),z=Se,c=f("el-table-column"),se=Me,K=f("el-tag"),me=f("el-switch"),pe=f("el-table"),ue=Ce,de=f("form-create"),Q=De,g=Y("hasPermi"),fe=Y("loading");return i(),S(G,null,[o(z,null,{default:l(()=>[o(re,{ref_key:"queryFormRef",ref:q,class:"-mb-15px",inline:!0,"label-width":"68px",model:n(s)},{default:l(()=>[o(v,{label:"流程标识",prop:"key"},{default:l(()=>[o(x,{modelValue:n(s).key,"onUpdate:modelValue":e[0]||(e[0]=t=>n(s).key=t),class:"!w-240px",clearable:"",placeholder:"请输入流程标识",onKeyup:j(D,["enter"])},null,8,["modelValue"])]),_:1}),o(v,{label:"流程名称",prop:"name"},{default:l(()=>[o(x,{modelValue:n(s).name,"onUpdate:modelValue":e[1]||(e[1]=t=>n(s).name=t),class:"!w-240px",clearable:"",placeholder:"请输入流程名称",onKeyup:j(D,["enter"])},null,8,["modelValue"])]),_:1}),o(v,{label:"流程分类",prop:"category"},{default:l(()=>[o(ie,{modelValue:n(s).category,"onUpdate:modelValue":e[2]||(e[2]=t=>n(s).category=t),class:"!w-240px",clearable:"",placeholder:"请选择流程分类"},{default:l(()=>[(i(!0),S(G,null,ke(n(qe)(n(J).BPM_MODEL_CATEGORY),t=>(i(),r(T,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(v,null,{default:l(()=>[o(m,{onClick:D},{default:l(()=>[o(M,{class:"mr-5px",icon:"ep:search"}),e[9]||(e[9]=p(" 搜索 "))]),_:1}),o(m,{onClick:W},{default:l(()=>[o(M,{class:"mr-5px",icon:"ep:refresh"}),e[10]||(e[10]=p(" 重置 "))]),_:1}),_((i(),r(m,{plain:"",type:"primary",onClick:e[3]||(e[3]=t=>L("create"))},{default:l(()=>[o(M,{class:"mr-5px",icon:"ep:plus"}),e[11]||(e[11]=p(" 新建流程 "))]),_:1})),[[g,["bpm:model:create"]]]),_((i(),r(m,{plain:"",type:"success",onClick:H},{default:l(()=>[o(M,{class:"mr-5px",icon:"ep:upload"}),e[12]||(e[12]=p(" 导入流程 "))]),_:1})),[[g,["bpm:model:import"]]])]),_:1})]),_:1},8,["model"])]),_:1}),o(z,null,{default:l(()=>[_((i(),r(pe,{data:n(h)},{default:l(()=>[o(c,{align:"center",label:"流程标识",prop:"key",width:"200"}),o(c,{align:"center",label:"流程名称",prop:"name",width:"200"},{default:l(t=>[o(m,{link:"",type:"primary",onClick:u=>ae(t.row)},{default:l(()=>[R("span",null,b(t.row.name),1)]),_:2},1032,["onClick"])]),_:1}),o(c,{align:"center",label:"流程分类",prop:"category",width:"100"},{default:l(t=>[o(se,{type:n(J).BPM_MODEL_CATEGORY,value:t.row.category},null,8,["type","value"])]),_:1}),o(c,{align:"center",label:"表单信息",prop:"formType",width:"200"},{default:l(t=>[t.row.formType===10?(i(),r(m,{key:0,link:"",type:"primary",onClick:u=>A(t.row)},{default:l(()=>[R("span",null,b(t.row.formName),1)]),_:2},1032,["onClick"])):t.row.formType===20?(i(),r(m,{key:1,link:"",type:"primary",onClick:u=>A(t.row)},{default:l(()=>[R("span",null,b(t.row.formCustomCreatePath),1)]),_:2},1032,["onClick"])):(i(),S("label",Ee,"暂无表单"))]),_:1}),o(c,{align:"center",formatter:n(ve),label:"创建时间",prop:"createTime",width:"180"},null,8,["formatter"]),o(c,{align:"center",label:"最新部署的流程定义"},{default:l(()=>[o(c,{align:"center",label:"流程版本",prop:"processDefinition.version",width:"100"},{default:l(t=>[t.row.processDefinition?(i(),r(K,{key:0},{default:l(()=>[p("v"+b(t.row.processDefinition.version),1)]),_:2},1024)):(i(),r(K,{key:1,type:"warning"},{default:l(()=>e[13]||(e[13]=[p("未部署")])),_:1}))]),_:1}),o(c,{align:"center",label:"激活状态",prop:"processDefinition.version",width:"85"},{default:l(t=>[t.row.processDefinition?(i(),r(me,{key:0,modelValue:t.row.processDefinition.suspensionState,"onUpdate:modelValue":u=>t.row.processDefinition.suspensionState=u,"active-value":1,"inactive-value":2,onChange:u=>ee(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])):X("",!0)]),_:1}),o(c,{align:"center",label:"部署时间",prop:"deploymentTime",width:"180"},{default:l(t=>[t.row.processDefinition?(i(),S("span",Ae,b(n(be)(t.row.processDefinition.deploymentTime)),1)):X("",!0)]),_:1})]),_:1}),o(c,{align:"center",fixed:"right",label:"操作",width:"240"},{default:l(t=>[_((i(),r(m,{link:"",type:"primary",onClick:u=>L("update",t.row.id)},{default:l(()=>e[14]||(e[14]=[p("修改流程")])),_:2},1032,["onClick"])),[[g,["bpm:model:update"]]]),_((i(),r(m,{link:"",type:"primary",onClick:u=>te(t.row)},{default:l(()=>e[15]||(e[15]=[p("设计流程")])),_:2},1032,["onClick"])),[[g,["bpm:model:update"]]]),_((i(),r(m,{link:"",type:"primary",onClick:u=>le(t.row)},{default:l(()=>e[16]||(e[16]=[p(" 分配规则 ")])),_:2},1032,["onClick"])),[[g,["bpm:task-assign-rule:query"]]]),_((i(),r(m,{link:"",type:"primary",onClick:u=>oe(t.row)},{default:l(()=>e[17]||(e[17]=[p("发布流程")])),_:2},1032,["onClick"])),[[g,["bpm:model:deploy"]]]),_((i(),r(m,{link:"",type:"primary",onClick:u=>ne(t.row)},{default:l(()=>e[18]||(e[18]=[p(" 流程定义 ")])),_:2},1032,["onClick"])),[[g,["bpm:process-definition:query"]]]),_((i(),r(m,{link:"",type:"danger",onClick:u=>Z(t.row.id)},{default:l(()=>e[19]||(e[19]=[p("删除")])),_:2},1032,["onClick"])),[[g,["bpm:model:delete"]]])]),_:1})]),_:1},8,["data"])),[[fe,n(F)]]),o(ue,{limit:n(s).pageSize,"onUpdate:limit":e[4]||(e[4]=t=>n(s).pageSize=t),page:n(s).pageNo,"onUpdate:page":e[5]||(e[5]=t=>n(s).pageNo=t),total:n(U),onPagination:y},null,8,["limit","page","total"])]),_:1}),o(Fe,{ref_key:"formRef",ref:I,onSuccess:y},null,512),o(Le,{ref_key:"importFormRef",ref:E,onSuccess:y},null,512),o(Q,{modelValue:n(V),"onUpdate:modelValue":e[6]||(e[6]=t=>B(V)?V.value=t:null),title:"表单详情",width:"800"},{default:l(()=>[o(de,{option:n(P).option,rule:n(P).rule},null,8,["option","rule"])]),_:1},8,["modelValue"]),o(Q,{modelValue:n($),"onUpdate:modelValue":e[8]||(e[8]=t=>B($)?$.value=t:null),title:"流程图",width:"800"},{default:l(()=>[o(n(he),Ve({key:"designer",modelValue:n(w),"onUpdate:modelValue":e[7]||(e[7]=t=>B(w)?w.value=t:null)},n(O),{prefix:n(O).prefix,value:n(w)}),null,16,["modelValue","prefix","value"])]),_:1},8,["modelValue"])],64)}}});export{ot as default};
