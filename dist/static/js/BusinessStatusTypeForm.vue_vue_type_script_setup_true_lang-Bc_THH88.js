/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:10:14 
 */
import{d as M,r as u,f as P,g as d,h as E,k as S,o as L,m as l,w as $,a as s,j as t,v as m,t as G,$ as H,y as J,_ as O,N as Q,z as W}from"./index-BdC40rFX.js";import{b as X,c as Y,u as Z}from"./index-DsOzKSei.js";import{d as ee,h as te}from"./tree-vSlcEeQq.js";import{g as ae}from"./index-CXnDo_Xr.js";const re=M({__name:"BusinessStatusTypeForm",emits:["success"],setup(le,{expose:T,emit:B}){const{t:v}=Q(),V=W(),r=u(!1),w=u(""),i=u(!1),x=u(""),o=u({id:0,name:"",deptIds:[],statusList:[]}),D=P({name:[{required:!0,message:"状态类型名不能为空",trigger:"blur"}]}),y=u(),h=u([]),p=u(),C=u(!0);T({open:async(n,e)=>{if(r.value=!0,w.value=v(`action.${n}`),x.value=n,U(),e){i.value=!0;try{o.value=await X(e),p.value.setCheckedKeys(o.value.deptIds),o.value.statusList.length==0&&g(0)}finally{i.value=!1}}else g();h.value=te(await ae())}});const I=B,R=async()=>{await y.value.validate(),i.value=!0;try{const n=o.value;n.deptIds=p.value.getCheckedKeys(!1),x.value==="create"?(await Y(n),V.success(v("common.createSuccess"))):(await Z(n),V.success(v("common.updateSuccess"))),r.value=!1,I("success")}finally{i.value=!1}},U=()=>{C.value=!0,o.value={id:0,name:"",deptIds:[],statusList:[]},p.value?.setCheckedNodes([]),y.value?.resetFields()},g=()=>{o.value.statusList.push({name:"",percent:""})},F=n=>{o.value.statusList.splice(n,1)};return(n,e)=>{const b=d("el-input"),k=d("el-form-item"),N=d("el-tree"),A=d("el-text"),f=d("el-table-column"),_=d("el-button"),K=d("el-table"),j=d("el-form"),q=O,z=E("loading");return L(),S(q,{modelValue:s(r),"onUpdate:modelValue":e[2]||(e[2]=a=>J(r)?r.value=a:null),title:s(w)},{footer:l(()=>[t(_,{disabled:s(i),type:"primary",onClick:R},{default:l(()=>e[5]||(e[5]=[m("确 定")])),_:1},8,["disabled"]),t(_,{onClick:e[1]||(e[1]=a=>r.value=!1)},{default:l(()=>e[6]||(e[6]=[m("取 消")])),_:1})]),default:l(()=>[$((L(),S(j,{ref_key:"formRef",ref:y,"label-width":"100px",model:s(o),rules:s(D)},{default:l(()=>[t(k,{label:"状态类型名",prop:"name"},{default:l(()=>[t(b,{modelValue:s(o).name,"onUpdate:modelValue":e[0]||(e[0]=a=>s(o).name=a),placeholder:"请输入状态类型名"},null,8,["modelValue"])]),_:1}),t(k,{label:"应用部门",prop:"deptIds"},{default:l(()=>[t(N,{ref_key:"treeRef",ref:p,"check-strictly":!s(C),data:s(h),"node-key":"id",placeholder:"请选择归属部门",props:s(ee),"show-checkbox":""},null,8,["check-strictly","data","props"])]),_:1}),t(k,{label:"状态设置",prop:"statusList"},{default:l(()=>[t(K,{border:"",data:s(o).statusList,style:{width:"100%"}},{default:l(()=>[t(f,{align:"center",label:"状态",prop:"star",width:"120"},{default:l(a=>[t(A,null,{default:l(()=>[m("状态"+G(a.$index+1),1)]),_:2},1024)]),_:1}),t(f,{align:"center",label:"状态名称",prop:"name",width:"120"},{default:l(({row:a})=>[t(b,{modelValue:a.name,"onUpdate:modelValue":c=>a.name=c,placeholder:"请输入状态名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{align:"center",label:"赢单率",prop:"percent",width:"120"},{default:l(({row:a})=>[t(b,{modelValue:a.percent,"onUpdate:modelValue":c=>a.percent=c,placeholder:"请输入赢单率"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{align:"center",label:"操作"},{default:l(a=>[t(_,{link:"",type:"primary",onClick:c=>g(a.$index)},{default:l(()=>e[3]||(e[3]=[m("添加")])),_:2},1032,["onClick"]),$(t(_,{link:"",type:"danger",onClick:c=>F(a.$index)},{default:l(()=>e[4]||(e[4]=[m("删除")])),_:2},1032,["onClick"]),[[H,a.$index>0]])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])),[[z,s(i)]])]),_:1},8,["modelValue","title"])}}});export{re as _};
