/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{d as G,H as Q,r as p,f as W,b as X,g as i,h as Y,c as L,o as d,j as e,m as o,a,J as Z,F as P,n as ee,k as c,w,v as _,K as le,i as S,t as U,x as h,M as ae,z as te}from"./index-BdmDrM2Y.js";import{_ as oe}from"./DictTag.vue_vue_type_script_lang-bjcRCBWf.js";import{_ as ne}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CIA3YA7G.js";import{_ as se}from"./index-63l7YclF.js";import{_ as re,g as ie,e as pe}from"./JobLogDetail.vue_vue_type_script_setup_true_lang-C5frv2uB.js";import{c as de,D as F}from"./dict-Cm-9nniQ.js";import{d as ue}from"./download-U6qaYcnP.js";import"./color-B5phLuB-.js";const Te=G({name:"InfraJobLog",__name:"index",setup(me){const M=te(),{query:R}=Q(),f=p(!0),T=p(0),k=p([]),n=W({pageNo:1,pageSize:10,jobId:R.id,handlerName:void 0,beginTime:void 0,endTime:void 0,status:void 0}),V=p(),g=p(!1),b=async()=>{f.value=!0;try{const s=await ie(n);k.value=s.list,T.value=s.total}finally{f.value=!1}},v=()=>{n.pageNo=1,b()},j=()=>{V.value.resetFields(),v()},N=p(),q=s=>{N.value.open(s)},B=async()=>{try{await M.exportConfirm(),g.value=!0;const s=await pe(n);ue.excel(s,"定时任务执行日志.xls")}catch(s){console.log(s)}finally{g.value=!1}};return X(()=>{b()}),(s,t)=>{const y=se,J=i("el-input"),u=i("el-form-item"),D=i("el-date-picker"),$=i("el-option"),H=i("el-select"),x=le,m=i("el-button"),O=i("el-form"),C=ne,r=i("el-table-column"),z=oe,A=i("el-table"),E=ae,I=Y("hasPermi"),K=Y("loading");return d(),L(P,null,[e(y,{title:"定时任务",url:"https://doc.iocoder.cn/job/"}),e(y,{title:"异步任务",url:"https://doc.iocoder.cn/async-task/"}),e(y,{title:"消息队列",url:"https://doc.iocoder.cn/message-queue/"}),e(C,null,{default:o(()=>[e(O,{ref_key:"queryFormRef",ref:V,class:"-mb-15px",inline:!0,"label-width":"120px",model:a(n)},{default:o(()=>[e(u,{label:"处理器的名字",prop:"handlerName"},{default:o(()=>[e(J,{modelValue:a(n).handlerName,"onUpdate:modelValue":t[0]||(t[0]=l=>a(n).handlerName=l),class:"!w-240px",clearable:"",placeholder:"请输入处理器的名字",onKeyup:Z(v,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"开始执行时间",prop:"beginTime"},{default:o(()=>[e(D,{modelValue:a(n).beginTime,"onUpdate:modelValue":t[1]||(t[1]=l=>a(n).beginTime=l),class:"!w-240px",clearable:"",placeholder:"选择开始执行时间",type:"date","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(u,{label:"结束执行时间",prop:"endTime"},{default:o(()=>[e(D,{modelValue:a(n).endTime,"onUpdate:modelValue":t[2]||(t[2]=l=>a(n).endTime=l),class:"!w-240px",clearable:"","default-time":new Date("1 23:59:59"),placeholder:"选择结束执行时间",type:"date","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),e(u,{label:"任务状态",prop:"status"},{default:o(()=>[e(H,{modelValue:a(n).status,"onUpdate:modelValue":t[3]||(t[3]=l=>a(n).status=l),class:"!w-240px",clearable:"",placeholder:"请选择任务状态"},{default:o(()=>[(d(!0),L(P,null,ee(a(de)(a(F).INFRA_JOB_LOG_STATUS),l=>(d(),c($,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(m,{onClick:v},{default:o(()=>[e(x,{class:"mr-5px",icon:"ep:search"}),t[6]||(t[6]=_(" 搜索 "))]),_:1}),e(m,{onClick:j},{default:o(()=>[e(x,{class:"mr-5px",icon:"ep:refresh"}),t[7]||(t[7]=_(" 重置 "))]),_:1}),w((d(),c(m,{loading:a(g),plain:"",type:"success",onClick:B},{default:o(()=>[e(x,{class:"mr-5px",icon:"ep:download"}),t[8]||(t[8]=_(" 导出 "))]),_:1},8,["loading"])),[[I,["infra:job:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(C,null,{default:o(()=>[w((d(),c(A,{data:a(k)},{default:o(()=>[e(r,{align:"center",label:"日志编号",prop:"id"}),e(r,{align:"center",label:"任务编号",prop:"jobId"}),e(r,{align:"center",label:"处理器的名字",prop:"handlerName"}),e(r,{align:"center",label:"处理器的参数",prop:"handlerParam"}),e(r,{align:"center",label:"第几次执行",prop:"executeIndex"}),e(r,{align:"center",label:"执行时间",width:"170s"},{default:o(l=>[S("span",null,U(a(h)(l.row.beginTime)+" ~ "+a(h)(l.row.endTime)),1)]),_:1}),e(r,{align:"center",label:"执行时长",prop:"duration"},{default:o(l=>[S("span",null,U(l.row.duration+" 毫秒"),1)]),_:1}),e(r,{align:"center",label:"任务状态",prop:"status"},{default:o(l=>[e(z,{type:a(F).INFRA_JOB_LOG_STATUS,value:l.row.status},null,8,["type","value"])]),_:1}),e(r,{align:"center",label:"操作"},{default:o(l=>[w((d(),c(m,{link:"",type:"primary",onClick:ce=>q(l.row.id)},{default:o(()=>t[9]||(t[9]=[_("详细")])),_:2},1032,["onClick"])),[[I,["infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[K,a(f)]]),e(E,{limit:a(n).pageSize,"onUpdate:limit":t[4]||(t[4]=l=>a(n).pageSize=l),page:a(n).pageNo,"onUpdate:page":t[5]||(t[5]=l=>a(n).pageNo=l),total:a(T),onPagination:b},null,8,["limit","page","total"])]),_:1}),e(re,{ref_key:"detailRef",ref:N},null,512)],64)}}});export{Te as default};
