/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{V as C,d as ee,r as f,f as le,b as te,g as i,h as M,c as N,o as p,j as e,m as o,a as t,J as z,F as V,n as K,k as u,w,v as g,K as ae,L as oe,l as h,M as ne,z as re}from"./index-lcC3l4R2.js";import{_ as se}from"./DictTag.vue_vue_type_script_lang-G_4C17ZW.js";import{_ as pe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C6z1f3RI.js";import{_ as ie}from"./index-bMugPczL.js";import{_ as ue}from"./ApiErrorLogDetail.vue_vue_type_script_setup_true_lang-BX_S25bd.js";import{I as b}from"./constants-BPQb3nxh.js";import{c as B,D as S}from"./dict-B7jb0IEc.js";import{d as de}from"./download-U6qaYcnP.js";import"./color-B5phLuB-.js";const me=d=>C.get({url:"/infra/api-error-log/page",params:d}),ce=(d,y)=>C.put({url:`/infra/api-error-log/update-status?id=${d}&processStatus=${y}`}),_e=d=>C.download({url:"/infra/api-error-log/export-excel",params:d}),Te=ee({name:"InfraApiErrorLog",__name:"index",setup(d){const y=re(),T=f(!0),R=f(0),P=f([]),n=le({pageNo:1,pageSize:10,userId:null,userType:null,applicationName:null,requestUrl:null,processStatus:null,exceptionTime:[]}),U=f(),E=f(!1),v=async()=>{T.value=!0;try{const r=await me(n);P.value=r.list,R.value=r.total}finally{T.value=!1}},x=()=>{n.pageNo=1,v()},G=()=>{U.value.resetFields(),x()},D=f(),H=r=>{D.value.open(r)},A=async(r,a)=>{try{const m=a===b.DONE?"已处理":"已忽略";await y.confirm(`确认标记为${m}?`),await ce(r,a),await y.success(m),await v()}catch(m){console.log(m)}},Q=async()=>{try{await y.exportConfirm(),E.value=!0;const r=await _e(n);de.excel(r,"异常日志.xls")}catch(r){console.log(r)}finally{E.value=!1}};return te(()=>{v()}),(r,a)=>{const m=ie,L=i("el-input"),c=i("el-form-item"),$=i("el-option"),O=i("el-select"),j=i("el-date-picker"),I=ae,_=i("el-button"),J=i("el-form"),q=pe,s=i("el-table-column"),F=se,W=i("el-table"),X=ne,k=M("hasPermi"),Z=M("loading");return p(),N(V,null,[e(m,{title:"系统日志",url:"https://doc.iocoder.cn/system-log/"}),e(q,null,{default:o(()=>[e(J,{ref_key:"queryFormRef",ref:U,class:"-mb-15px",inline:!0,"label-width":"68px",model:t(n)},{default:o(()=>[e(c,{label:"用户编号",prop:"userId"},{default:o(()=>[e(L,{modelValue:t(n).userId,"onUpdate:modelValue":a[0]||(a[0]=l=>t(n).userId=l),class:"!w-240px",clearable:"",placeholder:"请输入用户编号",onKeyup:z(x,["enter"])},null,8,["modelValue"])]),_:1}),e(c,{label:"用户类型",prop:"userType"},{default:o(()=>[e(O,{modelValue:t(n).userType,"onUpdate:modelValue":a[1]||(a[1]=l=>t(n).userType=l),class:"!w-240px",clearable:"",placeholder:"请选择用户类型"},{default:o(()=>[(p(!0),N(V,null,K(t(B)(t(S).USER_TYPE),l=>(p(),u($,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"应用名",prop:"applicationName"},{default:o(()=>[e(L,{modelValue:t(n).applicationName,"onUpdate:modelValue":a[2]||(a[2]=l=>t(n).applicationName=l),class:"!w-240px",clearable:"",placeholder:"请输入应用名",onKeyup:z(x,["enter"])},null,8,["modelValue"])]),_:1}),e(c,{label:"异常时间",prop:"exceptionTime"},{default:o(()=>[e(j,{modelValue:t(n).exceptionTime,"onUpdate:modelValue":a[3]||(a[3]=l=>t(n).exceptionTime=l),class:"!w-240px","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),e(c,{label:"处理状态",prop:"processStatus"},{default:o(()=>[e(O,{modelValue:t(n).processStatus,"onUpdate:modelValue":a[4]||(a[4]=l=>t(n).processStatus=l),class:"!w-240px",clearable:"",placeholder:"请选择处理状态"},{default:o(()=>[(p(!0),N(V,null,K(t(B)(t(S).INFRA_API_ERROR_LOG_PROCESS_STATUS),l=>(p(),u($,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:o(()=>[e(_,{onClick:x},{default:o(()=>[e(I,{class:"mr-5px",icon:"ep:search"}),a[7]||(a[7]=g(" 搜索 "))]),_:1}),e(_,{onClick:G},{default:o(()=>[e(I,{class:"mr-5px",icon:"ep:refresh"}),a[8]||(a[8]=g(" 重置 "))]),_:1}),w((p(),u(_,{loading:t(E),plain:"",type:"success",onClick:Q},{default:o(()=>[e(I,{class:"mr-5px",icon:"ep:download"}),a[9]||(a[9]=g(" 导出 "))]),_:1},8,["loading"])),[[k,["infra:api-error-log:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(q,null,{default:o(()=>[w((p(),u(W,{data:t(P)},{default:o(()=>[e(s,{align:"center",label:"日志编号",prop:"id"}),e(s,{align:"center",label:"用户编号",prop:"userId"}),e(s,{align:"center",label:"用户类型",prop:"userType"},{default:o(l=>[e(F,{type:t(S).USER_TYPE,value:l.row.userType},null,8,["type","value"])]),_:1}),e(s,{align:"center",label:"应用名",prop:"applicationName",width:"200"}),e(s,{align:"center",label:"请求方法",prop:"requestMethod",width:"80"}),e(s,{align:"center",label:"请求地址",prop:"requestUrl",width:"180"}),e(s,{align:"center",formatter:t(oe),label:"异常发生时间",prop:"exceptionTime",width:"180"},null,8,["formatter"]),e(s,{align:"center",label:"异常名",prop:"exceptionName",width:"180"}),e(s,{align:"center",label:"处理状态",prop:"processStatus"},{default:o(l=>[e(F,{type:t(S).INFRA_API_ERROR_LOG_PROCESS_STATUS,value:l.row.processStatus},null,8,["type","value"])]),_:1}),e(s,{align:"center",label:"操作",width:"200"},{default:o(l=>[w((p(),u(_,{link:"",type:"primary",onClick:Y=>H(l.row)},{default:o(()=>a[10]||(a[10]=[g("详细")])),_:2},1032,["onClick"])),[[k,["infra:api-error-log:query"]]]),l.row.processStatus===t(b).INIT?w((p(),u(_,{key:0,link:"",type:"primary",onClick:Y=>A(l.row.id,t(b).DONE)},{default:o(()=>a[11]||(a[11]=[g(" 已处理 ")])),_:2},1032,["onClick"])),[[k,["infra:api-error-log:update-status"]]]):h("",!0),l.row.processStatus===t(b).INIT?w((p(),u(_,{key:1,link:"",type:"primary",onClick:Y=>A(l.row.id,t(b).IGNORE)},{default:o(()=>a[12]||(a[12]=[g(" 已忽略 ")])),_:2},1032,["onClick"])),[[k,["infra:api-error-log:update-status"]]]):h("",!0)]),_:1})]),_:1},8,["data"])),[[Z,t(T)]]),e(X,{limit:t(n).pageSize,"onUpdate:limit":a[5]||(a[5]=l=>t(n).pageSize=l),page:t(n).pageNo,"onUpdate:page":a[6]||(a[6]=l=>t(n).pageNo=l),total:t(R),onPagination:v},null,8,["limit","page","total"])]),_:1}),e(ue,{ref_key:"detailRef",ref:D},null,512)],64)}}});export{Te as default};
