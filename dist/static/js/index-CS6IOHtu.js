/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:52:22 
 */
import{_ as $}from"./Echart.vue_vue_type_script_setup_true_lang-BWD9Ibfj.js";import{_ as j}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DPMk4m5L.js";import{f as z}from"./index-CK9h_xGL.js";import{V as D,d as W,r as A,dm as H,dn as J,f as C,b as K,g as d,c as V,o as I,j as a,m as t,y as k,a as g,F as Y,n as P,k as Q,i as c,z as X,dp as O,x as r,dq as Z}from"./index-DMg0mq0e.js";import"./install-DNIeUnSy.js";const ee=i=>D.get({url:"/mp/statistics/upstream-message",params:i}),ae=i=>D.get({url:"/mp/statistics/user-summary",params:i}),te=i=>D.get({url:"/mp/statistics/user-cumulate",params:i}),se=i=>D.get({url:"/mp/statistics/interface-summary",params:i}),ie=W({name:"MpStatistics",__name:"index",setup(i){const M=X(),l=A([H(new Date(new Date().getTime()-3600*1e3*24*7)),J(new Date(new Date().getTime()-3600*1e3*24))]),u=A(-1),x=A([]),m=A([]),p=C({color:["#67C23A","#E5323E"],legend:{data:["新增用户","取消关注的用户"]},tooltip:{},xAxis:{data:[]},yAxis:{minInterval:1},series:[{name:"新增用户",type:"bar",label:{show:!0},barGap:0,data:[]},{name:"取消关注的用户",type:"bar",label:{show:!0},data:[]}]}),y=C({legend:{data:["累计用户量"]},xAxis:{type:"category",data:[]},yAxis:{minInterval:1},series:[{name:"累计用户量",data:[],type:"line",smooth:!0,label:{show:!0}}]}),f=C({color:["#67C23A","#E5323E"],legend:{data:["用户发送人数","用户发送条数"]},tooltip:{},xAxis:{data:[]},yAxis:{minInterval:1},series:[{name:"用户发送人数",type:"line",smooth:!0,label:{show:!0},data:[]},{name:"用户发送条数",type:"line",smooth:!0,label:{show:!0},data:[]}]}),o=C({color:["#67C23A","#E5323E","#E6A23C","#409EFF"],legend:{data:["被动回复用户消息的次数","失败次数","最大耗时","总耗时"]},tooltip:{},xAxis:{data:[]},yAxis:{},series:[{name:"被动回复用户消息的次数",type:"bar",label:{show:!0},barGap:0,data:[]},{name:"失败次数",type:"bar",label:{show:!0},data:[]},{name:"最大耗时",type:"bar",label:{show:!0},data:[]},{name:"总耗时",type:"bar",label:{show:!0},data:[]}]}),F=async()=>{x.value=await z(),x.value.length>0&&(u.value=x.value[0].id)},E=()=>{if(!u)return M.error("未选中公众号，无法统计数据"),!1;if(O(l.value[0],l.value[1])>=7)return M.error("时间间隔 7 天以内，请重新选择"),!1;m.value=[];const s=O(l.value[0],l.value[1]);for(let e=0;e<=s;e++)m.value.push(r(Z(l.value[0],3600*1e3*24*e),"YYYY-MM-DD"));T(),B(),L(),q()},T=async()=>{p.xAxis.data=[],p.series[0].data=[],p.series[1].data=[];try{const s=await ae({accountId:u.value,date:[r(l.value[0]),r(l.value[1])]});p.xAxis.data=m.value,m.value.forEach((e,n)=>{s.forEach(v=>{r(new Date(v.refDate),"YYYY-MM-DD").indexOf(e)!==-1&&(p.series[0].data[n]=v.newUser,p.series[1].data[n]=v.cancelUser)})})}catch(s){console.log(s)}},B=async()=>{y.xAxis.data=[],y.series[0].data=[];try{const s=await te({accountId:u.value,date:[r(l.value[0]),r(l.value[1])]});y.xAxis.data=m.value,s.forEach((e,n)=>{y.series[0].data[n]=e.cumulateUser})}catch(s){console.log(s)}},L=async()=>{f.xAxis.data=[],f.series[0].data=[],f.series[1].data=[];try{const s=await ee({accountId:u.value,date:[r(l.value[0]),r(l.value[1])]});f.xAxis.data=m.value,s.forEach((e,n)=>{f.series[0].data[n]=e.messageUser,f.series[1].data[n]=e.messageCount})}catch(s){console.log(s)}},q=async()=>{o.xAxis.data=[],o.series[0].data=[],o.series[1].data=[],o.series[2].data=[],o.series[3].data=[];try{const s=await se({accountId:u.value,date:[r(l.value[0]),r(l.value[1])]});o.xAxis.data=m.value,s.forEach((e,n)=>{o.series[0].data[n]=e.callbackCount,o.series[1].data[n]=e.failCount,o.series[2].data[n]=e.maxTimeCost,o.series[3].data[n]=e.totalTimeCost})}catch(s){console.log(s)}};return K(async()=>{await F(),E()}),(s,e)=>{const n=d("el-option"),v=d("el-select"),U=d("el-form-item"),R=d("el-date-picker"),G=d("el-form"),S=j,h=$,b=d("el-card"),w=d("el-col"),N=d("el-row");return I(),V(Y,null,[a(S,null,{default:t(()=>[a(G,{ref:"queryForm",class:"-mb-15px",inline:!0,"label-width":"68px"},{default:t(()=>[a(U,{label:"公众号",prop:"accountId"},{default:t(()=>[a(v,{modelValue:g(u),"onUpdate:modelValue":e[0]||(e[0]=_=>k(u)?u.value=_:null),class:"!w-240px",onChange:E},{default:t(()=>[(I(!0),V(Y,null,P(g(x),_=>(I(),Q(n,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(U,{label:"时间范围",prop:"dateRange"},{default:t(()=>[a(R,{modelValue:g(l),"onUpdate:modelValue":e[1]||(e[1]=_=>k(l)?l.value=_:null),class:"!w-240px","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange",onChange:E},null,8,["modelValue","default-time"])]),_:1})]),_:1},512)]),_:1}),a(S,null,{default:t(()=>[a(N,null,{default:t(()=>[a(w,{class:"card-box",span:12},{default:t(()=>[a(b,null,{header:t(()=>e[2]||(e[2]=[c("div",null,[c("span",null,"用户增减数据")],-1)])),default:t(()=>[a(h,{height:420,options:g(p)},null,8,["options"])]),_:1})]),_:1}),a(w,{class:"card-box",span:12},{default:t(()=>[a(b,null,{header:t(()=>e[3]||(e[3]=[c("div",null,[c("span",null,"累计用户数据")],-1)])),default:t(()=>[a(h,{height:420,options:g(y)},null,8,["options"])]),_:1})]),_:1}),a(w,{class:"card-box",span:12},{default:t(()=>[a(b,null,{header:t(()=>e[4]||(e[4]=[c("div",null,[c("span",null,"消息概况数据")],-1)])),default:t(()=>[a(h,{height:420,options:g(f)},null,8,["options"])]),_:1})]),_:1}),a(w,{class:"card-box",span:12},{default:t(()=>[a(b,null,{header:t(()=>e[5]||(e[5]=[c("div",null,[c("span",null,"接口分析数据")],-1)])),default:t(()=>[a(h,{height:420,options:g(o)},null,8,["options"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{ie as default};
