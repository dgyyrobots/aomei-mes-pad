/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 13:49:10 
 */
import{d as T,r as d,f as R,g as m,h as N,c as $,o as y,j as l,m as o,w as I,k,a as t,v as p,y as _,_ as L,l as j,F as q,z}from"./index-BW9ifGp0.js";import{h as K,i as M}from"./index-4jSC5rBh.js";import{D as S,T as A}from"./constants-BPQb3nxh.js";import G from"./index-Bd1-38-i.js";const Z=T({name:"OrderPickUpForm",__name:"OrderPickUpForm",emits:["success"],setup(H,{expose:C,emit:U}){const c=z(),s=d(!1),i=d(!1),r=d(!1),g=R({pickUpVerifyCode:[{required:!0,message:"核销码不能为空",trigger:"blur"}]}),n=d({pickUpVerifyCode:""}),u=d(),v=d({});C({open:async()=>{w(),s.value=!0}});const b=U,D=async()=>{r.value=!0;try{await K(n.value.pickUpVerifyCode),c.success("核销成功"),i.value=!1,s.value=!1,b("success",!0)}finally{r.value=!1}},w=()=>{n.value={pickUpVerifyCode:""},u.value?.resetFields()},F=async()=>{if(!u||!await u.value.validate())return;r.value=!0;const e=await M(n.value.pickUpVerifyCode);if(r.value=!1,e?.deliveryType!==S.PICK_UP.type){c.error("请输入正确的核销码");return}if(e?.status!==A.UNDELIVERED.status){c.error("订单不是待核销状态");return}v.value=e,i.value=!0};return(O,e)=>{const x=m("el-input"),B=m("el-form-item"),E=m("el-form"),f=m("el-button"),V=L,P=N("loading");return y(),$(q,null,[l(V,{modelValue:t(s),"onUpdate:modelValue":e[2]||(e[2]=a=>_(s)?s.value=a:null),title:"订单核销",width:"35%"},{footer:o(()=>[l(f,{disabled:t(r),type:"primary",onClick:F},{default:o(()=>e[5]||(e[5]=[p("查询")])),_:1},8,["disabled"]),l(f,{onClick:e[1]||(e[1]=a=>s.value=!1)},{default:o(()=>e[6]||(e[6]=[p("取 消")])),_:1})]),default:o(()=>[I((y(),k(E,{ref_key:"formRef",ref:u,"label-width":"100px",model:t(n),rules:t(g)},{default:o(()=>[l(B,{label:"核销码",prop:"pickUpVerifyCode"},{default:o(()=>[l(x,{modelValue:t(n).pickUpVerifyCode,"onUpdate:modelValue":e[0]||(e[0]=a=>t(n).pickUpVerifyCode=a),placeholder:"请输入核销码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[P,t(r)]])]),_:1},8,["modelValue"]),l(V,{modelValue:t(i),"onUpdate:modelValue":e[4]||(e[4]=a=>_(i)?i.value=a:null),title:"订单详情",width:"55%"},{footer:o(()=>[l(f,{disabled:t(r),type:"primary",onClick:D},{default:o(()=>e[7]||(e[7]=[p("确认核销")])),_:1},8,["disabled"]),l(f,{onClick:e[3]||(e[3]=a=>i.value=!1)},{default:o(()=>e[8]||(e[8]=[p("取 消")])),_:1})]),default:o(()=>[t(v).id?(y(),k(G,{key:0,id:t(v).id,"show-pick-up":!1},null,8,["id"])):j("",!0)]),_:1},8,["modelValue"])],64)}}});export{Z as _};
