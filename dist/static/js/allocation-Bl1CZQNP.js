/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:05:55 
 */
import{_ as Tl}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DXTslarw.js";import{V as H,d as Ye,r,f as _e,b as Te,g as u,h as Ce,k as h,o as f,m as l,w as S,j as e,J as Z,c as he,F as ze,n as xe,a as N,D as ge,v,a0 as Ee,$ as fe,t as we,M as Ue,i as j,a6 as Je,A as qe,l as me,W as Vl,O as Ae,x as je,X as Oe,R as El,Y as Ll,Z as J,E as $e,G as Wl,a7 as hl,a4 as Ml,a8 as Kl,T as He,a5 as Bl}from"./index-D3S9e4gi.js";import{_ as Sl}from"./DictTag.vue_vue_type_script_lang-DqsMypuM.js";import{D as Fe}from"./dict-D5UmY5m8.js";import{k as Ql}from"./index-BiMNsS3R.js";import"./color-B5phLuB-.js";const $l=async d=>await H.get({url:"/mes/pro/task/page",params:d}),zl=async()=>await H.get({url:"/mes/pro/cess/list-all-simple"}),Hl=async d=>await H.get({url:"/mes/md-workstation/page",params:d}),Yl=async()=>await H.get({url:"/mes/md-workshop/list-all-simple"}),Jl={class:"dialog-footer"},jl=Ye({name:"WorkstationSelect",__name:"simpletableSingle",props:{processId:{}},emits:["onSelected"],setup(d,{expose:c,emit:G}){const g=d,w=r(!1),q=r(!0),t=r(),V=r([]);r(!0),r(!0);const X=r(!0),ae=r(0),re=r([]),D=r([]),K=r([]),W=r(),k=_e({pageNo:1,pageSize:10,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:g.processId,processCode:null,processName:null,enableFlag:null});_e({workstationId:null,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:null,processCode:null,processName:null,enableFlag:"Y",remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null});const z=async()=>{q.value=!0;try{const E=await Hl(k);re.value=E.list,ae.value=E.total}finally{q.value=!1}},se=async()=>{const E=await Yl();D.value=E},F=async()=>{const E=await zl();K.value=E},_=()=>{k.pageNo=1,z()},de=()=>{W.value?.resetFields(),_()},L=E=>{E&&(V.value=E)},b=E=>{E&&(V.value=E)},I=E=>{E&&(V.value=E,ie("onSelected",V.value),w.value=!1)},ee=()=>{if(!t.value){Je({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}ie("onSelected",V.value),w.value=!1},ie=G;return Te(()=>{z(),se(),F()}),c({showFlag:w}),(E,C)=>{const B=u("el-input"),ue=u("el-form-item"),oe=u("el-col"),le=u("el-option"),T=u("el-select"),y=u("el-button"),p=u("el-row"),i=u("el-form"),Q=u("el-radio"),$=u("el-table-column"),te=u("el-table"),O=u("el-dialog"),ne=Ce("loading");return f(),h(O,{title:"工作站选择",modelValue:w.value,"onUpdate:modelValue":C[7]||(C[7]=P=>w.value=P),modal:!1,width:"80%",center:""},{footer:l(()=>[j("div",Jl,[e(y,{type:"primary",onClick:ee},{default:l(()=>C[11]||(C[11]=[v("确 定")])),_:1}),e(y,{onClick:C[6]||(C[6]=P=>w.value=!1)},{default:l(()=>C[12]||(C[12]=[v("取 消")])),_:1})])]),default:l(()=>[S(e(i,{model:k,ref_key:"queryFormRef",ref:W,size:"small",inline:!0,"label-width":"90px"},{default:l(()=>[e(p,null,{default:l(()=>[e(oe,{span:7},{default:l(()=>[e(ue,{label:"工作站编号",prop:"workstationCode"},{default:l(()=>[e(B,{modelValue:k.workstationCode,"onUpdate:modelValue":C[0]||(C[0]=P=>k.workstationCode=P),placeholder:"请输入工作站编号",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(oe,{span:7},{default:l(()=>[e(ue,{label:"所属工序",prop:"processName"},{default:l(()=>[e(T,{modelValue:k.processId,"onUpdate:modelValue":C[1]||(C[1]=P=>k.processId=P),placeholder:"请选择工序"},{default:l(()=>[(f(!0),he(ze,null,xe(K.value,P=>(f(),h(le,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(oe,{span:7},{default:l(()=>[e(ue,{label:"所在车间",prop:"workshopName"},{default:l(()=>[e(T,{modelValue:k.workshopId,"onUpdate:modelValue":C[2]||(C[2]=P=>k.workshopId=P),placeholder:"请选择车间"},{default:l(()=>[(f(!0),he(ze,null,xe(D.value,P=>(f(),h(le,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(oe,{span:3},{default:l(()=>[e(ue,null,{default:l(()=>[e(y,{type:"primary",icon:N(ge),size:"small",onClick:_},{default:l(()=>C[8]||(C[8]=[v("搜索")])),_:1},8,["icon"]),e(y,{icon:N(Ee),size:"small",onClick:de},{default:l(()=>C[9]||(C[9]=[v("重置")])),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(oe,{span:24})]),_:1})]),_:1},8,["model"]),[[fe,X.value]]),S((f(),h(te,{data:re.value,onCurrentChange:L,onRowDblclick:I},{default:l(()=>[e($,{width:"55",align:"center"},{default:l(P=>[e(Q,{modelValue:t.value,"onUpdate:modelValue":C[3]||(C[3]=ve=>t.value=ve),label:P.row.id,onChange:ve=>b(P.row)},{default:l(()=>C[10]||(C[10]=[v(we(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e($,{label:"工作站编号",align:"center",prop:"workstationCode"}),e($,{label:"工作站名称",align:"center",prop:"workstationName"}),e($,{label:"工作站地点",align:"center",prop:"workstationAddress"}),e($,{label:"所在车间名称",align:"center",prop:"workshopName"}),e($,{label:"所属工序",align:"center",prop:"processName"}),e($,{label:"备注",align:"center",prop:"remark"})]),_:1},8,["data"])),[[ne,q.value]]),S(e(Ue,{total:ae.value,page:k.pageNo,"onUpdate:page":C[4]||(C[4]=P=>k.pageNo=P),limit:k.pageSize,"onUpdate:limit":C[5]||(C[5]=P=>k.pageSize=P),onPagination:z},null,8,["total","page","limit"]),[[fe,ae.value>0]])]),_:1},8,["modelValue"])}}}),Gl=qe(jl,[["__scopeId","data-v-848b7f87"]]),Xl={name:"ProtaskSelect",components:{WorkstationSelect:Gl},props:{workorderId:null,workorderCode:null,processId:null,processCode:null,workstationId:null,workstationCode:null},watch:{workorderId(d){this.queryParams.workorderId=d}},data(){return{showFlag:!1,selectedTaskId:void 0,selectedRow:void 0,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,protaskList:[],title:"",open:!1,queryParams:{pageNo:1,pageSize:10,taskCode:null,taskName:null,workorderId:this.workorderId,workorderCode:null,workorderName:null,workstationId:null,workstationCode:null,workstationName:null,processId:this.processId,processCode:null,processName:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,clientId:null,clientCode:null,clientName:null,clientNick:null,startTime:null,duration:null,endTime:null,colorCode:null,requestDate:null},form:{},rules:{workstationId:[{required:!0,message:"工作站不能为空",trigger:"blur"}],quantity:[{required:!0,message:"排产数量不能为空",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始生产日期",trigger:"blur"}],duration:[{required:!0,message:"清输入估算的生产用时",trigger:"blur"}]}}},created(){this.getList(),this.getProcess()},methods:{getList(){this.loading=!0,$l(this.queryParams).then(d=>{this.protaskList=d.list,this.total=d.total,this.loading=!1})},getProcess(){zl().then(d=>{this.processOptions=d})},handleQuery(){this.queryParams.pageNo=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleCurrent(d){d&&(this.selectedRow=d)},handleRowDbClick(d){d&&(this.selectedRow=d,this.$emit("onSelected",this.selectedRow),this.showFlag=!1)},handleRowChange(d){d&&(this.selectedRow=d)},confirmSelect(){if(this.selectedTaskId==null||this.selectedTaskId==0){this.$notify({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}this.$emit("onSelected",this.selectedRow),this.showFlag=!1}}},Zl={"slot-scope":"scope"},ea={"slot-scope":"scope"},la={"slot-scope":"scope"},aa={"slot-scope":"scope"},oa={slot:"footer",class:"dialog-footer"};function ta(d,c,G,g,w,q){const t=u("el-option"),V=u("el-select"),X=u("el-form-item"),ae=u("el-col"),re=u("el-input"),D=u("el-row"),K=u("el-button"),W=u("el-form"),k=u("el-radio"),z=u("el-table-column"),se=u("el-color-picker"),F=u("el-table"),_=Ue,de=u("el-dialog"),L=Ce("hasPermi"),b=Ce("loading");return w.showFlag?(f(),h(de,{key:0,title:"生产任务选择",visible:w.showFlag,modal:!1,width:"80%",center:""},{default:l(()=>[S(e(W,{model:w.queryParams,ref:"queryForm",size:"small",inline:!0,"label-width":"100px"},{default:l(()=>[e(D,null,{default:l(()=>[e(ae,{span:8},{default:l(()=>[e(X,{label:"所属工序",prop:"processName"},{default:l(()=>[e(V,{modelValue:w.queryParams.processId,"onUpdate:modelValue":c[0]||(c[0]=I=>w.queryParams.processId=I),placeholder:"请选择工序"},{default:l(()=>[(f(!0),he(ze,null,xe(d.processOptions,I=>(f(),h(t,{key:I.processId,label:I.processName,value:I.processId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ae,{span:8},{default:l(()=>[e(X,{label:"所属工作站",prop:"workstationCode"},{default:l(()=>[e(re,{modelValue:w.queryParams.workstationCode,"onUpdate:modelValue":c[1]||(c[1]=I=>w.queryParams.workstationCode=I),placeholder:"请输入工作站编号",clearable:"",onKeyup:Z(q.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(ae,{span:8},{default:l(()=>[e(X,{label:"任务编号",prop:"taskCode"},{default:l(()=>[e(re,{modelValue:w.queryParams.taskCode,"onUpdate:modelValue":c[2]||(c[2]=I=>w.queryParams.taskCode=I),placeholder:"请输入生产任务编号",clearable:"",onKeyup:Z(q.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:l(()=>[e(ae,{span:8},{default:l(()=>[e(X,null,{default:l(()=>[e(K,{type:"primary",icon:"el-icon-search",size:"mini",onClick:q.handleQuery},{default:l(()=>c[8]||(c[8]=[v("搜索")])),_:1},8,["onClick"]),e(K,{icon:"el-icon-refresh",size:"mini",onClick:q.resetQuery},{default:l(()=>c[9]||(c[9]=[v("重置")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),[[fe,w.showSearch]]),S((f(),h(F,{data:w.protaskList,onCurrentChange:q.handleCurrent,onRowDblclick:q.handleRowDbClick},{default:l(()=>[e(z,{width:"55",align:"center"},{default:l(I=>[e(k,{modelValue:w.selectedTaskId,"onUpdate:modelValue":c[3]||(c[3]=ee=>w.selectedTaskId=ee),label:I.row.id,onChange:ee=>q.handleRowChange(I.row)},{default:l(()=>c[10]||(c[10]=[v(we(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(z,{label:"任务编号",align:"center",width:"100px",prop:"taskCode","show-overflow-tooltip":!0}),e(z,{label:"任务名称",align:"center",width:"120px",prop:"taskName","show-overflow-tooltip":!0}),e(z,{label:"工作站编号",align:"center",width:"150px",prop:"workstationCode","show-overflow-tooltip":!0}),e(z,{label:"工作站名称",align:"center",width:"150px",prop:"workstationName","show-overflow-tooltip":!0}),e(z,{label:"排产数量",align:"center",prop:"quantity"}),e(z,{label:"已生产数量",align:"center",width:"100px",prop:"quantityProduced"}),e(z,{label:"开始生产时间",align:"center",prop:"startTime",width:"180"},{default:l(()=>[j("template",Zl,[j("span",null,we(d.parseTime(d.scope.row.startTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(z,{label:"生产时长",align:"center",prop:"duration"}),e(z,{label:"预计完成时间",align:"center",prop:"endTime",width:"180"},{default:l(()=>[j("template",ea,[j("span",null,we(d.parseTime(d.scope.row.endTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(z,{label:"显示颜色",align:"center",prop:"colorCode"},{default:l(()=>[j("template",la,[e(se,{modelValue:d.scope.row.colorCode,"onUpdate:modelValue":c[4]||(c[4]=I=>d.scope.row.colorCode=I),disabled:""},null,8,["modelValue"])])]),_:1}),e(z,{label:"操作",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:l(()=>[j("template",aa,[S((f(),h(K,{size:"mini",type:"text",icon:"el-icon-edit",onClick:c[5]||(c[5]=I=>d.handleUpdate(d.scope.row))},{default:l(()=>c[11]||(c[11]=[v("修改")])),_:1})),[[L,["pro:protask:edit"]]]),S((f(),h(K,{size:"mini",type:"text",icon:"el-icon-delete",onClick:c[6]||(c[6]=I=>d.handleDelete(d.scope.row))},{default:l(()=>c[12]||(c[12]=[v("删除")])),_:1})),[[L,["pro:protask:remove"]]])])]),_:1})]),_:1},8,["data","onCurrentChange","onRowDblclick"])),[[b,w.loading]]),S(e(_,{total:w.total,page:w.queryParams.pageNo,limit:w.queryParams.pageSize,onPagination:q.getList},null,8,["total","page","limit","onPagination"]),[[fe,w.total>0]]),j("div",oa,[e(K,{type:"primary",onClick:q.confirmSelect},{default:l(()=>c[13]||(c[13]=[v("确 定")])),_:1},8,["onClick"]),e(K,{onClick:c[7]||(c[7]=I=>w.showFlag=!1)},{default:l(()=>c[14]||(c[14]=[v("取 消")])),_:1})])]),_:1},8,["visible"])):me("",!0)}const Il=qe(Xl,[["render",ta]]),na=async d=>await H.get({url:"/mes/wms/material-stock/page",params:d}),ra=async()=>await H.get({url:"/mes/md-item-type/treeselect"}),xl=async()=>await H.get({url:"/wms/warehouse/getTreeList"}).then(d=>(d.data=(d.data||[]).map(c=>(c.children&&(c.children=c.children.map(G=>(G.children&&(G.children=G.children.map(g=>({...g,pId:g.id,pName:g.areaName,lId:g.locationId,areaId:g.id}))),{...G,wId:G.warehouseId,pId:G.id,pName:G.locationName,locationId:G.id}))),{...c,wId:c.id,pId:c.id,pName:c.warehouseName,warehouseId:c.id})),d)),da={class:"head-container"},ua={class:"head-container"},sa={class:"dialog-footer"},ia=Ye({name:"WmstockMultiSelect",__name:"multi",emits:["onSelected"],setup(d,{expose:c,emit:G}){const g=Vl(),w=Ae(()=>g.currentSize==="mini"?"small":g.currentSize),q=r(!1),t=r(!0),V=r([]),X=r([]),ae=r(!0),re=r(!0),D=r(!0),K=r(0),W=r([]),k=r([]),z=r(),se=r(),F=r(),_=_e({pageNo:1,pageSize:10,itemTypeId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,vendorId:null,vendorCode:null,vendorName:null,vendorNick:null,quantityOnhand:null,expireDate:null,warehouse:null}),de={children:"children",label:"label"},L=r([]),b={multiple:!1,value:"pId",label:"pName"},I=async()=>{t.value=!0;try{const p=await na(_);k.value=p.list,K.value=p.total}finally{t.value=!1}},ee=async()=>{const p=await ra();W.value=p},ie=(p,i)=>p?i.label.indexOf(p)!==-1:!0,E=p=>{_.itemTypeId=p.id,C()},C=()=>{_.pageNo=1,I()},B=()=>{F.value?.resetFields(),C()},ue=p=>{V.value=p.map(i=>i.materialStockId),ae.value=p.length!==1,re.value=!p.length,X.value=p},oe=()=>{if(!X.value.length){Je({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}y("onSelected",X.value),q.value=!1},le=async()=>{const p=await xl();L.value=p,L.value.map(i=>{i.pId=i.id,i.pName=i.warehouseName,i.children.map($=>{let te=JSON.stringify($.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");$.children=JSON.parse(te)});let Q=JSON.stringify(i.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");i.children=JSON.parse(Q)})},T=p=>{p&&(_.warehouseId=p[0],_.locationId=p[1],_.areaId=p[2])},y=G;return Te(()=>{I(),ee(),le()}),c({showFlag:q}),(p,i)=>{const Q=u("el-input"),$=u("el-tree"),te=u("el-col"),O=u("el-form-item"),ne=u("el-cascader"),P=u("el-date-picker"),ve=u("el-button"),De=u("el-form"),Le=u("right-toolbar"),Re=u("el-row"),Y=u("el-table-column"),pe=u("el-table"),We=u("el-dialog"),Ie=Ce("loading");return f(),h(We,{title:"物料选择",modelValue:q.value,"onUpdate:modelValue":i[12]||(i[12]=x=>q.value=x),modal:!1,width:"92%",center:""},{footer:l(()=>[j("div",sa,[e(ve,{size:N(w),type:"primary",onClick:oe},{default:l(()=>i[15]||(i[15]=[v("确 定")])),_:1},8,["size"]),e(ve,{size:N(w),onClick:i[11]||(i[11]=x=>q.value=!1)},{default:l(()=>i[16]||(i[16]=[v("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(Re,{gutter:14},{default:l(()=>[e(te,{span:4,xs:24},{default:l(()=>[j("div",da,[e(Q,{modelValue:z.value,"onUpdate:modelValue":i[0]||(i[0]=x=>z.value=x),placeholder:"请输入分类名称",clearable:"",":size":N(w),"prefix-icon":N(ge),style:{"margin-bottom":"20px"}},null,8,["modelValue",":size","prefix-icon"])]),j("div",ua,[e($,{data:W.value,props:de,"expand-on-click-node":!1,"filter-node-method":ie,ref_key:"treeRef",ref:se,"default-expand-all":"",onNodeClick:E},null,8,["data"])])]),_:1}),e(te,{span:20,xs:24},{default:l(()=>[S(e(De,{model:_,ref_key:"queryFormRef",ref:F,":size":N(w),inline:!0},{default:l(()=>[e(O,{label:"产品物料编码",prop:"itemCode"},{default:l(()=>[e(Q,{modelValue:_.itemCode,"onUpdate:modelValue":i[1]||(i[1]=x=>_.itemCode=x),placeholder:"请输入产品物料编码",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(O,{label:"产品物料名称",prop:"itemName"},{default:l(()=>[e(Q,{modelValue:_.itemName,"onUpdate:modelValue":i[2]||(i[2]=x=>_.itemName=x),placeholder:"请输入产品物料名称",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(O,{label:"入库批次号",prop:"batchCode"},{default:l(()=>[e(Q,{modelValue:_.batchCode,"onUpdate:modelValue":i[3]||(i[3]=x=>_.batchCode=x),placeholder:"请输入入库批次号",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(O,{label:"仓库信息",prop:"warehouse"},{default:l(()=>[e(ne,{modelValue:_.warehouse,"onUpdate:modelValue":i[4]||(i[4]=x=>_.warehouse=x),options:L.value,props:b,onChange:T},null,8,["modelValue","options"])]),_:1}),e(O,{label:"供应商编号",prop:"vendorCode"},{default:l(()=>[e(Q,{modelValue:_.vendorCode,"onUpdate:modelValue":i[5]||(i[5]=x=>_.vendorCode=x),placeholder:"请输入供应商编号",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(O,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[e(Q,{modelValue:_.vendorName,"onUpdate:modelValue":i[6]||(i[6]=x=>_.vendorName=x),placeholder:"请输入供应商名称",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(O,{label:"库存有效期",prop:"expireDate"},{default:l(()=>[e(P,{clearable:"",modelValue:_.expireDate,"onUpdate:modelValue":i[7]||(i[7]=x=>_.expireDate=x),type:"date","value-format":"timestamp",placeholder:"请选择库存有效期"},null,8,["modelValue"])]),_:1}),e(O,null,{default:l(()=>[e(ve,{type:"primary",icon:N(ge),":size":N(w),onClick:C},{default:l(()=>i[13]||(i[13]=[v("搜索")])),_:1},8,["icon",":size"]),e(ve,{icon:N(Ee),":size":N(w),onClick:B},{default:l(()=>i[14]||(i[14]=[v("重置")])),_:1},8,["icon",":size"])]),_:1})]),_:1},8,["model",":size"]),[[fe,D.value]]),e(Re,{gutter:10,class:"mb8"},{default:l(()=>[e(Le,{showSearch:D.value,"onUpdate:showSearch":i[8]||(i[8]=x=>D.value=x),onQueryTable:I},null,8,["showSearch"])]),_:1}),S((f(),h(pe,{size:N(w),data:k.value,onSelectionChange:ue},{default:l(()=>[e(Y,{type:"selection",width:"55",align:"center"}),e(Y,{label:"产品物料编码",width:"120px",align:"center",prop:"itemCode"}),e(Y,{label:"产品物料名称",width:"150px",align:"center",prop:"itemName","show-overflow-tooltip":!0}),e(Y,{label:"规格型号",align:"center",prop:"specification","show-overflow-tooltip":!0}),e(Y,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(Y,{label:"入库批次号",width:"100px",align:"center",prop:"batchCode","show-overflow-tooltip":!0}),e(Y,{label:"仓库",align:"center",prop:"warehouseName"}),e(Y,{label:"库区",align:"center",prop:"locationName"}),e(Y,{label:"库位",align:"center",prop:"areaName"}),e(Y,{label:"供应商编号",width:"100px",align:"center",prop:"vendorCode"}),e(Y,{label:"供应商名称",width:"120px",align:"center",prop:"vendorName","show-overflow-tooltip":!0}),e(Y,{label:"供应商简称",width:"100px",align:"center",prop:"vendorNick"}),e(Y,{label:"在库数量",align:"center",prop:"quantityOnhand"}),e(Y,{label:"库存有效期",align:"center",prop:"expireDate",width:"180"},{default:l(x=>[j("span",null,we(N(je)(x.row.expireDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["size","data"])),[[Ie,t.value]]),S(e(Ue,{total:K.value,page:_.pageNo,"onUpdate:page":i[9]||(i[9]=x=>_.pageNo=x),limit:_.pageSize,"onUpdate:limit":i[10]||(i[10]=x=>_.pageSize=x),onPagination:I},null,8,["total","page","limit"]),[[fe,K.value>0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),pa=qe(ia,[["__scopeId","data-v-82c195e3"]]),ca=async d=>await H.get({url:"/mes/pro/workorder/page",params:d}),ma={class:"dialog-footer"},fa=Ye({name:"WorkOrderSelectSingle",__name:"single",emits:["onSelected"],setup(d,{expose:c,emit:G}){const g=r(!1),w=r(!0),q=r(),t=r([]);r(!0),r(!0);const V=r(!0),X=r(0),ae=r([]),re=r(),D=_e({pageNo:1,pageSize:10,workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:"CONFIRMED"}),K=async()=>{w.value=!0;try{const L=await ca(D);ae.value=L.list,X.value=L.total}finally{w.value=!1}},W=()=>{K()},k=()=>{re.value?.resetFields(),W()},z=L=>{L&&(t.value=L)},se=L=>{L&&(t.value=L)},F=L=>{L&&(t.value=L,de("onSelected",t.value),g.value=!1)},_=()=>{if(!q.value){Je({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}de("onSelected",t.value),g.value=!1},de=G;return Te(()=>{K()}),c({showFlag:g}),(L,b)=>{const I=u("el-input"),ee=u("el-form-item"),ie=u("el-button"),E=u("el-form"),C=u("el-radio"),B=u("el-table-column"),ue=Sl,oe=u("el-table"),le=u("el-dialog"),T=Ce("loading");return f(),h(le,{title:"工单选择",modelValue:g.value,"onUpdate:modelValue":b[9]||(b[9]=y=>g.value=y),modal:!1,width:"80%",center:""},{footer:l(()=>[j("div",ma,[e(ie,{type:"primary",onClick:_},{default:l(()=>b[13]||(b[13]=[v("确 定")])),_:1}),e(ie,{onClick:b[8]||(b[8]=y=>g.value=!1)},{default:l(()=>b[14]||(b[14]=[v("取 消")])),_:1})])]),default:l(()=>[S(e(E,{model:D,ref_key:"queryFormRef",ref:re,size:"small",inline:!0,"label-width":"68px"},{default:l(()=>[e(ee,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(I,{modelValue:D.workorderCode,"onUpdate:modelValue":b[0]||(b[0]=y=>D.workorderCode=y),placeholder:"请输入工单编码",clearable:"",onKeyup:Z(W,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"工单名称",prop:"workorderName"},{default:l(()=>[e(I,{modelValue:D.workorderName,"onUpdate:modelValue":b[1]||(b[1]=y=>D.workorderName=y),placeholder:"请输入工单名称",clearable:"",onKeyup:Z(W,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"产品编号",prop:"productCode"},{default:l(()=>[e(I,{modelValue:D.productCode,"onUpdate:modelValue":b[2]||(b[2]=y=>D.productCode=y),placeholder:"请输入产品编号",clearable:"",onKeyup:Z(W,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"产品名称",prop:"productName"},{default:l(()=>[e(I,{modelValue:D.productName,"onUpdate:modelValue":b[3]||(b[3]=y=>D.productName=y),placeholder:"请输入产品名称",clearable:"",onKeyup:Z(W,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"客户名称",prop:"clientName"},{default:l(()=>[e(I,{modelValue:D.clientName,"onUpdate:modelValue":b[4]||(b[4]=y=>D.clientName=y),placeholder:"请输入客户名称",clearable:"",onKeyup:Z(W,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,null,{default:l(()=>[e(ie,{type:"primary",icon:N(ge),size:"small",onClick:W},{default:l(()=>b[10]||(b[10]=[v("搜索")])),_:1},8,["icon"]),e(ie,{icon:N(Ee),size:"small",onClick:k},{default:l(()=>b[11]||(b[11]=[v("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),[[fe,V.value]]),S((f(),h(oe,{data:ae.value,onCurrentChange:z,onRowDblclick:F},{default:l(()=>[e(B,{width:"55",align:"center"},{default:l(y=>[e(C,{modelValue:q.value,"onUpdate:modelValue":b[5]||(b[5]=p=>q.value=p),label:y.row.id,onChange:p=>se(y.row)},{default:l(()=>b[12]||(b[12]=[v(we(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(B,{label:"工单编码",width:"180",prop:"workorderCode"}),e(B,{label:"工单名称",width:"200",align:"center",prop:"workorderName","show-overflow-tooltip":!0}),e(B,{label:"工单来源",align:"center",prop:"orderSource"},{default:l(y=>[e(ue,{type:N(Fe).MES_WORKORDER_SOURCETYPE,value:y.row.orderSource},null,8,["type","value"])]),_:1}),e(B,{label:"订单编号",width:"140",align:"center",prop:"sourceCode"}),e(B,{label:"产品编号",width:"120",align:"center",prop:"productCode"}),e(B,{label:"产品名称",width:"200",align:"center",prop:"productName","show-overflow-tooltip":!0}),e(B,{label:"规格型号",align:"center",prop:"productSpc","show-overflow-tooltip":!0}),e(B,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(B,{label:"工单数量",align:"center",prop:"quantity"}),e(B,{label:"客户编码",align:"center",prop:"clientCode"}),e(B,{label:"客户名称",align:"center",prop:"clientName","show-overflow-tooltip":!0}),e(B,{label:"需求日期",align:"center",prop:"requestDate",width:"180"},{default:l(y=>[j("span",null,we(N(je)(y.row.requestDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["data"])),[[T,w.value]]),S(e(Ue,{total:X.value,page:D.pageNo,"onUpdate:page":b[6]||(b[6]=y=>D.pageNo=y),limit:D.pageSize,"onUpdate:limit":b[7]||(b[7]=y=>D.pageSize=y),onPagination:K},null,8,["total","page","limit"]),[[fe,X.value>0]])]),_:1},8,["modelValue"])}}}),va=qe(fa,[["__scopeId","data-v-85cb79ad"]]),ga=async d=>await H.post({url:"/wms/allocated-header/create",data:d}),wa=async d=>await H.put({url:"/wms/allocated-header/update",data:d}),ka=async d=>await H.delete({url:`/wms/allocated-header/delete?id=${d}`}),Nl=async d=>await H.get({url:`/wms/allocated-header/get?id=${d}`}),ba=async d=>await H.get({url:"/wms/allocated-header/page",params:d}),_a=async d=>await H.download({url:"/wms/allocated-header/export-excel",params:d}),Ca=async d=>await H.post({url:"/wms/allocated-header/initBom",data:d}),ya=async d=>await H.put({url:`/wms/allocated-header/${d}`}),ha=async d=>await H.get({url:`/wms/allocated-header/finsh?id=${d}`}),Ia=async d=>await H.post({url:"/wms/allocated-line/updateLine",data:d}),Na=async d=>await H.get({url:`/wms/allocated-header/createIssue?id=${d}`}),Va=async d=>await H.get({url:`/mes/autocode/get/${d}`}),Sa=async d=>await H.get({url:`/wms/allocated-record/getByHeaderId?id=${d}`}),za={class:"app-container"},xa={key:0},Ua={class:"dialog-footer"},qa={class:"dialog-footer"},Da={__name:"allocation",setup(d,{expose:c}){const G=Vl(),g=Ae(()=>G.currentSize==="mini"?"small":G.currentSize),w=r(null),q=r(null),t=r({id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),V=r({bindWorkorder:!1,status:"",allocatedDate:null,workorderCode:"",taskCode:"",clientCode:"",remark:"",workorderId:null,taskId:null}),X=r(null),ae=r(null),re=r(null),D=r(null),K=r(!1),W=r(void 0),k=r([]),z=r([]),se=_e({multiple:!1,value:"pId",label:"pName"}),F=r(!0),_=r(!1),de=r([]),L=r([]),b=r(!0),I=r(!0),ee=r(!0),ie=r(!0),E=r(!1),C=r(!0),B=r(0),ue=r([]),oe=r(""),le=r(!1),T=_e({pageNo:1,pageSize:10,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:[],status:null,remark:null,createTime:[],bindWorkorder:null}),y=r([]),p=r([]),i=_e({allocatedCode:[{required:!0,message:"调拨单编号不能为空",trigger:"blur"}],warehouseId:[{required:!0,message:"请指定调入仓库",trigger:"blur"}],locationId:[{required:!0,message:"请指定调入库区",trigger:"blur"}],areaId:[{required:!0,message:"请指定调入库位",trigger:"blur"}],workorderCode:[],taskCode:[]}),Q=r(!1),$=r(null),te=r(null),O=_e({}),ne=r(null);r(640),r(480),r("");const P=Ae(()=>W.value==="edit");Ae(()=>t.value.bindWorkorder?{workorderCode:[{required:!0,message:"请指定生产工单",trigger:"blur"}],taskCode:[{required:!0,message:"请指定生产任务",trigger:"blur"}]}:{workorderCode:[],taskCode:[]}),Te(()=>{pe(),We(),window.addEventListener("keydown",De),document.addEventListener("click",()=>{Q.value&&Y()}),Oe(()=>{setTimeout(()=>{$.value&&$.value.focus()},1e3)})}),El(()=>{ve()}),Ll(()=>Q.value,o=>{o?Oe(()=>{setTimeout(()=>{$.value&&($.value.focus(),console.log("设置焦点成功"))},300)}):ne.value=null});const ve=()=>{window.removeEventListener("keydown",De,!1)},De=o=>{if(o.keyCode===13){if(!o.target.value)return;te.value=o.target.value;var s=te.value;if(typeof s=="string"&&s.includes("{")&&s.includes("}")){let m="";s=s.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),console.log(s,"newVal 111"),s=s.replace(/\uFEFF/g,""),s=Re(s);const M=JSON.parse(s);M&&(ne.value=M.id,te.value=null,m=M.type,Y()),Be(m)}else if(typeof s=="object"&&s.id){let m="";ne.value=s.id,m=s.type,te.value=null,Y(),Be(m)}else console.log('输入内容不包含完整的 "{" 和 "}"')}},Le=()=>{ne.value=null,te.value=null,Y()};function Re(o){let a=0,s=!1,m=!1;for(let M=0;M<o.length;M++){const A=o[M];if(m){m=!1;continue}if(A==="\\"){m=!0;continue}if(A==='"'&&(s=!s),!s){if(A==="{")a++;else if(A==="}"&&(a--,a===0)){const ke=o.slice(0,M+1);try{return ke}catch{throw new Error("Invalid JSON object")}}}}throw new Error("No valid JSON object found")}const Y=()=>{Q.value&&$.value&&Oe(()=>{setTimeout(()=>{$.value&&$.value.focus()},300)})},pe=()=>{F.value=!0,ba(T).then(o=>{ue.value=o.list,B.value=o.total,F.value=!1})},We=()=>{xl().then(o=>{z.value=o,z.value.map(a=>{a.pId=a.id,a.pName=a.warehouseName,a.children.map(m=>{let M=JSON.stringify(m.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");m.children=JSON.parse(M)});let s=JSON.stringify(a.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");a.children=JSON.parse(s)}),W.value==="add"&&k.value.length===0&&z.value.length>0&&(k.value=[z.value[0].value,z.value[0].children[0].value,z.value[0].children[0].children[0].value])})},Ie=()=>{le.value=!1,y.value=[],p.value=[],Q.value=!1,x()},x=()=>{Object.assign(t.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bomList:[]}),K.value=!1,y.value=[],k.value=[],q.value&&q.value.resetFields()},ye=()=>{T.pageNo=1,pe()},Ge=()=>{w.value&&w.value.resetFields(),ye()},Xe=o=>{de.value=o.map(a=>a.id),b.value=o.length!==1,ee.value=!o.length},Ze=()=>{x(),le.value=!0,oe.value="添加调拨单",W.value="add",k.value=[]},el=o=>{x();const a=o.id;Nl(a).then(s=>{Object.assign(t.value,s),t.value.bindWorkorder=t.value.bindWorkorder==="true",k.value=[s.warehouseId,s.locationId,s.areaId],y.value=s.bomList,p.value=[],le.value=!0,oe.value="修改调拨单",W.value="edit"})},ll=()=>{q.value.validate(o=>{if(o){if(t.value.bindWorkorder||(t.value.bindWorkorder=!1),t.value.warehouseId==null||t.value.locationId==null||t.value.areaId==null){J.error("请选择调拨仓库、库区、库位信息！");return}if(p.value.length===0&&t.value.bindWorkorder===!0){J.error("请选择需要调拨的BOM信息");return}if(t.value.bomList=p.value.map(a=>({...a,quantityAllocated:parseFloat(a.quantityAllocated)})),t.value.id!=null){wa(t.value).then(a=>{J.success("修改成功"),le.value=!1,pe()});return}t.value.bomList=p.value,ga(t.value).then(a=>{J.success("新增成功"),le.value=!1,pe()})}})},al=o=>{const a=o.id;He.confirm('是否确认删除调拨单头编号为"'+a+'"的数据项?').then(()=>ka(a)).then(()=>{pe(),J.success("删除成功")}).catch(()=>{})},ol=()=>{let o={...T};o.pageNo=void 0,o.pageSize=void 0,He.confirm("是否确认导出所有调拨单头数据项?").then(()=>(E.value=!0,_a(o))).then(a=>{Bl.excel(a,"调拨单头.xls"),J.success("导出成功"),E.value=!1}).catch(()=>{})},Me=o=>{o!==null?(t.value.warehouseId=o[0],t.value.locationId=o[1],t.value.areaId=o[2]):(t.value.warehouseId=null,t.value.locationId=null,t.value.areaId=null)},Ke=()=>{ae.value.showFlag=!0},Ul=o=>{o!=null&&o!=null&&(t.value.workorderId=o.id,t.value.workorderCode=o.workorderCode,t.value.workorderName=o.workorderName,t.value.clientId=o.clientId,t.value.clientCode=o.clientCode,t.value.clientName=o.clientName),_.value=!0,Ca(t.value.workorderCode).then(a=>{y.value=a,_.value=!1})},tl=o=>{o?(F.value=!0,Va("ALLOCATED_CODE").then(a=>{t.value.allocatedCode=a,F.value=!1})):t.value.allocatedCode=null},nl=o=>{x();const a=o.id||de.value;F.value=!0,ha(a).then(s=>{J.success("成功"),le.value=!1,F.value=!1,pe()})},rl=o=>{p.value=o.map(a=>({...a}))},dl=o=>{ql(o.id)},ql=o=>{O.id=o,Oe(()=>{X.value&&X.value.resetFields()}),Nl(o).then(a=>{Object.assign(O,a),O.bindWorkorder=O.bindWorkorder==="true",k.value=[a.warehouseId,a.locationId,a.areaId],k.value[0]=a.warehouseId,k.value[1]=a.locationId,k.value[2]=a.areaId,y.value=a.bomList}),Sa(o).then(a=>{p.value=a}),Q.value=!0},ul=()=>{if(!ne.value){J.error("请扫描正确的单据信息!");return}Be()},sl=()=>{D.value.showFlag=!0,D.value.getList()},il=()=>{const o=L.value;p.value=p.value.filter(a=>!o.includes(a.id))},pl=o=>{L.value=o.map(a=>a.id),I.value=o.length!==1,ie.value=!o.length},Be=o=>{let a="";if(o&&(a=o),k.value[0]===""||k.value[1]===""||k.value[2]===""){J.error("请选择调拨仓库、库区、库位信息！");return}if(!ne.value){J.error("请输入或扫描单据信息!");return}let s={id:parseInt(ne.value),type:a,method:"allocated",warehouseId:k.value[0],locationId:k.value[1],areaId:k.value[2]};F.value=!0,Ql(s).then(m=>{F.value=!1;let M=m;M.quantityAllocated=M.quantityOnhand,p.value.some(ke=>ke.itemCode===M.itemCode&&ke.batchCode===M.batchCode)?J.error("物料唯一码已存在，请勿添加重复项。"):(J.success("新增成功"),p.value.push(M))})},cl=async()=>{let o={headerId:O.id,bomList:p.value};F.value=!0;try{await Ia(o),await ya(O.id),F.value=!1,pe(),J.success("出库成功"),Q.value=!1}catch{J.error("操作失败"),F.value=!1}},ml=o=>{const a=parseFloat(o.quantityAllocated);if(isNaN(a)||a<=0){J.error("调拨数量必须为大于0的正数"),o.quantityAllocated="";return}const s=p.value.findIndex(m=>m.itemCode===o.itemCode);s!==-1&&(p.value[s]={...p.value[s],quantityAllocated:a})},Qe=()=>{re.value.showFlag=!0,re.value.getList()},Dl=o=>{o!=null&&o!=null&&(t.value.taskId=o.id,t.value.taskCode=o.taskCode,t.value.taskName=o.taskName,t.value.workstationId=o.workstationId,t.value.workstationCode=o.workstationCode,t.value.workstationName=o.workstationName,t.value.processId=o.processId,t.value.processCode=o.processCode,t.value.processName=o.processName)},Rl=o=>{o!=null&&o!=null&&(O.taskId=o.id,O.taskCode=o.taskCode,O.taskName=o.taskName,O.workstationId=o.workstationId,O.workstationCode=o.workstationCode,O.workstationName=o.workstationName,O.processId=o.processId,O.processCode=o.processCode,O.processName=o.processName)},Pl=o=>{if(o!=null&&o!=null)for(let a=0;a<o.length;a++){let s=o[a];s.quantityAllocated=s.quantityOnhand,p.value.some(M=>M.itemCode===s.itemCode&&M.batchCode===s.batchCode)?J.error("物料唯一码已存在，请勿添加重复项。"):p.value.push(s)}},fl=o=>{t.value.bindWorkorder=o,q.value&&q.value.validate()},vl=o=>{He.confirm("确认生成领料单吗?").then(()=>{F.value=!0;const a=o.id||de.value;Na(a).then(()=>{F.value=!1,pe(),J.success("领料单创建成功"),Q.value=!1}).catch(s=>{J.error("领料单创建失败"),F.value=!1})}).catch(()=>{J.info("已取消")})};return c({queryParams:T,showSearch:C,loading:F,list:ue,total:B,single:b,multiple:ee,exportLoading:E,handleQuery:ye,resetQuery:Ge,handleSelectionChange:Xe,handleAdd:Ze,handleUpdate:el,handleDelete:al,handleExport:ol,handleFinsh:nl,handleIssue:vl,handleExecute:dl,form:t,rules:i,autoGenFlag:K,optType:W,warehouseInfo:k,warehouseOptions:z,warehouseProps:se,bomList:y,allocatedList:p,bomLoadding:_,open:le,title:oe,isEdit:P,handleAutoGenChange:tl,handleWarehouseChanged:Me,handleWorkorderSelect:Ke,handleTaskSelect:Qe,handleBindWorkorderChange:fl,handleBomSelectionChange:rl,handleQuantityChange:ml,submitForm:ll,cancel:Ie,executeDialogVisible:Q,executeForm:O,purchaseId:ne,allocatedSingle:I,allocatedHandleAdd:ul,allocatedHandleBatchAdd:sl,allocatedHandleDelete:il,allocatedHandleSelectionChange:pl,executeAllocated:cl}),(o,a)=>{const s=u("el-input"),m=u("el-form-item"),M=u("el-date-picker"),A=u("el-button"),ke=u("el-form"),R=u("el-col"),ce=u("el-row"),U=u("el-table-column"),Ol=Sl,Ne=u("el-table"),Al=Ue,Fl=Tl,gl=u("el-switch"),wl=u("el-cascader"),kl=u("el-option"),bl=u("el-select"),Pe=u("el-divider"),_l=u("el-card"),Cl=u("el-dialog"),be=Ce("hasPermi"),Ve=Ce("loading"),yl=Ce("dialogDrag");return f(),he("div",za,[S(e(ke,{model:T,ref:"queryFormRef",size:g.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(m,{label:"调拨单号",prop:"allocatedCode"},{default:l(()=>[e(s,{modelValue:T.allocatedCode,"onUpdate:modelValue":a[0]||(a[0]=n=>T.allocatedCode=n),placeholder:"请输入调拨单编号",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(s,{modelValue:T.allocatedName,"onUpdate:modelValue":a[1]||(a[1]=n=>T.allocatedName=n),placeholder:"请输入调拨单名称",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(s,{modelValue:T.workorderCode,"onUpdate:modelValue":a[2]||(a[2]=n=>T.workorderCode=n),placeholder:"请输入生产工单编码",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"仓库名称",prop:"warehouseName"},{default:l(()=>[e(s,{modelValue:T.warehouseName,"onUpdate:modelValue":a[3]||(a[3]=n=>T.warehouseName=n),placeholder:"请输入仓库名称",clearable:"",onKeyup:Z(ye,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(M,{modelValue:T.allocatedDate,"onUpdate:modelValue":a[4]||(a[4]=n=>T.allocatedDate=n),style:{width:"240px"},"value-format":"yyyy-MM-dd HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(A,{type:"primary",icon:N(ge),onClick:ye},{default:l(()=>a[30]||(a[30]=[v("搜索")])),_:1},8,["icon"]),e(A,{icon:N(Ee),onClick:Ge},{default:l(()=>a[31]||(a[31]=[v("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[fe,C.value]]),e(ce,{gutter:10,class:"mb8"},{default:l(()=>[e(R,{span:1.5},{default:l(()=>[S((f(),h(A,{type:"primary",icon:N($e),size:g.value,onClick:Ze},{default:l(()=>a[32]||(a[32]=[v("新增 ")])),_:1},8,["icon","size"])),[[be,["wms:allocated-header:create"]]])]),_:1}),e(R,{span:1.5},{default:l(()=>[S((f(),h(A,{type:"warning",plain:"",icon:N(Wl),size:g.value,onClick:ol,loading:E.value},{default:l(()=>a[33]||(a[33]=[v("导出 ")])),_:1},8,["icon","size","loading"])),[[be,["wms:allocated-header:export"]]])]),_:1}),e(R,{span:1.5},{default:l(()=>[S((f(),h(A,{type:"success",plain:"",icon:N(hl),size:g.value,onClick:nl,disabled:b.value},{default:l(()=>a[34]||(a[34]=[v("完成 ")])),_:1},8,["icon","size","disabled"])),[[be,["wms:allocated-header:finsh"]]])]),_:1}),e(R,{span:1.5},{default:l(()=>[S((f(),h(A,{plain:"",icon:N(hl),size:g.value,onClick:vl,disabled:b.value},{default:l(()=>a[35]||(a[35]=[v("生成领料单 ")])),_:1},8,["icon","size","disabled"])),[[be,["wms:allocated-header:createIssue"]]])]),_:1})]),_:1}),e(Fl,null,{default:l(()=>[S((f(),h(Ne,{data:ue.value,size:g.value,onSelectionChange:Xe},{default:l(()=>[e(U,{type:"selection",width:"55",align:"center"}),e(U,{label:"调拨单编号",align:"center",prop:"allocatedCode"}),e(U,{label:"调拨单名称",align:"center",prop:"allocatedName"}),e(U,{label:"生产工单",align:"center",prop:"workorderCode"}),e(U,{label:"调拨日期",align:"center",prop:"allocatedDate",width:"180"},{default:l(n=>[j("span",null,we(N(je)(n.row.allocatedDate,"YYYY-MM-DD")),1)]),_:1}),e(U,{label:"单据状态",align:"center",prop:"status"},{default:l(n=>[e(Ol,{type:N(Fe).MES_ALLOCATED_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),e(U,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(n=>[n.row.status!="FINISHED"?S((f(),h(A,{key:0,size:g.value,type:"text",onClick:Se=>dl(n.row)},{default:l(()=>a[36]||(a[36]=[v("执行领出")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:allocated"]]]):me("",!0),S((f(),h(A,{size:g.value,type:"text",onClick:Se=>el(n.row)},{default:l(()=>a[37]||(a[37]=[v("修改 ")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:update"]]]),S((f(),h(A,{size:g.value,type:"text",onClick:Se=>al(n.row)},{default:l(()=>a[38]||(a[38]=[v("删除 ")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:delete"]]])]),_:1})]),_:1},8,["data","size"])),[[Ve,F.value]]),S(e(Al,{total:B.value,page:T.pageNo,"onUpdate:page":a[5]||(a[5]=n=>T.pageNo=n),limit:T.pageSize,"onUpdate:limit":a[6]||(a[6]=n=>T.pageSize=n),onPagination:pe},null,8,["total","page","limit"]),[[fe,B.value>0]])]),_:1}),S((f(),h(Cl,{title:oe.value,modelValue:le.value,"onUpdate:modelValue":a[17]||(a[17]=n=>le.value=n),width:"80%","append-to-body":""},{footer:l(()=>[j("div",Ua,[e(A,{size:g.value,type:"primary",onClick:ll},{default:l(()=>a[41]||(a[41]=[v("确 定")])),_:1},8,["size"]),e(A,{size:g.value,onClick:Ie},{default:l(()=>a[42]||(a[42]=[v("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(ke,{ref_key:"formRef",ref:q,size:g.value,model:t.value,rules:i},{default:l(()=>[e(ce,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(m,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(s,{disabled:P.value,modelValue:t.value.allocatedCode,"onUpdate:modelValue":a[7]||(a[7]=n=>t.value.allocatedCode=n),placeholder:"请输入调拨单编号"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(R,{span:4},{default:l(()=>[e(m,null,{default:l(()=>[W.value!="view"&&t.value.status=="PREPARE"?(f(),h(gl,{key:0,modelValue:K.value,"onUpdate:modelValue":a[8]||(a[8]=n=>K.value=n),"active-color":"#13ce66","active-text":"自动生成",onChange:tl},null,8,["modelValue"])):me("",!0)]),_:1})]),_:1}),e(R,{span:12},{default:l(()=>[e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(s,{disabled:"",modelValue:t.value.allocatedName,"onUpdate:modelValue":a[9]||(a[9]=n=>t.value.allocatedName=n),placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ce,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(M,{clearable:"",modelValue:t.value.allocatedDate,"onUpdate:modelValue":a[10]||(a[10]=n=>t.value.allocatedDate=n),type:"date","value-format":"timestamp",placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(m,{label:"领料仓库"},{default:l(()=>[e(wl,{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=n=>k.value=n),options:z.value,props:se,placeholder:"请选择",onChange:Me},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(m,{label:"单据状态",prop:"status"},{default:l(()=>[e(bl,{modelValue:t.value.status,"onUpdate:modelValue":a[12]||(a[12]=n=>t.value.status=n),disabled:""},{default:l(()=>[(f(!0),he(ze,null,xe(N(Fe).MES_ALLOCATED_STATUS,n=>(f(),h(kl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ce,null,{default:l(()=>[e(R,{span:2}),e(R,{span:6},{default:l(()=>[e(m,{"label-width":"80"},{default:l(()=>[W.value!="view"&&t.value.status=="PREPARE"?(f(),h(gl,{key:0,style:{"margin-left":"10%"},modelValue:t.value.bindWorkorder,"onUpdate:modelValue":a[13]||(a[13]=n=>t.value.bindWorkorder=n),"active-color":"#13ce66","inactive-text":"绑定工单",onChange:fl},null,8,["modelValue"])):me("",!0)]),_:1})]),_:1}),t.value&&t.value.bindWorkorder?(f(),h(R,{key:0,span:8},{default:l(()=>[e(m,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(s,{modelValue:t.value.workorderCode,"onUpdate:modelValue":a[14]||(a[14]=n=>t.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(A,{icon:N(ge),onClick:Ke},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(va,{ref:"woSelectRef",onOnSelected:Ul},null,512)]),_:1})):me("",!0),t.value&&t.value.bindWorkorder?(f(),h(R,{key:1,span:8},{default:l(()=>[e(m,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(s,{modelValue:t.value.taskCode,"onUpdate:modelValue":a[15]||(a[15]=n=>t.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(A,{icon:N(ge),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Il,{ref:"taskSelectRef",workorderId:t.value.workorderId,onOnSelected:Dl},null,8,["workorderId"])]),_:1})):me("",!0)]),_:1}),e(ce,null,{default:l(()=>[e(R,{span:24},{default:l(()=>[e(m,{label:"备注",prop:"remark"},{default:l(()=>[e(s,{modelValue:t.value.remark,"onUpdate:modelValue":a[16]||(a[16]=n=>t.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"]),t.value&&t.value.bindWorkorder?(f(),he("div",xa,[e(Pe,{"content-position":"center"},{default:l(()=>a[39]||(a[39]=[v("物料信息")])),_:1}),e(_l,{shadow:"always",class:"box-card"},{default:l(()=>[S((f(),h(Ne,{size:g.value,"max-height":"300",data:y.value,onSelectionChange:rl},{default:l(()=>[e(U,{type:"selection",width:"65",align:"center"}),e(U,{label:"物料编码",align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{width:"210",label:"需求数量",align:"center",prop:"quantityAllocated"}),e(U,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,_.value]])]),_:1}),e(Pe,{"content-position":"center"},{default:l(()=>a[40]||(a[40]=[v("调拨信息")])),_:1}),e(_l,{shadow:"always",class:"box-card"},{default:l(()=>[S((f(),h(Ne,{size:g.value,"max-height":"300",data:p.value,"row-key":"itemCode"},{default:l(()=>[e(U,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{width:"220",label:"调拨数量",align:"center",prop:"quantityAllocated"},{default:l(n=>[e(s,{modelValue:n.row.quantityAllocated,"onUpdate:modelValue":Se=>n.row.quantityAllocated=Se,type:"number",placeholder:"请输入数量",onBlur:Se=>ml(n.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(U,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,_.value]])]),_:1})])):me("",!0)]),_:1},8,["title","modelValue"])),[[yl]]),S((f(),h(Cl,{title:"执行出库",class:"execute-dialog",modelValue:Q.value,"onUpdate:modelValue":a[29]||(a[29]=n=>Q.value=n),width:"92%","append-to-body":""},{footer:l(()=>[j("span",qa,[e(A,{size:g.value,onClick:Ie},{default:l(()=>a[50]||(a[50]=[v("取 消")])),_:1},8,["size"]),e(A,{size:g.value,type:"primary",onClick:cl},{default:l(()=>a[51]||(a[51]=[v("确 定")])),_:1},8,["size"])])]),default:l(()=>[e(ke,{size:g.value,ref_key:"executeFormRef",ref:X,model:V.value,"label-width":"100px"},{default:l(()=>[e(ce,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(m,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(s,{modelValue:V.value.allocatedCode,"onUpdate:modelValue":a[18]||(a[18]=n=>V.value.allocatedCode=n),disabled:"",placeholder:"请输入调拨单编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:12},{default:l(()=>[e(m,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(s,{modelValue:V.value.allocatedName,"onUpdate:modelValue":a[19]||(a[19]=n=>V.value.allocatedName=n),disabled:"",placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ce,null,{default:l(()=>[e(R,{span:8},{default:l(()=>[e(m,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(M,{clearable:"",modelValue:V.value.allocatedDate,"onUpdate:modelValue":a[20]||(a[20]=n=>V.value.allocatedDate=n),disabled:"",type:"date","value-format":"timestamp",placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(m,{label:"领料仓库"},{default:l(()=>[e(wl,{disabled:"",modelValue:k.value,"onUpdate:modelValue":a[21]||(a[21]=n=>k.value=n),options:z.value,props:se,onChange:Me},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(m,{label:"单据状态",prop:"status"},{default:l(()=>[e(bl,{disabled:"",modelValue:V.value.status,"onUpdate:modelValue":a[22]||(a[22]=n=>V.value.status=n)},{default:l(()=>[(f(!0),he(ze,null,xe(N(Fe).MES_ALLOCATED_STATUS,n=>(f(),h(kl,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),V.value.bindWorkorder?(f(),h(ce,{key:0},{default:l(()=>[e(R,{span:8},{default:l(()=>[e(m,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(s,{disabled:"",modelValue:V.value.workorderCode,"onUpdate:modelValue":a[23]||(a[23]=n=>V.value.workorderCode=n),placeholder:"请选择生产工单"},{append:l(()=>[e(A,{disabled:"",icon:N(ge),onClick:Ke},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(R,{span:8},{default:l(()=>[e(m,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(s,{disabled:"",modelValue:V.value.taskCode,"onUpdate:modelValue":a[24]||(a[24]=n=>V.value.taskCode=n),placeholder:"请选择生产任务"},{append:l(()=>[e(A,{disabled:"",icon:N(ge),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Il,{ref:"taskSelectRef",workorderId:V.value.workorderId,onOnSelected:Rl},null,8,["workorderId"])]),_:1}),e(R,{span:8},{default:l(()=>[e(m,{label:"客户编号"},{default:l(()=>[e(s,{disabled:"",modelValue:V.value.clientCode,"onUpdate:modelValue":a[25]||(a[25]=n=>V.value.clientCode=n),placeholder:"请选择生产工单"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):me("",!0),e(ce,null,{default:l(()=>[e(R,{span:24},{default:l(()=>[e(m,{label:"备注",prop:"remark"},{default:l(()=>[e(s,{disabled:"",modelValue:V.value.remark,"onUpdate:modelValue":a[26]||(a[26]=n=>V.value.remark=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),V.value.bindWorkorder?(f(),h(Pe,{key:1,"content-position":"center"},{default:l(()=>a[43]||(a[43]=[v("BOM信息")])),_:1})):me("",!0),V.value.bindWorkorder?S((f(),h(Ne,{key:2,size:g.value,"max-height":"200",data:y.value,style:{width:"100%"}},{default:l(()=>[e(U,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{label:"需求数量",align:"center",prop:"quantityAllocated"}),e(U,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ve,_.value]]):me("",!0),e(Pe,{"content-position":"center"},{default:l(()=>a[44]||(a[44]=[v("调拨信息")])),_:1}),e(ce,{gutter:10},{default:l(()=>[e(R,{span:8},{default:l(()=>[e(m,{label:"单据信息",prop:"purchaseId"},{default:l(()=>[e(s,{readonly:"",modelValue:ne.value,"onUpdate:modelValue":a[27]||(a[27]=n=>ne.value=n),placeholder:"请输入"},null,8,["modelValue"]),S(j("input",{ref_key:"scannerInput",ref:$,"onUpdate:modelValue":a[28]||(a[28]=n=>te.value=n),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"1",height:"1","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[Ml,te.value]]),a[45]||(a[45]=j("span",null,"支持扫码枪扫描, 无法扫码时点击重置按钮",-1))]),_:1})]),_:1}),e(R,{span:4},{default:l(()=>[e(A,{type:"primary",round:"",onClick:Le},{default:l(()=>a[46]||(a[46]=[v("重置")])),_:1})]),_:1}),e(R,{span:2.5},{default:l(()=>[e(A,{type:"primary",style:{"margin-right":"10px"},icon:N($e),size:g.value,onClick:ul},{default:l(()=>a[47]||(a[47]=[v("新增")])),_:1},8,["icon","size"])]),_:1}),e(R,{span:2.5},{default:l(()=>[S((f(),h(A,{type:"primary",style:{"margin-right":"10px"},icon:N($e),size:g.value,onClick:sl},{default:l(()=>a[48]||(a[48]=[v("批量新增")])),_:1},8,["icon","size"])),[[be,["wms:allocated-header:batchAdd"]]])]),_:1}),e(pa,{ref_key:"stockSelectRef",ref:D,onOnSelected:Pl},null,512),e(R,{span:2.5},{default:l(()=>[e(A,{type:"danger",plain:"",icon:N(Kl),size:g.value,disabled:I.value,onClick:il},{default:l(()=>a[49]||(a[49]=[v("删除")])),_:1},8,["icon","size","disabled"])]),_:1})]),_:1}),S((f(),h(Ne,{size:g.value,data:p.value,onSelectionChange:pl},{default:l(()=>[e(U,{type:"selection",width:"55",align:"center"}),e(U,{label:"序号",width:"55",align:"center"},{default:l(n=>[v(we(n.$index+1),1)]),_:1}),e(U,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(U,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(U,{label:"调拨数量","show-overflow-tooltip":!0,align:"center",prop:"quantityAllocated"}),e(U,{width:"70",label:"单位",align:"center",prop:"unitOfMeasure"}),e(U,{label:"批次号","show-overflow-tooltip":!0,align:"center",prop:"batchCode"}),e(U,{label:"调拨标识","show-overflow-tooltip":!0,width:"90",align:"center",prop:"allocatedFlag"}),e(U,{label:"仓库名称","show-overflow-tooltip":!0,align:"center",prop:"warehouseName"}),e(U,{label:"库区名称","show-overflow-tooltip":!0,align:"center",prop:"locationName"}),e(U,{label:"库位名称","show-overflow-tooltip":!0,align:"center",prop:"areaName"})]),_:1},8,["size","data"])),[[Ve,F.value]])]),_:1},8,["size","model"])]),_:1},8,["modelValue"])),[[yl]])])}}},Ea=qe(Da,[["__scopeId","data-v-cae43b11"]]);export{Ea as default};
