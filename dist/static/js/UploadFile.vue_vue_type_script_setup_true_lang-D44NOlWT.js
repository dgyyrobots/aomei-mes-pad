/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{d as L,az as a,r as n,bx as N,by as j,Y as A,g as h,c as M,o as C,j as g,aG as F,m as x,i as f,v as m,t as S,K as q,a as y,y as T,aO as U,bI as D,z as G}from"./index-lcC3l4R2.js";const H={class:"upload-file"},K={style:{"font-size":"8px"}},P={style:{color:"#f56c6c"}},Y={style:{"font-size":"8px"}},J={style:{color:"#f56c6c"}},W=L({name:"UploadFile",__name:"UploadFile",props:{modelValue:a.oneOfType([String,Array]).isRequired,title:a.string.def("文件上传"),updateUrl:a.string.def(void 0),fileType:a.array.def(["doc","xls","ppt","txt","pdf"]),fileSize:a.number.def(5),limit:a.number.def(5),autoUpload:a.bool.def(!0),drag:a.bool.def(!1),isShowTip:a.bool.def(!0)},emits:["update:modelValue"],setup(s,{emit:w}){const i=G(),z=w,o=s,p=n(o.modelValue),O=n(),u=n([]),t=n([]),c=n(0),B=n({Authorization:`Bearer ${j()}`,"tenant-id":N()}),I=l=>{if(t.value.length>=o.limit)return i.error(`上传文件数量不能超过${o.limit}个!`),!1;let e="";l.name.lastIndexOf(".")>-1&&(e=l.name.slice(l.name.lastIndexOf(".")+1));const d=o.fileType.some(r=>l.type.indexOf(r)>-1?!0:!!(e&&e.indexOf(r)>-1)),v=l.size<o.fileSize*1024*1024;if(!d)return i.error(`文件格式不正确, 请上传${o.fileType.join("/")}格式!`),!1;if(!v)return i.error(`上传文件大小不能超过${o.fileSize}MB!`),!1;i.success("正在上传文件，请稍候..."),c.value++},R=l=>{i.success("上传成功");const e=t.value;e.pop(),t.value=e,u.value.push({name:l.data,url:l.data}),u.value.length==c.value&&(t.value=t.value.concat(u.value),u.value=[],c.value=0,b())},_=()=>{i.error(`上传文件数量不能超过${o.limit}个!`)},$=()=>{i.error("导入数据失败，请您重新上传！")},k=l=>{const e=t.value.map(d=>d.name).indexOf(l.name);e>-1&&(t.value.splice(e,1),b())},E=l=>{console.log(l)};A(()=>o.modelValue,()=>{const l=[];if(U(o.modelValue))o.modelValue.includes(",")?l.concat(o.modelValue.split(",")):o.modelValue.length>0&&l.push(o.modelValue);else if(D(o.modelValue))l.concat(o.modelValue);else if(o.modelValue!=null)throw new Error("不支持的 modelValue 类型");t.value=l.map(e=>({url:e,name:e.substring(e.lastIndexOf("/")+1)}))},{immediate:!0});const b=()=>{let l=t.value.map(e=>e.url);U(o.modelValue)&&(l=l.join(",")),z("update:modelValue",l)};return(l,e)=>{const d=q,v=h("el-button"),r=h("el-upload");return C(),M("div",H,[g(r,{ref_key:"uploadRef",ref:O,modelValue:y(p),"onUpdate:modelValue":e[0]||(e[0]=V=>T(p)?p.value=V:null),"file-list":y(t),"onUpdate:fileList":e[1]||(e[1]=V=>T(t)?t.value=V:null),action:s.updateUrl,"auto-upload":s.autoUpload,"before-upload":I,class:"upload-file-uploader",drag:s.drag,headers:y(B),limit:o.limit,multiple:o.limit>1,name:"file","on-error":$,"on-exceed":_,"on-preview":E,"on-remove":k,"on-success":R,"show-file-list":!0},F({default:x(()=>[g(v,{type:"primary"},{default:x(()=>[g(d,{icon:"ep:upload-filled"}),e[2]||(e[2]=m(" 选取文件 "))]),_:1})]),_:2},[s.isShowTip?{name:"tip",fn:x(()=>[f("div",K,[e[3]||(e[3]=m(" 大小不超过 ")),f("b",P,S(s.fileSize)+"MB",1)]),f("div",Y,[e[4]||(e[4]=m(" 格式为 ")),f("b",J,S(s.fileType.join("/")),1),e[5]||(e[5]=m(" 的文件 "))])]),key:"0"}:void 0]),1032,["modelValue","file-list","action","auto-upload","drag","headers","limit","multiple"])])}}});export{W as _};
