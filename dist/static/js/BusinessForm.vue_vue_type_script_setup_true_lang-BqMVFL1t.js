/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 13:38:04 
 */
import{V as m,d as ue,r as u,f as O,g as i,h as re,k as V,o as _,m as o,w as ie,a as t,j as a,aS as de,M as me,v as T,c as q,F as j,n as G,y as pe,_ as ce,N as ve,z as fe,cG as ge}from"./index-FPuwcz_Y.js";import{_ as _e}from"./DictTag.vue_vue_type_script_lang-o_bnFpkw.js";import{g as ye,a as be}from"./index-BbB39EXo.js";import{D as J}from"./dict-C9lD-gwA.js";const Pe=async n=>await m.get({url:"/crm/business/page",params:n}),Be=async n=>await m.get({url:"/crm/business/page-by-customer",params:n}),we=async n=>await m.get({url:`/crm/business/get?id=${n}`}),Ve=async n=>await m.post({url:"/crm/business/create",data:n}),Te=async n=>await m.put({url:"/crm/business/update",data:n}),Ne=async n=>await m.delete({url:`/crm/business/delete?id=${n}`}),Re=async n=>await m.download({url:"/crm/business/export-excel",params:n}),xe=ue({__name:"BusinessForm",emits:["success"],setup(n,{expose:Y,emit:A}){const{t:S}=ve(),U=fe(),p=u(!1),C=u(""),c=u(!1),P=u(""),s=u({id:void 0,name:void 0,statusTypeId:void 0,statusId:void 0,contactNextTime:void 0,customerId:void 0,dealTime:void 0,price:void 0,discountPercent:void 0,productPrice:void 0,remark:void 0,ownerUserId:void 0,roUserIds:void 0,rwUserIds:void 0,endStatus:void 0,endRemark:void 0,contactLastTime:void 0,followUpStatus:void 0}),H=O({name:[{required:!0,message:"商机名称不能为空",trigger:"blur"}]}),b=u(),B=u([]),N=u([]),R=u(!0),x=u(0),L=u([]);Y({open:async(r,e)=>{if(p.value=!0,C.value=S(`action.${r}`),P.value=r,W(),e){c.value=!0;try{s.value=await we(e)}finally{c.value=!1}}N.value=await ye()}});const K=A,Q=async()=>{if(!(!b||!await b.value.validate())){c.value=!0;try{const e=s.value;P.value==="create"?(await Ve(e),U.success(S("common.createSuccess"))):(await Te(e),U.success(S("common.updateSuccess"))),p.value=!1,K("success")}finally{c.value=!1}}},W=()=>{s.value={id:void 0,name:void 0,statusTypeId:void 0,statusId:void 0,contactNextTime:void 0,customerId:void 0,dealTime:void 0,price:void 0,discountPercent:void 0,productPrice:void 0,remark:void 0,ownerUserId:void 0,roUserIds:void 0,rwUserIds:void 0,endStatus:void 0,endRemark:void 0,contactLastTime:void 0,followUpStatus:void 0},b.value?.resetFields()},X=async r=>{B.value=await be(r)},v=O({pageNo:1,pageSize:10,name:null,mobile:null,industryId:null,level:null,source:null}),f=u(!1),Z=()=>{f.value=!f.value,v.pageNo=1,E()},E=async()=>{R.value=!0;try{const r=await ge(v);console.log(JSON.stringify(r)),L.value=r.list,x.value=r.total}finally{R.value=!1}},k=u(),I=u(),h=(r,e)=>{I.value=e,k.value.clearSelection(),k.value.toggleRowSelection(e,!1)},ee=()=>{s.value.customerId=I.value.id,s.value.customerName=I.value.name,f.value=!f.value};return(r,e)=>{const g=i("el-input"),d=i("el-form-item"),y=i("el-table-column"),$=_e,le=me,z=i("el-col"),D=i("el-row"),w=i("el-button"),te=i("el-popover"),F=i("el-option"),M=i("el-select"),ae=i("el-date-picker"),oe=i("el-form"),se=ce,ne=re("loading");return _(),V(se,{modelValue:t(p),"onUpdate:modelValue":e[13]||(e[13]=l=>pe(p)?p.value=l:null),title:t(C)},{footer:o(()=>[a(w,{disabled:t(c),type:"primary",onClick:Q},{default:o(()=>e[16]||(e[16]=[T("确 定")])),_:1},8,["disabled"]),a(w,{onClick:e[12]||(e[12]=l=>p.value=!1)},{default:o(()=>e[17]||(e[17]=[T("取 消")])),_:1})]),default:o(()=>[ie((_(),V(oe,{ref_key:"formRef",ref:b,"label-width":"100px",model:t(s),rules:t(H)},{default:o(()=>[a(d,{label:"商机名称",prop:"name"},{default:o(()=>[a(g,{modelValue:t(s).name,"onUpdate:modelValue":e[0]||(e[0]=l=>t(s).name=l),placeholder:"请输入商机名称"},null,8,["modelValue"])]),_:1}),a(d,{label:"客户名称",prop:"customerName"},{default:o(()=>[a(te,{offset:10,placement:"bottom",teleported:!1,trigger:"click",visible:t(f),width:600},{reference:o(()=>[a(g,{modelValue:t(s).customerName,"onUpdate:modelValue":e[1]||(e[1]=l=>t(s).customerName=l),placeholder:"请选择客户",onClick:Z},null,8,["modelValue"])]),default:o(()=>[a(t(de),{ref_key:"multipleTableRef",ref:k,data:t(L),onSelect:h},{default:o(()=>[a(y,{label:"选择",type:"selection",width:"55"}),a(y,{label:"编号",property:"id",width:"100"}),a(y,{label:"客户名称",property:"name",width:"150"}),a(y,{align:"center",label:"客户来源",prop:"source",width:"100"},{default:o(l=>[a($,{type:t(J).CRM_CUSTOMER_SOURCE,value:l.row.source},null,8,["type","value"])]),_:1}),a(y,{align:"center",label:"客户等级",prop:"level",width:"120"},{default:o(l=>[a($,{type:t(J).CRM_CUSTOMER_LEVEL,value:l.row.level},null,8,["type","value"])]),_:1})]),_:1},8,["data"]),a(D,{gutter:20},{default:o(()=>[a(z,null,{default:o(()=>[a(le,{limit:t(v).pageSize,"onUpdate:limit":e[2]||(e[2]=l=>t(v).pageSize=l),page:t(v).pageNo,"onUpdate:page":e[3]||(e[3]=l=>t(v).pageNo=l),layout:"sizes, prev, pager, next",total:t(x),onPagination:E},null,8,["limit","page","total"])]),_:1})]),_:1}),a(D,{gutter:20},{default:o(()=>[a(z,{offset:13,span:10},{default:o(()=>[a(w,{onClick:ee},{default:o(()=>e[14]||(e[14]=[T("确认")])),_:1}),a(w,{onClick:e[4]||(e[4]=l=>f.value=!1)},{default:o(()=>e[15]||(e[15]=[T("取消")])),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])]),_:1}),a(d,{label:"商机状态类型",prop:"statusTypeId"},{default:o(()=>[a(M,{modelValue:t(s).statusTypeId,"onUpdate:modelValue":e[5]||(e[5]=l=>t(s).statusTypeId=l),clearable:"",placeholder:"请选择商机状态类型",size:"small",onChange:X},{default:o(()=>[(_(!0),q(j,null,G(t(N),l=>(_(),V(F,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"商机状态",prop:"statusId"},{default:o(()=>[a(M,{modelValue:t(s).statusId,"onUpdate:modelValue":e[6]||(e[6]=l=>t(s).statusId=l),clearable:"",placeholder:"请选择商机状态",size:"small"},{default:o(()=>[(_(!0),q(j,null,G(t(B),l=>(_(),V(F,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"预计成交日期",prop:"dealTime"},{default:o(()=>[a(ae,{modelValue:t(s).dealTime,"onUpdate:modelValue":e[7]||(e[7]=l=>t(s).dealTime=l),placeholder:"选择预计成交日期",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1}),a(d,{label:"商机金额",prop:"price"},{default:o(()=>[a(g,{modelValue:t(s).price,"onUpdate:modelValue":e[8]||(e[8]=l=>t(s).price=l),placeholder:"请输入商机金额"},null,8,["modelValue"])]),_:1}),a(d,{label:"整单折扣",prop:"discountPercent"},{default:o(()=>[a(g,{modelValue:t(s).discountPercent,"onUpdate:modelValue":e[9]||(e[9]=l=>t(s).discountPercent=l),placeholder:"请输入整单折扣"},null,8,["modelValue"])]),_:1}),a(d,{label:"产品总金额",prop:"productPrice"},{default:o(()=>[a(g,{modelValue:t(s).productPrice,"onUpdate:modelValue":e[10]||(e[10]=l=>t(s).productPrice=l),placeholder:"请输入产品总金额"},null,8,["modelValue"])]),_:1}),a(d,{label:"备注",prop:"remark"},{default:o(()=>[a(g,{modelValue:t(s).remark,"onUpdate:modelValue":e[11]||(e[11]=l=>t(s).remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[ne,t(c)]])]),_:1},8,["modelValue","title"])}}});export{xe as _,Pe as a,Ne as d,Re as e,Be as g};
