/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 14:15:15 
 */
import{d as te,az as K,r as s,b as ae,g as d,h as le,k as b,o as x,m as n,j as t,w as oe,J as ne,a as l,v as f,K as se,aS as ie,l as Y,t as re,b$ as ue,L as pe,M as ce,y as de,_ as me,z as fe}from"./index-D3eRVKjp.js";import{_ as ge}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Dg75KKir.js";import{c as _e}from"./index-Dl7TZtCB.js";import{h as ve,d as ye}from"./tree-vSlcEeQq.js";import{g as we}from"./index-E49OBwDm.js";import{g as ke}from"./category-RLeiMjVu.js";import{g as Se,d as be}from"./spu-CL8bP2N_.js";import{_ as xe}from"./SkuList.vue_vue_type_script_setup_true_lang-D7xFNNba.js";const $e=te({name:"PromotionSpuSelect",__name:"SpuSelect",props:{isSelectSku:K.bool.def(!1),radio:K.bool.def(!1)},emits:["confirm"],setup(L,{expose:E,emit:B}){const C=L,g=fe(),I=s(0),D=s([]),V=s(!1),m=s(!1),R=s(""),i=s({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]}),h=s([]),T=s(),P=s(),_=s(),v=s(!1),y=s(),r=s(0),p=s([]),F=a=>{const e=P.value?.getSkuTableRef();if(r.value===0){g.warning("请先选择商品再选择相应的规格！！！"),e?.clearSelection();return}if(a.length===0){p.value=[];return}if(C.radio){if(p.value=[a.map(c=>c.id)[0]],a.length>1){e?.clearSelection(),e?.toggleRowSelection(a.pop(),!0);return}}else p.value=a.map(c=>c.id)},H=a=>{if(a.length===0){r.value=0;return}if(r.value=a.map(e=>e.id)[0],p.value.length>0&&(p.value=[]),a.length>1){T.value?.clearSelection(),T.value?.toggleRowSelection(a.pop(),!0);return}U(a[0],a)},U=async(a,e)=>{if(r.value!==0){if(a.id!==r.value){g.warning("你已选择商品请先取消"),y.value=[r.value];return}if(v.value&&_.value?.id===a.id)return}if(_.value={},h.value=[],v.value=!1,e?.length===0){y.value=[];return}const c=await Se(a.id);h.value=we(c),_.value=c,v.value=!0,y.value=[a.id]},$=B,Q=()=>{if(r.value===0){g.warning("没有选择任何商品");return}if(C.isSelectSku&&p.value.length===0){g.warning("没有选择任何商品属性");return}C.isSelectSku?$("confirm",r.value,p.value):$("confirm",r.value),m.value=!1,r.value=0,p.value=[]};E({open:()=>{R.value="商品选择",m.value=!0}});const w=async()=>{V.value=!0;try{const a=await be(i.value);D.value=a.list,I.value=a.total}finally{V.value=!1}},z=()=>{w()},j=()=>{i.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},w()},q=a=>{_e({zIndex:99999999,urlList:[a]})},N=s();return ae(async()=>{await w();const a=await ke({});N.value=ve(a,"id","parentId")}),(a,e)=>{const c=d("el-input"),k=d("el-col"),J=d("el-tree-select"),W=d("el-date-picker"),M=se,S=d("el-button"),A=d("el-row"),u=d("el-table-column"),G=d("el-image"),O=ce,X=ge,Z=me,ee=le("loading");return x(),b(Z,{modelValue:l(m),"onUpdate:modelValue":e[6]||(e[6]=o=>de(m)?m.value=o:null),"append-to-body":!0,title:l(R),width:"70%"},{footer:n(()=>[t(S,{type:"primary",onClick:Q},{default:n(()=>e[9]||(e[9]=[f("确 定")])),_:1}),t(S,{onClick:e[5]||(e[5]=o=>m.value=!1)},{default:n(()=>e[10]||(e[10]=[f("取 消")])),_:1})]),default:n(()=>[t(X,null,{default:n(()=>[t(A,{class:"mb-10px",gutter:20},{default:n(()=>[t(k,{span:6},{default:n(()=>[t(c,{modelValue:l(i).name,"onUpdate:modelValue":e[0]||(e[0]=o=>l(i).name=o),class:"!w-240px",clearable:"",placeholder:"请输入商品名称",onKeyup:ne(z,["enter"])},null,8,["modelValue"])]),_:1}),t(k,{span:6},{default:n(()=>[t(J,{modelValue:l(i).categoryId,"onUpdate:modelValue":e[1]||(e[1]=o=>l(i).categoryId=o),"check-strictly":"",class:"w-1/1",data:l(N),"node-key":"id",placeholder:"请选择商品分类",props:l(ye)},null,8,["modelValue","data","props"])]),_:1}),t(k,{span:6},{default:n(()=>[t(W,{modelValue:l(i).createTime,"onUpdate:modelValue":e[2]||(e[2]=o=>l(i).createTime=o),class:"!w-240px","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),t(k,{span:6},{default:n(()=>[t(S,{onClick:z},{default:n(()=>[t(M,{class:"mr-5px",icon:"ep:search"}),e[7]||(e[7]=f(" 搜索 "))]),_:1}),t(S,{onClick:j},{default:n(()=>[t(M,{class:"mr-5px",icon:"ep:refresh"}),e[8]||(e[8]=f(" 重置 "))]),_:1})]),_:1})]),_:1}),oe((x(),b(l(ie),{ref_key:"spuListRef",ref:T,data:l(D),"expand-row-keys":l(y),"row-key":"id",onExpandChange:U,onSelectionChange:H},{default:n(()=>[L.isSelectSku?(x(),b(u,{key:0,type:"expand",width:"30"},{default:n(()=>[l(v)?(x(),b(l(xe),{key:0,ref_key:"skuListRef",ref:P,"is-component":!0,"is-detail":!0,"prop-form-data":l(_),"property-list":l(h),onSelectionChange:F},null,8,["prop-form-data","property-list"])):Y("",!0)]),_:1})):Y("",!0),t(u,{type:"selection",width:"55"}),t(u,{key:"id",align:"center",label:"商品编号",prop:"id"}),t(u,{label:"商品图","min-width":"80"},{default:n(({row:o})=>[t(G,{class:"h-30px w-30px",src:o.picUrl,onClick:Ve=>q(o.picUrl)},null,8,["src","onClick"])]),_:1}),t(u,{label:"商品名称","min-width":"300",prop:"name","show-overflow-tooltip":!0}),t(u,{align:"center",label:"商品售价","min-width":"90",prop:"price"},{default:n(({row:o})=>[f(re(l(ue)(o.price)),1)]),_:1}),t(u,{align:"center",label:"销量","min-width":"90",prop:"salesCount"}),t(u,{align:"center",label:"库存","min-width":"90",prop:"stock"}),t(u,{align:"center",label:"排序","min-width":"70",prop:"sort"}),t(u,{align:"center",formatter:l(pe),label:"创建时间",prop:"createTime",width:"180"},null,8,["formatter"])]),_:1},8,["data","expand-row-keys"])),[[ee,l(V)]]),t(O,{limit:l(i).pageSize,"onUpdate:limit":e[3]||(e[3]=o=>l(i).pageSize=o),page:l(i).pageNo,"onUpdate:page":e[4]||(e[4]=o=>l(i).pageNo=o),total:l(I),onPagination:w},null,8,["limit","page","total"])]),_:1})]),_:1},8,["modelValue","title"])}}});export{$e as _};
