/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:52:22 
 */
import{d as N,r as i,g as x,k as R,o as j,m as o,j as u,a as l,y as b,i as p,K as A,v as c,_ as E,z as D,bx as H,by as K}from"./index-DMg0mq0e.js";import{i as M}from"./index-DsEIKZmm.js";import{d as O}from"./download-U6qaYcnP.js";const q={class:"el-upload__tip text-center"},G={class:"el-upload__tip"},Y=N({name:"SystemUserImportForm",__name:"UserImportForm",emits:["success"],setup(J,{expose:k,emit:y}){const d=D(),m=i(!1),a=i(!1),v=i(),$=`${void 0+void 0}/system/user/import`,g=i(),f=i([]),_=i(0);k({open:()=>{m.value=!0,w()}});const V=async()=>{if(f.value.length==0){d.error("请上传文件");return}g.value={Authorization:`Bearer ${K()}`,"tenant-id":H()},a.value=!0,v.value.submit()},F=y,C=n=>{if(n.code!==0){d.error(n.msg),a.value=!1;return}const e=n.data;let s=`上传成功数量：${e.createUsernames.length};`;for(const t of e.createUsernames)s+=`< ${t} >`;s+=`更新成功数量：${e.updateUsernames.length};`;for(const t of e.updateUsernames)s+=`< ${t} >`;s+=`更新失败数量：${Object.keys(e.failureUsernames).length};`;for(const t in e.failureUsernames)s+=`< ${t}: ${e.failureUsernames[t]} >`;d.alert(s),F("success")},T=()=>{d.error("上传失败，请您重新上传！"),a.value=!1},w=()=>{a.value=!1,v.value?.clearFiles()},B=()=>{d.error("最多只能上传一个文件！")},S=async()=>{const n=await M();O.excel(n,"用户导入模版.xls")};return(n,e)=>{const s=A,t=x("el-checkbox"),z=x("el-link"),I=x("el-upload"),U=x("el-button"),L=E;return j(),R(L,{modelValue:l(m),"onUpdate:modelValue":e[3]||(e[3]=r=>b(m)?m.value=r:null),title:"用户导入",width:"400"},{footer:o(()=>[u(U,{disabled:l(a),type:"primary",onClick:V},{default:o(()=>e[8]||(e[8]=[c("确 定")])),_:1},8,["disabled"]),u(U,{onClick:e[2]||(e[2]=r=>m.value=!1)},{default:o(()=>e[9]||(e[9]=[c("取 消")])),_:1})]),default:o(()=>[u(I,{ref_key:"uploadRef",ref:v,"file-list":l(f),"onUpdate:fileList":e[1]||(e[1]=r=>b(f)?f.value=r:null),accept:".xlsx, .xls",action:$+"?updateSupport="+l(_),"auto-upload":!1,disabled:l(a),drag:"",headers:l(g),limit:1,"on-error":T,"on-exceed":B,"on-success":C},{tip:o(()=>[p("div",q,[p("div",G,[u(t,{modelValue:l(_),"onUpdate:modelValue":e[0]||(e[0]=r=>b(_)?_.value=r:null)},null,8,["modelValue"]),e[4]||(e[4]=c(" 是否更新已经存在的用户数据 "))]),e[6]||(e[6]=p("span",null,"仅允许导入 xls、xlsx 格式文件。",-1)),u(z,{style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",underline:!1,onClick:S},{default:o(()=>e[5]||(e[5]=[c(" 下载模板 ")])),_:1})])]),default:o(()=>[u(s,{icon:"ep:upload"}),e[7]||(e[7]=p("div",{class:"el-upload__text"},[c(" 将文件拖到此处，或 "),p("em",null,"点击上传")],-1))]),_:1},8,["file-list","action","disabled","headers"])]),_:1},8,["modelValue"])}}});export{Y as _};
