/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 14:15:15 
 */
import{V as z,d as $,H as A,u as D,r as q,f as O,O as R,a as r,Y as E,g as u,w as F,Z as j,o as d,c as g,j as c,i as H,m as l,v,F as J,n as M,C as V,k as P,t as Y}from"./index-D3eRVKjp.js";import{u as Z,L as C,_ as G}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-CbdWh4hv.js";const K=m=>z.get({url:`/system/oauth2/authorize?clientId=${m}`}),Q=(m,n,h,S,k,_,t)=>{const f={};for(const a of _)f[a]=!0;for(const a of t)f[a]=!1;return z.post({url:"/system/oauth2/authorize",headers:{"Content-type":"application/x-www-form-urlencoded"},params:{response_type:m,client_id:n,redirect_uri:h,state:S,auto_approve:k,scope:JSON.stringify(f)}})},W={class:"form-cont"},X={key:0},ee={key:1},oe=$({name:"SSOLogin",__name:"SSOLogin",setup(m){const n=A(),{currentRoute:h}=D(),{getLoginState:S,setLoginState:k}=Z(),_=q({name:"",logo:""}),t=O({responseType:"",clientId:"",redirectUri:"",state:"",scopes:[]}),f=R(()=>r(S)===C.SSO),a=O({scopes:[]}),y=q(!1),I=async()=>{if(typeof n.query.client_id>"u")return;if(t.responseType=n.query.response_type,t.clientId=n.query.client_id,t.redirectUri=n.query.redirect_uri,t.state=n.query.state,n.query.scope&&(t.scopes=n.query.scope.split(" ")),t.scopes.length>0){const s=await b(!0,t.scopes,[]);if(s){location.href=s;return}}const o=await K(t.clientId);_.value=o.client;let e;if(t.scopes.length>0){e=[];for(const s of o.scopes)t.scopes.indexOf(s.key)>=0&&e.push(s)}else{e=o.scopes;for(const s of e)t.scopes.push(s.key)}for(const s of e)s.value&&a.scopes.push(s.key)},w=async o=>{let e,s;o?(e=a.scopes,s=t.scopes.filter(p=>e.indexOf(p)===-1)):(e=[],s=t.scopes),y.value=!0;try{const p=await b(!1,e,s);if(!p)return;location.href=p}finally{y.value=!1}},b=(o,e,s)=>Q(t.responseType,t.clientId,t.redirectUri,t.state,o,e,s),B=o=>{switch(o){case"user.read":return"访问你的个人信息";case"user.write":return"修改你的个人信息";default:return o}};return E(()=>h.value,o=>{o.name==="SSOLogin"&&(k(C.SSO),I())},{immediate:!0}),(o,e)=>{const s=u("el-tab-pane"),p=u("el-tabs"),N=u("el-checkbox"),T=u("el-checkbox-group"),x=u("el-form-item"),L=u("el-button"),U=u("el-form");return F((d(),g("div",W,[c(G,{style:{width:"100%"}}),c(p,{class:"form",style:{float:"none"},value:"uname"},{default:l(()=>[c(s,{label:r(_).name,name:"uname"},null,8,["label"])]),_:1}),H("div",null,[c(U,{class:"login-form",model:r(a)},{default:l(()=>[e[4]||(e[4]=v(" 此第三方应用请求获得以下权限： ")),c(x,{prop:"scopes"},{default:l(()=>[c(T,{modelValue:r(a).scopes,"onUpdate:modelValue":e[0]||(e[0]=i=>r(a).scopes=i)},{default:l(()=>[(d(!0),g(J,null,M(r(t).scopes,i=>(d(),P(N,{key:i,label:i,style:{display:"block","margin-bottom":"-10px"}},{default:l(()=>[v(Y(B(i)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(x,{class:"w-1/1"},{default:l(()=>[c(L,{class:"w-6/10",loading:r(y),type:"primary",onClick:e[1]||(e[1]=V(i=>w(!0),["prevent"]))},{default:l(()=>[r(y)?(d(),g("span",ee,"授 权 中...")):(d(),g("span",X,"同意授权"))]),_:1},8,["loading"]),c(L,{class:"w-3/10",onClick:e[2]||(e[2]=V(i=>w(!1),["prevent"]))},{default:l(()=>e[3]||(e[3]=[v("拒绝")])),_:1})]),_:1})]),_:1},8,["model"])])],512)),[[j,r(f)]])}}});export{oe as _};
