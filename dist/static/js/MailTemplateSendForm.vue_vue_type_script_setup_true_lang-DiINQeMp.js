/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{d as $,r as d,f as D,g as p,h as R,k as v,o as c,m as s,w as T,a as l,j as n,c as U,F as q,n as B,v as V,y as S,_ as L,z as N}from"./index-BdmDrM2Y.js";import{_ as z}from"./style.css_vue_type_style_index_0_src_true_lang-CMBP_pq0.js";import{g as E,s as I}from"./index-Ca1ie2u2.js";const K=$({name:"SystemMailTemplateSendForm",__name:"MailTemplateSendForm",setup(h,{expose:b}){const w=N(),m=d(!1),u=d(!1),a=d({content:"",params:{},mail:"",templateCode:"",templateParams:new Map}),f=D({mail:[{required:!0,message:"邮箱不能为空",trigger:"blur"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),i=d();b({open:async _=>{m.value=!0,P(),u.value=!0;try{const e=await E(_);a.value.content=e.content,a.value.params=e.params,a.value.templateCode=e.code,a.value.templateParams=e.params.reduce((o,r)=>(o[r]="",o),{}),f.templateParams=e.params.reduce((o,r)=>(o[r]={required:!0,message:`参数 ${r} 不能为空`,trigger:"blur"},o),{})}finally{u.value=!1}}});const C=async()=>{if(!(!i||!await i.value.validate())){u.value=!0;try{const e=a.value,o=await I(e);o&&w.success(`提交发送成功！发送结果，见发送日志编号：${o}`),m.value=!1}finally{u.value=!1}}},P=()=>{a.value={content:"",params:{},mail:"",templateCode:"",templateParams:new Map},f.templateParams={},i.value?.resetFields()};return(_,e)=>{const o=z,r=p("el-form-item"),g=p("el-input"),k=p("el-form"),y=p("el-button"),x=L,F=R("loading");return c(),v(x,{modelValue:l(m),"onUpdate:modelValue":e[2]||(e[2]=t=>S(m)?m.value=t:null),title:"测试"},{footer:s(()=>[n(y,{disabled:l(u),type:"primary",onClick:C},{default:s(()=>e[3]||(e[3]=[V("确 定")])),_:1},8,["disabled"]),n(y,{onClick:e[1]||(e[1]=t=>m.value=!1)},{default:s(()=>e[4]||(e[4]=[V("取 消")])),_:1})]),default:s(()=>[T((c(),v(k,{ref_key:"formRef",ref:i,"label-width":"120px",model:l(a),rules:l(f)},{default:s(()=>[n(r,{label:"模板内容",prop:"content"},{default:s(()=>[n(o,{height:"150px","model-value":l(a).content,readonly:""},null,8,["model-value"])]),_:1}),n(r,{label:"收件邮箱",prop:"mail"},{default:s(()=>[n(g,{modelValue:l(a).mail,"onUpdate:modelValue":e[0]||(e[0]=t=>l(a).mail=t),placeholder:"请输入收件邮箱"},null,8,["modelValue"])]),_:1}),(c(!0),U(q,null,B(l(a).params,t=>(c(),v(r,{key:t,label:"参数 {"+t+"}",prop:"templateParams."+t},{default:s(()=>[n(g,{modelValue:l(a).templateParams[t],"onUpdate:modelValue":M=>l(a).templateParams[t]=M,placeholder:"请输入 "+t+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])),[[F,l(u)]])]),_:1},8,["modelValue"])}}});export{K as _};
