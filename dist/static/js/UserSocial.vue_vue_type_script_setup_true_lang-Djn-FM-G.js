/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 13:49:10 
 */
import{_ as w}from"./XTextButton-wOb7MTWD.js";import{S as y}from"./constants-BPQb3nxh.js";import{g as V}from"./profile-JFR8_PDQ.js";import{V as f,d as q,r as _,H as I,b as T,Y as j,g as U,k as E,o as m,m as p,j as r,i as g,t as F,c as h,F as v,v as b,a as M,z as P}from"./index-BW9ifGp0.js";const z=(a,o,l)=>f.post({url:"/system/social-user/bind",data:{type:a,code:o,state:l}}),A=(a,o)=>f.delete({url:"/system/social-user/unbind",data:{type:a,openid:o}}),D=(a,o)=>f.get({url:`/system/auth/social-auth-redirect?type=${a}&redirectUri=${o}`}),H=["src"],L={class:"mr-5"},K=q({name:"UserSocial",__name:"UserSocial",props:{activeName:{}},emits:["update:activeName"],setup(a,{emit:o}){const l=P(),u=_([]),i=_(),k=async()=>{u.value=[];const e=await V();i.value=e;for(const t in y){const s={...y[t]};if(u.value.push(s),i.value?.socialUsers){for(const c in i.value.socialUsers)if(s.type===i.value.socialUsers[c].type){s.openid=i.value.socialUsers[c].openid;break}}}},d=I(),C=o,S=()=>{const e=$("type"),t=d.query.code,s=d.query.state;t&&z(e,t,s).then(()=>{l.success("绑定成功"),C("update:activeName","userSocial")})};function $(e){return new URL(decodeURIComponent(location.href)).searchParams.get(e)??""}const x=e=>{const t=`${location.origin}/user/profile?${encodeURIComponent(`type=${e.type}`)}`;D(e.type,encodeURIComponent(t)).then(s=>{window.location.href=s})},B=async e=>{await A(e.type,e.openid)&&(e.openid=void 0),l.success("解绑成功")};return T(async()=>{await k()}),j(()=>d,()=>{S()},{immediate:!0}),(e,t)=>{const s=U("el-table-column"),c=w,N=U("el-table");return m(),E(N,{data:M(u),"show-header":!1},{default:p(()=>[r(s,{fixed:"left",title:"序号",type:"seq",width:"60"}),r(s,{align:"left",label:"社交平台",width:"120"},{default:p(({row:n})=>[g("img",{alt:"",class:"h-5 align-middle",src:n.img},null,8,H),g("p",L,F(n.title),1)]),_:1}),r(s,{align:"center",label:"操作"},{default:p(({row:n})=>[n.openid?(m(),h(v,{key:0},[t[0]||(t[0]=b(" 已绑定 ")),r(c,{class:"mr-5",title:"(解绑)",type:"primary",onClick:R=>B(n)},null,8,["onClick"])],64)):(m(),h(v,{key:1},[t[1]||(t[1]=b(" 未绑定 ")),r(c,{class:"mr-5",title:"(绑定)",type:"primary",onClick:R=>x(n)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}}});export{K as _};
