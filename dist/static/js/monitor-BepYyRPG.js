/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 10:14:51 
 */
import{d2 as Zc,d as qn,aZ as lo,c as Vr,k as Jc,o as Ir,p as eh,U as _n,i as xe,t as th,m as Ee,a as ur,A as zo,bR as Di,r as Gn,Y as rh,b as ih,B as nh,f as uo,I as ah,cZ as sh,g as _t,j as ve,y as fo,F as oh,n as lh,v as $e}from"./index-BuFigy1A.js";import{_ as uh}from"./index-By-WKUMt.js";var fh=0;function ch(y){var m=++fh;return Zc(y)+m}const hh={key:1,class:"vab-fieldset"},dh=qn({name:"VabDivider",__name:"index",props:{...lo.props,blockquote:{type:Boolean,default:!1},fieldset:{type:Boolean,default:!1},type:{type:String,default:"primary"},isBorder:{type:Boolean,default:!1},title:{type:String,default:""}},setup(y){return(m,d)=>y.blockquote?(Ir(),Vr("blockquote",{key:0,class:eh(["vab-blockquote",y.isBorder?"vab-blockquote-"+y.type+" is-border":"vab-blockquote-"+y.type])},[_n(m.$slots,"default",{},void 0,!0)],2)):y.fieldset?(Ir(),Vr("fieldset",hh,[xe("legend",null,th(y.title),1),_n(m.$slots,"default",{},void 0,!0)])):(Ir(),Jc(ur(lo),{key:2,"border-style":m.borderStyle,"content-position":m.contentPosition,direction:m.direction},{default:Ee(()=>[_n(m.$slots,"default",{},void 0,!0)]),_:3},8,["border-style","content-position","direction"]))}}),vh=zo(dh,[["__scopeId","data-v-efa63d73"]]);function co(y,m){var d=Object.keys(y);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(y);m&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(y,e).enumerable})),d.push.apply(d,n)}return d}function Xe(y){for(var m=1;m<arguments.length;m++){var d=arguments[m]!=null?arguments[m]:{};m%2?co(Object(d),!0).forEach(function(n){q(y,n,d[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(d)):co(Object(d)).forEach(function(n){Object.defineProperty(y,n,Object.getOwnPropertyDescriptor(d,n))})}return y}function dt(y){"@babel/helpers - typeof";return dt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},dt(y)}function ce(y,m){if(!(y instanceof m))throw new TypeError("Cannot call a class as a function")}function ho(y,m){for(var d=0;d<m.length;d++){var n=m[d];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(y,$o(n.key),n)}}function he(y,m,d){return m&&ho(y.prototype,m),d&&ho(y,d),Object.defineProperty(y,"prototype",{writable:!1}),y}function q(y,m,d){return m=$o(m),m in y?Object.defineProperty(y,m,{value:d,enumerable:!0,configurable:!0,writable:!0}):y[m]=d,y}function me(y,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(m&&m.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),m&&Vn(y,m)}function Te(y){return Te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},Te(y)}function Vn(y,m){return Vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},Vn(y,m)}function gh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function K(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function Xn(y,m){if(m&&(typeof m=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return K(y)}function ye(y){var m=gh();return function(){var n=Te(y),e;if(m){var s=Te(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return Xn(this,e)}}function ph(y,m){for(;!Object.prototype.hasOwnProperty.call(y,m)&&(y=Te(y),y!==null););return y}function _e(){return typeof Reflect<"u"&&Reflect.get?_e=Reflect.get.bind():_e=function(m,d,n){var e=ph(m,d);if(e){var s=Object.getOwnPropertyDescriptor(e,d);return s.get?s.get.call(arguments.length<3?m:n):s.value}},_e.apply(this,arguments)}function wt(y){return mh(y)||yh(y)||Eh(y)||Th()}function mh(y){if(Array.isArray(y))return Kn(y)}function yh(y){if(typeof Symbol<"u"&&y[Symbol.iterator]!=null||y["@@iterator"]!=null)return Array.from(y)}function Eh(y,m){if(y){if(typeof y=="string")return Kn(y,m);var d=Object.prototype.toString.call(y).slice(8,-1);if(d==="Object"&&y.constructor&&(d=y.constructor.name),d==="Map"||d==="Set")return Array.from(y);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return Kn(y,m)}}function Kn(y,m){(m==null||m>y.length)&&(m=y.length);for(var d=0,n=new Array(m);d<m;d++)n[d]=y[d];return n}function Th(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sh(y,m){if(typeof y!="object"||y===null)return y;var d=y[Symbol.toPrimitive];if(d!==void 0){var n=d.call(y,m);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(y)}function $o(y){var m=Sh(y,"string");return typeof m=="symbol"?m:String(m)}var bn={exports:{}},vo;function xh(){return vo||(vo=1,function(y){var m=Object.prototype.hasOwnProperty,d="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(d=!1));function e(T,S,C){this.fn=T,this.context=S,this.once=C||!1}function s(T,S,C,R,F){if(typeof C!="function")throw new TypeError("The listener must be a function");var B=new e(C,R||T,F),U=d?d+S:S;return T._events[U]?T._events[U].fn?T._events[U]=[T._events[U],B]:T._events[U].push(B):(T._events[U]=B,T._eventsCount++),T}function c(T,S){--T._eventsCount===0?T._events=new n:delete T._events[S]}function v(){this._events=new n,this._eventsCount=0}v.prototype.eventNames=function(){var S=[],C,R;if(this._eventsCount===0)return S;for(R in C=this._events)m.call(C,R)&&S.push(d?R.slice(1):R);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(C)):S},v.prototype.listeners=function(S){var C=d?d+S:S,R=this._events[C];if(!R)return[];if(R.fn)return[R.fn];for(var F=0,B=R.length,U=new Array(B);F<B;F++)U[F]=R[F].fn;return U},v.prototype.listenerCount=function(S){var C=d?d+S:S,R=this._events[C];return R?R.fn?1:R.length:0},v.prototype.emit=function(S,C,R,F,B,U){var W=d?d+S:S;if(!this._events[W])return!1;var z=this._events[W],ne=arguments.length,te,J;if(z.fn){switch(z.once&&this.removeListener(S,z.fn,void 0,!0),ne){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,C),!0;case 3:return z.fn.call(z.context,C,R),!0;case 4:return z.fn.call(z.context,C,R,F),!0;case 5:return z.fn.call(z.context,C,R,F,B),!0;case 6:return z.fn.call(z.context,C,R,F,B,U),!0}for(J=1,te=new Array(ne-1);J<ne;J++)te[J-1]=arguments[J];z.fn.apply(z.context,te)}else{var Le=z.length,pe;for(J=0;J<Le;J++)switch(z[J].once&&this.removeListener(S,z[J].fn,void 0,!0),ne){case 1:z[J].fn.call(z[J].context);break;case 2:z[J].fn.call(z[J].context,C);break;case 3:z[J].fn.call(z[J].context,C,R);break;case 4:z[J].fn.call(z[J].context,C,R,F);break;default:if(!te)for(pe=1,te=new Array(ne-1);pe<ne;pe++)te[pe-1]=arguments[pe];z[J].fn.apply(z[J].context,te)}}return!0},v.prototype.on=function(S,C,R){return s(this,S,C,R,!1)},v.prototype.once=function(S,C,R){return s(this,S,C,R,!0)},v.prototype.removeListener=function(S,C,R,F){var B=d?d+S:S;if(!this._events[B])return this;if(!C)return c(this,B),this;var U=this._events[B];if(U.fn)U.fn===C&&(!F||U.once)&&(!R||U.context===R)&&c(this,B);else{for(var W=0,z=[],ne=U.length;W<ne;W++)(U[W].fn!==C||F&&!U[W].once||R&&U[W].context!==R)&&z.push(U[W]);z.length?this._events[B]=z.length===1?z[0]:z:c(this,B)}return this},v.prototype.removeAllListeners=function(S){var C;return S?(C=d?d+S:S,this._events[C]&&c(this,C)):(this._events=new n,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=d,v.EventEmitter=v,y.exports=v}(bn)),bn.exports}var qo=xh();const Xo=Di(qo);var _h=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,Ln={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},Cn="%c[xgplayer]",we={config:{debug:_h?3:0},logInfo:function(m){for(var d,n=arguments.length,e=new Array(n>1?n-1:0),s=1;s<n;s++)e[s-1]=arguments[s];this.config.debug>=3&&(d=console).log.apply(d,[Cn,Ln.info,m].concat(e))},logWarn:function(m){for(var d,n=arguments.length,e=new Array(n>1?n-1:0),s=1;s<n;s++)e[s-1]=arguments[s];this.config.debug>=1&&(d=console).warn.apply(d,[Cn,Ln.warn,m].concat(e))},logError:function(m){var d;if(!(this.config.debug<1)){for(var n=this.config.debug>=2?"trace":"error",e=arguments.length,s=new Array(e>1?e-1:0),c=1;c<e;c++)s[c-1]=arguments[c];(d=console)[n].apply(d,[Cn,Ln.error,m].concat(s))}}};function bh(y){y.logInfo=we.logInfo.bind(y),y.logWarn=we.logWarn.bind(y),y.logError=we.logError.bind(y)}var Lh=function(){function y(m){ce(this,y),this.bufferedList=m}return he(y,[{key:"start",value:function(d){return this.bufferedList[d].start}},{key:"end",value:function(d){return this.bufferedList[d].end}},{key:"length",get:function(){return this.bufferedList.length}}]),y}(),A={};A.createDom=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(y);return e.className=n,e.innerHTML=m,Object.keys(d).forEach(function(s){var c=s,v=d[s];y==="video"||y==="audio"||y==="live-video"?v&&e.setAttribute(c,v):e.setAttribute(c,v)}),e};A.createDomFromHtml=function(y){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";try{var n=document.createElement("div");n.innerHTML=y;var e=n.children;return n=null,e.length>0?(e=e[0],d&&A.addClass(e,d),m&&Object.keys(m).forEach(function(s){e.setAttribute(s,m[s])}),e):null}catch(s){return we.logError("util.createDomFromHtml",s),null}};A.hasClass=function(y,m){if(!y||!m)return!1;try{return Array.prototype.some.call(y.classList,function(n){return n===m})}catch{var d=y.className&&dt(y.className)==="object"?y.getAttribute("class"):y.className;return d&&!!d.match(new RegExp("(\\s|^)"+m+"(\\s|$)"))}};A.addClass=function(y,m){if(!(!y||!m))try{m.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(d){d&&y.classList.add(d)})}catch{A.hasClass(y,m)||(y.className&&dt(y.className)==="object"?y.setAttribute("class",y.getAttribute("class")+" "+m):y.className+=" "+m)}};A.removeClass=function(y,m){if(!(!y||!m))try{m.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(d){d&&y.classList.remove(d)})}catch{A.hasClass(y,m)&&m.split(/\s+/g).forEach(function(n){var e=new RegExp("(\\s|^)"+n+"(\\s|$)");y.className&&dt(y.className)==="object"?y.setAttribute("class",y.getAttribute("class").replace(e," ")):y.className=y.className.replace(e," ")})}};A.toggleClass=function(y,m){y&&m.split(/\s+/g).forEach(function(d){A.hasClass(y,d)?A.removeClass(y,d):A.addClass(y,d)})};A.classNames=function(){for(var y=arguments,m=[],d=function(s){A.typeOf(y[s])==="String"?m.push(y[s]):A.typeOf(y[s])==="Object"&&Object.keys(y[s]).map(function(c){y[s][c]&&m.push(c)})},n=0;n<arguments.length;n++)d(n);return m.join(" ")};A.findDom=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,m=arguments.length>1?arguments[1]:void 0,d;try{d=y.querySelector(m)}catch(n){we.logError("util.findDom",n),m.indexOf("#")===0&&(d=y.getElementById(m.slice(1)))}return d};A.getCss=function(y,m){return y.currentStyle?y.currentStyle[m]:document.defaultView.getComputedStyle(y,!1)[m]};A.padStart=function(y,m,d){for(var n=String(d),e=m>>0,s=Math.ceil(e/n.length),c=[],v=String(y);s--;)c.push(n);return c.join("").substring(0,e-v.length)+v};A.format=function(y){if(window.isNaN(y))return"";y=Math.round(y);var m=A.padStart(Math.floor(y/3600),2,0),d=A.padStart(Math.floor((y-m*3600)/60),2,0),n=A.padStart(Math.floor(y-m*3600-d*60),2,0);return(m==="00"?[d,n]:[m,d,n]).join(":")};A.event=function(y){if(y.touches){var m=y.touches[0]||y.changedTouches[0];y.clientX=m.clientX||0,y.clientY=m.clientY||0,y.offsetX=m.pageX-m.target.offsetLeft,y.offsetY=m.pageY-m.target.offsetTop}y._target=y.target||y.srcElement};A.typeOf=function(y){return Object.prototype.toString.call(y).match(/([^\s.*]+)(?=]$)/g)[0]};A.deepCopy=function(y,m){if(A.typeOf(m)==="Object"&&A.typeOf(y)==="Object")return Object.keys(m).forEach(function(d){A.typeOf(m[d])==="Object"&&!(m[d]instanceof Node)?y[d]===void 0||y[d]===void 0?y[d]=m[d]:A.deepCopy(y[d],m[d]):A.typeOf(m[d])==="Array"?y[d]=A.typeOf(y[d])==="Array"?y[d].concat(m[d]):m[d]:y[d]=m[d]}),y};A.deepMerge=function(y,m){return Object.keys(m).map(function(d){if(A.typeOf(m[d])==="Array"&&A.typeOf(y[d])==="Array"){if(A.typeOf(y[d])==="Array"){var n;(n=y[d]).push.apply(n,wt(m[d]))}}else A.typeOf(y[d])===A.typeOf(m[d])&&y[d]!==null&&A.typeOf(y[d])==="Object"&&!(m[d]instanceof window.Node)?A.deepMerge(y[d],m[d]):m[d]!==null&&(y[d]=m[d])}),y};A.getBgImage=function(y){var m=(y.currentStyle||window.getComputedStyle(y,null)).backgroundImage;if(!m||m==="none")return"";var d=document.createElement("a");return d.href=m.replace(/url\("|"\)/g,""),d.href};A.copyDom=function(y){if(y&&y.nodeType===1){var m=document.createElement(y.tagName);return Array.prototype.forEach.call(y.attributes,function(d){m.setAttribute(d.name,d.value)}),y.innerHTML&&(m.innerHTML=y.innerHTML),m}else return""};A.setInterval=function(y,m,d,n){y._interval[m]||(y._interval[m]=window.setInterval(d.bind(y),n))};A.clearInterval=function(y,m){clearInterval(y._interval[m]),y._interval[m]=null};A.setTimeout=function(y,m,d){y._timers||(y._timers=[]);var n=setTimeout(function(){m(),A.clearTimeout(y,n)},d);return y._timers.push(n),n};A.clearTimeout=function(y,m){var d=y._timers;if(A.typeOf(d)==="Array"){for(var n=0;n<d.length;n++)if(d[n]===m){d.splice(n,1),clearTimeout(m);break}}else clearTimeout(m)};A.clearAllTimers=function(y){var m=y._timers;A.typeOf(m)==="Array"&&(m.map(function(d){clearTimeout(d)}),y._timerIds=[])};A.createImgBtn=function(y,m,d,n){var e=A.createDom("xg-".concat(y),"",{},"xgplayer-".concat(y,"-img"));if(e.style.backgroundImage='url("'.concat(m,'")'),d&&n){var s,c,v;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(T){return d.indexOf(T)>-1&&n.indexOf(T)>-1?(s=parseFloat(d.slice(0,d.indexOf(T)).trim()),c=parseFloat(n.slice(0,n.indexOf(T)).trim()),v=T,!1):!0}),e.style.width="".concat(s).concat(v),e.style.height="".concat(c).concat(v),e.style.backgroundSize="".concat(s).concat(v," ").concat(c).concat(v),y==="start"?e.style.margin="-".concat(c/2).concat(v," auto auto -").concat(s/2).concat(v):e.style.margin="auto 5px auto 5px"}return e};A.Hex2RGBA=function(y,m){var d=[];if(/^\#[0-9A-F]{3}$/i.test(y)){var n="#";y.replace(/[0-9A-F]/ig,function(e){n+=e+e}),y=n}return/^#[0-9A-F]{6}$/i.test(y)?(y.replace(/[0-9A-F]{2}/ig,function(e){d.push(parseInt(e,16))}),"rgba(".concat(d.join(","),", ").concat(m,")")):"rgba(255, 255, 255, 0.1)"};A.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement};A.checkIsFunction=function(y){return y&&typeof y=="function"};A.checkIsObject=function(y){return y!==null&&dt(y)==="object"};A.hide=function(y){y.style.display="none"};A.show=function(y,m){y.style.display=m||"block"};A.isUndefined=function(y){if(typeof y>"u"||y===null)return!0};A.isNotNull=function(y){return y!=null};A.setStyleFromCsstext=function(y,m){if(m)if(A.typeOf(m)==="String"){var d=m.replace(/\s+/g,"").split(";");d.map(function(n){if(n){var e=n.split(":");e.length>1&&(y.style[e[0]]=e[1])}})}else Object.keys(m).map(function(n){y.style[n]=m[n]})};function Ch(y,m){for(var d=0,n=m.length;d<n;d++)if(y.indexOf(m[d])>-1)return!0;return!1}A.filterStyleFromText=function(y){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],d=y.style.cssText;if(!d)return{};var n=d.replace(/\s+/g,"").split(";"),e={},s={};return n.map(function(c){if(c){var v=c.split(":");v.length>1&&(Ch(v[0],m)?e[v[0]]=v[1]:s[v[0]]=v[1])}}),y.setAttribute("style",""),Object.keys(s).map(function(c){y.style[c]=s[c]}),e};A.getStyleFromCsstext=function(y){var m=y.style.cssText;if(!m)return{};var d=m.replace(/\s+/g,"").split(";"),n={};return d.map(function(e){if(e){var s=e.split(":");s.length>1&&(n[s[0]]=s[1])}}),n};A.preloadImg=function(y){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(y){var n=new window.Image;n.onload=function(e){n=null,m&&m(e)},n.onerror=function(e){n=null,d&&d(e)},n.src=y}};A.stopPropagation=function(y){y&&y.stopPropagation()};A.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0};A.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0};A.checkTouchSupport=function(){return"ontouchstart"in window};A.getBuffered2=function(y){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,d=[],n=0;n<y.length;n++)d.push({start:y.start(n)<.5?0:y.start(n),end:y.end(n)});d.sort(function(T,S){var C=T.start-S.start;return C||S.end-T.end});var e=[];if(m)for(var s=0;s<d.length;s++){var c=e.length;if(c){var v=e[c-1].end;d[s].start-v<m?d[s].end>v&&(e[c-1].end=d[s].end):e.push(d[s])}else e.push(d[s])}else e=d;return new Lh(e)};A.getEventPos=function(y){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return y.touches&&y.touches.length>0&&(y=y.touches[0]),{x:y.x/m,y:y.y/m,clientX:y.clientX/m,clientY:y.clientY/m,offsetX:y.offsetX/m,offsetY:y.offsetY/m,pageX:y.pageX/m,pageY:y.pageY/m}};A.requestAnimationFrame=function(y){var m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(m)return m(y)};A.getHostFromUrl=function(y){if(A.typeOf(y)!=="String")return"";var m=y.split("/"),d="";return m.length>3&&m[2]&&(d=m[2]),d};A.cancelAnimationFrame=function(y){var m=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;m&&m(y)};A.isMSE=function(y){return y.media&&(y=y.media),!y||!(y instanceof HTMLMediaElement)?!1:/^blob/.test(y.currentSrc)||/^blob/.test(y.src)};A.isBlob=function(y){return typeof y=="string"&&/^blob/.test(y)};A.generateSessionId=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=new Date().getTime();try{y=parseInt(y)}catch{y=0}m+=y,window.performance&&typeof window.performance.now=="function"&&(m+=parseInt(window.performance.now()));var d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=(m+Math.random()*16)%16|0;return m=Math.floor(m/16),(n==="x"?e:e&3|8).toString(16)});return d};A.createEvent=function(y){var m;return typeof window.Event=="function"?m=new Event(y):(m=document.createEvent("Event"),m.initEvent(y,!0,!0)),m};A.adjustTimeByDuration=function(y,m,d){return!m||!y?y:y>m||d&&y<m?m:y};A.createPositionBar=function(y,m){var d=A.createDom("xg-bar","",{"data-index":-1},y);return m.appendChild(d),d};A.getTransformStyle=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{x:0,y:0,scale:1,rotate:0},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",d={scale:"".concat(y.scale||1),translate:"".concat(y.x||0,"%, ").concat(y.y||0,"%"),rotate:"".concat(y.rotate||0,"deg")},n=Object.keys(d);return n.forEach(function(e){var s=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),c="".concat(e,"(").concat(d[e],")");s.test(m)?(s.lastIndex=-1,m=m.replace(s,c)):m+="".concat(c," ")}),m};A.convertDeg=function(y){return Math.abs(y)<=1?y*360:y%360};A.getIndexByTime=function(y,m){var d=m.length,n=-1;if(d<1)return n;if(y<=m[0].end||d<2)n=0;else if(y>m[d-1].end)n=d-1;else for(var e=1;e<d;e++)if(y>m[e-1].end&&y<=m[e].end){n=e;break}return n};A.getOffsetCurrentTime=function(y,m){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,n=-1;if(d>=0&&d<m.length?n=d:n=A.getIndexByTime(y,m),n<0)return-1;var e=m.length,s=m[n],c=s.start,v=s.end,T=s.cTime,S=s.offset;return y<c?T:y>=c&&y<=v?y-S:y>v&&n>=e-1?v:-1};A.getCurrentTimeByOffset=function(y,m){var d=-1;if(!m||m.length<0)return y;for(var n=0;n<m.length;n++)if(y<=m[n].duration){d=n;break}if(d!==-1){var e=m[d].start;return d-1<0?e+y:e+(y-m[d-1].duration)}return y};function Qo(y){var m=dt(y);return y!==null&&(m==="object"||m==="function")}function Ah(y,m,d){var n,e,s,c,v,T,S=0,C=!1,R=!1,F=!0,B=!m&&m!==0&&typeof window.requestAnimationFrame=="function";if(typeof y!="function")throw new TypeError("Expected a function");m=+m||0,Qo(d)&&(C=!!d.leading,R="maxWait"in d,s=R?Math.max(+d.maxWait||0,m):s,F="trailing"in d?!!d.trailing:F);function U(ge){var at=n,Tt=e;return n=e=void 0,S=ge,c=y.apply(Tt,at),c}function W(ge,at){return B?(window.cancelAnimationFrame(v),window.requestAnimationFrame(ge)):setTimeout(ge,at)}function z(ge){if(B)return window.cancelAnimationFrame(ge);clearTimeout(ge)}function ne(ge){return S=ge,v=W(Le,m),C?U(ge):c}function te(ge){var at=ge-T,Tt=ge-S,ft=m-at;return R?Math.min(ft,s-Tt):ft}function J(ge){var at=ge-T,Tt=ge-S;return T===void 0||at>=m||at<0||R&&Tt>=s}function Le(){var ge=Date.now();if(J(ge))return pe(ge);v=W(Le,te(ge))}function pe(ge){return v=void 0,F&&n?U(ge):(n=e=void 0,c)}function De(){v!==void 0&&z(v),S=0,n=T=e=v=void 0}function Re(){return v===void 0?c:pe(Date.now())}function je(){return v!==void 0}function Ve(){for(var ge=Date.now(),at=J(ge),Tt=arguments.length,ft=new Array(Tt),ae=0;ae<Tt;ae++)ft[ae]=arguments[ae];if(n=ft,e=this,T=ge,at){if(v===void 0)return ne(T);if(R)return v=W(Le,m),U(T)}return v===void 0&&(v=W(Le,m)),c}return Ve.cancel=De,Ve.flush=Re,Ve.pending=je,Ve}function kh(y,m,d){var n=!0,e=!0;if(typeof y!="function")throw new TypeError("Expected a function");return Qo(d)&&(n="leading"in d?!!d.leading:n,e="trailing"in d?!!d.trailing:e),Ah(y,m,{leading:n,trailing:e,maxWait:m})}function Rh(){var y=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return y==="zh-cn"&&(y="zh"),y}function Ih(y,m,d){if(y){var n=y.getAttribute(d);return!!(n&&n===m&&(y.tagName==="VIDEO"||y.tagName==="AUDIO"))}}var go={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},Ph=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],Ae={get device(){var y=Ae.os;return y.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var y=navigator.userAgent.toLowerCase(),m={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(m).filter(function(d){return m[d].test(y)}))[0]},get os(){if(typeof navigator>"u")return{};var y=navigator.userAgent,m=/(?:Windows Phone)/.test(y),d=/(?:SymbianOS)/.test(y)||m,n=/(?:Android)/.test(y),e=/(?:Firefox)/.test(y),s=/(?:iPad|PlayBook)/.test(y)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,c=s||n&&!/(?:Mobile)/.test(y)||e&&/(?:Tablet)/.test(y),v=/(?:iPhone)/.test(y)&&!c,T=!v&&!n&&!d&&!c;return{isTablet:c,isPhone:v,isIpad:s,isIos:v||s,isAndroid:n,isPc:T,isSymbian:d,isWindowsPhone:m,isFireFox:e}},get osVersion(){if(typeof navigator>"u")return 0;var y=navigator.userAgent,m="";/(?:iPhone)|(?:iPad|PlayBook)/.test(y)?m=go.ios:m=go.android;var d=m?m.exec(y):[];if(d&&d.length>=3){var n=d[2].split(".");return n.length>0?parseInt(n[0]):0}return 0},get isWeixin(){if(typeof navigator>"u")return!1;var y=/(micromessenger)\/([\d.]+)/,m=y.exec(navigator.userAgent.toLocaleLowerCase());return!!m},isSupportMP4:function(){var m={isSupport:!1,mime:""};if(typeof document>"u")return m;if(this.supportResult)return this.supportResult;var d=document.createElement("video");return typeof d.canPlayType=="function"&&Ph.map(function(n){d.canPlayType('video/mp4; codecs="'.concat(n,'"'))==="probably"&&(m.isSupport=!0,m.mime+="||".concat(n))}),this.supportResult=m,d=null,m},isMSESupport:function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(m)}catch(d){return this._logger.error(m,d),!1}},isHevcSupported:function(){return typeof MediaSource>"u"||!MediaSource.isTypeSupported?!1:MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function(m){var d={supported:!1,smooth:!1,powerEfficient:!1};if(!m||typeof navigator>"u")return Promise.resolve(d);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(m);var n=m.video||{},e=m.audio||{};try{var s=MediaSource.isTypeSupported(n.contentType),c=MediaSource.isTypeSupported(e.contentType);return Promise.resolve({supported:s&&c,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(d)}}},Wn="3.0.21",po={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},mo={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},xi=he(function y(m){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};ce(this,y);var n=m&&m.i18n?m.i18n.ERROR_TYPES:null;if(m.media){var e=d.mediaError?d.mediaError:m.media.error||{},s=m.duration,c=m.currentTime,v=m.ended,T=m.src,S=m.currentSrc,C=m.media,R=C.readyState,F=C.networkState,B=d.errorCode||e.code;mo[B]&&(B=mo[B]);var U={playerVersion:Wn,currentTime:c,duration:s,ended:v,readyState:R,networkState:F,src:T||S,errorType:d.errorType,errorCode:B,message:d.errorMessage||e.message,mediaError:e,originError:d.originError?d.originError.stack:"",host:A.getHostFromUrl(T||S)};return d.ext&&Object.keys(d.ext).map(function(te){U[te]=d.ext[te]}),U}else if(arguments.length>1){for(var W={playerVersion:Wn,domain:document.domain},z=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],ne=0;ne<arguments.length;ne++)W[z[ne]]=arguments[ne];return W.ex=n?(n[arguments[0]]||{}).msg:"",W}}),Ct="play",Qn="playing",cr="ended",Pr="pause",Wr="error",Oi="seeking",$t="seeked",Lt="timeupdate",jr="waiting",zt="canplay",wh="canplaythrough",Xt="durationchange",Zo="volumechange",qt="loadeddata",Dh="loadedmetadata",Jo="ratechange",el="progress",Zn="loadstart",hr="emptied",Oh="stalled",Mh="suspend",Fh="abort",Nh="bufferedChange",Jn="focus",tl="blur",ea="ready",rl="urlNull",fr="autoplay_started",ta="autoplay_was_prevented",Mi="complete",_i="replay",ra="destroy",Yr="urlchange",jn="download_speed_change",il="leaveplayer",nl="enterplayer",al="loading",Yt="fullscreen_change",bi="cssFullscreen_change",Li="mini_state_change",ia="definition_change",Bh="before_definition_change",Yn="after_definition_change",Uh="SEI_PARSED",Hh="retry",ar="video_resize",zn="pip_change",sl="rotate",ol="screenShot",Ci="playnext",ll="shortcut",ul="xglog",Ai="user_action",Fi="reset",fl="source_error",cl="source_success",Gh="switch_subtitle",hl=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],dl={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},vl="fps_stuck";const Vh=Object.freeze(Object.defineProperty({__proto__:null,ABORT:Fh,AFTER_DEFINITION_CHANGE:Yn,AUTOPLAY_PREVENTED:ta,AUTOPLAY_STARTED:fr,BEFORE_DEFINITION_CHANGE:Bh,BUFFER_CHANGE:Nh,CANPLAY:zt,CANPLAY_THROUGH:wh,COMPLETE:Mi,CSS_FULLSCREEN_CHANGE:bi,DEFINITION_CHANGE:ia,DESTROY:ra,DOWNLOAD_SPEED_CHANGE:jn,DURATION_CHANGE:Xt,EMPTIED:hr,ENDED:cr,ENTER_PLAYER:nl,ERROR:Wr,FPS_STUCK:vl,FULLSCREEN_CHANGE:Yt,LEAVE_PLAYER:il,LOADED_DATA:qt,LOADED_METADATA:Dh,LOADING:al,LOAD_START:Zn,MINI_STATE_CHANGE:Li,PAUSE:Pr,PIP_CHANGE:zn,PLAY:Ct,PLAYER_BLUR:tl,PLAYER_FOCUS:Jn,PLAYING:Qn,PLAYNEXT:Ci,PROGRESS:el,RATE_CHANGE:Jo,READY:ea,REPLAY:_i,RESET:Fi,RETRY:Hh,ROTATE:sl,SCREEN_SHOT:ol,SEEKED:$t,SEEKING:Oi,SEI_PARSED:Uh,SHORTCUT:ll,SOURCE_ERROR:fl,SOURCE_SUCCESS:cl,STALLED:Oh,STATS_EVENTS:dl,SUSPEND:Mh,SWITCH_SUBTITLE:Gh,TIME_UPDATE:Lt,URL_CHANGE:Yr,URL_NULL:rl,USER_ACTION:Ai,VIDEO_EVENTS:hl,VIDEO_RESIZE:ar,VOLUME_CHANGE:Zo,WAITING:jr,XGLOG:ul},Symbol.toStringTag,{value:"Module"}));function An(y,m){!this||!this.emit||(y==="error"?this.errorHandler(y,m.error):this.emit(y,m))}function Kh(y,m){return function(d,n){var e={player:m,eventName:y,originalEvent:d,detail:d.detail||{},timeStamp:d.timeStamp,currentTime:m.currentTime,duration:m.duration,paused:m.paused,ended:m.ended,isInternalOp:!!m._internalOp[d.type],muted:m.muted,volume:m.volume,host:A.getHostFromUrl(m.currentSrc),vtype:m.vtype};if(m.removeInnerOP(d.type),y==="timeupdate"&&(m._currentTime=m.media&&m.media.currentTime),y==="ratechange"){var s=m.media?m.media.playbackRate:0;if(s&&m._rate===s)return;m._rate=m.media&&m.media.playbackRate}if(y==="durationchange"&&(m._duration=m.media.duration),y==="volumechange"&&(e.isMutedChange=m._lastMuted!==m.muted,m._lastMuted=m.muted),y==="error"&&(e.error=n||m.video.error),m.mediaEventMiddleware[y]){var c=An.bind(m,y,e);try{m.mediaEventMiddleware[y].call(m,e,c)}catch(v){throw An.call(m,y,e),v}}else An.call(m,y,e)}}var Wh=function(y){me(d,y);var m=ye(d);function d(n){var e;ce(this,d),e=m.call(this,n),e._hasStart=!1,e._currentTime=0,e._duration=0,e._internalOp={},e._lastMuted=!1,e.vtype="MP4",e._rate=-1,e.mediaConfig=Object.assign({},{controls:!1,autoplay:n.autoplay,playsinline:n.playsinline,"x5-playsinline":n.playsinline,"webkit-playsinline":n.playsinline,"x5-video-player-fullscreen":n["x5-video-player-fullscreen"]||n.x5VideoPlayerFullscreen,"x5-video-orientation":n["x5-video-orientation"]||n.x5VideoOrientation,airplay:n.airplay,"webkit-airplay":n.airplay,tabindex:n.tabindex|0,mediaType:n.mediaType||"video","data-index":-1},n.videoConfig,n.videoAttributes);var s=n["x5-video-player-type"]||n.x5VideoPlayerType;return Ae.isWeixin&&Ae.os.isAndroid&&s&&(e.mediaConfig["x5-video-player-type"]=s,delete e.mediaConfig.playsinline,delete e.mediaConfig["webkit-playsinline"],delete e.mediaConfig["x5-playsinline"]),n.loop&&(e.mediaConfig.loop="loop"),n.autoplayMuted&&!Object.prototype.hasOwnProperty.call(e.mediaConfig,"muted")&&(e.mediaConfig.muted=!0),e.media=n.mediaEl instanceof HTMLMediaElement?n.mediaEl:typeof n.mediaEl=="function"?n.mediaEl(e.mediaConfig):A.createDom(e.mediaConfig.mediaType,"",e.mediaConfig,""),n.defaultPlaybackRate&&(e.media.defaultPlaybackRate=e.media.playbackRate=n.defaultPlaybackRate),A.typeOf(n.volume)==="Number"&&(e.volume=n.volume),n.autoplayMuted&&(e.media.muted=!0,e._lastMuted=!0),n.autoplay&&(e.media.autoplay=!0),n.playsinline&&(e.media.playsinline=!0),e._interval={},e.mediaEventMiddleware={},e.attachVideoEvents(),e}return he(d,[{key:"setEventsMiddleware",value:function(e){var s=this;Object.keys(e).map(function(c){s.mediaEventMiddleware[c]=e[c]})}},{key:"removeEventsMiddleware",value:function(e){var s=this;Object.keys(e).map(function(c){delete s.mediaEventMiddleware[c]})}},{key:"attachVideoEvents",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers||(this._evHandlers=hl.map(function(c){var v="on".concat(c.charAt(0).toUpperCase()).concat(c.slice(1));return typeof e[v]=="function"&&e.on(c,e[v]),q({},c,Kh(c,e))})),this._evHandlers.forEach(function(c){var v=Object.keys(c)[0];s.addEventListener(v,c[v],!1)})}},{key:"detachVideoEvents",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers.forEach(function(c){var v=Object.keys(c)[0];s.removeEventListener(v,c[v],!1)}),this._evHandlers.forEach(function(c){var v=Object.keys(c)[0],T="on".concat(v.charAt(0).toUpperCase()).concat(v.slice(1));typeof e[T]=="function"&&e.off(v,e[T])}),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,s){var c=this;e.removeAttribute("src"),e.load(),s.forEach(function(R,F){c.media.appendChild(A.createDom("source","",{src:"".concat(R.src),type:"".concat(R.type||""),"data-index":F+1}))});var v=e.children;if(v){this._videoSourceCount=v.length,this._videoSourceIndex=v.length,this._vLoadeddata=function(R){c.emit(cl,{src:R.target.currentSrc,host:A.getHostFromUrl(R.target.currentSrc)})};for(var T=null,S=0;S<this._evHandlers.length;S++)if(Object.keys(this._evHandlers[S])[0]==="error"){T=this._evHandlers[S];break}!this._sourceError&&(this._sourceError=function(R){var F=parseInt(R.target.getAttribute("data-index"),10);if(c._videoSourceIndex--,c._videoSourceIndex===0||F>=c._videoSourceCount){var B={code:4,message:"sources_load_error"};T?T.error(R,B):c.errorHandler("error",B)}var U=po[4];c.emit(fl,new xi(c,{errorType:U,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:R.target.src}))});for(var C=0;C<v.length;C++)v[C].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var s=e.children;if(!(!s||s.length===0||!this._sourceError)){for(var c=0;c<s.length;c++)s[c].removeEventListener("error",this._sourceError);for(;s.length>0;)e.removeChild(s[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.media&&(this.media.error||s)){var c=this.media.error||s,v=c.code?po[c.code]:"other",T=c.message;this.media.currentSrc||this.media.srcObject||(T="empty_src",c={code:6,message:T}),this.emit(e,new xi(this,{errorType:v,errorCode:c.code,errorMessage:c.message||"",mediaError:c}))}}},{key:"destroy",value:function(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(var e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return this.media?this.media.canPlayType(e):!1}},{key:"getBufferedRange",value:function(e){var s=[0,0];if(!this.media)return s;e||(e=this.media.buffered);var c=this.media.currentTime;if(e)for(var v=0,T=e.length;v<T&&(s[0]=e.start(v),s[1]=e.end(v),!(s[0]<=c&&c<=s[1]));v++);return s[0]-c<=0&&c-s[1]<=0?s:[0,0]}},{key:"autoplay",get:function(){return this.media?this.media.autoplay:!1},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?A.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var s=this.media.buffered;if(!s||s.length===0)return e;for(var c=0;c<s.length;c++)if((s.start(c)<=this.currentTime||s.start(c)<.1)&&s.end(c)>=this.currentTime)return{start:s.start(c),end:s.end(c)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?this.media.currentTime!==void 0?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return this.media?this.media.defaultMuted:!1},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return this.media?this.media.ended:!1}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var s=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return s[this.media.error.code-1]}},{key:"loop",get:function(){return this.media?this.media.loop:!1},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return this.media?this.media.muted:!1},set:function(e){!this.media||this.media.muted===e||(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return this.media?this.media.paused:!0}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){!this.media||e===1/0||(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return this.media?this.media.preload:!1},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return this.media?this.media.seekable:!1}},{key:"seeking",get:function(){return this.media?this.media.seeking:!1}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){if(this.media){if(this.emit(Yr,e),this.emit(jr),this._currentTime=0,this._duration=0,A.isMSE(this.media)){this.onWaiting();return}this._detachSourceEvents(this.media),A.typeOf(e)==="Array"?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()}}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e===1/0||!this.media||(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,s){for(var c,v=arguments.length,T=new Array(v>2?v-2:0),S=2;S<v;S++)T[S-2]=arguments[S];(c=_e(Te(d.prototype),"emit",this)).call.apply(c,[this,e,s].concat(T))}},{key:"on",value:function(e,s){for(var c,v=arguments.length,T=new Array(v>2?v-2:0),S=2;S<v;S++)T[S-2]=arguments[S];(c=_e(Te(d.prototype),"on",this)).call.apply(c,[this,e,s].concat(T))}},{key:"once",value:function(e,s){for(var c,v=arguments.length,T=new Array(v>2?v-2:0),S=2;S<v;S++)T[S-2]=arguments[S];(c=_e(Te(d.prototype),"once",this)).call.apply(c,[this,e,s].concat(T))}},{key:"off",value:function(e,s){for(var c,v=arguments.length,T=new Array(v>2?v-2:0),S=2;S<v;S++)T[S-2]=arguments[S];(c=_e(Te(d.prototype),"off",this)).call.apply(c,[this,e,s].concat(T))}},{key:"offAll",value:function(){_e(Te(d.prototype),"removeAllListeners",this).call(this)}}]),d}(Xo),jh=function(){function y(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};ce(this,y),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=m}return he(y,[{key:"openDB",value:function(d){var n=this,e=this,s=this.myDB.version||1,c=e.indexedDB.open(e.myDB.name,s);c.onerror=function(v){},c.onsuccess=function(v){n.myDB.db=v.target.result,d.call(e)},c.onupgradeneeded=function(v){var T=v.target.result;v.target.transaction,T.objectStoreNames.contains(e.myDB.ojstore.name)||T.createObjectStore(e.myDB.ojstore.name,{keyPath:e.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var d=this;d.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(d,n){for(var e=this.myDB.db.transaction(d,"readwrite").objectStore(d),s,c=0;c<n.length;c++)s=e.add(n[c]),s.onerror=function(){},s.onsuccess=function(){}}},{key:"putData",value:function(d,n){for(var e=this.myDB.db.transaction(d,"readwrite").objectStore(d),s,c=0;c<n.length;c++)s=e.put(n[c]),s.onerror=function(){},s.onsuccess=function(){}}},{key:"getDataByKey",value:function(d,n,e){var s=this,c=this.myDB.db.transaction(d,"readwrite").objectStore(d),v=c.get(n);v.onerror=function(){e.call(s,null)},v.onsuccess=function(T){var S=T.target.result;e.call(s,S)}}},{key:"deleteData",value:function(d,n){var e=this.myDB.db.transaction(d,"readwrite").objectStore(d);e.delete(n)}},{key:"clearData",value:function(d){var n=this.myDB.db.transaction(d,"readwrite").objectStore(d);n.clear()}}]),y}(),yo=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],Eo=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],To=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],nr="data-xgplayerid";function mi(y,m,d){for(var n=arguments.length,e=new Array(n>3?n-3:0),s=3;s<n;s++)e[s-3]=arguments[s];var c=m.call.apply(m,[y].concat(e));!d||typeof d!="function"||(c&&c.then?c.then(function(){for(var v=arguments.length,T=new Array(v),S=0;S<v;S++)T[S]=arguments[S];d.call.apply(d,[y].concat(T))}):d.call.apply(d,[y].concat(e)))}function ki(y,m){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[y]&&(this.__hooks[y]=null),function(){var n=arguments,e=this;if(d.pre)try{var s;(s=d.pre).call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}catch(v){throw v.message="[pluginName: ".concat(this.pluginName,":").concat(y,":pre error] >> ").concat(v.message),v}if(this.__hooks&&this.__hooks[y])try{var c=Gt(this,y,m);c?c.then?c.then(function(v){v!==!1&&mi.apply(void 0,[e,m,d.next].concat(wt(n)))}).catch(function(v){throw v}):mi.apply(void 0,[this,m,d.next].concat(Array.prototype.slice.call(arguments))):c===void 0&&mi.apply(void 0,[this,m,d.next].concat(Array.prototype.slice.call(arguments)))}catch(v){throw v.message="[pluginName: ".concat(this.pluginName,":").concat(y,"] >> ").concat(v.message),v}else mi.apply(void 0,[this,m,d.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function gl(y,m){var d=this.__hooks;if(!d||!Array.isArray(d[y]))return-1;for(var n=d[y],e=0;e<n.length;e++)if(n[e]===m)return e;return-1}function Ri(y,m){var d=this.__hooks;if(d)return d.hasOwnProperty(y)?(Array.isArray(d[y])||(d[y]=[]),gl.call(this,y,m)===-1&&d[y].push(m),!0):(console.warn("has no supported hook which name [".concat(y,"]")),!1)}function Ii(y,m){var d=this.__hooks;if(d)if(Array.isArray(d[y])){var n=d[y],e=gl.call(this,y,m);e!==-1&&n.splice(e,1)}else d[y]&&(d[y]=null)}function So(y){if(!(!this.plugins||!this.plugins[y.toLowerCase()])){for(var m=this.plugins[y.toLowerCase()],d=arguments.length,n=new Array(d>1?d-1:0),e=1;e<d;e++)n[e-1]=arguments[e];return m.useHooks&&m.useHooks.apply(m,n)}}function xo(y){if(!(!this.plugins||!this.plugins[y.toLowerCase()])){var m=this.plugins[y.toLowerCase()];if(m){for(var d=arguments.length,n=new Array(d>1?d-1:0),e=1;e<d;e++)n[e-1]=arguments[e];return m.removeHooks&&m.removeHooks.apply(m,n)}}}function pl(y){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];y.__hooks={},m&&m.map(function(d){y.__hooks[d]=null}),Object.defineProperty(y,"hooks",{get:function(){return y.__hooks&&Object.keys(y.__hooks).map(function(n){if(y.__hooks[n])return n})}})}function ml(y){y.__hooks=null}function Gt(y,m,d){for(var n=arguments.length,e=new Array(n>3?n-3:0),s=3;s<n;s++)e[s-3]=arguments[s];if(y.__hooks&&Array.isArray(y.__hooks[m])){var c=y.__hooks[m],v=-1,T=function S(C,R,F){for(var B=arguments.length,U=new Array(B>3?B-3:0),W=3;W<B;W++)U[W-3]=arguments[W];if(v++,c.length===0||v===c.length)return F.call.apply(F,[C,C].concat(U));var z=c[v],ne=z.call.apply(z,[C,C].concat(U));if(ne&&ne.then)return ne.then(function(te){return te===!1?null:S.apply(void 0,[C,R,F].concat(U))}).catch(function(te){console.warn("[runHooks]".concat(R," reject"),te.message)});if(ne!==!1)return S.apply(void 0,[C,R,F].concat(U))};return T.apply(void 0,[y,m,d].concat(e))}else return d.call.apply(d,[y,y].concat(e))}function kn(y,m){we.logError("[".concat(y,"] event or callback cant be undefined or null when call ").concat(m))}var Dt=function(){function y(m){ce(this,y),A.checkIsFunction(this.beforeCreate)&&this.beforeCreate(m),pl(this),this.__args=m,this.__events={},this.__onceEvents={},this.config=m.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(m)}return he(y,[{key:"beforeCreate",value:function(d){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(d){this.player=d.player,this.playerConfig=d.player&&d.player.config,this.pluginName=d.pluginName?d.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=d.player&&d.player.logger}},{key:"updateLang",value:function(d){d||(d=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var d=A.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&(this.playerConfig.domEventType==="touch"||this.playerConfig.domEventType==="mouse")&&(d=this.playerConfig.domEventType),d}},{key:"on",value:function(d,n){var e=this;if(!d||!n||!this.player){kn(this.pluginName,"plugin.on(event, callback)");return}typeof d=="string"?(this.__events[d]=n,this.player.on(d,n)):Array.isArray(d)&&d.forEach(function(s){e.__events[s]=n,e.player.on(s,n)})}},{key:"once",value:function(d,n){var e=this;if(!d||!n||!this.player){kn(this.pluginName,"plugin.once(event, callback)");return}typeof d=="string"?(this.__onceEvents[d]=n,this.player.once(d,n)):Array.isArray(d)&&d.forEach(function(s){e.__onceEvents[s]=n,e.player.once(d,n)})}},{key:"off",value:function(d,n){var e=this;if(!d||!n||!this.player){kn(this.pluginName,"plugin.off(event, callback)");return}typeof d=="string"?(delete this.__events[d],this.player.off(d,n)):Array.isArray(d)&&d.forEach(function(s){delete e.__events[d],e.player.off(s,n)})}},{key:"offAll",value:function(){var d=this;["__events","__onceEvents"].forEach(function(n){Object.keys(d[n]).forEach(function(e){d[n][e]&&d.off(e,d[n][e]),e&&delete d[n][e]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(d){var n;if(this.player){for(var e=arguments.length,s=new Array(e>1?e-1:0),c=1;c<e;c++)s[c-1]=arguments[c];(n=this.player).emit.apply(n,[d].concat(s))}}},{key:"emitUserAction",value:function(d,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.player){var s=Xe(Xe({},e),{},{pluginName:this.pluginName});this.player.emitUserAction(d,n,s)}}},{key:"hook",value:function(d,n){return ki.call.apply(ki,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(d,n){for(var e=arguments.length,s=new Array(e>2?e-2:0),c=2;c<e;c++)s[c-2]=arguments[c];return Ri.call.apply(Ri,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(d,n){for(var e=arguments.length,s=new Array(e>2?e-2:0),c=2;c<e;c++)s[c-2]=arguments[c];return Ii.call.apply(Ii,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(d){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(this.player)return e&&(n.pluginName=e),this.player.registerPlugin({plugin:d,options:n})}},{key:"getPlugin",value:function(d){return this.player?this.player.getPlugin(d):null}},{key:"__destroy",value:function(){var d=this,n=this.player,e=this.pluginName;this.offAll(),A.clearAllTimers(this),A.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(s){d[s]=null}),n.unRegisterPlugin(e),ml(this)}}],[{key:"defineGetterOrSetter",value:function(d,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&Object.defineProperty(d,e,n[e])}},{key:"defineMethod",value:function(d,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&typeof n[e]=="function"&&Object.defineProperty(d,e,{configurable:!0,value:n[e]})}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),y}(),Rn,_o;function Yh(){if(_o)return Rn;_o=1;var y=9;if(typeof Element<"u"&&!Element.prototype.matches){var m=Element.prototype;m.matches=m.matchesSelector||m.mozMatchesSelector||m.msMatchesSelector||m.oMatchesSelector||m.webkitMatchesSelector}function d(n,e){for(;n&&n.nodeType!==y;){if(typeof n.matches=="function"&&n.matches(e))return n;n=n.parentNode}}return Rn=d,Rn}var In,bo;function zh(){if(bo)return In;bo=1;var y=Yh();function m(e,s,c,v,T){var S=n.apply(this,arguments);return e.addEventListener(c,S,T),{destroy:function(){e.removeEventListener(c,S,T)}}}function d(e,s,c,v,T){return typeof e.addEventListener=="function"?m.apply(null,arguments):typeof c=="function"?m.bind(null,document).apply(null,arguments):(typeof e=="string"&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,function(S){return m(S,s,c,v,T)}))}function n(e,s,c,v){return function(T){T.delegateTarget=y(T.target,s),T.delegateTarget&&v.call(e,T)}}return In=d,In}var $h=zh();const Lo=Di($h);var qh={CONTROLS:"controls",ROOT:"root"},Ke={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},Co={ICON_DISABLE:"xg-icon-disable"};function Pn(y){return y?y.indexOf&&/^(?:http|data:|\/)/.test(y):!1}function Xh(y,m){return dt(y)==="object"&&y.class&&typeof y.class=="string"?"".concat(m," ").concat(y.class):m}function Qh(y,m){return dt(y)==="object"&&y.attr&&dt(y.attr)==="object"&&Object.keys(y.attr).map(function(d){m[d]=y.attr[d]}),m}function Ao(y,m){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",s=null;if(y instanceof window.Element)return A.addClass(y,d),Object.keys(n).map(function(c){y.setAttribute(c,n[c])}),y;if(Pn(y)||Pn(y.url))return n.src=Pn(y)?y:y.url||"",s=A.createDom(y.tag||"img","",n,"xg-img ".concat(d)),s;if(typeof y=="function")try{return s=y(),s instanceof window.Element?(A.addClass(s,d),Object.keys(n).map(function(c){s.setAttribute(c,n[c])}),s):(we.logWarn("warn>>icons.".concat(m," in config of plugin named [").concat(e,"] is a function mast return an Element Object")),null)}catch(c){return we.logError("Plugin named [".concat(e,"]:createIcon"),c),null}return typeof y=="string"?A.createDomFromHtml(y,n,d):(we.logWarn("warn>>icons.".concat(m," in config of plugin named [").concat(e,"] is invalid")),null)}function Zh(y,m){var d=m.config.icons||m.playerConfig.icons;Object.keys(y).map(function(n){var e=y[n],s=e&&e.class?e.class:"",c=e&&e.attr?e.attr:{},v=null;d&&d[n]&&(s=Xh(d[n],s),c=Qh(d[n],c),v=Ao(d[n],n,s,c,m.pluginName)),!v&&e&&(v=Ao(e.icon?e.icon:e,c,s,{},m.pluginName)),m.icons[n]=v})}function Jh(y,m){Object.keys(y).map(function(d){Object.defineProperty(m.langText,d,{get:function(){var e=m.lang,s=m.i18n;return s[d]?s[d]:y[d]&&y[d][e]||""}})})}var Fe=function(y){me(d,y);var m=ye(d);function d(){var n,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ce(this,d),n=m.call(this,e),n.__delegates=[],n}return he(d,[{key:"__init",value:function(e){if(_e(Te(d.prototype),"__init",this).call(this,e),!!e.root){var s=e.root,c=null;this.icons={},this.root=null,this.parent=null;var v=this.registerIcons()||{};Zh(v,this),this.langText={};var T=this.registerLanguageTexts()||{};Jh(T,this);var S="";try{S=this.render()}catch(F){throw we.logError("Plugin:".concat(this.pluginName,":render"),F),new Error("Plugin:".concat(this.pluginName,":render:").concat(F.message))}if(S)c=d.insert(S,s,e.index),c.setAttribute("data-index",e.index);else if(e.tag)c=A.createDom(e.tag,"",e.attr,e.name),c.setAttribute("data-index",e.index),s.appendChild(c);else return;this.root=c,this.parent=s;var C=this.config.attr||{},R=this.config.style||{};this.setAttr(C),this.setStyle(R),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var s=this.children();s&&dt(s)==="object"&&Object.keys(s).length>0&&Object.keys(s).map(function(c){var v=c,T=s[v],S={root:e.root},C,R;typeof T=="function"?(C=e.config[v]||{},R=T):dt(T)==="object"&&typeof T.plugin=="function"&&(C=T.options?A.deepCopy(e.config[v]||{},T.options):e.config[v]||{},R=T.plugin),S.config=C,C.index!==void 0&&(S.index=C.index),C.root&&(S.root=C.root),e.registerPlugin(R,S,v)})}}},{key:"updateLang",value:function(e){e||(e=this.lang);function s(S,C){for(var R=0;R<S.children.length;R++)S.children[R].children.length>0?s(S.children[R],C):C(S.children[R])}var c=this.root,v=this.i18n,T=this.langText;c&&s(c,function(S){var C=S.getAttribute&&S.getAttribute("lang-key");if(C){var R=v[C.toUpperCase()]||T[C];R&&(S.innerHTML=typeof R=="function"?R(e):R)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",c=this.i18n||{},v=this.langText;e.setAttribute&&e.setAttribute("lang-key",s);var T=c[s]||v[s]||"";T&&(e.innerHTML=T)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,A.addClass(this.find(".xgplayer-icon"),Co.ICON_DISABLE)}},{key:"enable",value:function(){this.config.disable=!1,A.removeClass(this.find(".xgplayer-icon"),Co.ICON_DISABLE)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";s.root=s.root||this.root;var v=_e(Te(d.prototype),"registerPlugin",this).call(this,e,s,c);return this._children.push(v),v}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,s,c){var v=this;if(arguments.length<3&&typeof s=="function")Array.isArray(e)?e.forEach(function(S){v.bindEL(S,s)}):this.bindEL(e,s);else{var T=d.delegate.call(this,this.root,e,s,c);this.__delegates=this.__delegates.concat(T)}}},{key:"unbind",value:function(e,s){var c=this;if(arguments.length<3&&typeof s=="function")Array.isArray(e)?e.forEach(function(S){c.unbindEL(S,s)}):this.unbindEL(e,s);else for(var v="".concat(e,"_").concat(s),T=0;T<this.__delegates.length;T++)if(this.__delegates[T].key===v){this.__delegates[T].destroy(),this.__delegates.splice(T,1);break}}},{key:"setStyle",value:function(e,s){var c=this;if(this.root){if(A.typeOf(e)==="String")return this.root.style[e]=s;A.typeOf(e)==="Object"&&Object.keys(e).map(function(v){c.root.style[v]=e[v]})}}},{key:"setAttr",value:function(e,s){var c=this;if(this.root){if(A.typeOf(e)==="String")return this.root.setAttribute(e,s);A.typeOf(e)==="Object"&&Object.keys(e).map(function(v){c.root.setAttribute(v,e[v])})}}},{key:"setHtml",value:function(e,s){this.root&&(this.root.innerHTML=e,typeof s=="function"&&s())}},{key:"bindEL",value:function(e,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof s=="function"&&this.root.addEventListener(e,s,c)}},{key:"unbindEL",value:function(e,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof s=="function"&&this.root.removeEventListener(e,s,c)}},{key:"show",value:function(e){if(this.root){this.root.style.display=e!==void 0?e:"block";var s=window.getComputedStyle(this.root,null),c=s.getPropertyValue("display");if(c==="none")return this.root.style.display="block"}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,s){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!s||!(s instanceof window.Element))return null;try{return typeof e=="string"?this.find(e).appendChild(s):e.appendChild(s)}catch(c){return we.logError("Plugin:appendChild",c),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,s=this.player;this.__delegates.map(function(c){c.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(c){s.unRegisterPlugin(c.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),_e(Te(d.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(c){e[c]=null})}}],[{key:"insert",value:function(e,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=s.children.length,T=Number(c),S=e instanceof window.Node;if(v){for(var C=0,R=null,F="";C<v;C++){R=s.children[C];var B=Number(R.getAttribute("data-index"));if(B>=T){F="beforebegin";break}else B<T&&(F="afterend")}return S?F==="afterend"?s.appendChild(e):s.insertBefore(e,R):R.insertAdjacentHTML(F,e),F==="afterend"?s.children[s.children.length-1]:s.children[C]}else return S?s.appendChild(e):s.insertAdjacentHTML("beforeend",e),s.children[s.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,s,c,v){var T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,S=[];if(e instanceof window.Node&&typeof v=="function")if(Array.isArray(c))c.forEach(function(R){var F=Lo(e,s,R,v,T);F.key="".concat(s,"_").concat(R),S.push(F)});else{var C=Lo(e,s,c,v,T);C.key="".concat(s,"_").concat(c),S.push(C)}return S}},{key:"ROOT_TYPES",get:function(){return qh}},{key:"POSITIONS",get:function(){return Ke}}]),d}(Dt),ed=function(){function y(){var m=this;if(ce(this,y),q(this,"__trigger",function(d){var n=new Date().getTime();m.timeStamp=n;for(var e=0;e<d.length;e++)m.__runHandler(d[e].target)}),this.__handlers=[],this.timeStamp=0,this.observer=null,!!window.ResizeObserver)try{this.observer=new window.ResizeObserver(kh(this.__trigger,100,{trailing:!0})),this.timeStamp=new Date().getTime()}catch(d){console.error(d)}}return he(y,[{key:"addObserver",value:function(d,n){if(this.observer){this.observer.observe(d);for(var e=d.getAttribute(nr),s=this.__handlers,c=-1,v=0;v<s.length;v++)s[v]&&d===s[v].target&&(c=v);c>-1?this.__handlers[c].handler=n:this.__handlers.push({target:d,handler:n,playerId:e})}}},{key:"unObserver",value:function(d){var n=-1;this.__handlers.map(function(s,c){d===s.target&&(n=c)});try{var e;(e=this.observer)===null||e===void 0||e.unobserve(d)}catch{}n>-1&&this.__handlers.splice(n,1)}},{key:"destroyObserver",value:function(){var d;(d=this.observer)===null||d===void 0||d.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(d){for(var n=this.__handlers,e=0;e<n.length;e++)if(n[e]&&d===n[e].target){try{n[e].handler(d)}catch(s){console.error(s)}return!0}return!1}}]),y}(),Gr=null;function td(y,m){return Gr||(Gr=new ed),Gr.addObserver(y,m),Gr}function rd(y,m){var d;(d=Gr)===null||d===void 0||d.unObserver(y,m)}var ut={pluginGroup:{},init:function(m){var d=m._pluginInfoId;d||(d=new Date().getTime(),m._pluginInfoId=d),!m.config.closeResizeObserver&&td(m.root,function(){m.resize()}),this.pluginGroup[d]={_originalOptions:m.config||{},_plugins:{}}},formatPluginInfo:function(m,d){var n=null,e=null;return m.plugin&&typeof m.plugin=="function"?(n=m.plugin,e=m.options):(n=m,e={}),d&&(e.config=d||{}),{PLUFGIN:n,options:e}},checkPluginIfExits:function(m,d){for(var n=0;n<d.length;n++)if(m.toLowerCase()===d[n].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(m,d){for(var n=Object.keys(d),e=null,s=0;s<n.length;s++)if(m.toLowerCase()===n[s].toLowerCase()){e=d[n[s]];break}return A.typeOf(e)==="Object"?{root:e.root,position:e.position}:{}},lazyRegister:function(m,d){var n=this,e=d.timeout||1500;return Promise.race([d.loader().then(function(s){var c;s&&s.__esModule?c=s.default:c=s,n.register(m,c,s.options)}),new Promise(function(s,c){setTimeout(function(){c(new Error("timeout"))},e)})])},register:function(m,d){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!m||!d||typeof d!="function"||d.prototype===void 0)){var e=m._pluginInfoId;if(!(!e||!this.pluginGroup[e])){this.pluginGroup[e]._plugins||(this.pluginGroup[e]._plugins={});var s=this.pluginGroup[e]._plugins,c=this.pluginGroup[e]._originalOptions;n.player=m;var v=n.pluginName||d.pluginName;if(!v)throw new Error("The property pluginName is necessary");if(d.isSupported&&!d.isSupported(m.config.mediaType,m.config.codecType)){console.warn("not supported plugin [".concat(v,"]"));return}n.config||(n.config={});for(var T=Object.keys(c),S=0;S<T.length;S++)if(v.toLowerCase()===T[S].toLowerCase()){var C=c[T[S]];A.typeOf(C)==="Object"?n.config=Object.assign({},n.config,c[T[S]]):A.typeOf(C)==="Boolean"&&(n.config.disable=!C);break}d.defaultConfig&&Object.keys(d.defaultConfig).forEach(function(F){typeof n.config[F]>"u"&&(n.config[F]=d.defaultConfig[F])}),n.root?typeof n.root=="string"&&(n.root=m[n.root]):n.root=m.root,n.index=n.config.index||0;try{s[v.toLowerCase()]&&(this.unRegister(e,v.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(v,"] exist, destroy the old instance")));var R=new d(n);return s[v.toLowerCase()]=R,s[v.toLowerCase()].func=d,R&&typeof R.afterCreate=="function"&&R.afterCreate(),R}catch(F){throw console.error(F),F}}}},unRegister:function(m,d){m._pluginInfoId&&(m=m._pluginInfoId),d=d.toLowerCase();try{var n=this.pluginGroup[m]._plugins[d];n&&(n.pluginName&&n.__destroy(),delete this.pluginGroup[m]._plugins[d])}catch(e){console.error("[unRegister:".concat(d,"] cgid:[").concat(m,"] error"),e)}},deletePlugin:function(m,d){var n=m._pluginInfoId;n&&this.pluginGroup[n]&&this.pluginGroup[n]._plugins&&delete this.pluginGroup[n]._plugins[d]},getPlugins:function(m){var d=m._pluginInfoId;return d&&this.pluginGroup[d]?this.pluginGroup[d]._plugins:{}},findPlugin:function(m,d){var n=m._pluginInfoId;if(!n||!this.pluginGroup[n])return null;var e=d.toLowerCase();return this.pluginGroup[n]._plugins[e]},beforeInit:function(m){var d=this;function n(e){return!e||!e.then?new Promise(function(s){s()}):e}return new Promise(function(e){if(d.pluginGroup){var s;return m._loadingPlugins&&m._loadingPlugins.length?s=Promise.all(m._loadingPlugins):s=Promise.resolve(),s.then(function(){var c=m._pluginInfoId;if(!d.pluginGroup[c]){e();return}var v=d.pluginGroup[c]._plugins,T=[];Object.keys(v).forEach(function(S){if(v[S]&&v[S].beforePlayerInit)try{var C=v[S].beforePlayerInit();T.push(n(C))}catch(R){throw T.push(n(null)),R}}),Promise.all([].concat(T)).then(function(){e()}).catch(function(S){console.error(S),e()})})}})},afterInit:function(m){var d=m._pluginInfoId;if(!(!d||!this.pluginGroup[d])){var n=this.pluginGroup[d]._plugins;Object.keys(n).forEach(function(e){n[e]&&n[e].afterPlayerInit&&n[e].afterPlayerInit()})}},setLang:function(m,d){var n=d._pluginInfoId;if(!(!n||!this.pluginGroup[n])){var e=this.pluginGroup[n]._plugins;Object.keys(e).forEach(function(s){if(e[s].updateLang)e[s].updateLang(m);else try{e[s].lang=m}catch{console.warn("".concat(s," setLang"))}})}},reRender:function(m){var d=this,n=m._pluginInfoId;if(!(!n||!this.pluginGroup[n])){var e=[],s=this.pluginGroup[n]._plugins;Object.keys(s).forEach(function(c){c!=="controls"&&s[c]&&(e.push({plugin:s[c].func,options:s[c].__args}),d.unRegister(n,c))}),e.forEach(function(c){d.register(m,c.plugin,c.options)})}},onPluginsReady:function(m){var d=m._pluginInfoId;if(!(!d||!this.pluginGroup[d])){var n=this.pluginGroup[d]._plugins||{};Object.keys(n).forEach(function(e){n[e].onPluginsReady&&typeof n[e].onPluginsReady=="function"&&n[e].onPluginsReady()})}},destroy:function(m){var d=m._pluginInfoId;if(this.pluginGroup[d]){rd(m.root);for(var n=this.pluginGroup[d]._plugins,e=0,s=Object.keys(n);e<s.length;e++){var c=s[e];this.unRegister(d,c)}delete this.pluginGroup[d],delete m._pluginInfoId}}},ee={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function ko(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:Rh(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var id=function(m,d){var n,e,s;d.preset&&d.options?s=new d.preset(d.options,m.config):s=new d({},m.config);var c=s,v=c.plugins,T=v===void 0?[]:v,S=c.ignores,C=S===void 0?[]:S,R=c.icons,F=R===void 0?{}:R,B=c.i18n,U=B===void 0?[]:B;m.config.plugins||(m.config.plugins=[]),m.config.ignores||(m.config.ignores=[]),(n=m.config.plugins).push.apply(n,wt(T)),(e=m.config.ignores).push.apply(e,wt(C)),Object.keys(F).map(function(z){m.config.icons[z]||(m.config.icons[z]=F[z])});var W=m.config.i18n||[];U.push.apply(U,wt(W)),m.config.i18n=U},nd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onMouseEnter",function(v){var T=K(n),S=T.player,C=T.playerConfig;C.closeControlsBlur&&S.focus({autoHide:!1})}),q(K(n),"onMouseLeave",function(v){var T=K(n),S=T.player;S.focus()}),n}return he(d,[{key:"beforeCreate",value:function(e){!e.config.mode&&Ae.device==="mobile"&&(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,s=this.config,c=s.disable,v=s.height,T=s.mode;if(!c){T==="flex"&&this.player.addClass(ee.FLEX_CONTROLS);var S={height:"".concat(v,"px")};Object.keys(S).map(function(R){e.root.style[R]=S[R]}),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(Li,function(R){R?A.addClass(e.root,"mini-controls"):A.removeClass(e.root,"mini-controls")});var C=this.playerConfig.isMobileSimulateMode;Ae.device!=="mobile"&&C!=="mobile"&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&A.addClass(this.root,ee.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){A.removeClass(this.root,ee.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;if(this.root){var v=e.defaultConfig||{};if(!s.root){var T=s.position?s.position:s.config&&s.config.position?s.config.position:v.position;switch(T){case Ke.CONTROLS_LEFT:s.root=this.left;break;case Ke.CONTROLS_RIGHT:s.root=this.right;break;case Ke.CONTROLS_CENTER:s.root=this.center;break;case Ke.CONTROLS:s.root=this.root;break;default:s.root=this.left}return _e(Te(d.prototype),"registerPlugin",this).call(this,e,s,c)}}}},{key:"destroy",value:function(){Ae.device!=="mobile"&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave)),this.left=null,this.center=null,this.right=null,this.innerRoot=null}},{key:"render",value:function(){var e=this.config,s=e.mode,c=e.autoHide,v=e.initShow,T=e.disable;if(!T){var S=A.classNames({"xgplayer-controls":!0},{"flex-controls":s==="flex"},{"bottom-controls":s==="bottom"},q({},ee.CONTROLS_AUTOHIDE,c),{"xgplayer-controls-initshow":v||!c});return'<xg-controls class="'.concat(S,`" unselectable="on">
    <xg-inner-controls class="xg-inner-controls xg-pos">
      <xg-left-grid class="xg-left-grid">
      </xg-left-grid>
      <xg-center-grid class="xg-center-grid"></xg-center-grid>
      <xg-right-grid class="xg-right-grid">
      </xg-right-grid>
    </xg-inner-controls>
    </xg-controls>`)}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),d}(Fe),ad={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},bt={lang:{},langKeys:[],textKeys:[]};function Kr(y,m){return Object.keys(m).forEach(function(d){var n=A.typeOf(m[d]),e=A.typeOf(y[d]);if(n==="Array"){var s;e!=="Array"&&(y[d]=[]),(s=y[d]).push.apply(s,wt(m[d]))}else n==="Object"?(e!=="Object"&&(y[d]={}),Kr(y[d],m[d])):y[d]=m[d]}),y}function yl(){Object.keys(bt.lang.en).map(function(y){bt.textKeys[y]=y})}function sd(y,m){var d=[];if(m||(m=bt),!!m.lang){A.typeOf(y)!=="Array"?d=Object.keys(y).map(function(s){var c=s==="zh"?"zh-cn":s;return{LANG:c,TEXT:y[s]}}):d=y;var n=m,e=n.lang;d.map(function(s){s.LANG==="zh"&&(s.LANG="zh-cn"),e[s.LANG]?Kr(e[s.LANG]||{},s.TEXT||{}):na(s,m)}),yl()}}function na(y,m){var d=y.LANG;if(m||(m=bt),!!m.lang){var n=y.TEXT||{};d==="zh"&&(d="zh-cn"),m.lang[d]?Kr(m.lang[d],n):(m.langKeys.push(d),m.lang[d]=n),yl()}}function od(y){var m,d={lang:{},langKeys:[],textKeys:{},pId:y};return Kr(d.lang,bt.lang),(m=d.langKeys).push.apply(m,wt(bt.langKeys)),Kr(d.textKeys,bt.textKeys),d}na(ad);var Rr={get textKeys(){return bt.textKeys},get langKeys(){return bt.langKeys},get lang(){var y={};return bt.langKeys.map(function(m){y[m]=bt.lang[m]}),bt.lang["zh-cn"]&&(y.zh=bt.lang["zh-cn"]||{}),y},extend:sd,use:na,init:od},Me={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7},Ro=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],Et={},wn=null,El=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"add",value:function(e){e&&(Et[e.playerId]=e,Object.keys(Et).length===1&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete Et[e.playerId])}},{key:"_iterate",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var c in Et)if(Object.prototype.hasOwnProperty.call(Et,c)){var v=Et[c];if(s){if(e(v))break}else e(v)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var s=null;return this._iterate(function(c){var v=e(c);return v&&(s=c),v},!0),s}},{key:"findAll",value:function(e){var s=[];return this._iterate(function(c){e(c)&&s.push(c)}),s}},{key:"setActive",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(Et[e])return s?this.forEach(function(c){e===c.playerId?(c.isUserActive=!0,c.isInstNext=!1):c.isUserActive=!1}):Et[e].isUserActive=s,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(Et),s=0;s<e.length;s++){var c=Et[e[s]];if(c&&c.isUserActive)return e[s]}return null}},{key:"setNext",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(Et[e])return s?this.forEach(function(c){e===c.playerId?(c.isUserActive=!1,c.isInstNext=!0):c.isInstNext=!1}):Et[e].isInstNext=s,e}}],[{key:"getInstance",value:function(){return wn||(wn=new d),wn}}]),d}(qo.EventEmitter);function ld(y){for(var m=Object.keys(Et),d=0;d<m.length;d++){var n=Et[m[d]];if(n.root===y)return n}return null}var ud=["play","pause","replay","retry"],Io=0,Po=0,tr=null,Ni=function(y){me(d,y);var m=ye(d);function d(n){var e;ce(this,d);var s=A.deepMerge(ko(),n);e=m.call(this,s),q(K(e),"canPlayFunc",function(){if(e.config){var U=e.config,W=U.autoplay,z=U.defaultPlaybackRate;we.logInfo("player","canPlayFunc, startTime",e.__startTime),e._seekToStartTime(),e.playbackRate=z,(W||e._useAutoplay)&&e.mediaPlay(),e.off(zt,e.canPlayFunc),e.removeClass(ee.ENTER)}}),q(K(e),"onFullscreenChange",function(U,W){var z=function(){A.setTimeout(K(e),function(){e.resize()},100)},ne=A.getFullScreenEl();e._fullActionFrom?e._fullActionFrom="":e.emit(Ai,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var te=Ih(ne,e.playerId,nr);if(W||ne&&(ne===e._fullscreenEl||te))z(),!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,ne,ee.FULLSCREEN),e.emit(Yt,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){z();var J=K(e),Le=J._fullScreenOffset,pe=J.config;if(pe.needFullscreenScroll?(window.scrollTo(Le.left,Le.top),A.setTimeout(K(e),function(){e.fullscreen=!1,e._fullScreenOffset=null},100)):(!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen)e.removeClass(ee.FULLSCREEN);else{var De=e._fullscreenEl;!De&&(e.root.contains(U.target)||U.target===e.root)&&(De=U.target),e.recoverFullStyle(e.root,De,ee.FULLSCREEN)}e._fullscreenEl=null,e.emit(Yt,!1)}}),q(K(e),"_onWebkitbeginfullscreen",function(U){e._fullscreenEl=e.media,e.onFullscreenChange(U,!0)}),q(K(e),"_onWebkitendfullscreen",function(U){e.onFullscreenChange(U,!1)}),pl(K(e),ud),e.config=s,e._pluginInfoId=A.generateSessionId(),bh(K(e));var c=e.constructor.defaultPreset;if(e.config.presets.length){var v=e.config.presets.indexOf("default");v>=0&&c&&(e.config.presets[v]=c)}else c&&e.config.presets.push(c);e.userTimer=null,e.waitTimer=null,e.handleSource=!0,e._state=Me.INITIAL,e.isAd=!1,e.isError=!1,e._hasStart=!1,e.isSeeking=!1,e.isCanplay=!1,e._useAutoplay=!1,e.__startTime=-1,e.rotateDeg=0,e.isActive=!1,e.fullscreen=!1,e.cssfullscreen=!1,e.isRotateFullscreen=!1,e._fullscreenEl=null,e.timeSegments=[],e._cssfullscreenEl=null,e.curDefinition=null,e._orgCss="",e._fullScreenOffset=null,e._videoHeight=0,e._videoWidth=0,e.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},e.sizeInfo={width:0,height:0,left:0,top:0},e._accPlayed={t:0,acc:0,loopAcc:0},e._offsetInfo={currentTime:-1,duration:0},e.innerContainer=null,e.controls=null,e.topBar=null,e.root=null,e.__i18n=Rr.init(e._pluginInfoId),Ae.os.isAndroid&&Ae.osVersion>0&&Ae.osVersion<6&&(e.config.autoplay=!1),e.database=new jh,e.isUserActive=!1,e._onceSeekCanplay=null,e._isPauseBeforeSeek=0,e.innerStates={isActiveLocked:!1},e.instManager=tr;var T=e._initDOM();if(!T)return console.error(new Error("can't find the dom which id is ".concat(e.config.id," or this.config.el does not exist"))),Xn(e);var S=e.config,C=S.definition,R=C===void 0?{}:C,F=S.url;if(!F&&R.list&&R.list.length>0){var B=R.list.find(function(U){return U.definition&&U.definition===R.defaultDefinition});B||(R.defaultDefinition=R.list[0].definition,B=R.list[0]),e.config.url=B.url,e.curDefinition=B}return e._bindEvents(),e._registerPresets(),e._registerPlugins(),ut.onPluginsReady(K(e)),e.getInitDefinition(),e.setState(Me.READY),A.setTimeout(K(e),function(){e.emit(ea)},0),e.onReady&&e.onReady(),(e.config.videoInit||e.config.autoplay)&&(!e.hasStart||e.state<Me.ATTACHED)&&e.start(),e}return he(d,[{key:"_initDOM",value:function(){var e,s=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var c=this.config.el;if(c&&c.nodeType===1)this.root=c;else return this.emit(Wr,new xi("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1}var v=ld(this.root);if(v&&(we.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),v.destroy()),this.root.setAttribute(nr,this.playerId),this.media.setAttribute(nr,this.playerId),(e=tr)===null||e===void 0||e.add(this),ut.init(this),this._initBaseDoms(),this.config.controls){var T=this.config.controls.root||null,S=ut.register(this,nd,{root:T});this.controls=S}var C=this.config.isMobileSimulateMode==="mobile"?"mobile":Ae.device;if(this.addClass("".concat(ee.DEFAULT," ").concat(ee.INACTIVE," xgplayer-").concat(C," ").concat(this.config.controls?"":ee.NO_CONTROLS)),this.config.autoplay?this.addClass(ee.ENTER):this.addClass(ee.NO_START),this.config.fluid){var R=this.config,F=R.width,B=R.height;(typeof F!="number"||typeof B!="number")&&(F=600,B=337.5);var U={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(B*100/F,"%")};Object.keys(U).forEach(function(Le){s.root.style[Le]=U[Le]})}else["width","height"].forEach(function(Le){s.config[Le]&&(typeof s.config[Le]!="number"?s.root.style[Le]=s.config[Le]:s.root.style[Le]="".concat(s.config[Le],"px"))});var W=this.root.getBoundingClientRect(),z=W.width,ne=W.height,te=W.left,J=W.top;return this.sizeInfo.width=z,this.sizeInfo.height=ne,this.sizeInfo.left=te,this.sizeInfo.top=J,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=A.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach(function(s){e.on(s,e["on"+s.charAt(0).toUpperCase()+s.slice(1)])}),yo.forEach(function(s){document&&document.addEventListener(s,e.onFullscreenChange)}),Ae.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(qt,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(Ct,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),yo.forEach(function(s){document.removeEventListener(s,e.onFullscreenChange)}),this.playFunc&&this.off(Ct,this.playFunc),this.off(zt,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(A.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var s=this;if(this.media&&!((!e||e===""||A.typeOf(e)==="Array"&&e.length===0)&&(e="",this.emit(rl),we.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),A.typeOf(e)==="Array"&&e.length>0?this._attachSourceEvents(this.media,e):!this.media.src||this.media.src!==e?this.media.src=e:e||this.media.removeAttribute("src")),A.typeOf(this.config.volume)==="Number"&&(this.volume=this.config.volume);var c=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!c.contains(this.media)&&c.insertBefore(this.media,c.firstChild);var v=this.media.readyState;we.logInfo("_startInit readyState",v),this.config.autoplay&&(!A.isMSE(this.media)&&this.load(),(Ae.os.isIpad||Ae.os.isPhone)&&this.mediaPlay());var T=this.config.startTime;this.__startTime=T>0?T:-1,this.config.startTime=0,v>=2&&this.duration>0?this.canPlayFunc():this.on(zt,this.canPlayFunc),(!this.hasStart||this.state<Me.ATTACHED)&&ut.afterInit(this),this.hasStart=!0,this.setState(Me.ATTACHED),A.setTimeout(this,function(){s.emit(Mi)},0)}}},{key:"_registerPlugins",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._loadingPlugins=[];var c=this.config.ignores||[],v=this.config.plugins||[],T=this.config.i18n||[];s&&Rr.extend(T,this.__i18n);var S=c.join("||").toLowerCase().split("||"),C=this.plugins;v.forEach(function(R){try{var F=R.plugin?R.plugin.pluginName:R.pluginName;if(F&&S.indexOf(F.toLowerCase())>-1)return null;if(!s&&C[F.toLowerCase()])return;if(R.lazy&&R.loader){var B=ut.lazyRegister(e,R);R.forceBeforeInit&&(B.then(function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(B),1)}).catch(function(U){we.logError("_registerPlugins:loadingPlugin",U),e._loadingPlugins.splice(e._loadingPlugins.indexOf(B),1)}),e._loadingPlugins.push(B));return}return e.registerPlugin(R)}catch(U){we.logError("_registerPlugins:",U)}})}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach(function(s){id(e,s)})}},{key:"_getRootByPosition",value:function(e){var s=null;switch(e){case Ke.ROOT_RIGHT:this.rightBar||(this.rightBar=A.createPositionBar("xg-right-bar",this.root)),s=this.rightBar;break;case Ke.ROOT_LEFT:this.leftBar||(this.leftBar=A.createPositionBar("xg-left-bar",this.root)),s=this.leftBar;break;case Ke.ROOT_TOP:this.topBar||(this.topBar=A.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&A.addClass(this.topBar,ee.TOP_BAR_AUTOHIDE)),s=this.topBar;break;default:s=this.innerContainer||this.root;break}return s}},{key:"registerPlugin",value:function(e,s){var c=ut.formatPluginInfo(e,s),v=c.PLUFGIN,T=c.options,S=this.config.plugins,C=ut.checkPluginIfExits(v.pluginName,S);!C&&S.push(v);var R=ut.getRootByConfig(v.pluginName,this.config);R.root&&(T.root=R.root),R.position&&(T.position=R.position);var F=T.position?T.position:T.config&&T.config.position||v.defaultConfig&&v.defaultConfig.position;if(!T.root&&typeof F=="string"&&F.indexOf("controls")>-1){var B;return(B=this.controls)===null||B===void 0?void 0:B.registerPlugin(v,T,v.pluginName)}return T.root||(T.root=this._getRootByPosition(F)),ut.register(this,v,T)}},{key:"deregister",value:function(e){typeof e=="string"?ut.unRegister(this,e):e instanceof Dt&&ut.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.deregister(e),s&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var s;if(typeof e=="string"?s=e:e instanceof Dt&&(s=e.pluginName),!!s)for(var c=this.config.plugins.length-1;c>-1;c--){var v=this.config.plugins[c];if(v.pluginName.toLowerCase()===s.toLowerCase()){this.config.plugins.splice(c,1);break}}}},{key:"plugins",get:function(){return ut.getPlugins(this)}},{key:"getPlugin",value:function(e){var s=ut.findPlugin(this,e);return s&&s.pluginName?s:null}},{key:"addClass",value:function(e){this.root&&(A.hasClass(this.root,e)||A.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&A.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return A.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,s){this.root&&this.root.setAttribute(e,s)}},{key:"removeAttribute",value:function(e,s){this.root&&this.root.removeAttribute(e,s)}},{key:"start",value:function(e){var s=this;if(!(this.state>Me.ATTACHING))return!e&&!this.config.url&&this.getInitDefinition(),this.hasStart=!0,this.setState(Me.ATTACHING),this._registerPlugins(!1),ut.beforeInit(this).then(function(){if(s.config){e||(e=s.url||s.config.url);var c=s.preProcessUrl(e),v=s._startInit(c.url);return v}}).catch(function(c){throw c.fileName="player",c.lineNumber="236",we.logError("start:beforeInit:",c),c})}},{key:"switchURL",value:function(e,s){var c=this,v=e;A.typeOf(e)==="Object"&&(v=e.url),v=this.preProcessUrl(v).url;var T=this.currentTime;this.__startTime=T;var S=this.paused&&!this.isError;return this.src=v,new Promise(function(C,R){var F=function(W){c.off("timeupdate",B),c.off("canplay",B),R(W)},B=function(){c._seekToStartTime(),S&&c.pause(),c.off("error",F),C(!0)};if(c.once("error",F),!v){c.errorHandler("error",{code:6,message:"empty_src"});return}Ae.os.isAndroid?c.once("timeupdate",B):c.once("canplay",B),c.play()})}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<Me.ATTACHED){this.removeClass(ee.NO_START),this.addClass(ee.ENTER),this.start(),this._useAutoplay=!0;return}this.state<Me.RUNNING&&(this.removeClass(ee.NO_START),!this.isCanplay&&this.addClass(ee.ENTER));var s=_e(Te(d.prototype),"play",this).call(this);return s!==void 0&&s&&s.then?s.then(function(){e.removeClass(ee.NOT_ALLOW_AUTOPLAY),e.addClass(ee.PLAYING),e.state<Me.RUNNING&&(we.logInfo(">>>>playPromise.then"),e.setState(Me.RUNNING),e.emit(fr))}).catch(function(c){if(we.logWarn(">>>>playPromise.catch",c.name),e.media&&e.media.error){e.onError(),e.removeClass(ee.ENTER);return}c.name==="NotAllowedError"&&(e._errorTimer=A.setTimeout(e,function(){e._errorTimer=null,e.emit(ta),e.addClass(ee.NOT_ALLOW_AUTOPLAY),e.removeClass(ee.ENTER),e.pause(),e.setState(Me.NOTALLOW)},0))}):(we.logWarn("video.play not return promise"),this.state<Me.RUNNING&&(this.setState(Me.RUNNING),this.removeClass(ee.NOT_ALLOW_AUTOPLAY),this.removeClass(ee.NO_START),this.removeClass(ee.ENTER),this.addClass(ee.PLAYING),this.emit(fr))),s}},{key:"mediaPause",value:function(){_e(Te(d.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){_e(Te(d.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(ee.PAUSED),Gt(this,"play",function(){return e.mediaPlay()})}},{key:"pause",value:function(){var e=this;Gt(this,"pause",function(){_e(Te(d.prototype),"pause",e).call(e)})}},{key:"seek",value:function(e,s){var c=this;if(!(!this.media||Number.isNaN(Number(e))||!this.hasStart)){var v=this.config,T=v.isSeekedPlay,S=v.seekedStatus,C=s||(T?"play":S);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off($t,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(c.removeClass(ee.ENTER),c.isSeeking=!1,C){case"play":c.play();break;case"pause":c.pause();break;default:c._isPauseBeforeSeek>1||c.paused?c.pause():c.play()}c._isPauseBeforeSeek=0,c._onceSeekCanplay=null},this.once($t,this._onceSeekCanplay),this.state<Me.RUNNING?(this.removeClass(ee.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,s=this.config,c=s.definition,v=s.url;!v&&c&&c.list&&c.list.length>0&&c.defaultDefinition&&c.list.map(function(T){T.definition===c.defaultDefinition&&(e.config.url=T.url,e.curDefinition=T)})}},{key:"changeDefinition",value:function(e,s){var c=this,v=this.config.definition;if(Array.isArray(v?.list)&&v.list.forEach(function(S){e?.definition===S.definition&&(c.curDefinition=S)}),e!=null&&e.bitrate&&typeof e.bitrate!="number"&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(ia,{from:s,to:e}),!this.hasStart){this.config.url=e.url;return}var T=this.switchURL(e.url,Xe({seamless:v.seamless!==!1&&typeof MediaSource<"u"&&typeof MediaSource.isTypeSupported=="function"},e));T&&T.then?T.then(function(){c.emit(Yn,{from:s,to:e})}):this.emit(Yn,{from:s,to:e})}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(qt,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,s=ee.NOT_ALLOW_AUTOPLAY,c=ee.PLAYING,v=ee.NO_START,T=ee.PAUSED,S=ee.REPLAY,C=ee.ENTER,R=ee.ENDED,F=ee.ERROR,B=ee.LOADING,U=[s,c,v,T,S,C,R,F,B];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,U.forEach(function(W){e.removeClass(W)}),this.addClass(ee.NO_START),this.emit(Fi)}},{key:"reset",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=arguments.length>1?arguments[1]:void 0;this.resetState();var v=this.plugins;if(v&&(s.map(function(S){e.deregister(S)}),c)){var T=ko();Object.keys(this.config).keys(function(S){e.config[S]!=="undefined"&&(S==="plugins"||S==="presets"||S==="el"||S==="id")&&(e.config[S]=T[S])})}}},{key:"destroy",value:function(){var e,s=this,c=this.innerContainer,v=this.root,T=this.media;if(!(!v||!T)){if(this.hasStart=!1,this._useAutoplay=!1,v.removeAttribute(nr),T.removeAttribute(nr),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),A.clearAllTimers(this),this.emit(ra),(e=tr)===null||e===void 0||e.remove(this),ut.destroy(this),ml(this),_e(Te(d.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),c)for(var S=c.children,C=0;C<S.length;C++)c.removeChild(S[C]);!c&&T instanceof window.Node&&v.contains(T)&&!this.config.remainMediaAfterDestroy&&v.removeChild(T),["topBar","leftBar","rightBar","innerContainer"].map(function(F){s[F]&&v.removeChild(s[F]),s[F]=null});var R=v.className.split(" ");R.length>0?v.className=R.filter(function(F){return F.indexOf("xgplayer")<0}).join(" "):v.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach(function(F){s[F]=!1})}}},{key:"replay",value:function(){var e=this;this.removeClass(ee.ENDED),this.currentTime=0,this.isSeeking=!1,Gt(this,"replay",function(){e.once($t,function(){var s=e.mediaPlay();s&&s.catch&&s.catch(function(c){console.log(c)})}),e.emit(_i),e.onPlay()})}},{key:"retry",value:function(){var e=this;this.removeClass(ee.ERROR),this.addClass(ee.LOADING),Gt(this,"retry",function(){var s=e.currentTime,c=e.config.url,v=A.isMSE(e.media)?{url:c}:e.preProcessUrl(c);e.src=v.url,!e.config.isLive&&(e.currentTime=s),e.once(zt,function(){e.mediaPlay()})})}},{key:"changeFullStyle",value:function(e,s,c,v){e&&(v||(v=ee.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=A.filterStyleFromText(e)),A.addClass(e,c),s&&s!==e&&!this._orgPCss&&(this._orgPCss=A.filterStyleFromText(s),A.addClass(s,v),s.setAttribute(nr,this.playerId)))}},{key:"recoverFullStyle",value:function(e,s,c,v){v||(v=ee.PARENT_FULLSCREEN),this._orgCss&&(A.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),A.removeClass(e,c),s&&s!==e&&this._orgPCss&&(A.setStyleFromCsstext(s,this._orgPCss),this._orgPCss="",A.removeClass(s,v),s.removeAttribute(nr))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget,s=this.root,c=this.media;(e==="video"||e==="media")&&(e=this[e]),e||(e=s),this._fullScreenOffset={top:A.scrollTop(),left:A.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var v=A.getFullScreenEl();if(v===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var T=0;T<Eo.length;T++){var S=Eo[T];if(e[S]){var C=S==="webkitRequestFullscreen"?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[S]();return C&&C.then?C:Promise.resolve()}}return c.fullscreenEnabled||c.webkitSupportsFullscreen?(c.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch{return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!(!this._fullscreenEl&&!A.getFullScreenEl())){this.root;var s=this.media;this._fullActionFrom="exit";try{for(var c=0;c<To.length;c++){var v=To[c];if(document[v]){var T=document[v]();return T&&T.then?T:Promise.resolve()}}return s&&s.webkitSupportsFullscreen?(s.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch{return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var s=e?"".concat(ee.INNER_FULLSCREEN," ").concat(ee.CSS_FULLSCREEN):ee.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,s);var c=this.config.fullscreen,v=c===void 0?{}:c,T=v.useCssFullscreen===!0||typeof v.useCssFullscreen=="function"&&v.useCssFullscreen();T&&(this.fullscreen=!0,this.emit(Yt,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(bi,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(ee.INNER_FULLSCREEN," ").concat(ee.CSS_FULLSCREEN):ee.CSS_FULLSCREEN;if(!this.fullscreen)this.recoverFullStyle(this.root,this._cssfullscreenEl,e);else{var s=this.config.fullscreen,c=s===void 0?{}:s,v=c.useCssFullscreen===!0||typeof c.useCssFullscreen=="function"&&c.useCssFullscreen();v?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(Yt,!1)):this.removeClass(e)}this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(bi,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var s=e?"".concat(ee.INNER_FULLSCREEN," ").concat(ee.ROTATE_FULLSCREEN):ee.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,s,ee.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(Yt,!0)}},{key:"exitRotateFullscreen",value:function(e){var s=this._fullscreenEl!==this.root?"".concat(ee.INNER_FULLSCREEN," ").concat(ee.ROTATE_FULLSCREEN):ee.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,s,ee.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(Yt,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){window.orientation===90||window.orientation===-90?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};if(this.isActive){this.onFocus(e);return}this.emit(Jn,Xe({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{ignorePaused:!1};if(!this.isActive){this.onBlur(e);return}this._clearUserTimer(),this.emit(tl,Xe({paused:this.paused,ended:this.ended},e))}},{key:"onFocus",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!0,delay:3e3},c=this.innerStates;if(this.isActive=!0,this.removeClass(ee.INACTIVE),this._clearUserTimer(),s.isLock!==void 0&&(c.isActiveLocked=s.isLock),s.autoHide===!1||s.isLock===!0||c.isActiveLocked){this._clearUserTimer();return}var v=s&&s.delay?s.delay:this.config.inactive;this.userTimer=A.setTimeout(this,function(){e.userTimer=null,e.blur()},v)}},{key:"onBlur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=e.ignorePaused,c=s===void 0?!1:s;if(!this.innerStates.isActiveLocked){var v=this.config.closePauseVideoFocus;this.isActive=!1,(c||v||!this.paused&&!this.ended)&&this.addClass(ee.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(ee.ENTER),this.removeClass(ee.ERROR),this.removeClass(ee.LOADING),this.isCanplay=!0,this.waitTimer&&A.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var e=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once(Xt,function(){e._seekToStartTime()}))}},{key:"onLoadstart",value:function(){this.removeClass(ee.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===Me.ENDED&&this.setState(Me.RUNNING),this.removeClass(ee.PAUSED),this.ended&&this.removeClass(ee.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(ee.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(ee.ENDED),this.setState(Me.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(ee.NOT_ALLOW_AUTOPLAY),this.removeClass(ee.NO_START),this.removeClass(ee.ENTER),this.removeClass(ee.LOADING),this.addClass(ee.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(ee.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&A.clearTimeout(this,this.waitTimer),this.removeClass(ee.LOADING),this.removeClass(ee.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&A.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=A.setTimeout(this,function(){e.addClass(ee.LOADING),e.emit(al),A.clearTimeout(e,e.waitTimer),e.waitTimer=null},this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var s=ee.NO_START,c=ee.PAUSED,v=ee.ENDED,T=ee.ERROR,S=ee.REPLAY,C=ee.LOADING,R=[s,c,v,T,S,C];R.forEach(function(F){e.removeClass(F)}),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(ee.LOADING))&&this.media.readyState>2&&(this.removeClass(ee.LOADING),A.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===Me.NOTALLOW&&this.duration&&(this.setState(Me.RUNNING),this.emit(fr)),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onVolumechange",value:function(){A.typeOf(this.config.volume)==="Number"&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,s,c){if(!(!this.media||!s||!e)){var v=A.typeOf(e)==="String"?e:e.type||"";c.props&&A.typeOf(c.props)!=="Array"&&(c.props=[c.props]),this.emit(Ai,Xe({eventType:v,action:s,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},c))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var s=new Date().getTime()-this._accPlayed.t;this._accPlayed.acc+=s,this._accPlayed.t=0,(e==="ended"||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{startDiff:0,endDiff:0},c=s||{},v=c.startDiff,T=v===void 0?0:v,S=c.endDiff,C=S===void 0?0:S,R=this.media.buffered;if(!R||R.length===0||!this.duration)return!0;for(var F=e||this.media.currentTime||.2,B=R.length,U=0;U<B;U++)if(R.start(U)+T<=F&&R.end(U)-C>F)return!0;return!1}},{key:"resizePosition",value:function(){var e=this,s=this.videoPos,c=s.vy,v=s.vx,T=s.h,S=s.w,C=this.videoPos.rotate;if(!(C<0&&T<0&&S<0)){var R=this.videoPos._pi;if(!R&&this.media.videoHeight&&(R=this.media.videoWidth/this.media.videoHeight*100),!!R){this.videoPos.pi=R,C=C<0?0:C;var F={rotate:C},B=0,U=0,W=1,z=Math.abs(C/90),ne=this.root,te=this.innerContainer,J=ne.offsetWidth,Le=te?te.offsetHeight:ne.offsetHeight,pe={},De=Le,Re=J;if(z%2===0)W=T>0?100/T:S>0?100/S:1,F.scale=W,B=c>0?(100-T)/2-c:0,F.y=z===2?0-B:B,U=v>0?(100-S)/2-v:0,F.x=z===2?0-U:U,pe.width="".concat(Re,"px"),pe.height="".concat(De,"px"),pe.maxWidth="",pe.maxHeight="";else if(z%2===1){Re=Le,De=J;var je=Le-J;U=-je/2/Re*100,F.x=z===3?U+c/2:U-c/2,B=je/2/De*100,F.y=z===3?B+v/2:B-v/2,F.scale=W,pe.width="".concat(Re,"px"),pe.maxWidth="".concat(Re,"px"),pe.height="".concat(De,"px"),pe.maxHeight="".concat(De,"px")}var Ve=A.getTransformStyle(F,this.media.style.transform||this.media.style.webkitTransform);pe.transform=Ve,pe.webkitTransform=Ve,Object.keys(pe).map(function(ge){e.media.style[ge]=pe[ge]})}}}},{key:"position",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{h:0,y:0,x:0,w:0};if(!(!this.media||!e||!e.h)){var s=this.videoPos;s.h=e.h*100||0,s.w=e.w*100||0,s.vx=e.x*100||0,s.vy=e.y*100||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var s=this;e&&Object.keys(e).map(function(c){if(c!=="plugins"){s.config[c]=e[c];var v=s.plugins[c.toLowerCase()];v&&A.typeOf(v.setConfig)==="Function"&&v.setConfig(e[c])}})}},{key:"playNext",value:function(e){var s=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,Gt(this,"playnext",function(){s.start(),s.emit(Ci,e)})}},{key:"resize",value:function(){var e=this;if(this.media){var s=this.root.getBoundingClientRect();this.sizeInfo.width=s.width,this.sizeInfo.height=s.height,this.sizeInfo.left=s.left,this.sizeInfo.top=s.top;var c=this.media,v=c.videoWidth,T=c.videoHeight,S=this.config,C=S.fitVideoSize,R=S.videoFillMode;if((R==="fill"||R==="cover"||R==="contain")&&this.setAttribute("data-xgfill",R),!(!T||!v)){this._videoHeight=T,this._videoWidth=v;var F=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,B=s.width,U=s.height-F,W=parseInt(v/T*1e3,10),z=parseInt(B/U*1e3,10),ne=B,te=U,J={};C==="auto"&&z>W||C==="fixWidth"?(te=B/W*1e3,this.config.fluid?J.paddingTop="".concat(te*100/ne,"%"):J.height="".concat(te+F,"px")):(C==="auto"&&z<W||C==="fixHeight")&&(ne=W*U/1e3,J.width="".concat(ne,"px")),!this.fullscreen&&!this.cssfullscreen&&Object.keys(J).forEach(function(pe){e.root.style[pe]=J[pe]}),(R==="fillHeight"&&z<W||R==="fillWidth"&&z>W)&&this.setAttribute("data-xgfill","cover");var Le={videoScale:W,vWidth:ne,vHeight:te,cWidth:ne,cHeight:te+F};this.resizePosition(),this.emit(ar,Le)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this.media.updateObjectPosition){this.media.updateObjectPosition(e,s);return}this.media.style.objectPosition="".concat(e*100,"% ").concat(s*100,"%")}},{key:"setState",value:function(e){we.logInfo("setState","state from:".concat(Ro[this.state]," to:").concat(Ro[e])),this._state=e}},{key:"preProcessUrl",value:function(e,s){var c=this.config,v=c.preProcessUrl,T=c.preProcessUrlOptions,S=Object.assign({},T,s);return!A.isBlob(e)&&typeof v=="function"?v(e,S):{url:e}}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){typeof e=="boolean"&&(this._hasStart=e,e===!1&&this.setState(Me.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===Me.RUNNING||this._state===Me.ENDED},set:function(e){e?this.setState(Me.RUNNING):this._state>=Me.RUNNING&&this.setState(Me.ATTACHED)}},{key:"definitionList",get:function(){return!this.config||!this.config.definition?[]:this.config.definition.list||[]},set:function(e){var s=this,c=this.config.definition,v=null,T=null;c.list=e,this.emit("resourceReady",e),e.forEach(function(S){var C;((C=s.curDefinition)===null||C===void 0?void 0:C.definition)===S.definition&&(v=S),c.defaultDefinition===S.definition&&(T=S)}),!T&&e.length>0&&(T=e[0]),v?this.changeDefinition(v):T&&this.changeDefinition(T)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var s=this.media.getVideoPlaybackQuality();return e.dropped=s.droppedVideoFrames||0,e.total=s.totalVideoFrames||0,e.corrupted=s.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var s=Rr.langKeys.filter(function(c){return c===e});if(s.length===0&&e!=="zh"){console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(Rr.langKeys.join(),"] "));return}this.config.lang=e,ut.setLang(e,this)}},{key:"i18n",get:function(){var e=this.config.lang;return e==="zh"&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return Wn}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return _e(Te(d.prototype),"readyState",this)}},{key:"error",get:function(){var e=_e(Te(d.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return _e(Te(d.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return this._fullScreenOffset!==null}},{key:"cumulateTime",get:function(){var e=this._accPlayed,s=e.acc,c=e.t;return c?new Date().getTime()-c+s:s}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=A.convertDeg(e),!(e%90!==0||e===this.videoPos.rotate)&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return Po},set:function(e){Po=e}},{key:"realTimeSpeed",get:function(){return Io},set:function(e){Io=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,s){return ki.call.apply(ki,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,s){return Ri.call.apply(Ri,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,s){return Ii.call.apply(Ii,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,s,c){for(var v=arguments.length,T=new Array(v>3?v-3:0),S=3;S<v;S++)T[S-3]=arguments[S];return So.call.apply(So,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,s,c){for(var v=arguments.length,T=new Array(v>3?v-3:0),S=3;S<v;S++)T[S-3]=arguments[S];return xo.call.apply(xo,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,s){var c;typeof s=="boolean"&&s!==this.muted&&(this.addInnerOP("volumechange"),A.typeOf(s)===Boolean&&(this.muted=s)),(c=tr)===null||c===void 0||c.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return we.config.debug},set:function(e){we.config.debug=e}},{key:"instManager",get:function(){return tr},set:function(e){tr=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return(e=tr)===null||e===void 0?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,s){var c;(c=tr)===null||c===void 0||c.setActive(e,s)}},{key:"isHevcSupported",value:function(){return Ae.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return Ae.probeConfigSupported(e)}},{key:"install",value:function(e,s){d.plugins||(d.plugins={}),d.plugins[e]||(d.plugins[e]=s)}},{key:"use",value:function(e,s){d.plugins||(d.plugins={}),d.plugins[e]=s}}]),d}(Wh);q(Ni,"defaultPreset",null);q(Ni,"XgVideoProxy",null);Ni.instManager=El.getInstance();function ht(){return new Date().getTime()}var rr={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},fd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"_onTimeupdate",function(){n._state.isTimeUpdate=!0,n._state.autoplayStart&&(we.logInfo("[xgLogger]".concat(n.player.playerId," _onTimeupdate")),n._sendFF("onTimeupdate"))}),q(K(n),"_onAutoplayStart",function(){we.logInfo("[xgLogger]".concat(n.player.playerId," _onAutoplayStart")),n._state.autoplayStart=!0,n.vt&&n._sendFF("onAutoplayStart")}),q(K(n),"_onReset",function(){n._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},n.vt=0,n.pt=0,n.fvt=0,n.newPointTime=ht(),n.loadedCostTime=0,n.startCostTime=0,n._isSeeking=!1,n.seekingStart=0,n.waitingStart=0,n.fixedWaitingStart=0,n._isWaiting=!1,n._waitTimer&&A.clearTimeout(K(n),n._waitTimer),n._waittTimer&&A.clearTimeout(K(n),n._waittTimer),n._waitTimer=null,n._waittTimer=null,n._waitType=0}),q(K(n),"_onSeeking",function(){n.seekingStart||(n.suspendWaitingStatus("seek"),n.seekingStart=ht(),n.emitLog(rr.SEEK_START,{start:ht()}))}),q(K(n),"_onSeeked",function(){n.suspendSeekingStatus("seeked")}),q(K(n),"_onWaitingLoadStart",function(){n._isWaiting||n.vt||(n._isWaiting=!0,n.waitingStart=ht(),n.fixedWaitingStart=ht(),n._waitType=1,n.emitLog(rr.WAIT_START,{fixedStart:n.fixedWaitingStart,start:n.waitingStart,type:1,endType:"loadstart"}))}),q(K(n),"_onWaiting",function(){n._isWaiting||!n.vt||(n._isWaiting=!0,n.vt?n.seekingStart?n._waitType=2:n._waitType=0:n._waitType=1,n.fixedWaitingStart=ht(),n._waitTimer=A.setTimeout(K(n),function(){n._isWaiting&&(n.waitingStart=ht(),A.clearTimeout(K(n),n._waitTimer),n._waitTimer=null,n._startWaitTimeout(),n.emitLog(rr.WAIT_START,{fixedStart:n.fixedWaitingStart,start:n.waitingStart,type:n._waitType,endType:n._waitType===2?"seek":"playing"}))},200))}),q(K(n),"_onError",function(){n.suspendSeekingStatus("error"),n.suspendWaitingStatus("error")}),q(K(n),"_onPlaying",function(){n._isWaiting&&n.suspendWaitingStatus("playing")}),n}return he(d,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=ht(),this.loadedCostTime=0,this.startCostTime=0,this.on(Zn,function(){var s=e._state,c=s.autoplayStart,v=s.isFFSend;e.startCostTime=ht()-e.newPointTime,we.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(c," isFFSend:").concat(v," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),!v&&(!s.isLs&&e.emitLog(rr.LOAD_START,{}),s.isLs=!0,s.isTimeUpdate=!1,s.isFFLoading=!0,e.pt=ht(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())}),this.on(qt,function(){e.vt=ht(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var s=e._state,c=s.isTimeUpdate,v=s.isFFSend,T=s.autoplayStart;we.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(c||T)&&e._sendFF("loadedData"),v||e.emitLog(rr.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")}),this.on(Oi,this._onSeeking),this.on($t,this._onSeeked),this.on(ra,function(){e.endState("destroy")}),this.on(Yr,function(){e.endState("urlChange"),we.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()}),this.on([Qn,zt],this._onPlaying),this.on(jr,this._onWaiting),this.on(Wr,this._onError),this.on(Fi,function(){we.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()})}},{key:"_initOnceEvents",value:function(){this.off(fr,this._onAutoplayStart),this.off(Lt,this._onTimeupdate),this.once(fr,this._onAutoplayStart),this.once(Lt,this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=ht();var s=this._state,c=s.isFFLoading,v=s.isFFSend;we.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(c," !isFFSend:").concat(!v)),this.vt>0&&c&&!v&&(we.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(rr.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&A.clearTimeout(this,this._waittTimer),this._waittTimer=A.setTimeout(this,function(){e.suspendWaitingStatus("timeout"),A.clearTimeout(e,e._waittTimer),e._waittTimer=null},this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var s=ht(),c=s-this.seekingStart;this.seekingStart=0,this.emitLog(rr.SEEK_END,{end:s,costTime:c,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(A.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(A.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,!!this.waitingStart){var s=ht(),c=s-this.waitingStart,v=s-this.fixedWaitingStart,T=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(rr.WAIT_END,{fixedCostTime:v>T?T:v,costTime:c>T?T:c,type:e==="loadeddata"?1:this._waitType,endType:this._waitType===2?"seek":e})}}},{key:"emitLog",value:function(e,s){var c=this.player;this.emit(ul,Xe({t:ht(),host:A.getHostFromUrl(c.currentSrc),vtype:c.vtype,eventType:e,currentTime:this.player.currentTime,readyState:c.video.readyState,networkState:c.video.networkState},s))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),d}(Fe);function cd(){return new DOMParser().parseFromString(`<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">
  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>
</svg>
`,"image/svg+xml").firstChild}var hd=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"registerIcons",value:function(){return{replay:cd}}},{key:"afterCreate",value:function(){var e=this;Fe.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",function(){e.player.replay()},{pre:function(c){c.preventDefault(),c.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(cr,function(){if(e.playerConfig.loop||A.addClass(e.player.root,"replay"),!e.config.disable){e.show();var s=e.root.querySelector("path");if(s){var c=window.getComputedStyle(s).getPropertyValue("transform");if(typeof c=="string"&&c.indexOf("none")>-1)return null;s.setAttribute("transform",c)}}}),this.on(Ct,function(){e.hide()})}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),A.removeClass(this.player.root,"replay")}},{key:"show",value:function(e){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return`<xg-replay class="xgplayer-replay">
      <xg-replay-txt class="xgplayer-replay-txt" lang-key="`.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,`</xg-replay-txt>
    </xg-replay>`)}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),d}(Fe),dd=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){A.addClass(this.root,"hide")}},{key:"show",value:function(e){A.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){typeof e.player.config.poster=="string"&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(cr,function(){e.isEndedShow&&A.removeClass(e.root,"hide")}),this.config.hideCanplay?(this.once(Lt,function(){e.onTimeUpdate()}),this.on(Yr,function(){A.removeClass(e.root,"hide"),A.addClass(e.root,"xg-showplay"),e.once(Lt,function(){e.onTimeUpdate()})})):this.on(Ct,function(){A.addClass(e.root,"hide")})}},{key:"setConfig",value:function(e){var s=this;Object.keys(e).forEach(function(v){s.config[v]=e[v]});var c=this.config.poster;this.update(c)}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?A.removeClass(this.root,"xg-showplay"):this.once(Lt,function(){e.onTimeUpdate()})}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"getBgSize",value:function(e){var s="";switch(e){case"cover":s="cover";break;case"contain":s="contain";break;case"fixHeight":s="auto 100%";break;default:s=""}return s?"background-size: ".concat(s,";"):""}},{key:"render",value:function(){var e=this.config,s=e.poster,c=e.hideCanplay,v=e.fillMode,T=e.notHidden,S=this.getBgSize(v),C=s?"background-image:url(".concat(s,");").concat(S):S,R=T?"xg-not-hidden":c?"xg-showplay":"";return'<xg-poster class="xgplayer-poster '.concat(R,'" style="').concat(C,`">
    </xg-poster>`)}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),d}(Fe);function aa(){return new DOMParser().parseFromString(`<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>
</svg>
`,"image/svg+xml").firstChild}function sa(){return new DOMParser().parseFromString(`<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>
</svg>
`,"image/svg+xml").firstChild}var Ht={};function vd(y,m){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{start:null,end:null};return Ht[y]&&window.clearTimeout(Ht[y].id),Ht[y]={},d.start&&d.start(),Ht[y].id=window.setTimeout(function(){d.end&&d.end(),window.clearTimeout(Ht[y].id),delete Ht[y]},m),Ht[y].id}function wo(y){if(y){window.clearTimeout(y);return}Object.keys(Ht).map(function(m){window.clearTimeout(Ht[m].id),delete Ht[m]})}var gd=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"onPlayerReset",function(){e.autoPlayStart=!1;var s=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),A.removeClass(e.root,s),e.show()}),q(K(e),"onAutoplayStart",function(){if(!e.autoPlayStart){var s=e.config.mode==="auto"?"auto-hide":"hide";A.addClass(e.root,s),e.autoPlayStart=!0,e.toggleTo("play")}}),e.autoPlayStart=!1,e}return he(d,[{key:"afterCreate",value:function(){var e=this.playerConfig;this.initIcons(),this.listenEvents(),this.bindClickEvents(),e.autoplay||this.show()}},{key:"listenEvents",value:function(){var e=this,s=this.player,c=this.playerConfig;this.once(ea,function(){c&&(c.lang&&c.lang==="en"?A.addClass(s.root,"lang-is-en"):c.lang==="jp"&&A.addClass(s.root,"lang-is-jp"))}),this.on(fr,this.onAutoplayStart),this.on(ta,function(){var v=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),A.removeClass(e.root,v),e.show()}),this.on(Ct,function(){e.toggleTo("play")}),this.on(Pr,function(){e.toggleTo("pause")}),this.on(Fi,function(){e.onPlayerReset()})}},{key:"bindClickEvents",value:function(){var e=this;this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(c){c.cancelable&&c.preventDefault(),c.stopPropagation();var v=e.player.paused;e.emitUserAction(c,"switch_play_pause",{props:"paused",from:v,to:!v})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:aa,class:"xg-icon-play"},startPause:{icon:sa,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){A.addClass(this.root,"hide")}},{key:"show",value:function(e){A.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){A.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){A.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var s=this;this._animateId=vd("pauseplay",400,{start:function(){A.addClass(s.root,"interact"),s.show(),s.switchStatus(!0)},end:function(){A.removeClass(s.root,"interact"),!e&&s.hide(),s._animateId=null}})}},{key:"endAnimate",value:function(){A.removeClass(this.root,"interact"),wo(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(e){var s=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(s.state<Me.READY)){var c=this.player.paused;!c&&s.state===Me.RUNNING?s.pause():s.play()}}},{key:"onPlayPause",value:function(e){this.toggleTo(e)}},{key:"toggleTo",value:function(e){var s=this.config,c=this.player;if(!(!c||c.state<Me.RUNNING||!this.autoPlayStart)){if(s.mode==="show"){this.switchStatus(),this.show();return}if(s.mode==="auto"){this.switchStatus();return}if(s.isShowPause&&c.paused&&!c.ended||s.isShowEnd&&c.ended){this.switchStatus(),this.show(),this.endAnimate();return}if(s.disableAnimate){this.switchStatus(),this.hide();return}if(e==="play")this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||c.ended)return;this.animate()}}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),wo(this._animateId)}},{key:"render",value:function(){var e=this.playerConfig.autoplay?this.config.mode==="auto"?"auto-hide":"hide":"";return`
    <xg-start class="xgplayer-start `.concat(e,`">
    <xg-start-inner></xg-start-inner>
    </xg-start>`)}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),d}(Fe),pd=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"render",value:function(){var e=this.config.innerHtml,s=A.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)s.appendChild(e);else if(e&&typeof e=="string")s.innerHTML=e;else{for(var c="",v=1;v<=12;v++)c+='<div class="xgplayer-enter-bar'.concat(v,'"></div>');s.innerHTML='<div class="xgplayer-enter-spinner">'.concat(c,"</div>")}return s}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),d}(Fe);function sr(y,m,d){try{return' <div class="xg-tips '.concat(d?"hide":" ",'" lang-key="').concat(y.i18nKeys[m],`">
    `).concat(y.i18n[m],`
    </div>`)}catch{return'<div class="xg-tips hide"></div>'}}var Do=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return`
      <xg-icon class="xgplayer-miniicon">
      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="`.concat(this.i18nKeys[e],'">').concat(this.i18n[e],`</span></div>
      </xg-icon>`)}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:10}}}]),d}(Fe);function Oo(y){var m=parseFloat(y),d=y.indexOf("%")===-1&&!Number.isNaN(m);return d&&m}var oa=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],Tl=oa.length;function md(){for(var y={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},m=0;m<Tl;m++){var d=oa[m];y[d]=0}return y}function yd(y){var m=window.getComputedStyle(y);return m}function Mo(y){if(typeof y=="string"&&(y=document.querySelector(y)),!(!y||dt(y)!=="object"||!y.nodeType)){var m=yd(y);if(m.display==="none")return md();var d={};d.width=y.offsetWidth,d.height=y.offsetHeight;for(var n=d.isBorderBox=m.boxSizing==="border-box",e=0;e<Tl;e++){var s=oa[e],c=m[s],v=parseFloat(c);d[s]=Number.isNaN(v)?0:v}var T=d.paddingLeft+d.paddingRight,S=d.paddingTop+d.paddingBottom,C=d.marginLeft+d.marginRight,R=d.marginTop+d.marginBottom,F=d.borderLeftWidth+d.borderRightWidth,B=d.borderTopWidth+d.borderBottomWidth,U=n,W=Oo(m.width);W!==!1&&(d.width=W+(U?0:T+F));var z=Oo(m.height);return z!==!1&&(d.height=z+(U?0:S+B)),d.innerWidth=d.width-(T+F),d.innerHeight=d.height-(S+B),d.outerWidth=d.width+C,d.outerHeight=d.height+R,d}}function Dn(y,m){for(var d=0;d<y.length;d++){var n=y[d];if(n.identifier===m)return n}}var On={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},Fo={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Ed=function(y){me(d,y);var m=ye(d);function d(n){var e,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ce(this,d),e=m.call(this),e.isEnabled=!0,e.isDragging=!1,e.isDown=!1,e.position={},e.downPoint={},e.dragPoint={x:0,y:0},e.startPos={x:0,y:0},e._root=n instanceof Element?n:document.querySelector(n),e._handlerDom=s.handle instanceof Element?s.handle:document.querySelector(s.handle),!e._root||!e._handlerDom?Xn(e):(e._bindStartEvent(),e)}return he(d,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),Fo[this._startKey].map(function(s){e["on".concat(s)]=e["on".concat(s)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var s=this;if(e){var c=Fo[this._startKey];c.map(function(v){window.addEventListener(v,s["on".concat(v)])}),this._boundPointerEvents=c}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map(function(s){window.removeEventListener(s,e["on".concat(s)])}),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame(function(){e.animate()}))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var s=e.changedTouches[0];this.dragStart(e,s),this.touchIdentifier=s.pointerId!==void 0?s.pointerId:s.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var s=Dn(e.changedTouches,this.touchIdentifier);s&&this.dragMove(e,s)}},{key:"ontouchend",value:function(e){var s=Dn(e.changedTouches,this.touchIdentifier);s&&this.dragEnd(e,s),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var s=Dn(e.changedTouches,this.touchIdentifier);s&&this.dragCancel(e,s)}},{key:"dragStart",value:function(e,s){if(!(!this._root||this.isDown||!this.isEnabled)){this.downPoint=s,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var c=Mo(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-c.height,this.startPos.maxX=window.innerWidth-c.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,s){this.isDragging=!0,this.animate(),this.emit(On.START,this.startPos)}},{key:"dragEnd",value:function(e,s){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(On.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,s){var c={x:s.pageX-this.downPoint.pageX,y:s.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(c)&&this.dragRealStart(e,s),c}},{key:"dragMove",value:function(e,s){if(e=e||window.event,!!this.isDown){var c=this.startPos,v=c.x,T=c.y,S=this._dragPointerMove(e,s),C=S.x,R=S.y;C=this.checkContain("x",C,v),R=this.checkContain("y",R,T),this.position.x=v+C,this.position.y=T+R,this.dragPoint.x=C,this.dragPoint.y=R,this.emit(On.MOVE,this.position)}}},{key:"dragCancel",value:function(e,s){this.dragEnd(e,s)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,s,c){return s+c<0?0-c:e==="x"&&s+c>this.startPos.maxX?this.startPos.maxX-c:e==="y"&&s+c>this.startPos.maxY?this.startPos.maxY-c:s}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),s=this._getPositionCoord(e.left,"width"),c=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(s)?0:s,this.position.y=Number.isNaN(c)?0:c,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var s=e.transform;if(s.indexOf("matrix")===0){var c=s.split(","),v=s.indexOf("matrix3d")===0?12:4,T=parseInt(c[v],10),S=parseInt(c[v+1],10);this.position.x+=T,this.position.y+=S}}},{key:"_getPositionCoord",value:function(e,s){if(e.indexOf("%")!==-1){var c=Mo(this._root.parentNode);return c?parseFloat(e)/100*c[s]:0}return parseInt(e,10)}}]),d}(Xo),Td=function(y){me(d,y);var m=ye(d);function d(n){var e;ce(this,d),e=m.call(this,n),q(K(e),"onCancelClick",function(v){e.exitMini(),e.isClose=!0}),q(K(e),"onCenterClick",function(v){var T=K(e),S=T.player;S.paused?S.play():S.pause()}),q(K(e),"onScroll",function(v){if(!(!window.scrollY&&window.scrollY!==0||Math.abs(window.scrollY-e.pos.scrollY)<50)){var T=parseInt(A.getCss(e.player.root,"height"));T+=e.config.scrollTop,e.pos.scrollY=window.scrollY,window.scrollY>T+5?!e.isMini&&!e.isClose&&e.getMini():window.scrollY<=T&&(e.isMini&&e.exitMini(),e.isClose=!1)}}),e.isMini=!1,e.isClose=!1;var s=K(e),c=s.config;return e.pos={left:c.left<0?window.innerWidth-c.width-20:c.left,top:c.top<0?window.innerHeight-c.height-20:c.top,height:e.config.height,width:e.config.width,scrollY:window.scrollY||0},e.lastStyle=null,e}return he(d,[{key:"beforeCreate",value:function(e){typeof e.player.config.mini=="boolean"&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(Pr,function(){e.setAttr("data-state","pause")}),this.on(Ct,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,s=this.player,c=this.config;if(!c.disable){if(this.config.isShowIcon){var v={config:{onClick:function(){e.getMini()}}};s.controls.registerPlugin(Do,v,Do.pluginName)}var T=A.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",T,this.onCancelClick),this.bind(".play-icon",T,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Ed(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:aa,class:"xg-icon-play"},pause:{icon:sa,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var s=this.player,c=this.playerConfig,v=this.config.target||this.player.root;this.lastStyle={},A.addClass(s.root,"xgplayer-mini"),["width","height","top","left"].map(function(T){e.lastStyle[T]=v.style[T],v.style[T]="".concat(e.pos[T],"px")}),c.fluid&&(v.style["padding-top"]=""),this.emit(Li,!0),s.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var s=this.player,c=this.playerConfig,v=this.config.target||this.player.root;A.removeClass(s.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(T){v.style[T]=e.lastStyle[T]}),this.lastStyle=null,c.fluid&&(s.root.style.width="100%",s.root.style.height="0",s.root.style["padding-top"]="".concat(c.height*100/c.width,"%")),this.emit(Li,!1),this.isMini=s.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=A.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return`
      <xg-mini-layer class="xg-mini-layer">
      <xg-mini-header class="xgplayer-mini-header">
      `.concat(sr(this,"MINI_DRAG",this.playerConfig.isHideTips),`
      </xg-mini-header>
      <div class="mini-cancel-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>
        </svg>
      </div>
      <div class="play-icon">
      </div>
      </xg-mini-layer>`)}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),d}(Fe),yi={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},Mn=["videoClick","videoDbClick"],Fn=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onMouseMove",function(v){var T=K(n),S=T.player,C=T.playerConfig;S.isActive||(S.focus({autoHide:!C.closeDelayBlur}),!C.closeFocusVideoFocus&&S.media.focus())}),q(K(n),"onMouseEnter",function(v){var T=K(n),S=T.playerConfig,C=T.player;!S.closeFocusVideoFocus&&C.media.focus(),S.closeDelayBlur?C.focus({autoHide:!1}):C.focus(),n.emit(nl)}),q(K(n),"onMouseLeave",function(v){var T=n.playerConfig,S=T.closePlayerBlur,C=T.leavePlayerTime,R=T.closeDelayBlur;!S&&!R&&(C?n.player.focus({autoHide:!0,delay:C}):n.player.blur({ignorePaused:!0})),n.emit(il)}),q(K(n),"onVideoClick",function(v){var T=K(n),S=T.player,C=T.playerConfig;v.target&&C.closeVideoClick||(v.target===S.root||v.target===S.media||v.target===S.innerContainer||v.target===S.media.__canvas)&&(v.preventDefault(),C.closeVideoStopPropagation||v.stopPropagation(),n._clickCount++,n.clickTimer&&(clearTimeout(n.clickTimer),n.clickTimer=null),n.clickTimer=setTimeout(function(){n._clickCount&&(n._clickCount--,Gt(K(n),Mn[0],function(R,F){n.switchPlayPause(F.e)},{e:v,paused:S.paused}),clearTimeout(n.clickTimer),n.clickTimer=null)},300))}),q(K(n),"onVideoDblClick",function(v){var T=K(n),S=T.player,C=T.playerConfig;if(!(C.closeVideoDblclick||!v.target||v.target!==S.media&&v.target!==S.media.__canvas)){if(!C.closeVideoClick&&n._clickCount<2){n._clickCount=0;return}n._clickCount=0,n.clickTimer&&(clearTimeout(n.clickTimer),n.clickTimer=null),v.preventDefault(),v.stopPropagation(),Gt(K(n),Mn[1],function(R,F){n.emitUserAction(F.e,"switch_fullscreen",{props:"fullscreen",from:S.fullscreen,to:!S.fullscreen}),S.fullscreen?S.exitFullscreen():S.getFullscreen()},{e:v,fullscreen:S.fullscreen})}}),n}return he(d,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,Mn.map(function(c){e.__hooks[c]=null});var s=this.playerConfig.isMobileSimulateMode;s==="mobile"||Ae.device==="mobile"&&!Ae.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,s=this.player,c=s.media,v=s.root,T=this.playerConfig.enableContextmenu;v&&v.addEventListener("click",this.onVideoClick,!1),v&&v.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(yi).map(function(S){v.addEventListener(S,e[yi[S]],!1)}),!T&&c&&c.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var s=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:s.paused,to:!s.paused}),s.ended?s.duration!==1/0&&s.duration>0&&s.replay():s.paused?s.play():s.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,s=this.player,c=s.video,v=s.root;this.clickTimer&&clearTimeout(this.clickTimer),v.removeEventListener("click",this.onVideoClick,!1),v.removeEventListener("dblclick",this.onVideoDblClick,!1),c.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(yi).map(function(T){v.removeEventListener(T,e[yi[T]],!1)})}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),d}(Dt),ir={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},Sd={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},xd={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function No(y){return y&&y.length>0?y[y.length-1]:null}function _d(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var bd=function(){function y(m){var d=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{eventType:"touch"};ce(this,y),q(this,"onTouchStart",function(e){var s=d._pos,c=d.root,v=No(e.touches);s.x=v?parseInt(v.pageX,10):e.pageX,s.y=v?parseInt(v.pageX,10):e.pageX,s.start=!0,d.__setPress(e),c.addEventListener(d.events.end,d.onTouchEnd),c.addEventListener(d.events.cancel,d.onTouchCancel),c.addEventListener(d.events.move,d.onTouchMove),d.trigger(ir.TOUCH_START,e)}),q(this,"onTouchCancel",function(e){d.onTouchEnd(e)}),q(this,"onTouchEnd",function(e){var s=d._pos,c=d.root;d.__clearPress(),c.removeEventListener(d.events.cancel,d.onTouchCancel),c.removeEventListener(d.events.end,d.onTouchEnd),c.removeEventListener(d.events.move,d.onTouchMove),e.moving=s.moving,e.press=s.press,s.press&&d.trigger(ir.PRESS_END,e),d.trigger(ir.TOUCH_END,e),!s.press&&!s.moving&&d.__setDb(e),s.press=!1,s.start=!1,s.moving=!1}),q(this,"onTouchMove",function(e){var s=d._pos,c=d.config,v=No(e.touches),T=v?parseInt(v.pageX,10):e.pageX,S=v?parseInt(v.pageY,10):e.pageX,C=T-s.x,R=S-s.y;Math.abs(R)<c.miniStep&&Math.abs(C)<c.miniStep||(d.__clearPress(),s.press&&d.trigger(ir.PRESS_END,e),s.press=!1,s.moving=!0,d.trigger(ir.TOUCH_MOVE,e))}),this._pos={moving:!1,start:!1,x:0,y:0},this.config=_d(),Object.keys(n).map(function(e){d.config[e]=n[e]}),this.root=m,this.events=n.eventType==="mouse"?xd:Sd,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return he(y,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(d){var n=this,e=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout(function(){n.trigger(ir.PRESS,d),n._pos.press=!0,n.__clearPress()},e.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(d){var n=this,e=this.config;if(this.dbIntrvalId){this.__clearDb(),this.trigger(ir.DOUBlE_CLICK,d);return}this.dbIntrvalId=setTimeout(function(){n.__clearDb(),!n._pos.start&&!n._pos.press&&!n._pos.moving&&n.trigger(ir.CLICK,d)},e.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(d,n){this.__handlers[d]||(this.__handlers[d]=[]),this.__handlers[d].push(n)}},{key:"off",value:function(d,n){if(this.__handlers[d]){for(var e=this.__handlers[d],s=-1,c=0;c<e.length;c++)if(e[c]===n){s=c;break}s>=0&&this.__handlers[d].splice(s,1)}}},{key:"trigger",value:function(d,n){this.__handlers[d]&&this.__handlers[d].map(function(e){try{e(n)}catch(s){console.error("trigger>>:".concat(d),s)}})}},{key:"destroy",value:function(){var d=this,n={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(n).forEach(function(e){d.root.removeEventListener(e,d[n[e]])})}}]),y}();function Ld(){return new DOMParser().parseFromString(`<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path opacity="0.54"
    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"
    fill="white" />
  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>
</svg>`,"image/svg+xml").firstChild}var _r={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate"},Nn=["videoClick","videoDbClick"],Cd=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"onTouchStart",function(s){var c=K(e),v=c.player,T=c.config,S=c.pos,C=c.playerConfig,R=e.getTouche(s);if(R&&!T.disableGesture&&e.duration>0&&!v.ended){S.isStart=!0,e.timer&&clearTimeout(e.timer),A.checkIsFunction(C.disableSwipeHandler)&&C.disableSwipeHandler(),e.find(".xg-dur").innerHTML=A.format(e.duration);var F=e.root.getBoundingClientRect();v.rotateDeg===90?(S.top=F.left,S.left=F.top,S.width=F.height,S.height=F.width):(S.top=F.top,S.left=F.left,S.width=F.width,S.height=F.height);var B=parseInt(R.pageX-S.left,10),U=parseInt(R.pageY-S.top,10);S.x=v.rotateDeg===90?U:B,S.y=v.rotateDeg===90?B:U,S.scopeL=T.scopeL*S.width,S.scopeR=(1-T.scopeR)*S.width,S.scopeM1=S.width*(1-T.scopeM)/2,S.scopeM2=S.width-S.scopeM1}}),q(K(e),"onTouchMove",function(s){var c=e.getTouche(s),v=K(e),T=v.pos,S=v.config,C=v.player;if(!(!c||S.disableGesture||!e.duration||!T.isStart)){var R=S.miniMoveStep,F=S.hideControlsActive,B=parseInt(c.pageX-T.left,10),U=parseInt(c.pageY-T.top,10),W=C.rotateDeg===90?U:B,z=C.rotateDeg===90?B:U;if(Math.abs(W-T.x)>R||Math.abs(z-T.y)>R){var ne=W-T.x,te=z-T.y,J=T.scope;if(J===-1&&(J=e.checkScope(W,z,ne,te,T),J===0&&(F?C.blur():C.focus({autoHide:!1}),!T.time&&(T.time=parseInt(C.currentTime*1e3,10)+e.timeOffset*1e3)),T.scope=J),J===-1||J>0&&!S.gestureY||J===0&&!S.gestureX)return;e.executeMove(ne,te,J,T.width,T.height),T.x=W,T.y=z}}}),q(K(e),"onTouchEnd",function(s){var c=K(e),v=c.player,T=c.pos,S=c.playerConfig;if(setTimeout(function(){v.getPlugin("progress")&&v.getPlugin("progress").resetSeekState()},10),!!T.isStart){T.scope>-1&&s.cancelable&&s.preventDefault();var C=e.config,R=C.disableGesture,F=C.gestureX;!R&&F?e.endLastMove(T.scope):T.time=0,T.scope=-1,e.resetPos(),A.checkIsFunction(S.enableSwipeHandler)&&S.enableSwipeHandler(),e.changeAction(_r.AUTO)}}),q(K(e),"onRootTouchMove",function(s){e.config.disableGesture||!e.config.gestureX||e.checkIsRootTarget(s)&&(s.stopPropagation(),e.pos.isStart?e.onTouchMove(s):e.onTouchStart(s))}),q(K(e),"onRootTouchEnd",function(s){e.pos.scope>-1&&e.onTouchEnd(s)}),e.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},e.timer=null,e}return he(d,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:Ld,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;Nn.map(function(F){e.__hooks[F]=null});var s=this.playerConfig,c=this.config,v=this.player;s.closeVideoDblclick===!0&&(c.closedbClick=!0),this.resetPos(),A.isUndefined(s.disableGesture)||(c.disableGesture=!!s.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=A.createDom("xg-mask","",{},"xgmask"),v.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var T=this.domEventType==="mouse"?"mouse":"touch";this.touch=new bd(this.root,{eventType:T,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",function(F){F.preventDefault()}),v.root.addEventListener("touchmove",this.onRootTouchMove,!0),v.root.addEventListener("touchend",this.onRootTouchEnd,!0),v.root.addEventListener("touchcancel",this.onRootTouchEnd,!0);var S=this.player.controls;S&&S.center&&(S.center.addEventListener("touchmove",this.onRootTouchMove,!0),S.center.addEventListener("touchend",this.onRootTouchEnd,!0),S.center.addEventListener("touchcancel",this.onRootTouchEnd,!0)),this.on(Xt,function(){var F=e.player,B=e.config;F.duration>0&&F.duration*1e3<B.moveDuration&&(B.moveDuration=F.duration*1e3)}),this.on([zt,cr],function(){var F=e.pos,B=F.time,U=F.isStart;!U&&B>0&&(e.pos.time=0)});var C={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(C).map(function(F){e.touch.on(F,function(B){e[C[F]](B)})}),!c.disableActive){var R=v.plugins.progress;R&&(R.addCallBack("dragmove",function(F){e.activeSeekNote(F.currentTime,F.forward)}),["dragend","click"].forEach(function(F){R.addCallBack(F,function(){e.changeAction(_r.AUTO)})}))}}},{key:"registerThumbnail",value:function(){var e=this.player,s=e.plugins.thumbnail;if(s&&s.usable){this.thumbnail=s.createThumbnail(null,"mobile-thumbnail");var c=this.find(".time-preview");c.insertBefore(this.thumbnail,c.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},s=e.commonStyle,c=s.playedColor,v=s.progressColor,T=s.timePreviewStyle,S=s.curTimeColor,C=s.durationColor;if(c&&(this.find(".xg-curbar").style.backgroundColor=c),v&&(this.find(".xg-bar").style.backgroundColor=v),T){var R=this.find(".time-preview");Object.keys(T).forEach(function(U){R.style[U]=T[U]})}var F=S||c,B=C;F&&(this.find(".xg-cur").style.color=F),B&&(this.find(".xg-dur").style.color=B),this.config.disableTimeProgress&&A.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map(function(s){e.pos[s]=0})):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var s=this.player,c=this.root;c.setAttribute("data-xg-action",e);var v=s.plugins.start;v&&v.recover()}},{key:"getTouche",value:function(e){var s=this.player.rotateDeg,c=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return s===0?{pageX:c.pageX,pageY:c.pageY}:{pageX:c.pageX,pageY:c.pageY}}},{key:"checkScope",value:function(e,s,c,v,T){var S=T.width,C=-1;if(e<0||e>S)return C;var R=Math.abs(v===0?c:c/v);return Math.abs(c)>0&&R>=1.73&&e>T.scopeM1&&e<T.scopeM2?C=0:(Math.abs(c)===0||R<=.57)&&(C=e<T.scopeL?1:e>T.scopeR?2:3),C}},{key:"executeMove",value:function(e,s,c,v,T){switch(c){case 0:this.updateTime(e/v*this.config.scopeM);break;case 1:this.updateBrightness(s/T);break;case 2:Ae.os.isIos||this.updateVolume(s/T);break}}},{key:"endLastMove",value:function(e){var s=this,c=this.pos,v=this.player,T=this.config,S=(c.time-this.timeOffset)/1e3;switch(e){case 0:v.seek(Number(S).toFixed(1)),T.hideControlsEnd?v.blur():v.focus(),this.timer=setTimeout(function(){s.pos.time=0},500);break}this.changeAction(_r.AUTO)}},{key:"checkIsRootTarget",value:function(e){var s=this.player.plugins||{};return s.progress&&s.progress.root.contains(e.target)?!1:s.start&&s.start.root.contains(e.target)||s.controls&&s.controls.root.contains(e.target)}},{key:"sendUseAction",value:function(e){var s=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:s,to:!s})}},{key:"clickHandler",value:function(e){var s=this.player,c=this.config,v=this.playerConfig;if(s.state<Me.RUNNING){v.closeVideoClick||(this.sendUseAction(A.createEvent("click")),s.play());return}!c.closedbClick||v.closeVideoClick?s.isActive?s.blur():s.focus():v.closeVideoClick||((s.isActive||c.focusVideoClick)&&(this.sendUseAction(A.createEvent("click")),this.switchPlayPause()),s.focus())}},{key:"dbClickHandler",value:function(e){var s=this.config,c=this.player;!s.closedbClick&&c.state>=Me.RUNNING&&(this.sendUseAction(A.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var s=this,c=this.player;Gt(this,Nn[0],function(v,T){s.clickHandler(T.e)},{e,paused:c.paused})}},{key:"onDbClick",value:function(e){var s=this,c=this.player;Gt(this,Nn[1],function(v,T){s.dbClickHandler(T.e)},{e,paused:c.paused})}},{key:"onPress",value:function(e){var s=this.pos,c=this.config,v=this.player;c.disablePress||(s.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:v.playbackRate,to:c.pressRate}),v.playbackRate=c.pressRate,this.changeAction(_r.PLAYBACK))}},{key:"onPressEnd",value:function(e){var s=this.pos,c=this.config,v=this.player;c.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:v.playbackRate,to:s.rate}),v.playbackRate=s.rate,s.rate=1,this.changeAction(_r.AUTO))}},{key:"updateTime",value:function(e){var s=this.player,c=this.config,v=this.player.duration;e=Number(e.toFixed(4));var T=parseInt(e*c.moveDuration,10)+this.timeOffset;T+=this.pos.time,T=T<0?0:T>v*1e3?v*1e3-200:T,s.getPlugin("time")&&s.getPlugin("time").updateTime(T/1e3),s.getPlugin("progress")&&s.getPlugin("progress").updatePercent(T/1e3/this.duration,!0),this.activeSeekNote(T/1e3,e>0),c.isTouchingSeek&&s.seek(Number((T-this.timeOffset)/1e3).toFixed(1)),this.pos.time=T}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var s=this.player,c=this.pos;if(e=parseInt(e*100,10),c.volume+=e,!(Math.abs(c.volume)<10)){var v=parseInt(s.volume*10,10)-parseInt(c.volume/10,10);v=v>10?10:v<1?0:v,s.volume=v/10,c.volume=0}}},{key:"updateBrightness",value:function(e){var s=this.pos,c=this.config,v=this.xgMask;if(c.darkness){this.player.rotateDeg&&(e=-e);var T=s.light+.8*e;T=T>c.maxDarkness?c.maxDarkness:T<0?0:T,v&&(v.style.backgroundColor="rgba(0,0,0,".concat(T,")")),s.light=T}}},{key:"activeSeekNote",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,c=this.player,v=this.config,T=!(this.duration!==1/0&&this.duration>0);if(!(!e||typeof e!="number"||T||v.disableActive)){e<0?e=0:e>c.duration&&(e=c.duration-.2),this.changeAction(_r.SEEKING);var S=c.plugins.start;S&&S.focusHide(),this.find(".xg-dur").innerHTML=A.format(this.duration),this.find(".xg-cur").innerHTML=A.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),s?A.removeClass(this.find(".xg-seek-show"),"xg-back"):A.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var s=this.player,c=s.plugins.thumbnail;c&&c.usable&&this.thumbnail&&c.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<Me.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!0}},{key:"enableGesture",value:function(){this.config.disableGesture=!1}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0),e.root.removeEventListener("touchcancel",this.onRootTouchEnd,!0);var s=this.player.controls;s&&s.center&&(s.center.removeEventListener("touchmove",this.onRootTouchMove,!0),s.center.removeEventListener("touchend",this.onRootTouchEnd,!0),s.center.removeEventListener("touchcancel",this.onRootTouchEnd,!0))}},{key:"render",value:function(){var e=this.config.gradient!=="normal"?"gradient ".concat(this.config.gradient):"gradient";return`
     <xg-trigger class="trigger">
     <div class="`.concat(e,`"></div>
        <div class="time-preview">
            <div class="xg-seek-show `).concat(this.config.disableSeekIcon?" hide-seek-icon":"",`">
              <i class="xg-seek-icon"></i>
              <span class="xg-cur">00:00</span>
              <span class="xg-separator">/</span>
              <span class="xg-dur">00:00</span>
            </div>
              <div class="xg-bar xg-timebar">
                <div class="xg-curbar"></div>
              </div>
        </div>
        <div class="xg-playbackrate xg-top-note">
            <span><i>`).concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,`</span>
        </div>
     </xg-trigger>
    `)}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:60*6*1e3,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),d}(Fe);function Ad(y){y.preventDefault(),y.returnValue=!1}function Bo(y){var m=y.tagName;return!!(m==="INPUT"||m==="TEXTAREA"||y.isContentEditable)}var Uo=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onBodyKeyDown",function(v){if(n.player){var T=v||window.event,S=T.keyCode,C=K(n),R=C._keyState,F=C.player,B=n.config,U=B.disable,W=B.disableBodyTrigger,z=B.isIgnoreUserActive;if(U||W||!(F.isUserActive||z)||Bo(T.target)||!n.checkIsVisible()||T.metaKey||T.altKey||T.ctrlKey){R.isBodyKeyDown=!1;return}!v.repeat&&!R.isKeyDown&&((T.target===document.body||n.config.isGlobalTrigger&&!Bo(T.target))&&n.checkCode(S,!0)&&(R.isBodyKeyDown=!0),document.addEventListener("keyup",n.onBodyKeyUp)),R.isBodyKeyDown&&n.handleKeyDown(T)}}),q(K(n),"onBodyKeyUp",function(v){n.player&&(document.removeEventListener("keyup",n.onBodyKeyUp),n.handleKeyUp(v))}),q(K(n),"onKeydown",function(v){if(n.player){var T=v||window.event,S=K(n),C=S._keyState;if(!T.repeat){if(n.config.disable||n.config.disableRootTrigger||T.metaKey||T.altKey||T.ctrlKey)return;T&&(T.keyCode===37||n.checkCode(T.keyCode))&&(T.target===n.player.root||T.target===n.player.video||T.target===n.player.controls.el)&&(C.isKeyDown=!0),n.player.root.addEventListener("keyup",n.onKeyup)}C.isKeyDown&&n.handleKeyDown(T)}}),q(K(n),"onKeyup",function(v){n.player&&(n.player.root.removeEventListener("keyup",n.onKeyup),n.handleKeyUp(v))}),n}return he(d,[{key:"mergekeyCodeMap",value:function(){var e=this,s=this.config.keyCodeMap;s&&Object.keys(s).map(function(c){e.keyCodeMap[c]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map(function(v){s[c][v]&&(e.keyCodeMap[c][v]=s[c][v])}):e.keyCodeMap[c]=s[c]})}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e=typeof this.config.seekStep=="function"?this.config.seekStep(this.player):this.config.seekStep;!e||typeof e!="number"||(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(e){var s=this;Object.keys(e).forEach(function(c){s.config[c]=e[c]})}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),s=e.height,c=e.top,v=e.bottom,T=window.innerHeight;return!(c<0&&c<0-s*.9||v>0&&v-T>s*.9)}},{key:"checkCode",value:function(e,s){var c=this,v=!1;return Object.keys(this.keyCodeMap).map(function(T){c.keyCodeMap[T]&&e===c.keyCodeMap[T].keyCode&&!c.keyCodeMap[T].disable&&(v=!s||s&&!c.keyCodeMap[T].noBodyTarget)}),v}},{key:"downVolume",value:function(e){var s=this.player;if(!(s.volume<=0)){var c=parseFloat((s.volume-.1).toFixed(1)),v={volume:{from:s.volume,to:c}};this.emitUserAction(e,"change_volume",{props:v}),c>=0?s.volume=c:s.volume=0}}},{key:"upVolume",value:function(e){var s=this.player;if(!(s.volume>=1)){var c=parseFloat((s.volume+.1).toFixed(1)),v={volume:{from:s.volume,to:c}};this.emitUserAction(e,"change_volume",{props:v}),c<=1?s.volume=c:s.volume=1}}},{key:"seek",value:function(e){var s=this.player,c=s.currentTime,v=s.offsetCurrentTime,T=s.duration,S=s.offsetDuration,C=s.timeSegments,R=v>-1?v:c,F=S||T,B=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;R+B<=F?R=R+B:R=F;var U=A.getCurrentTimeByOffset(R,C),W={currentTime:{from:c,to:U}};this.emitUserAction(e,"seek",{props:W}),this.player.currentTime=U}},{key:"seekBack",value:function(e){var s=this.player,c=s.currentTime,v=s.offsetCurrentTime,T=s.timeSegments,S=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,C=v>-1?v:c,R=C-S;R<0&&(R=0),R=A.getCurrentTimeByOffset(R,T);var F={currentTime:{from:c,to:R}};this.emitUserAction(e,"seek",{props:F}),this.player.currentTime=R}},{key:"changePlaybackRate",value:function(e){var s=this._keyState,c=this.config,v=this.player;s.playbackRate===0&&(s.playbackRate=v.playbackRate,v.playbackRate=c.playbackRate)}},{key:"playPause",value:function(e){var s=this.player;s&&(this.emitUserAction(e,"switch_play_pause"),s.paused?s.play():s.pause())}},{key:"exitFullscreen",value:function(e){var s=this.player,c=s.fullscreen,v=s.cssfullscreen;c&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:c,to:!c}),s.exitFullscreen()),v&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:v,to:!v}),s.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var s=this._keyState;if(e.repeat){s.isPress=!0;var c=Date.now();if(c-s.tt<200)return;s.tt=c}this.handleKeyCode(e.keyCode,e,s.isPress)}},{key:"handleKeyUp",value:function(e){var s=this._keyState;s.playbackRate>0&&(this.player.playbackRate=s.playbackRate,s.playbackRate=0),s.isKeyDown=!1,s.isPress=!1,s.tt=0}},{key:"handleKeyCode",value:function(e,s,c){for(var v=Object.keys(this.keyCodeMap),T=0;T<v.length;T++){var S=this.keyCodeMap[v[T]],C=S.action,R=S.keyCode,F=S.disable,B=S.pressAction,U=S.disablePress;if(R===e){if(!F&&!(c&&U)){var W=c&&B||C;typeof W=="function"?C(s,this.player,c):typeof W=="string"&&typeof this[W]=="function"&&this[W](s,this.player,c),this.emit(ll,Xe({key:v[T],target:s.target,isPress:c},this.keyCodeMap[v[T]]))}Ad(s),s.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),d}(Dt);function kd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">
  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>
</svg>
`,"image/svg+xml").firstChild}var Rd=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"registerIcons",value:function(){return{loadingIcon:kd}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return`
    <xg-loading class="xgplayer-loading">
      <xg-loading-inner></xg-loading-inner>
    </xg-loading>`}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:Ke.ROOT}}}]),d}(Fe),Id=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],Pd=function(){function y(m){ce(this,y),this.fragments=m.fragments||[],this.fragments.length===0&&this.fragments.push({percent:1}),this._callBack=m.actionCallback,this.fragConfig={fragFocusClass:m.fragFocusClass||"inner-focus-point",fragAutoFocus:!!m.fragAutoFocus,fragClass:m.fragClass||""},this.style=m.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return he(y,[{key:"updateDuration",value:function(d){var n=this;this.duration=d;var e=0,s=this.fragments;this.fragments=s.map(function(c){return c.start=parseInt(e,10),c.end=parseInt(e+c.percent*n.duration,10),c.duration=parseInt(c.percent*n.duration,10),e+=c.percent*n.duration,c})}},{key:"updateProgress",value:function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"played",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},e=this.progressList,s=this.fragments;if(!(e.length<1)){var c=n.newIndex,v=n.curIndex,T=n.millisecond;c!==v&&e.map(function(R,F){F<c?R[d].style.width="100%":F>c&&(R[d].style.width=0)});var S=s[c],C=T===0?0:(T-S.start)/S.duration;e[c][d].style.width=C<0?0:"".concat(C*100,"%")}}},{key:"updateFocus",value:function(d){if(!(!this.fragConfig.fragAutoFocus||this.fragments.length<2)){if(!d){if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var n={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(n),this.focusIndex=-1}return}var e=this.findIndex(d.currentTime*1e3,this.focusIndex);if(e>=0&&e!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(e);var s={index:e,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=e,this._callBack&&this._callBack(s)}}}},{key:"update",value:function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},n=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(n*1e3,10)!==this.duration){if(!n&&n!==0)return;this.updateDuration(parseInt(n*1e3,10))}var e=this.playedIndex,s=this.cachedIndex;if(A.typeOf(d.played)!=="Undefined"){var c=this.findIndex(d.played*1e3,e);if(c<0)return;this.updateProgress("played",{newIndex:c,curIndex:e,millisecond:parseInt(d.played*1e3,10)}),this.playedIndex=c}if(A.typeOf(d.cached)!=="Undefined"){var v=this.findIndex(d.cached*1e3,s);if(v<0)return;this.updateProgress("cached",{newIndex:v,curIndex:s,millisecond:parseInt(d.cached*1e3,10)}),this.cachedIndex=v}}},{key:"findIndex",value:function(d,n){var e=this.fragments;if(!e||e.length===0)return-1;if(e.length===1)return 0;if(n>-1&&n<e.length&&d>e[n].start&&d<e[n].end)return n;if(d>e[e.length-1].start)return e.length-1;for(var s=0;s<e.length;s++)if(d>e[s].start&&d<=e[s].end){n=s;break}return n}},{key:"findHightLight",value:function(){for(var d=this.root.children,n=0;n<d.length;n++)if(A.hasClass(d[n],this.fragConfig.fragFocusClass))return{dom:d[n],pos:d[n].getBoundingClientRect()}}},{key:"findFragment",value:function(d){var n=this.root.children;return d<0||d>=n.length?null:{dom:n[d],pos:n[d].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var d=this.root.children,n=0;n<d.length;n++)A.removeClass(d[n],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(d){var n=this.root.children;if(d<n.length)return A.addClass(n[d],this.fragConfig.fragFocusClass),{dom:n[d],pos:n[d].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(d){var n=this;if(Object.keys(this.fragConfig).forEach(function(s){d[s]!==void 0&&(n.fragConfig[s]=d[s])}),d.fragments){if(this.fragments=d.fragments.length===0?[{percent:1}]:d.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root)for(var e=this.root.children;e.length>0;)this.root.removeChild(e[0]);this.render()}}},{key:"render",value:function(){var d=this,n=this.style.progressColor;if(this.root||(this.root=A.createDom("xg-inners","",{},"progress-list")),this.fragments){var e=this.fragConfig,s=e.fragClass,c=e.fragFocusClass;this.progressList=this.fragments.map(function(v){var T=A.createDom("xg-inner","",{style:n?"background:".concat(n,"; flex: ").concat(v.percent):"flex: ".concat(v.percent)},"".concat(v.isFocus?c:""," xgplayer-progress-inner ").concat(s));return d.root.appendChild(T),Id.forEach(function(S){T.appendChild(A.createDom(S.tag,"",{style:S.styleKey?"background: ".concat(d.style[S.styleKey],"; width:0;"):"width:0;"},S.className))}),{cached:T.children[0],played:T.children[1]}})}return this.root}}]),y}(),Ho={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},wd=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"onMoveOnly",function(s,c){var v=K(e),T=v.pos,S=v.config,C=v.player,R=c;if(s){A.event(s);var F=A.getEventPos(s,C.zoom),B=C.rotateDeg===90?F.clientY:F.clientX;if(T.moving&&Math.abs(T.x-B)<S.miniMoveStep)return;T.moving=!0,T.x=B,R=e.computeTime(s,B)}e.triggerCallbacks("dragmove",R,s),e._updateInnerFocus(R)}),q(K(e),"onBodyClick",function(s){e.pos.isLocked&&(e.pos.isLocked=!1,s.preventDefault(),s.stopPropagation())}),q(K(e),"_mouseDownHandler",function(s,c){e._state.time=c.currentTime,e.updateWidth(c.currentTime,c.seekTime,c.percent,0),e._updateInnerFocus(c)}),q(K(e),"_mouseUpHandler",function(s,c){var v=K(e),T=v.pos;T.moving&&e.updateWidth(c.currentTime,c.seekTime,c.percent,2)}),q(K(e),"_mouseMoveHandler",function(s,c){var v=K(e),T=v._state,S=v.pos,C=v.config,R=v.player;T.time<c.currentTime?c.forward=!0:c.forward=!1,T.time=c.currentTime,S.isDown&&!S.moving&&(S.moving=!0,C.isPauseMoving&&R.pause(),e.triggerCallbacks("dragstart",c,s),e.emitUserAction("drag","dragstart",c)),e.updateWidth(c.currentTime,c.seekTime,c.percent,1),e.triggerCallbacks("dragmove",c,s),e._updateInnerFocus(c)}),q(K(e),"onMouseDown",function(s){var c=K(e),v=c._state,T=c.player,S=c.pos,C=c.config,R=c.playerConfig,F=A.getEventPos(s,T.zoom),B=T.rotateDeg===90?F.clientY:F.clientX;if(!(T.isMini||C.closeMoveSeek||!R.allowSeekAfterEnded&&T.ended)){if(!T.duration&&!T.isPlaying){T.play();return}s.stopPropagation(),e.focus(),A.checkIsFunction(R.disableSwipeHandler)&&R.disableSwipeHandler(),A.checkIsFunction(C.onMoveStart)&&C.onMoveStart(),A.event(s),S.x=B,S.isDown=!0,S.moving=!1,v.prePlayTime=T.currentTime,T.focus({autoHide:!1}),e.isProgressMoving=!0,A.addClass(e.progressBtn,"active");var U=e.computeTime(s,B);U.prePlayTime=v.prePlayTime,e._mouseDownHandlerHook(s,U);var W=s.type;return W==="touchstart"?(e.root.addEventListener("touchmove",e.onMouseMove),e.root.addEventListener("touchend",e.onMouseUp),e.root.addEventListener("touchcancel",e.onMouseUp)):(e.unbind("mousemove",e.onMoveOnly),document.addEventListener("mousemove",e.onMouseMove,!1),document.addEventListener("mouseup",e.onMouseUp,!1)),!0}}),q(K(e),"onMouseUp",function(s){var c=K(e),v=c.player,T=c.config,S=c.pos,C=c.playerConfig,R=c._state;s.stopPropagation(),s.preventDefault(),A.checkIsFunction(C.enableSwipeHandler)&&C.enableSwipeHandler(),A.checkIsFunction(T.onMoveEnd)&&T.onMoveEnd(),A.event(s),A.removeClass(e.progressBtn,"active");var F=e.computeTime(s,S.x);F.prePlayTime=R.prePlayTime,S.moving?(e.triggerCallbacks("dragend",F,s),e.emitUserAction("drag","dragend",F)):(e.triggerCallbacks("click",F,s),e.emitUserAction("click","click",F)),e._mouseUpHandlerHook(s,F),S.moving=!1,S.isDown=!1,S.x=0,S.y=0,S.isLocked=!0,R.prePlayTime=0,R.time=0;var B=s.type;B==="touchend"||B==="touchcancel"?(e.root.removeEventListener("touchmove",e.onMouseMove),e.root.removeEventListener("touchend",e.onMouseUp),e.root.removeEventListener("touchcancel",e.onMouseUp),e.blur()):(document.removeEventListener("mousemove",e.onMouseMove,!1),document.removeEventListener("mouseup",e.onMouseUp,!1),S.isEnter?C.isMobileSimulateMode!=="mobile"&&e.bind("mousemove",e.onMoveOnly):e.onMouseLeave(s)),A.setTimeout(K(e),function(){e.resetSeekState()},1),v.focus()}),q(K(e),"onMouseMove",function(s){var c=K(e),v=c._state,T=c.pos,S=c.player,C=c.config;A.checkTouchSupport()&&s.preventDefault(),A.event(s);var R=A.getEventPos(s,S.zoom),F=S.rotateDeg===90?R.clientY:R.clientX,B=Math.abs(T.x-F);if(!(T.moving&&B<C.miniMoveStep||!T.moving&&B<C.miniStartStep)){T.x=F;var U=e.computeTime(s,F);U.prePlayTime=v.prePlayTime,e._mouseMoveHandlerHook(s,U)}}),q(K(e),"onMouseOut",function(s){e.triggerCallbacks("mouseout",null,s)}),q(K(e),"onMouseOver",function(s){e.triggerCallbacks("mouseover",null,s)}),q(K(e),"onMouseEnter",function(s){var c=K(e),v=c.player,T=c.pos;if(!(T.isDown||T.isEnter||v.isMini||!v.config.allowSeekAfterEnded&&v.ended)){T.isEnter=!0,e.bind("mousemove",e.onMoveOnly),e.bind("mouseleave",e.onMouseLeave),A.event(s);var S=A.getEventPos(s,v.zoom),C=v.rotateDeg===90?S.clientY:S.clientX,R=e.computeTime(s,C);e.triggerCallbacks("mouseenter",R,s),e.focus()}}),q(K(e),"onMouseLeave",function(s){e.triggerCallbacks("mouseleave",null,s),e.unlock(),e._updateInnerFocus(null)}),q(K(e),"onVideoResize",function(){var s=e.pos,c=s.x,v=s.isDown,T=s.isEnter;if(T&&!v){var S=e.computeTime(null,c);e.onMoveOnly(null,S)}}),e.useable=!1,e.isProgressMoving=!1,e.__dragCallBacks=[],e._state={now:-1,direc:0,time:0,prePlayTime:-1},e._disableBlur=!1,typeof e.config.isDragingSeek=="boolean"&&(console.warn("[XGPLAYER] 'isDragingSeek' is deprecated, please use 'isDraggingSeek' instead"),e.config.isDraggingSeek=e.config.isDragingSeek),e}return he(d,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var e=this.player,s=e.offsetCurrentTime,c=e.currentTime;return s>=0?s:c+this.timeOffset}},{key:"changeState",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.useable=e}},{key:"show",value:function(e){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!s||s.length===0)&&(s=[{percent:1}]);var v=Xe(Xe({fragments:s},c),{},{actionCallback:function(S){e.emitUserAction("fragment_focus","fragment_focus",S)}});this.innerList?this.innerList.reset(v):(this.innerList=new Pd(v),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(function(T){e[T]=e.innerList[T].bind(e.innerList)}))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var e=this.config,s=e.fragFocusClass,c=e.fragAutoFocus,v=e.fragClass;this._initInner(this.config.fragments,{fragFocusClass:s,fragAutoFocus:c,fragClass:v,style:this.playerConfig.commonStyle||{}}),Ae.device==="mobile"&&(this.config.isDraggingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.listenEvents(),this.bindDomEvents(),this.initCustomStyle()}}},{key:"listenEvents",value:function(){var e=this;this.on(Xt,function(){e.onMouseLeave()}),this.on(Lt,function(){e.onTimeupdate()}),this.on($t,function(){e.onTimeupdate(),e.onCacheUpdate()}),this.on(el,function(){e.onCacheUpdate()}),this.on(cr,function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0}),this.on(hr,function(){e.onReset()}),this.on(ar,function(){e.onVideoResize()})}},{key:"setConfig",value:function(e){var s=this,c=null;Object.keys(e).forEach(function(v){s.config[v]=e[v],v==="fragments"&&(c=e[v])}),c&&this._initInner(c,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},s=e.commonStyle,c=s.sliderBtnStyle,v=this.progressBtn;c&&(typeof c=="string"?v.style.boxShadow=c:dt(c)==="object"&&Object.keys(c).map(function(T){v.style[T]=c[T]}))}},{key:"triggerCallbacks",value:function(e,s,c){this.__dragCallBacks.length>0&&this.__dragCallBacks.map(function(v){if(v&&v.handler&&v.type===e)try{v.handler(s,c)}catch(T){console.error("[XGPLAYER][triggerCallbacks] ".concat(v," error"),T)}})}},{key:"addCallBack",value:function(e,s){s&&typeof s=="function"&&this.__dragCallBacks.push({type:e,handler:s})}},{key:"removeCallBack",value:function(e,s){var c=this.__dragCallBacks,v=-1;c.map(function(T,S){T&&T.type===e&&T.handler===s&&(v=S)}),v>-1&&c.splice(v,1)}},{key:"unlock",value:function(){var e=this.player,s=this.pos;if(s.isEnter=!1,s.isLocked=!1,!e.isMini){if(this.unbind("mousemove",this.onMoveOnly),s.isDown){this.unbind("mouseleave",this.onMouseLeave);return}this.blur()}}},{key:"bindDomEvents",value:function(){var e=this.player.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),(this.domEventType==="touch"||this.domEventType==="compatible")&&this.root.addEventListener("touchstart",this.onMouseDown),(this.domEventType==="mouse"||this.domEventType==="compatible")&&(this.bind("mousedown",this.onMouseDown),e.isMobileSimulateMode!=="mobile"&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),A.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),A.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,s,c,v){var T=this.config,S=this.player;if(!(T.isCloseClickSeek&&v===0)){var C=s=s>=S.duration?S.duration-T.endedDiff:Number(s).toFixed(1);this.updatePercent(c),this.updateTime(e),!(v===1&&(!T.isDraggingSeek||S.config.mediaType==="audio"))&&(this._state.now=C,this._state.direc=C>S.currentTime?0:1,S.seek(C))}}},{key:"computeTime",value:function(e,s){var c=this.player,v=this.root.getBoundingClientRect(),T=v.width,S=v.height,C=v.top,R=v.left,F,B,U=s;c.rotateDeg===90?(F=S,B=C):(F=T,B=R);var W=U-B;W=W>F?F:W<0?0:W;var z=W/F;z=z<0?0:z>1?1:z;var ne=parseInt(z*this.offsetDuration*1e3,10)/1e3,te=A.getCurrentTimeByOffset(ne,c.timeSegments);return{percent:z,currentTime:ne,seekTime:te,offset:W,width:F,left:B,e}}},{key:"updateTime",value:function(e){var s=this.player,c=this.duration;e>c?e=c:e<0&&(e=0);var v=s.plugins.time;v&&v.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,s){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(e*100,"%"),this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);var c=this.player.plugins.miniprogress;c&&c.update({played:e*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(e){var s=this.player,c=this._state,v=this.offsetDuration;if(!(s.isSeeking&&s.media.seeking||this.isProgressMoving||!s.hasStart)){if(c.now>-1){var T=parseInt(c.now*1e3,10)-parseInt(s.currentTime*1e3,10);if(c.direc===0&&T>300||c.direc===1&&T>-300){c.now=-1;return}else c.now=-1}var S=this.currentTime;S=A.adjustTimeByDuration(S,v,e),this.innerList.update({played:S},v),this.progressBtn.style.left="".concat(S/v*100,"%")}}},{key:"onCacheUpdate",value:function(e){var s=this.player,c=this.duration;if(s){var v=s.bufferedPoint.end;v=A.adjustTimeByDuration(v,c,e),this.innerList.update({cached:v},c)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var e=this.player;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var s=this.domEventType;(s==="touch"||s==="compatible")&&(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp)),(s==="mouse"||s==="compatible")&&(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){var e=this.player.controls?this.player.controls.config.mode:"",s=e==="bottom"?"xgplayer-progress-bottom":"";return`
    <xg-progress class="xgplayer-progress `.concat(s,`">
      <xg-outer class="xgplayer-progress-outer">
        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>
      </xg-outer>
    </xg-progress>
    `)}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_CENTER,index:0,disable:!1,isDraggingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:Ho.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return Ho}}]),d}(Fe),dr=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"_onMouseenter",function(v){n.emit("icon_mouseenter",{pluginName:n.pluginName})}),q(K(n),"_onMouseLeave",function(v){n.emit("icon_mouseleave",{pluginName:n.pluginName})}),n}return he(d,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),d}(Fe),Dd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"btnClick",function(v){v.preventDefault(),v.stopPropagation();var T=K(n),S=T.player;return n.emitUserAction(v,"switch_play_pause",{prop:"paused",from:S.paused,to:!S.paused}),S.ended?S.replay():S.paused?(S.play(),n.animate(!1)):(S.pause(),n.animate(!0)),!1}),n}return he(d,[{key:"afterCreate",value:function(){_e(Te(d.prototype),"afterCreate",this).call(this);var e=this.config;e.disable||(this.initIcons(),this.bind(["touchend","click"],this.btnClick),this.listenEvents(),this.animate(!0))}},{key:"listenEvents",value:function(){var e=this,s=this.player;this.on([Ct,Pr,Wr,hr],function(){e.animate(s.paused)})}},{key:"registerIcons",value:function(){return{play:{icon:aa,class:"xg-icon-play"},pause:{icon:sa,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var s=this.i18nKeys,c=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),c&&this.changeLangTextKey(c,s.PLAY_TIPS)):(this.setAttr("data-state","play"),c&&this.changeLangTextKey(c,s.PAUSE_TIPS))}}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-play">
    <div class="xgplayer-icon">
    </div>
    `.concat(sr(this,"PLAY_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_LEFT,index:0,disable:!1}}}]),d}(dr);function Od(){return new DOMParser().parseFromString(`<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>
    </g>
</svg>`,"image/svg+xml").firstChild}var Md=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(s){s.preventDefault(),s.stopPropagation(),e.config.onClick(s)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:Od,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){A.addClass(this.root,"show")}},{key:"hide",value:function(){A.removeClass(this.root,"show")}},{key:"render",value:function(){return`<xg-icon class="xgplayer-back">
    </xg-icon>`}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:Ke.ROOT_TOP,index:0}}}]),d}(Fe);function Fd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>
</svg>
`,"image/svg+xml").firstChild}function Nd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>
</svg>
`,"image/svg+xml").firstChild}var Bd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"_onOrientationChange",function(v){n.player.fullscreen&&n.config.rotateFullscreen&&(window.orientation===90||window.orientation===-90?n.player.setRotateDeg(0):n.player.setRotateDeg(90))}),n}return he(d,[{key:"afterCreate",value:function(){var e=this;_e(Te(d.prototype),"afterCreate",this).call(this);var s=this.config,c=this.playerConfig;if(!s.disable){s.target&&(this.playerConfig.fullscreenTarget=this.config.target);var v=A.getFullScreenEl();c.fullscreenTarget===v&&this.player.getFullscreen().catch(function(T){}),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(S){var C=e.player.fullscreen;e.emitUserAction(S,"switch_fullscreen",{prop:"fullscreen",from:C,to:!C})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(Yt,function(T){var S=e.find(".xg-tips");S&&e.changeLangTextKey(S,T?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(T)}),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:Md,options:{config:{onClick:function(S){e.handleFullscreen(S)}}}})),Ae.device==="mobile"&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:Fd,class:"xg-get-fullscreen"},exitFullscreen:{icon:Nd,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",Ae.device==="mobile"?"touchend":"click",this.handleFullscreen),Ae.device==="mobile"&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e instanceof Event&&(e.preventDefault(),e.stopPropagation());var s=this.player,c=this.config,v=c.useCssFullscreen===!0||typeof c.useCssFullscreen=="function"&&c.useCssFullscreen();v?(s.fullscreen?s.exitCssFullscreen():s.getCssFullscreen(),this.animate(s.fullscreen)):c.rotateFullscreen?(s.fullscreen?s.exitRotateFullscreen():s.getRotateFullscreen(),this.animate(s.fullscreen)):c.switchCallback&&typeof c.switchCallback=="function"?c.switchCallback(s.fullscreen):s.fullscreen?(s.exitFullscreen(),c.useScreenOrientation&&this.unlockScreen()):(s.getFullscreen().catch(function(T){}),c.useScreenOrientation&&s.aspectRatio>1&&this.lockScreen(c.lockOrientationType))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return`<xg-icon class="xgplayer-fullscreen">
    <div class="xgplayer-icon">
    </div>
    `.concat(sr(this,e,this.playerConfig.isHideTips),`
    </xg-icon>`)}}},{key:"lockScreen",value:function(e){try{screen.orientation.lock(e).catch(function(s){})}catch{}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch(function(e){})}catch{}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),d}(dr),Ud=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),e.isActiving=!1,e}return he(d,[{key:"duration",get:function(){var e=this.player,s=e.offsetDuration,c=e.duration;return this.playerConfig.customDuration||s||c}},{key:"currentTime",get:function(){var e=this.player,s=e.offsetCurrentTime,c=e.currentTime;return s>=0?s:c}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this.player.controls.config.mode;this.mode=e==="flex"?"flex":"normal",!this.config.disable&&(this.mode==="flex"&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;this.on([Xt,$t,Lt],function(s){s.eventName==="durationchange"&&(e.isActiving=!1),e.onTimeUpdate()}),this.on(cr,function(){e.onTimeUpdate(!0)}),this.on(hr,function(){e.onReset()})}},{key:"show",value:function(e){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="block"),this.centerDurDom&&(this.centerDurDom.style.display="block");return}this.root.style.display="block"}},{key:"hide",value:function(){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="none"),this.centerDurDom&&(this.centerDurDom.style.display="none");return}this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var s=this.player,c=this.config,v=this.duration;if(!(c.disable||this.isActiving||!s.hasStart)){var T=this.currentTime+this.timeOffset;T=A.adjustTimeByDuration(T,v,e),this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(A.format(T)),v!==1/0&&v>0&&(this.centerDurDom.innerHTML=A.format(v))):(this.timeDom.innerHTML=this.minWidthTime(A.format(T)),v!==1/0&&v>0&&(this.durationDom.innerHTML=A.format(v)))}}},{key:"onReset",value:function(){this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(A.format(0)),this.centerDurDom.innerHTML=A.format(0)):(this.timeDom.innerHTML=this.minWidthTime(A.format(0)),this.durationDom.innerHTML=A.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(!(!e.controls||!e.controls.center)){var s=e.controls.center;this.centerCurDom=A.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=A.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),s.children.length>0?s.insertBefore(this.centerCurDom,s.children[0]):s.appendChild(this.centerCurDom),s.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;if(this.duration===1/0||this.playerConfig.isLive?(A.hide(this.durationDom),A.hide(this.timeDom),A.hide(this.find(".time-separator")),A.show(this.find(".time-live-tag"))):A.hide(this.find(".time-live-tag")),e.hide){this.hide();return}this.show()}},{key:"changeLiveState",value:function(e){e?(A.hide(this.durationDom),A.hide(this.timeDom),A.hide(this.find(".time-separator")),A.show(this.find(".time-live-tag"))):(A.hide(this.find(".time-live-tag")),A.show(this.find(".time-separator")),A.show(this.durationDom),A.show(this.timeDom))}},{key:"updateTime",value:function(e){if(this.isActiving=!0,!(!e&&e!==0||e>this.duration)){if(this.mode==="flex"){this.centerCurDom.innerHTML=this.minWidthTime(A.format(e));return}this.timeDom.innerHTML=this.minWidthTime(A.format(e))}}},{key:"minWidthTime",value:function(e){return e.split(":").map(function(s){return'<span class="time-min-width">'.concat(s,"</span>")}).join(":")}},{key:"resetActive",value:function(){var e=this,s=this.player,c=function(){e.isActiving=!1};this.off($t,c),s.isSeeking&&s.media.seeking?this.once($t,c):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-time">
    <span class="time-current">00:00</span>
    <span class="time-separator">/</span>
    <span class="time-duration">00:00</span>
    <span class="time-live-tag">`.concat(this.i18n.LIVE_TIP,`</span>
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_LEFT,index:2,disable:!1}}}]),d}(Fe),Hd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"_onDurationChange",function(){n.updateSegments();var v=n.player,T=v.currentTime,S=v.timeSegments;if(n._checkIfEnabled(S)){var C=A.getIndexByTime(T,S),R=A.getOffsetCurrentTime(T,S,C);n.player.offsetCurrentTime=R,n.changeIndex(C,S)}}),q(K(n),"_onLoadedData",function(){var v=n.player.timeSegments;if(n._checkIfEnabled(v)){var T=A.getOffsetCurrentTime(0,v);n.player.offsetCurrentTime=T,n.changeIndex(0,v),n.curPos.start>0&&(n.player.currentTime=n.curPos.start)}}),q(K(n),"_onTimeupdate",function(){var v=n.player,T=v.currentTime,S=v.timeSegments;if(n._checkIfEnabled(S)){var C=S.length;n.lastCurrentTime=T;var R=A.getIndexByTime(T,S);R!==n.curIndex&&n.changeIndex(R,S);var F=A.getOffsetCurrentTime(T,S,R);if(n.player.offsetCurrentTime=F,!!n.curPos){var B=n.curPos,U=B.start,W=B.end;T<U?n.player.currentTime=U:T>W&&R>=C-1&&n.player.pause()}}}),q(K(n),"_onSeeking",function(){var v=n.player,T=v.currentTime,S=v.timeSegments;if(n._checkIfEnabled(S))if(T<S[0].start)n.player.currentTime=S[0].start;else if(T>S[S.length-1].end)n.player.currentTime=S[S.length-1].end;else{var C=A.getIndexByTime(T,S);if(C>=0){var R=n.getSeekTime(T,n.lastCurrentTime,C,S);R>=0&&(n.player.currentTime=R)}}}),q(K(n),"_onPlay",function(){var v=n.player,T=v.currentTime,S=v.timeSegments;n._checkIfEnabled(S)&&T>=S[S.length-1].end&&(n.player.currentTime=S[0].start)}),n}return he(d,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(Xt,this._onDurationChange),this.on(qt,this._onLoadedData),this.on(Lt,this._onTimeupdate),this.on(Oi,this._onSeeking),this.on(Ct,this._onPlay)}},{key:"setConfig",value:function(e){var s=this;if(e){var c=Object.keys(e);c.length<1||(c.forEach(function(v){s.config[v]=e[v]}),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,s=e.disable,c=e.segments,v=this.player;if(s||!c||c.length===0)v.timeSegments=[],v.offsetDuration=0,v.offsetCurrentTime=-1;else{var T=this.formatTimeSegments(c,v.duration);v.timeSegments=T,v.offsetDuration=T.length>0?T[T.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,s){var c=[];return e?(e.sort(function(v,T){return v.start-T.start}),e.forEach(function(v,T){var S={};if(S.start=v.start<0?0:v.start,S.end=s>0&&v.end>s?s:v.end,!(s>0&&S.start>s)){c.push(S);var C=S.end-S.start;if(T===0)S.offset=v.start,S.cTime=0,S.segDuration=C,S.duration=C;else{var R=c[T-1];S.offset=R.offset+(S.start-R.end),S.cTime=R.duration+R.cTime,S.segDuration=C,S.duration=R.duration+C}}}),c):[]}},{key:"getSeekTime",value:function(e,s,c,v){var T=-1,S=v[c],C=S.start,R=S.end;if(e>=C&&e<=R)return T;var F=e-s;if(F<0&&e<C){var B=s>C?s-C:0;return T=c-1>=0?v[c-1].end+F+B:0,T}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,s){this.curIndex=e,e>=0&&s.length>0?this.curPos=s[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),d}(Dt);function Gd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function Vd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function Kd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>
</svg>
`,"image/svg+xml").firstChild}var Wd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onBarMousedown",function(v){var T=K(n),S=T.player,C=n.find(".xgplayer-bar");A.event(v);var R=C.getBoundingClientRect(),F=A.getEventPos(v,S.zoom),B=R.height-(F.clientY-R.top);if(F.h=B,F.barH=R.height,n.pos=F,!(B<-2))return n.updateVolumePos(B,v),document.addEventListener("mouseup",n.onBarMouseUp),n._d.isStart=!0,!1}),q(K(n),"onBarMouseMove",function(v){var T=K(n),S=T._d;if(S.isStart){var C=K(n),R=C.pos,F=C.player;v.preventDefault(),v.stopPropagation(),A.event(v);var B=A.getEventPos(v,F.zoom);S.isMoving=!0;var U=R.h-B.clientY+R.clientY;U>R.barH||n.updateVolumePos(U,v)}}),q(K(n),"onBarMouseUp",function(v){A.event(v),document.removeEventListener("mouseup",n.onBarMouseUp);var T=K(n),S=T._d;S.isStart=!1,S.isMoving=!1}),q(K(n),"onMouseenter",function(v){n._d.isActive=!0,n.focus(),n.emit("icon_mouseenter",{pluginName:n.pluginName})}),q(K(n),"onMouseleave",function(v){n._d.isActive=!1,n.unFocus(100,!1,v),n.emit("icon_mouseleave",{pluginName:n.pluginName})}),q(K(n),"onVolumeChange",function(v){if(n.player){var T=n.player,S=T.muted,C=T.volume;n._d.isMoving||(n.find(".xgplayer-drag").style.height=S||C===0?"4px":"".concat(C*100,"%"),n.config.showValueLabel&&n.updateVolumeValue()),n.animate(S,C)}}),n}return he(d,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:Vd,class:"xg-volume-small"},volumeLarge:{icon:Gd,class:"xg-volume"},volumeMuted:{icon:Kd,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var s=this.playerConfig,c=s.commonStyle,v=s.volume;c.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=c.volumeColor),this.changeMutedHandler=this.hook("mutedChange",function(T){e.changeMuted(T)},{pre:function(S){S.preventDefault(),S.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),Ae.device!=="mobile"&&this.playerConfig.isMobileSimulateMode!=="mobile"&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(Zo,this.onVolumeChange),this.once(qt,this.onVolumeChange),A.typeOf(v)!=="Number"&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,s){var c=this.player,v=this.find(".xgplayer-drag"),T=this.find(".xgplayer-bar");if(!(!T||!v)){var S=parseInt(e/T.getBoundingClientRect().height*1e3,10);v.style.height="".concat(e,"px");var C=Math.max(Math.min(S/1e3,1),0),R={volume:{from:c.volume,to:C}};c.muted&&(R.muted={from:!0,to:!1}),this.emitUserAction(s,"change_volume",{muted:c.muted,volume:c.volume,props:R}),c.volume=Math.max(Math.min(S/1e3,1),0),c.muted&&(c.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,s=e.volume,c=e.muted,v=this.find(".xgplayer-value-label"),T=Math.max(Math.min(s,1),0);v.innerText=c?0:Math.round(T*100)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(A.clearTimeout(this,this._timerId),this._timerId=null),A.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,v=arguments.length>2?arguments[2]:void 0,T=this._d,S=this.player;T.isActive||(this._timerId&&(A.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=A.setTimeout(this,function(){T.isActive||(c?S.blur():S.focus(),A.removeClass(e.root,"slide-show"),T.isStart&&e.onBarMouseUp(v)),e._timerId=null},s))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var s=this.player,c=this._d;c.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:s.muted,volume:s.volume,props:{muted:{from:s.muted,to:!s.muted}}}),s.volume>0&&(s.muted=!s.muted),s.volume<.01&&(s.volume=this.config.miniVolume)}},{key:"animate",value:function(e,s){e||s===0?this.setAttr("data-state","mute"):s<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(A.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon",Ae.device==="mobile"?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,s=this.config.showValueLabel;return`
    <xg-icon class="xgplayer-volume" data-state="normal">
      <div class="xgplayer-icon">
      </div>
      <xg-slider class="xgplayer-slider">
        `.concat(s?'<div class="xgplayer-value-label">'.concat(e*100,"</div>"):"",`
        <div class="xgplayer-bar">
          <xg-drag class="xgplayer-drag" style="height: `).concat(e*100,`%"></xg-drag>
        </div>
      </xg-slider>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),d}(Fe);function jd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">
  <g>
    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>
    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>
  </g>
  <defs>
    <clipPath>
      <rect width="40" height="40" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,"image/svg+xml").firstChild}var Yd=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),e.rotateDeg=e.config.rotateDeg||0,e}return he(d,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){_e(Te(d.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(ar,function(){e.rotateDeg&&e.config.innerRotate&&A.setTimeout(e,function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)},100)});var s=this.player.root;this.rootWidth=s.style.width||s.offsetWidth||s.clientWidth,this.rootHeight=s.style.height||s.offsetHeight||s.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,s){if(e||(e=0),s){this.player.videoRotateDeg=e;return}var c=this.player,v=this.rootWidth,T=this.rootHeight,S=c.root,C=c.innerContainer,R=c.media,F=S.offsetWidth,B=C&&s?C.offsetHeight:S.offsetHeight,U=v,W=T,z=0,ne=0;(e===.75||e===.25)&&(U="".concat(B,"px"),W="".concat(F,"px"),z=-(B-F)/2,ne=-(F-B)/2);var te="translate(".concat(z,"px,").concat(ne,"px) rotate(").concat(e,"turn)"),J={transformOrigin:"center center",transform:te,webKitTransform:te,height:W,width:U},Le=s?R:S,pe=s?c.getPlugin("poster"):null;Object.keys(J).map(function(De){Le.style[De]=J[De],pe&&pe.root&&(pe.root.style[De]=J[De])})}},{key:"rotate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,v=this.player;this.rotateDeg||(this.rotateDeg=0);var T=e?1:-1;this.rotateDeg=(this.rotateDeg+1+T*.25*c)%1,this.updateRotateDeg(this.rotateDeg,s),v.emit(sl,this.rotateDeg*360)}},{key:"registerIcons",value:function(){return{rotate:jd}}},{key:"render",value:function(){if(!this.config.disable)return`
    <xg-icon class="xgplayer-rotate">
      <div class="xgplayer-icon">
      </div>
      `.concat(sr(this,"ROTATE_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),d}(dr);function zd(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}function $d(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}var br={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},qd=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"switchPIP",function(v){if(!n.isPIPAvailable())return!1;v.stopPropagation&&v.stopPropagation(),n.isPip?(n.exitPIP(),n.emitUserAction(v,"change_pip",{props:"pip",from:!0,to:!1}),n.setAttr("data-state","normal")):n.player.media.readyState===4&&(n.requestPIP(),n.emitUserAction(v,"change_pip",{props:"pip",from:!1,to:!0}),n.setAttr("data-state","pip"))}),n}return he(d,[{key:"beforeCreate",value:function(e){typeof e.player.config.pip=="boolean"&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(_e(Te(d.prototype),"afterCreate",this).call(this),this.pMode=br.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(Mi,function(){e.config.showIcon&&(A.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))}))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:zd,class:"xg-get-pip"},pipIconExit:{icon:$d,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,s=this.player;this.leavePIPCallback=function(){var c=s.paused;A.setTimeout(e,function(){!c&&s.mediaPlay()},0),!c&&s.mediaPlay(),e.setAttr("data-state","normal"),e.pipWindow=null,s.emit(zn,!1)},this.enterPIPCallback=function(c){s.emit(zn,!0),c!=null&&c.pictureInPictureWindow&&(e.pipWindow=c.pictureInPictureWindow),e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(c){var v=s.media.webkitPresentationMode;e.pMode===br.FULLSCREEN&&v!==br.FULLSCREEN&&s.onFullscreenChange(null,!1),e.pMode=v,v===br.PIP?e.enterPIPCallback(c):v===br.INLINE&&e.leavePIPCallback(c)},s.media&&(s.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),s.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),d.checkWebkitSetPresentationMode(s.media)&&s.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(e){var s=wt(document.styleSheets).map(function(v){try{return wt(v.cssRules).map(function(S){return S.cssText}).join("")}catch{var T=document.createElement("link");T.rel="stylesheet",T.type=v.type,T.media=v.media,T.href=v.href,e.document.head.appendChild(T)}return""}).filter(Boolean).join(`
`),c=document.createElement("style");c.textContent=s,e.document.head.appendChild(c)}},{key:"requestPIP",value:function(){var e=this,s=this.player,c=this.playerConfig,v=this.config;if(!(!this.isPIPAvailable()||this.isPip))try{var T=c.poster;if(T&&(s.media.poster=A.typeOf(T)==="String"?T:T.poster),v.preferDocument&&this.isDocPIPAvailable()){var S={};if(v.width&&v.height)S.width=v.width,S.height=v.height;else{var C=s.root.getBoundingClientRect();S.width=C.width,S.height=C.height}documentPictureInPicture.requestWindow(S).then(function(R){var F=v.docPiPNode,B=v.docPiPStyle;e.enterPIPCallback();var U=F||s.root,W=U.parentElement,z=U.previousSibling,ne=U.nextSibling;e.copyStyleIntoPiPWindow(R);var te=document.createElement("style");if(te.append("body{padding:0; margin:0;}"),B){var J="";typeof B=="string"?J=B:typeof B=="function"&&(J=B.call(v)),J&&te.append(J)}else U===s.root&&te.append(`
              .xgplayer{width: 100%!important; height: 100%!important;}
            `);R.document.head.append(te),R.document.body.append(U),R.addEventListener("pagehide",function(Le){W&&(ne?W.insertBefore(U,ne):z?W.insertBefore(U,z.nextSibling):W.appendChild(U)),e.leavePIPCallback()},{once:!0})})}else d.checkWebkitSetPresentationMode(s.media)?s.media.webkitSetPresentationMode("picture-in-picture"):s.media.requestPictureInPicture();return!0}catch(R){return console.error("requestPiP",R),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{if(this.isPIPAvailable()&&this.isPip){var s;this.isDocPIPAvailable()&&(s=documentPictureInPicture)!==null&&s!==void 0&&s.window?documentPictureInPicture.window.close():d.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()}return!0}catch(c){return console.error("exitPIP",c),!1}}},{key:"isPip",get:function(){var e,s=this.player;return!!(this.isDocPIPAvailable()&&(e=documentPictureInPicture)!==null&&e!==void 0&&e.window)||document.pictureInPictureElement&&document.pictureInPictureElement===s.media||s.media.webkitPresentationMode===br.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,s=A.typeOf(document.pictureInPictureEnabled)==="Boolean"?document.pictureInPictureEnabled:!1;return s&&(A.typeOf(e.disablePictureInPicture)==="Boolean"&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&A.typeOf(e.webkitSetPresentationMode)==="Function")||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),d.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(!(!this.config.showIcon||!this.isPIPAvailable()))return`<xg-icon class="xgplayer-pip">
      <div class="xgplayer-icon xg-icon-disable">
      </div>
      `.concat(sr(this,"PIP",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(e){return typeof e.webkitSetPresentationMode=="function"}}]),d}(dr);function Xd(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">
  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>
</svg>
`,"image/svg+xml").firstChild}var Qd=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"playNext",function(s){var c=K(e),v=c.player;s.preventDefault(),s.stopPropagation(),e.idx+1<e.config.urlList.length?(e.idx++,e.nextHandler(e.config.urlList[e.idx],e.idx),v.emit(Ci,e.idx+1)):(e.nextHandler(),v.emit(Ci))}),e.idx=-1,e}return he(d,[{key:"afterCreate",value:function(){!this.config.urlList||this.config.urlList.length===0||(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Xd}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e=Ae.device==="mobile"?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var s=this.player;e&&(s.pause(),s.currentTime=0,s.switchURL?s.switchURL(e):s.src=e,s.config.url=e,s.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(!(!this.config.urlList||this.config.urlList.length===0))return`
     <xg-icon class="xgplayer-playnext">
      <div class="xgplayer-icon">
      </div>
      `.concat(sr(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),`
     </xg-icon>
    `)}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),d}(Fe),Si={exports:{}},Zd=Si.exports,Go;function Jd(){return Go||(Go=1,function(y,m){(function(d,n){y.exports=n()})(Zd,function(){return function d(n,e,s){var c=window,v="application/octet-stream",T=s||v,S=n,C=!e&&!s&&S,R=document.createElement("a"),F=function(Re){return String(Re)},B=c.Blob||c.MozBlob||c.WebKitBlob||F,U=e||"download",W,z;if(B=B.call?B.bind(c):Blob,String(this)==="true"&&(S=[S,T],T=S[0],S=S[1]),C&&C.length<2048&&(U=C.split("/").pop().split("?")[0],R.href=C,R.href.indexOf(C)!==-1)){var ne=new XMLHttpRequest;return ne.open("GET",C,!0),ne.responseType="blob",ne.onload=function(Re){d(Re.target.response,U,v)},setTimeout(function(){ne.send()},0),ne}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(S))if(S.length>1024*1024*1.999&&B!==F)S=pe(S),T=S.type||v;else return navigator.msSaveBlob?navigator.msSaveBlob(pe(S),U):De(S);else if(/([\x80-\xff])/.test(S)){var te=0,J=new Uint8Array(S.length),Le=J.length;for(te;te<Le;++te)J[te]=S.charCodeAt(te);S=new B([J],{type:T})}W=S instanceof B?S:new B([S],{type:T});function pe(Re){var je=Re.split(/[:;,]/),Ve=je[1],ge=je[2]=="base64"?atob:decodeURIComponent,at=ge(je.pop()),Tt=at.length,ft=0,ae=new Uint8Array(Tt);for(ft;ft<Tt;++ft)ae[ft]=at.charCodeAt(ft);return new B([ae],{type:Ve})}function De(Re,je){if("download"in R)return R.href=Re,R.setAttribute("download",U),R.className="download-js-link",R.innerHTML="downloading...",R.style.display="none",document.body.appendChild(R),setTimeout(function(){R.click(),document.body.removeChild(R),je===!0&&setTimeout(function(){c.URL.revokeObjectURL(R.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(Re)&&(Re="data:"+Re.replace(/^data:([\w\/\-\+]+)/,v)),window.open(Re)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=Re),!0;var Ve=document.createElement("iframe");document.body.appendChild(Ve),!je&&/^data:/.test(Re)&&(Re="data:"+Re.replace(/^data:([\w\/\-\+]+)/,v)),Ve.src=Re,setTimeout(function(){document.body.removeChild(Ve)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(W,U);if(c.URL)De(c.URL.createObjectURL(W),!0);else{if(typeof W=="string"||W.constructor===F)try{return De("data:"+T+";base64,"+c.btoa(W))}catch{return De("data:"+T+","+encodeURIComponent(W))}z=new FileReader,z.onload=function(Re){De(this.result)},z.readAsDataURL(W)}return!0}})}(Si)),Si.exports}var ev=Jd();const tv=Di(ev);function rv(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">
      <g id="Group-2">
        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">
          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>
          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>
          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>
          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>
        </g>
      </g>
    </g>
  </g>
</svg>
`,"image/svg+xml").firstChild}var iv=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"download",function(s){if(!e.isLock){e.emitUserAction(s,"download");var c=e.playerConfig.url,v="";A.typeOf(c)==="String"?v=c:A.typeOf(c)==="Array"&&c.length>0&&(v=c[0].src);var T=e.getAbsoluteURL(v);tv(T),e.isLock=!0,e.timer=window.setTimeout(function(){e.isLock=!1,window.clearTimeout(e.timer),e.timer=null},300)}}),e.timer=null,e.isLock=!1,e}return he(d,[{key:"afterCreate",value:function(){_e(Te(d.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(s){s.preventDefault(),s.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:rv}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var s=document.createElement("div");s.innerHTML='<a href="'.concat(e,'">x</a>'),e=s.firstChild.href}return e}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">
   <div class="xgplayer-icon">
   </div>
   `.concat(sr(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:3,disable:!0}}}]),d}(dr),nv=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"beforeCreate",value:function(e){typeof e.player.config.screenShot=="boolean"&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){_e(Te(d.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(s){e.fitVideo&&(e.width=s.vWidth,e.height=s.vHeight)},this.once(ar,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,s){var c=document.createElement("a");c.href=e,c.download=s;var v;try{typeof MouseEvent<"u"?v=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(v=document.createEvent("MouseEvents"),v.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null))}catch(T){console.error("MouseEvent unsupported",T)}v&&c.dispatchEvent(v)}},{key:"createCanvas",value:function(e,s){var c=document.createElement("canvas"),v=c.getContext("2d");this.canvasCtx=v,this.canvas=c,c.width=e||this.config.width,c.height=s||this.config.height,v.imageSmoothingEnabled=!0,v.imageSmoothingEnabled&&(v.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var s=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var c=this.config;this.shot(c.width,c.height).then(function(v){s.emit(ol,v),c.saveImg&&s.saveScreenShot(v,c.name+c.format)})}},{key:"shot",value:function(e,s){var c=this,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{quality:.92,type:"image/png"},T=this.config,S=this.player,C=v.quality||T.quality,R=v.type||T.type;return new Promise(function(F,B){var U=null,W;if(S.media.canvas)U=S.media.canvas;else{c.canvas?(c.canvas.width=e||T.width,c.canvas.height=s||T.height):c.createCanvas(e,s),U=c.canvas,W=c.canvasCtx;var z=S.media.videoWidth/S.media.videoHeight,ne=U.width/U.height,te=0,J=0,Le=S.media.videoWidth,pe=S.media.videoHeight,De,Re,je,Ve;z>ne?(je=U.width,Ve=U.width/z,De=0,Re=Math.round((U.height-Ve)/2)):z===ne?(je=U.width,Ve=U.height,De=0,Re=0):z<ne&&(je=U.height*z,Ve=U.height,De=Math.round((U.width-je)/2),Re=0),W.drawImage(S.media,te,J,Le,pe,De,Re,je,Ve)}var ge=U.toDataURL(R,C).replace(R,"image/octet-stream");ge=ge.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),F(ge)})}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(ar,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",s="SCREENSHOT";return`
      <xg-icon class="xgplayer-shot">
      <div class="`.concat(e,`">
      `).concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[s],'">').concat(this.i18n[s],"</span>"),`
      </div>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),d}(dr),av=function(){function y(m){ce(this,y),this.config=m.config,this.parent=m.root,this.root=A.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),m.root.appendChild(this.root);var d=this.config.maxHeight;d&&this.setStyle({maxHeight:d}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var n=this.config.domEventType==="touch"?"touchend":"click";this._delegates=Fe.delegate.call(this,this.root,"li",n,this.onItemClick)}return he(y,[{key:"renderItemList",value:function(d){var n=this,e=this.config,s=this.root;d?e.data=d:d=e.data,e.style&&Object.keys(e.style).map(function(c){s.style[c]=e[c]}),d.length>0&&(this.attrKeys=Object.keys(d[0])),this.root.innerHTML="",d.map(function(c,v){var T=c.selected?"option-item selected":"option-item";c["data-index"]=v,n.root.appendChild(A.createDom("li","<span>".concat(c.showText,"</span>"),c,T))})}},{key:"onItemClick",value:function(d){d.delegateTarget||(d.delegateTarget=d.target);var n=d.delegateTarget;if(n&&A.hasClass(n,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,s=this.root.querySelector(".selected");A.addClass(n,"selected"),s&&A.removeClass(s,"selected"),e(d,{from:s?this.getAttrObj(s,this.attrKeys):null,to:this.getAttrObj(n,this.attrKeys)})}},{key:"getAttrObj",value:function(d,n){if(!d||!n)return{};var e={};n.map(function(c){e[c]=d.getAttribute(c)});var s=d.getAttribute("data-index");return s&&(e.index=Number(s)),e}},{key:"show",value:function(){A.removeClass(this.root,"hide"),A.addClass(this.root,"active")}},{key:"hide",value:function(){A.removeClass(this.root,"active"),A.addClass(this.root,"hide")}},{key:"setStyle",value:function(d){var n=this;Object.keys(d).forEach(function(e){n.root.style[e]=d[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(d){d.destroy&&d.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),y}(),Ut={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},Lr={CLICK:"click",HOVER:"hover"};function sv(y,m){return y===Ut.SIDE?m===Ke.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var lr=Ae.device==="mobile",Pi=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"onEnter",function(s){s.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(s)}),q(K(e),"switchActiveState",function(s){s.stopPropagation();var c=e.config.toggleMode;c===Lr.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),q(K(e),"onLeave",function(s){s.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==Ut.SIDE&&e.isActive&&e.toggle(!1)}),q(K(e),"onListEnter",function(s){e.enterType=2}),q(K(e),"onListLeave",function(s){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return he(d,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,s=this.config;this.initIcons(),lr=lr||this.domEventType==="touch",lr&&Ae.device==="mobile"&&s.listType===Ut.DEFAULT&&(s.listType=Ut.SIDE),s.hidePortrait&&A.addClass(this.root,"portrait"),this.on([ar,Yt],function(){e._resizeList()}),this.once(zt,function(){s.list&&s.list.length>0&&(e.renderItemList(s.list),e.show())}),lr&&this.on(Jn,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),lr?(s.toggleMode=Lr.CLICK,this.activeEvent="touchend"):this.activeEvent=s.toggleMode===Lr.CLICK?"click":"mouseenter",s.toggleMode===Lr.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,s=this.icons,c=Object.keys(s),v=!1;c.length>0&&(c.forEach(function(T){e.appendChild(".xgplayer-icon",s[T]),!v&&(v=s[T])}),this.isIcons=v),!v&&(this.appendChild(".xgplayer-icon",A.createDom("span","",{},"icon-text")),A.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||A.addClass(this.root,"show")}},{key:"hide",value:function(){A.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,s,c){if(e===void 0)return"";var v=this.config.list;!c&&(c=this.player.lang),s=!s||A.isUndefined(e[s])?"text":s,typeof e=="number"&&(e=v[e]);try{return dt(e[s])==="object"?e[s][c]||e[s].en:e[s]}catch(T){return console.warn(T),""}}},{key:"toggle",value:function(e){if(!(e===this.isActive||this.config.disable)){var s=this.player.controls,c=this.config.listType;e?(c===Ut.SIDE?s.blur():s.focus(),this.optionsList&&this.optionsList.show()):(c===Ut.SIDE?s.focus():s.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,s){e.stopPropagation();var c=this.config,v=c.listType,T=c.list;this.curIndex=s.to.index,this.curItem=T[this.curIndex],this.changeCurrentText();var S=this.config.isItemClickHide;(S||lr||v===Ut.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,s=this.curIndex<e.length?this.curIndex:0,c=e[s];c&&(this.find(".icon-text").innerHTML=this.getTextByLang(c,"iconText"))}}},{key:"renderItemList",value:function(e,s){var c=this,v=this.config,T=this.optionsList,S=this.player;if(typeof s=="number"&&(this.curIndex=s,this.curItem=v.list[s]),T){T.renderItemList(e),this.changeCurrentText();return}var C={config:{data:e||[],className:sv(v.listType,v.position),onItemClick:function(W,z){c.onItemClick(W,z)},domEventType:lr?"touch":"mouse"},root:v.listType===Ut.SIDE?S.innerContainer||S.root:this.root};if(this.config.isShowIcon){var R=this.player.root.getBoundingClientRect(),F=R.height,B=v.listType===Ut.MIDDLE?F-50:F;B&&v.heightLimit&&(C.config.maxHeight="".concat(B,"px")),this.optionsList=new av(C),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),s=e.height,c=this.config.listType===Ut.MIDDLE?s-50:s;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(c,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===Lr.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:Lr.HOVER,heightLimit:!0}}}]),d}(Fe),ov=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),e.curTime=0,e.isPaused=!0,e}return he(d,[{key:"beforeCreate",value:function(e){var s=e.config.list;Array.isArray(s)&&s.length>0&&(e.config.list=s.map(function(c){return!c.text&&c.name&&(c.text=c.name),c.text||(c.text=c.definition),c}))}},{key:"afterCreate",value:function(){var e=this;_e(Te(d.prototype),"afterCreate",this).call(this),this.on("resourceReady",function(s){e.changeDefinitionList(s)}),this.on(ia,function(s){e.renderItemList(e.config.list,s.to)}),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||A.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,s=e.list,c=e.defaultDefinition;if(s.length>0){var v=null;s.map(function(T){T.definition===c&&(v=T)}),v||(v=s[0]),this.changeDefinition(v)}}},{key:"renderItemList",value:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.list||[],c=arguments.length>1?arguments[1]:void 0,v=c&&c.definition?c.definition:this.config.defaultDefinition;c&&s.forEach(function(C){C.selected=!1});var T=0,S=s.map(function(C,R){var F=Xe(Xe({},C),{},{showText:e.getTextByLang(C)||C.definition,selected:!1});return(C.selected||C.definition&&C.definition==v)&&(F.selected=!0,T=R),F});_e(Te(d.prototype),"renderItemList",this).call(this,S,T)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map(function(s){return!s.text&&s.name&&(s.text=s.name),s.text||(s.text=s.definition),s}),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,s){this.player.changeDefinition(e,s)}},{key:"onItemClick",value:function(e,s){var c=this.player.definitionList;_e(Te(d.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:s.from,to:s.to});for(var v=0;v<c.length;v++)s.to&&c[v].definition===s.to.definition&&(s.to.url=c[v].url),s.from&&c[v].definition===s.from.definition&&(s.from.url=c[v].url);this.player.changeDefinition(s.to,s.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return Xe(Xe({},Pi.defaultConfig),{},{position:Ke.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),d}(Pi),lv=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),e.curRate=1,e}return he(d,[{key:"beforeCreate",value:function(e){var s=e.player.config.playbackRate,c=s?Array.isArray(s)?s:e.config.list:[];Array.isArray(c)&&(e.config.list=c.map(function(v){return typeof v=="number"?v={rate:v,text:"".concat(v,"x")}:!v.text&&v.rate&&(v.text="".concat(v.rate,"x")),v}))}},{key:"afterCreate",value:function(){var e=this;_e(Te(d.prototype),"afterCreate",this).call(this),this.on(Jo,function(){e.curValue!==e.player.playbackRate&&e.renderItemList()}),this.renderItemList()}},{key:"show",value:function(e){!this.config.list||this.config.list.length===0||_e(Te(d.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,s){_e(Te(d.prototype),"onItemClick",this).call(this,e,s);var c=e.delegateTarget,v=Number(c.getAttribute("rate"));if(!v||v===this.curValue)return!1;var T={playbackRate:{from:this.player.playbackRate,to:v}};this.emitUserAction(e,"change_rate",{props:T}),this.curValue=v,this.player.playbackRate=v}},{key:"renderItemList",value:function(){var e=this,s=this.player.playbackRate||1;this.curValue=s;var c=-1,v=this.config.list.map(function(T,S){var C={rate:T.rate};return C.rate===s&&(C.selected=!0,c=S),C.showText=e.getTextByLang(T),C});_e(Te(d.prototype),"renderItemList",this).call(this,v,c)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,s=this.curIndex<e.length?this.curIndex:0,c=e[s],v="";!c||this.curIndex<0?v="".concat(this.player.playbackRate,"x"):v=this.getTextByLang(c,"iconText"),this.find(".icon-text").innerHTML=v}}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return Xe(Xe({},Pi.defaultConfig),{},{position:Ke.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),d}(Pi);function uv(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" class='path_full' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}function fv(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}var Vo=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"beforeCreate",value:function(e){typeof e.player.config.cssFullscreen=="boolean"&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;_e(Te(d.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(bi,function(s){e.animate(s)}),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(c){c.preventDefault(),c.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,s=this.find(".xgplayer-icon");s.appendChild(e.cssFullscreen),s.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var s=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:s}),s?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var s=this.i18nKeys,c=this.find(".xg-tips");c&&this.changeLangTextKey(c,e?s.EXITCSSFULLSCREEN_TIPS:s.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:uv,class:"xg-get-cssfull"},exitCssFullscreen:{icon:fv,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){_e(Te(d.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class='xgplayer-cssfullscreen'>
    <div class="xgplayer-icon">
    </div>
    `.concat(sr(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:Ke.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),d}(dr),cv=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(c){c.preventDefault(),c.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(Wr,function(s){e.onError(s)})}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.player,c=e.errorType,v=s.errorNote?this.i18n[s.errorNote]:"";if(!v)switch(c){case"decoder":v=this.i18n.MEDIA_ERR_DECODE;break;case"network":v=this.i18n.MEDIA_ERR_NETWORK;break;default:v=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=v,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return`<xg-error class="xgplayer-error">
      <div class="xgplayer-errornote">
       <span class="xgplayer-error-text"></span>
       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>
      </div>
    </xg-error>`}}],[{key:"pluginName",get:function(){return"error"}}]),d}(Fe),hv=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],function(s){(e.config.onClick||e.customOnClick)&&(s.preventDefault(),s.stopPropagation(),e.customOnClick?e.customOnClick(s):e.config.onClick(s))}),this.player.showPrompt=function(){e.showPrompt.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var s=this;Object.keys(e).map(function(c){s.root.style[c]=e[c]})}},{key:"showPrompt",value:function(e){var s=this,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(e){this.customOnClick=v;var T=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),A.addClass(this.root,"show"),c.mode==="arrow"&&A.addClass(this.root,"arrow"),typeof e=="string"?this.find(".xgplayer-prompt-detail").innerHTML=e:this.find(".xgplayer-prompt-detail").innerHTML="".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),c.style&&this.setStyle(c.style);var S=typeof c.autoHide=="boolean"?c.autoHide:this.config.autoHide;if(S){var C=c.interval||T;this.intervalId=setTimeout(function(){s.hide()},C)}}}},{key:"hide",value:function(){A.removeClass(this.root,"show"),A.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(ee.CONTROLS_FOLLOW,`">
    <span class="xgplayer-prompt-detail"></span>
    </xg-prompt>`)}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),d}(Fe),Ko={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function Sl(y){Object.keys(Ko).map(function(m){y[m]===void 0&&(y[m]=Ko[m])})}var Wo={_updateDotDom:function(m,d){if(d){var n=this.calcuPosition(m.time,m.duration),e=m.style||{};e.left="".concat(n.left,"%"),e.width="".concat(n.width,"%"),d.setAttribute("data-text",m.text),d.setAttribute("data-time",m.time),n.isMini?A.addClass(d,"mini"):A.removeClass(d,"mini"),Object.keys(e).map(function(s){d.style[s]=e[s]})}},initDots:function(){var m=this;this._ispots.map(function(d){m.createDot(d,!1)}),this.ispotsInit=!0},createDot:function(m){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this.player.plugins.progress;if(n&&(d&&(Sl(m),this._ispots.push(m)),!(!this.ispotsInit&&d))){var e=this.calcuPosition(m.time,m.duration),s=m.style||{};s.left="".concat(e.left,"%"),s.width="".concat(e.width,"%");var c="xgspot_".concat(m.id," xgplayer-spot");e.isMini&&(c+=" mini");var v=m.template?'<div class="xgplayer-spot-pop">'.concat(m.template,"</div>"):"",T=A.createDom("xg-spot",v,{"data-text":m.text,"data-time":m.time,"data-id":m.id},c);Object.keys(s).map(function(S){T.style[S]=s[S]}),n.outer&&n.outer.appendChild(T),this.positionDot(T,m.id)}},findDot:function(m){if(this.player.plugins.progress){var d=this._ispots.filter(function(n,e){return n.id===m});return d.length>0?d[0]:null}},updateDot:function(m){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.player.plugins.progress;if(n){var e=this.findDot(m.id);if(e&&Object.keys(m).map(function(c){e[c]=m[c]}),!!this.ispotsInit){var s=n.find('xg-spot[data-id="'.concat(m.id,'"]'));s&&(this._updateDotDom(m,s),d&&this.showDot(m.id))}}},deleteDot:function(m){var d=this._ispots,n=this.player.plugins.progress;if(n){for(var e=[],s=0;s<d.length;s++)d[s].id===m&&e.push(s);for(var c=e.length,v=c-1;v>=0;v--)if(d.splice(e[v],1),this.ispotsInit){var T=n.find('xg-spot[data-id="'.concat(m,'"]'));T&&T.parentElement.removeChild(T)}}},deleteAllDots:function(){var m=this.player.plugins.progress;if(m){if(!this.ispotsInit){this._ispots=[];return}for(var d=m.root.getElementsByTagName("xg-spot"),n=d.length-1;n>=0;n--)m.outer.removeChild(d[n]);this._ispots=[]}},updateAllDots:function(){var m=this,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=this.player.plugins.progress;if(n){if(!this.ispotsInit){this._ispots=d;return}this._ispots=[];var e=n.root.getElementsByTagName("xg-spot"),s=e.length;if(s>d.length)for(var c=s-1;c>d.length-1;c--)n.outer.removeChild(e[c]);d.forEach(function(v,T){T<s?(e[T].setAttribute("data-id","".concat(v.id)),m._ispots.push(v),m.updateDot(v)):m.createDot(v)})}},positionDots:function(){var m=this,d=this._ispots,n=this.playerSize,e=this.player.sizeInfo,s=this.player.plugins.progress;!s||e.width===n.width||(n.width=e.width,n.left=e.left,d.forEach(function(c){var v=s.find('xg-spot[data-id="'.concat(c.id,'"]'));v&&m.positionDot(v,c.id)}))},positionDot:function(m,d){var n=A.findDom(m,".xgplayer-spot-pop");if(n){var e=this.playerSize,s=m.getBoundingClientRect(),c=n.getBoundingClientRect(),v=s.left-e.left,T=e.width-v-s.width/2;if(v<c.width/2||e.width<c.width){var S=c.width/2-v;n.style.left="".concat(S,"px")}else if(T<c.width/2){var C=T-c.width/2+s.width/2;n.style.left="".concat(C,"px")}else n.style.left="50%"}},updateDuration:function(){var m=this,d=this.player.plugins.progress;if(d){var n=this._ispots;n.forEach(function(e){var s=d.find('xg-spot[data-id="'.concat(e.id,'"]'));m._updateDotDom(e,s)})}},getAllDotsDom:function(){var m=this.player.plugins.progress;if(!m)return[];var d=m.root.getElementsByTagName("xg-spot");return d},getDotDom:function(m){var d=this.player.plugins.progress;if(d)return d.find('xg-spot[data-id="'.concat(m,'"]'))}};function dv(y){var m=y.config,d=y.player;Object.keys(Wo).map(function(e){y[e]=Wo[e].bind(y)});var n=d.config.progressDot||m.ispots||[];y._ispots=n.map(function(e){return Sl(e),e}),y.ispotsInit=!1,y.playerSize={left:d.sizeInfo.left,width:d.sizeInfo.width},y.on(Xt,function(){y.ispotsInit?y.updateDuration():y.initDots()}),y.on(ar,function(){y.positionDots()})}var Cr={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},vv=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),q(K(e),"onMousemove",function(s){if(!e.config.disable){if(A.hasClass(s.target,"xg-spot-content")&&e.config.isHideThumbnailHover){e.player.plugins.progress.onMouseLeave(s);return}(e._state.f||A.hasClass(s.target,"xg-spot-content"))&&(A.event(s),s.stopPropagation())}}),q(K(e),"onMousedown",function(s){e.config.disable||(e._state.f||A.hasClass(s.target,"xg-spot-content"))&&(A.event(s),s.stopPropagation())}),q(K(e),"onMouseup",function(s){if(e.isDrag){var c=e.player.plugins.progress;c&&c.pos&&(c.onMouseUp(s),!c.pos.isEnter&&c.onMouseLeave(s))}}),q(K(e),"onDotMouseLeave",function(s){if(!e.config.disable){e._curDot.removeEventListener("mouseleave",e.onDotMouseLeave),e.blurDot(s.target),e._curDot=null;var c=e.player.plugins.progress;c&&c.enableBlur(),e.show()}}),q(K(e),"onProgressMouseOver",function(s,c){if(!e.config.disable&&A.hasClass(c.target,"xgplayer-spot")&&!e._curDot){e._curDot=c.target,e.focusDot(c.target),e._curDot.children.length>0&&e.hide();var v=e.player.plugins.progress;v&&v.disableBlur(),e._curDot.addEventListener("mouseleave",e.onDotMouseLeave)}}),e._ispots=[],e.videoPreview=null,e.videothumbnail=null,e.thumbnail=null,e.timeStr="",e._state={now:0,f:!1},e}return he(d,[{key:"beforeCreate",value:function(e){var s=e.player.plugins.progress;s&&(e.root=s.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",function(s,c){c.seekTime&&e.player.seek(c.seekTime)}),this.transformTimeHook=this.hook("transformTime",function(s){e.setTimeContent(A.format(s))}),dv(this),this.on(Xt,function(){e.show()}),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var s=this;e&&Object.keys(e).map(function(c){s.config[c]=e[c]})}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,s=this.player.plugins.progress;if(s&&(Object.keys(Cr).map(function(v){e[Cr[v]]=e[Cr[v]].bind(e),s.addCallBack(v,e[Cr[v]])}),Ae.device!=="mobile")){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var c=this.hook("previewClick",function(){});this.handlerPreviewClick=function(v){v.stopPropagation(),c(parseInt(e._state.now*1e3,10)/1e3,v)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,s){this.config.disable||!this.player.duration||this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!0,this.videoPreview&&A.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!1,this.videoPreview&&A.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,s){this.config.disable||A.hasClass(s.target,"xgplayer-spot")&&(s.stopPropagation(),s.preventDefault(),["time","id","text"].map(function(c){e[c]=s.target.getAttribute("data-".concat(c))}),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(s,e))}},{key:"updateLinePos",value:function(e,s){var c=this.root,v=this.previewLine,T=this.player,S=this.config,C=T.controls.mode,R=C==="flex",F=c.getBoundingClientRect().width;if(!(!F&&this._hasThumnail)){F=this._hasThumnail&&F<S.width?S.width:F;var B=e-F/2,U;B<0&&!R?(B=0,U=e-F/2):B>s-F&&!R?(U=B-(s-F),B=s-F):U=0,U!==void 0&&(v.style.transform="translateX(".concat(U.toFixed(2),"px)")),c.style.transform="translateX(".concat(B.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var s=this.timeText,c=this.timePoint;s.innerHTML=e,!this.thumbnail&&(c.innerHTML=e)}},{key:"updatePosition",value:function(e,s,c,v){var T=this.root,S=this.config,C=this._state;if(T){C.now=c,this.transformTimeHook(c);var R=this.timeStr;v&&v.target&&A.hasClass(v.target,"xgplayer-spot")?(this.showTips(v.target.getAttribute("data-text"),!1,R),this.focusDot(v.target),C.f=!0,S.isFocusDots&&C.f&&(C.now=parseInt(v.target.getAttribute("data-time"),10))):S.defaultText?(C.f=!1,this.showTips(S.defaultText,!0,R)):(C.f=!1,this.hideTips("")),this.updateTimeText(R),this.updateThumbnails(C.now),this.updateLinePos(e,s)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var s=this.player,c=this.videoPreview,v=this.config,T=s.plugins.thumbnail;if(T&&T.usable){this.thumbnail&&T.update(this.thumbnail,e,v.width,v.height);var S=c&&c.getBoundingClientRect();this.videothumbnail&&T.update(this.videothumbnail,e,S.width,S.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ae.device!=="mobile"){var s=this.player,c=this.config,v=s.getPlugin("thumbnail");if(v&&v.setConfig(e),!v||!v.usable||!c.isShowThumbnail){A.addClass(this.root,"short-line no-thumbnail");return}else A.removeClass(this.root,"short-line no-thumbnail");c.mode==="short"&&A.addClass(this.root,"short-line"),this._hasThumnail=!0;var T=this.find(".xg-spot-thumbnail");this.thumbnail=v.createThumbnail(T,"progress-thumbnail"),c.isShowCoverPreview&&(this.videoPreview=A.createDom("xg-video-preview","",{},"xgvideo-preview"),s.root.appendChild(this.videoPreview),this.videothumbnail=v.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}}},{key:"calcuPosition",value:function(e,s){var c=this.player.plugins.progress,v=this.player,T=c.root.getBoundingClientRect().width,S=v.duration/T*6;return e+s>v.duration&&(s=v.duration-e),e/v.duration*100,s/v.duration,{left:e/v.duration*100,width:s/v.duration*100,isMini:s<S}}},{key:"showDot",value:function(e){var s=this.findDot(e);if(s){var c=this.root.getBoundingClientRect(),v=c.width,T=s.time/this.player.duration*v;this.updatePosition(T,v,s.time)}}},{key:"focusDot",value:function(e,s){e&&(s||(s=e.getAttribute("data-id")),A.addClass(e,"active"),this._activeDotId=s)}},{key:"blurDot",value:function(e){if(!e){var s=this._activeDotId;e=this.getDotDom(s)}e&&(A.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";A.addClass(this.root,"no-timepoint"),e&&(A.addClass(this.find(".xg-spot-content"),"show-text"),s&&this.config.mode==="production"?(A.addClass(this.root,"product"),this.tipText.textContent=e):(A.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(c," ").concat(e)))}},{key:"hideTips",value:function(){A.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",A.removeClass(this.find(".xg-spot-content"),"show-text"),A.removeClass(this.root,"product")}},{key:"hide",value:function(){A.addClass(this.root,"hide")}},{key:"show",value:function(e){A.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,s=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(s.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,s=this.player.plugins.progress;s&&Object.keys(Cr).map(function(c){s.removeCallBack(c,e[Cr[c]])}),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return Ae.device==="mobile"||this.playerConfig.isMobileSimulateMode==="mobile"?"":'<div class="xg-spot-info hide '.concat(this.config.mode==="short"?"short-line":"",`">
      <div class="xg-spot-content">
        <div class="xg-spot-thumbnail">
          <span class="xg-spot-time"></span>
        </div>
        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>
      </div>
      <div class="xgplayer-progress-point">00:00</div>
      <div class="xg-spot-ext-text"></div>
      <div class="xg-spot-line"></div>
    </div>`)}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),d}(Fe),gv=function(y){me(d,y);var m=ye(d);function d(n){var e;return ce(this,d),e=m.call(this,n),e.ratio=1,e.interval=null,e._preloadMark={},e}return he(d,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([Xt],function(){var s=e.config,c=s.pic_num,v=s.interval;e.usable&&(e.interval=v>0?v:Math.round(e.player.duration*1e3/c)/1e3)})}},{key:"setConfig",value:function(e){var s=this;if(e){var c=Object.keys(e);c.length<1||(c.forEach(function(v){s.config[v]=e[v]}),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,s=e.urls,c=e.pic_num;return s&&s.length>0&&c>0}},{key:"initThumbnail",value:function(){var e=this.config,s=e.width,c=e.height,v=e.pic_num,T=e.interval;this.ratio=s/c*100,this.interval=T||Math.round(this.player.duration/v),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var s=this;if(!this._preloadMark[e]){var c=this.config.urls,v=c.length,T=[];e>0&&T.push(e-1),T.push(e),e>0&&e<v-1&&T.push(e+1),T.map(function(S){!s._preloadMark[S]&&S>=0&&S<v&&(s._preloadMark[S]=1,A.preloadImg(c[S],function(){s._preloadMark[S]=2}))})}}},{key:"getPosition",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=this.config,T=v.pic_num,S=v.row,C=v.col,R=v.width,F=v.height;this.interval=Math.round(this.player.duration/T);var B=Math.ceil(e/this.interval);B=B>T?T:B;var U=B<S*C?0:Math.ceil(B/(S*C))-1,W=B-U*(C*S),z=W>0?Math.ceil(W/C)-1:0,ne=W>0?W-z*C-1:0,te=0,J=0;if(s&&c){var Le=s/c;Le<R/F?(J=c,te=J*(R/F)):(te=s,J=te/(R/F))}else c?s||(J=c||F,te=J*(R/F)):(te=s||R,J=te/(R/F));var pe=this.getUrlByIndex(U);return{urlIndex:U,rowIndex:z,colIndex:ne,url:pe,height:J,width:te,style:{backgroundImage:"url(".concat(pe,")"),backgroundSize:"".concat(te*C,"px auto"),backgroundPosition:"-".concat(ne*te,"px -").concat(z*J,"px"),width:"".concat(te,"px"),height:"".concat(J,"px")}}}},{key:"update",value:function(e,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",S=this.config,C=S.pic_num,R=S.urls;if(!(C<=0||!R||R.length===0)){var F=this.getPosition(s,c,v);this.preload(F.urlIndex),Object.keys(F.style).map(function(B){e.style[B]=F.style[B]}),Object.keys(T).map(function(B){e.style[B]=T[B]})}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,s){var c=A.createDom("xg-thumbnail","",{},"thumbnail ".concat(s));return e&&e.appendChild(c),c}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),d}(Fe);function Bn(y){return y?"background:".concat(y,";"):""}var pv=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onTimeupdate",function(){var v=n.player.ended,T=K(n),S=T.offsetDuration,C=n.currentTime;C=A.adjustTimeByDuration(C,S,v),n.update({played:C},S)}),n}return he(d,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var e=this.player,s=e.offsetCurrentTime,c=e.currentTime;return s>=0?s:c}},{key:"afterCreate",value:function(){var e=this;this.root&&(this.on(Lt,this.onTimeupdate),this.on(hr,function(){e.reset()}))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},s=arguments.length>1?arguments[1]:void 0;!s||!this.root||(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/s*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/s*100,"%")))}},{key:"render",value:function(){var e=this.playerConfig,s=e.commonStyle,c=e.miniprogress;if(c){var v=this.config,T=v.mode,S=v.height,C={cached:Bn(s.cachedColor),played:Bn(s.playedColor),progress:Bn(s.progressColor),height:S>0&&S!==2?"height: ".concat(S,"px;"):""},R=T==="show"?"xg-mini-progress-show":"";return'<xg-mini-progress class="xg-mini-progress '.concat(R,'" style="').concat(C.progress," ").concat(C.height,`">
    <xg-mini-progress-cache class="xg-mini-progress-cache" style="`).concat(C.cached,`"></xg-mini-progress-cache>
    <xg-mini-progress-played class="xg-mini-progress-played" style="`).concat(C.played,`"></xg-mini-progress-played>
    </xg-mini-progress>`)}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),d}(Fe),Ar={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",POSTER:"poster"};function mv(){try{return parseInt(window.performance.now(),10)}catch{return new Date().getTime()}}function yv(){try{var y=document.createElement("canvas").getContext;return!!y}catch{return!1}}var Ei=null,Ev=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onLoadedData",function(v){n.player&&(n._frameCount=n.config.startFrameCount,n.stop(),n.renderOnTimeupdate(v),n.off(Lt,n.renderOnTimeupdate),n.on(Lt,n.renderOnTimeupdate))}),q(K(n),"onVisibilitychange",function(v){document.visibilityState==="visible"?n._checkIfCanStart()&&n.start():document.visibilityState==="hidden"&&n.stop()}),q(K(n),"renderOnTimeupdate",function(v){if(n._frameCount>0)n.renderOnce(),n._frameCount--;else{n._isLoaded=!0,n.off(Lt,n.renderOnTimeupdate);var T=n.config.startInterval;!n.player.paused&&n._checkIfCanStart()&&n.start(0,T)}}),q(K(n),"start",function(v,T){var S=n.player.video,C=mv(),R=n.checkVideoIsSupport(S);!R||!n.canvasCtx||(T||(T=n.interval),n.stop(),S.videoWidth&&S.videoHeight&&(n.videoPI=S.videoHeight>0?parseInt(S.videoWidth/S.videoHeight*100,10):0,(n.config.mode===Ar.REAL_TIME||C-n.preTime>=T)&&(S&&S.videoWidth&&n.update(R,n.videoPI),n.preTime=C)),n.frameId=n._loopType==="timer"?A.setTimeout(K(n),n.start,T):A.requestAnimationFrame(n.start))}),q(K(n),"stop",function(){n.frameId&&(n._loopType==="timer"?A.clearTimeout(K(n),n.frameId):A.cancelAnimationFrame(n.frameId),n.frameId=null)}),n}return he(d,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.dynamicBg===!0&&(this.config.disable=!1),d.isSupport||(this.config.disable=!0);var s=this.config,c=s.disable,v=s.mode,T=s.frameRate;c||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/T,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==Ar.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(Mi,function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())}),v!==Ar.POSTER&&(v!==Ar.FIRST_FRAME&&(this.on(hr,function(){e.stop()}),this.on(Ct,function(){var S=e.config.startInterval;e._checkIfCanStart()&&e.start(0,S)}),this.on(Pr,function(){e.stop()})),this.on(qt,this.onLoadedData),this.on(Zn,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var s=this;Object.keys(e).forEach(function(c){c==="root"&&e[c]!==s.config[c]?s.reRender(e[c]):c==="frameRate"?s.interval=parseInt(1e3/e[c],10):c==="disable"&&e[c]&&s.stop(),s.config[c]=e[c]})}},{key:"init",value:function(e){var s=this.player,c=this.config;this.canvasFilter=d.supportCanvasFilter();try{var v=e||c.root;v||(v=c.isInnerRender&&s.innerContainer||s.root),v.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(c.index,`"><canvas>
        </canvas><xgmask></xgmask></div>`)),this.root=v.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=c.filter,this.canvas.style.webkitFilter=c.filter),this.mask=this.find("xgmask"),c.addMask&&(this.mask.style.background=c.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(T){we.logError("plugin:DynamicBg",T)}}},{key:"reRender",value:function(e){var s=this.config.disable;if(!(!s&&!this.root)){this.stop();var c=this.root?this.root.parentElement:null;if(c!==e&&c.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var v=this.config.startInterval;this._checkIfCanStart()&&this.start(0,v)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var s=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(s&&!(Ae.browser==="safari"&&A.isMSE(s)))return s;var c=s?s.tagName.toLowerCase():"";return c==="canvas"||c==="img"?s:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var s=A.typeOf(e)==="String"?e:A.typeOf(e.poster)==="String"?e.poster:null;this.updateImg(s)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==Ar.FIRST_FRAME&&e!==Ar.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!(!e.videoWidth||!e.videoHeight)){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var s=this.checkVideoIsSupport(e);s&&this.update(s,this.videoPI)}}},{key:"updateImg",value:function(e){var s=this;if(e){var c=this.canvas.getBoundingClientRect(),v=c.width,T=c.height,S=new window.Image;S.onload=function(){if(!(!s.canvas||s.frameId||s.isStart)){s.canvas.height=T,s.canvas.width=v;var C=parseInt(v/T*100,10);s.update(S,C),S=null}},S.src=e}}},{key:"update",value:function(e,s){if(!(!this.canvas||!this.canvasCtx||!s))try{var c=this._pos,v=this.config,T=this.canvas.getBoundingClientRect(),S=T.width,C=T.height;if(S!==c.width||C!==c.height||c.pi!==s){var R=parseInt(S/C*100,10);c.pi=s,c.width!==S&&(c.width=this.canvas.width=S),c.height!==C&&(c.height=this.canvas.height=C);var F=C,B=S;R<s?B=parseInt(C*s/100,10):R>s&&(F=parseInt(S*100/s,10)),c.rwidth=B*v.multiple,c.rheight=F*v.multiple,c.x=(S-c.rwidth)/2,c.y=(C-c.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=v.filter),this.canvasCtx.drawImage(e,c.x,c.y,c.rwidth,c.rheight)}catch(U){we.logError("plugin:DynamicBg",U)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return typeof Ei=="boolean"||(Ei=yv()),Ei}},{key:"supportCanvasFilter",value:function(){return!(Ae.browser==="safari"||Ae.browser==="firefox")}}]),d}(Fe),Tv={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}},Hr="info",Un=dl,Sv=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"_recordUserActions",function(v){var T=n._getTime(),S=Object.assign({},v,{msg:v.msg||v.action});n._stats[Hr].push(Xe(Xe({type:"userAction"},T),{},{payload:S}))}),q(K(n),"_onReset",function(){n.reset()}),q(K(n),"_recordInfo",function(v){n.info(v)}),q(K(n),"_downloadStats",function(){var v=n.getStats(),T=new Blob([JSON.stringify(v)],{type:"application/json"}),S=window.URL.createObjectURL(T),C=document.createElement("a");C.style.display="none",C.href=S,C.download="player.txt",C.disabled=!1,C.click()}),n}return he(d,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:new Date().toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(Ai,this._recordUserActions),this.on(Un.STATS_INFO,this._recordInfo),this.on(Un.STATS_DOWNLOAD,this._downloadStats),this.on(Un.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var s=this._getTime();this._stats[Hr].push(Xe(Xe({},s),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var s=Date.now(),c=s-e.startMs,v=Xe({cat:"function",dur:c,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(v)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(e={},q(e,Hr,[]),q(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,s=e.media,c=[],v=0;v<s.buffered.length;v++)c.push({start:s.buffered.start(v),end:s.buffered.end(v)});var T={currentTime:s.currentTime,readyState:s.readyState,buffered:c,paused:s.paused,ended:s.ended};return this._stats.media=T,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[Hr],s=e.map(function(c){var v=c.payload.data,T="";try{v instanceof Error?T=v.msg:v!==void 0&&(T=JSON.stringify(v))}catch(S){console.log("err",S)}return"[".concat(c.timeFormat,"] : ").concat(c.payload.msg," ").concat(T," ")});return s}},{key:"_getProfile",value:function(){var e={traceEvents:[]},s=this._stats[Hr];return s.forEach(function(c){c.payload.profile&&e.traceEvents.push(c.payload)}),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),d}(Dt),xl=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onGapJump",function(){var v=K(n),T=v.player,S=v.config;if(T.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(T.media.seeking){if(!n.seekingEventReceived)return}else n.seekingEventReceived=!1;if(!(T.media.paused&&T.media.currentTime!==0&&n.hasPlayed)){var C=T.media.buffered,R=S.smallGapLimit||.5,F=S.gapDetectionThreshold||.3,B=T.media.currentTime,U=n._getIndex(C,B,F);if(!(U===null||U===0)){console.log("GapJump  bufferRange ",C.start(U),C.end(U));var W=C.start(U)+.1,z=T.media.duration;if(!(W>z)){var ne=W-B,te=ne<=R;ne<d.BROWSER_GAP_TOLERANCE||te&&(S.useGapJump!==!1&&(T.media.currentTime=n.isSafari?W+.1:W),n.player&&n.player.emit("detectGap"),console.log("gapJump gapIndex",U," isGapSamll:",te," currentTime:",T.media.currentTime," jumpSize:",B-T.media.currentTime),W!==.08&&T&&T.emit("log",{type:"oneevent",end_type:"gap",vid:T.config.vid,ext:{video_postion:Math.floor(W*1e3)}}))}}}}}),n}return he(d,[{key:"afterCreate",value:function(){var e=this,s=this.config.useGapJump;s!==!1&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(jr,this.onGapJump),this.on(Ct,function(){e.hasPlayed=!0}),this.on(Oi,function(){e.seekingEventReceived=!0}))}},{key:"_getIndex",value:function(e,s,c){if(!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6)return null;for(var v=this._getBuffered(e),T=null,S=0;S<v.length;S++){var C=v[S];if(C.start>s&&(S===0||v[S-1].end-s<=c)){T=S;break}}return T}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var s=[],c=0;c<e.length;c++)s.push({start:e.start(c),end:e.end(c)});return s}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),d}(Fe);xl.BROWSER_GAP_TOLERANCE=.001;var xv=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"onWaiting",function(){var v=K(n),T=v.config;n.jumpCnt>T.jumpCntMax||n.timer||T.useWaitingTimeoutJump===!1||(n.timer=setTimeout(n.onJump,T.waitingTime*1e3))}),q(K(n),"onJump",function(){var v=K(n),T=v.player,S=v.config;if(clearTimeout(n.timer),n.timer=null,!(n.jumpCnt>S.jumpCntMax||S.useWaitingTimeoutJump===!1)&&!(T.media.paused&&T.media.currentTime!==0&&n.hasPlayed)){n.jumpSize=S.jumpSize*(n.jumpCnt+1),n.jumpCnt===S.jumpSize&&n.jumpSize<6&&(n.jumpSize=6);var C=T.currentTime+n.jumpSize,R=T.media.duration;C>R||(n.jumpCnt++,T.currentTime=C)}}),n}return he(d,[{key:"afterCreate",value:function(){var e=this,s=this.config,c=s.useWaitingTimeoutJump,v=s.jumpSize;c!==!1&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=v,this.on(jr,this.onWaiting),this.on([Qn,zt],function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize}),this.on(Ct,function(){e.hasPlayed=!0}))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),d}(Fe),kr="cdn",Ti=["cdn"],_v=function(y){me(d,y);var m=ye(d);function d(){var n;ce(this,d);for(var e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return n=m.call.apply(m,[this].concat(s)),q(K(n),"getSpeed",function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kr;if(!n.speedListCache||!n.speedListCache[v]||n.speedListCache[v].length<=0)return 0;var T=0;return n.speedListCache[v].map(function(S){T+=S}),Math.floor(T/n.speedListCache[v].length)}),q(K(n),"startTimer",function(){A.isMSE(n.player.video)||(n.initSpeedList(),n.cnt=0,n.timer=setTimeout(n.testSpeed,n.config.testTimeStep))}),q(K(n),"initSpeedList",function(){n.speedListCache={},Ti.forEach(function(v){n.speedListCache[v]=[]})}),q(K(n),"_onRealSpeedChange",function(v){v.speed&&n.appendList(v.speed,v.type||kr)}),q(K(n),"testSpeed",function(){if(clearTimeout(n.timer),n.timer=null,!(!n.player||!n.config.openSpeed)){var v=n.config,T=v.url,S=v.loadSize,C=v.testCnt,R=v.testTimeStep,F=T+(T.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(n.cnt>=C)){n.cnt++;try{var B=new Date().getTime(),U=null,W=new XMLHttpRequest;n.xhr=W,W.open("GET",F);var z={},ne=Math.floor(Math.random()*10);z.Range="bytes="+ne+"-"+(S+ne),z&&Object.keys(z).forEach(function(te){W.setRequestHeader(te,z[te])}),W.onreadystatechange=function(){if(W.readyState===4){n.xhr=null,U=new Date().getTime();var te=W.getResponseHeader("Content-Length")/1024*8,J=Math.round(te*1e3/(U-B));n.appendList(J),n.timer=setTimeout(n.testSpeed,R)}},W.send()}catch(te){console.error(te)}}}}),q(K(n),"appendList",function(v){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kr;if(!(!n.speedListCache||!n.speedListCache[T])){var S=n.config.saveSpeedMax;n.speedListCache[T].length>=S&&n.speedListCache[T].shift(),n.speedListCache[T].push(v);var C=K(n),R=C.player;R&&(T===kr?R.realTimeSpeed=v:R[n.getSpeedName("realTime",T)]=v),n.updateSpeed(T)}}),q(K(n),"updateSpeed",function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kr,T=n.getSpeed(v),S=K(n),C=S.player;if(C)if(v===kr)(!C.avgSpeed||T!==C.avgSpeed)&&(C.avgSpeed=T,C.emit(jn,{speed:T,realTimeSpeed:C.realTimeSpeed}));else{var R=n.getSpeedName("avg",v);(!C[R]||T!==C[R])&&(C[R]=T,C.emit(jn,{speed:T,realTimeSpeed:C.realTimeSpeed}))}}),n}return he(d,[{key:"afterCreate",value:function(){var e=this.config,s=e.openSpeed,c=e.addSpeedTypeList;c?.length>0&&Ti.push.apply(Ti,wt(c)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,s&&this.on([qt,_i],this.startTimer)}},{key:"getSpeedName",value:function(e,s){return e+"Speed"+s.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer){clearTimeout(this.timer),this.timer=null;return}if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var e=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([qt,_i],this.startTimer),Ti.forEach(function(s){e.speedListCache&&e.speedListCache[s]&&(e.speedListCache[s]=[])}),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&this.xhr.readyState!==4&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:200*1024,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),d}(Fe),bv=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d,[{key:"afterCreate",value:function(){var e=this,s=this.player,c=this.config,v=s.media||s.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!c.disabled){var T=v.getVideoPlaybackQuality;T&&(this.on(Ct,function(){e._startTick()}),this.on(Pr,function(){e._stopTick()}),this.on(cr,function(){e._stopTick()}),this.on(hr,function(){e._stopTick()}))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout(function(){e._checkDecodeFPS(),e._startTick()},this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,s){for(var c=!1,v=[],T=0;T<s.length;T++){var S=s.start(T),C=s.end(T);if(v.push({start:S,end:C}),S<=e&&e<=C-1){c=!0;break}}return{enoughBuffer:c,buffers:v}}},{key:"_checkStuck",value:function(e,s,c,v){var T=this.player.media||this.player.video,S=document.hidden,C=T.paused,R=T.readyState,F=T.currentTime,B=T.buffered;if(!(S||C||R<4)){var U=this._checkBuffer(F,B),W=U.enoughBuffer,z=U.buffers;W&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:F,buffers:z,curDecodedFrames:e,totalVideoFrames:s,droppedVideoFrames:c,checkInterval:v}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(vl,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var s=e.getVideoPlaybackQuality(),c=s.totalVideoFrames,v=s.droppedVideoFrames,T=performance.now();if(c&&this._lastCheckPoint){var S=c-this._lastDecodedFrames,C=T-this._lastCheckPoint;this._checkStuck(S,c,v,C)}this._lastDecodedFrames=c,this._lastCheckPoint=T}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),d}(Fe);Rr.use(Tv);var Lv=he(function y(m,d){var n,e,s;ce(this,y);var c=d&&d.isMobileSimulateMode==="mobile",v=d.isLive,T=v?[]:[Hd,wd,pv,vv,Ud],S=[].concat(T,[Dd,Bd,Yd,Qd,ov,lv,iv,nv,Wd,qd]),C=[hd,dd,gd,Rd,pd,cv,hv,gv,Td];this.plugins=[Sv,fd].concat(wt(S),C,[xl,xv]);var R=c?"mobile":Ae.device;switch(R){case"pc":(n=this.plugins).push.apply(n,[Uo,Fn,Vo,_v,bv]);break;case"mobile":(e=this.plugins).push.apply(e,[Cd]);break;default:(s=this.plugins).push.apply(s,[Uo,Fn,Vo])}(Ae.os.isIpad||R==="pc")&&this.plugins.push(Ev),Ae.os.isIpad&&this.plugins.push(Fn),this.ignores=[],this.i18n=[]}),Ot=function(y){me(d,y);var m=ye(d);function d(){return ce(this,d),m.apply(this,arguments)}return he(d)}(Ni);q(Ot,"defaultPreset",Lv);q(Ot,"Util",A);q(Ot,"Sniffer",Ae);q(Ot,"Errors",xi);q(Ot,"Events",Vh);q(Ot,"Plugin",Fe);q(Ot,"BasePlugin",Dt);q(Ot,"I18N",Rr);q(Ot,"STATE_CLASS",ee);q(Ot,"InstManager",El);function Cv(y,m){if(!(y instanceof m))throw new TypeError("Cannot call a class as a function")}function jo(y,m){for(var d=0;d<m.length;d++){var n=m[d];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(y,Ov(n.key),n)}}function Av(y,m,d){return m&&jo(y.prototype,m),d&&jo(y,d),Object.defineProperty(y,"prototype",{writable:!1}),y}function kv(y,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(m&&m.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),m&&$n(y,m)}function wi(y){return wi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},wi(y)}function $n(y,m){return $n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},$n(y,m)}function Rv(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Iv(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function Pv(y,m){if(m&&(typeof m=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iv(y)}function wv(y){var m=Rv();return function(){var n=wi(y),e;if(m){var s=wi(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return Pv(this,e)}}function Dv(y,m){if(typeof y!="object"||y===null)return y;var d=y[Symbol.toPrimitive];if(d!==void 0){var n=d.call(y,m);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}function Ov(y){var m=Dv(y,"string");return typeof m=="symbol"?m:String(m)}var Hn={exports:{}},Yo;function Mv(){return Yo||(Yo=1,function(y,m){(function d(n){(function(e,s){y.exports=s()})(this,function(){function e(o,u,a){if(F())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,u);var t=new(o.bind.apply(o,r));return a&&W(t,a.prototype),t}function s(o,u){for(var a=0;a<u.length;a++){var r=u[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,ne(r.key),r)}}function c(o,u,a){return u&&s(o.prototype,u),a&&s(o,a),Object.defineProperty(o,"prototype",{writable:!1}),o}function v(o,u,a){return(u=ne(u))in o?Object.defineProperty(o,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[u]=a,o}function T(){return T=Object.assign?Object.assign.bind():function(o){for(var u=1;u<arguments.length;u++){var a=arguments[u];for(var r in a)({}).hasOwnProperty.call(a,r)&&(o[r]=a[r])}return o},T.apply(null,arguments)}function S(o){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},S(o)}function C(o,u){o.prototype=Object.create(u.prototype),o.prototype.constructor=o,W(o,u)}function R(o){try{return Function.toString.call(o).indexOf("[native code]")!==-1}catch{return typeof o=="function"}}function F(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(F=function(){return!!o})()}function B(o,u){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);u&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})),a.push.apply(a,r)}return a}function U(o){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?B(Object(a),!0).forEach(function(r){v(o,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):B(Object(a)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(a,r))})}return o}function W(o,u){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,r){return a.__proto__=r,a},W(o,u)}function z(o,u){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var r=a.call(o,u);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(o)}function ne(o){var u=z(o,"string");return typeof u=="symbol"?u:u+""}function te(o){var u=typeof Map=="function"?new Map:void 0;return te=function(a){if(a===null||!R(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(a))return u.get(a);u.set(a,r)}function r(){return e(a,arguments,S(this).constructor)}return r.prototype=Object.create(a.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),W(r,a)},te(o)}function J(){try{return crypto.randomUUID()}catch{try{var o=URL.createObjectURL(new Blob),u=o.toString();return URL.revokeObjectURL(o),u.slice(u.lastIndexOf("/")+1)}catch{var a=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){var f=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(l=="x"?f:f&3|8).toString(16)});return r}}}function Le(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var pe={exports:{}},De;function Re(){return De||(De=1,function(o){var u=Object.prototype.hasOwnProperty,a="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(a=!1));function t(h,g,p){this.fn=h,this.context=g,this.once=p||!1}function i(h,g,p,E,x){if(typeof p!="function")throw new TypeError("The listener must be a function");var b=new t(p,E||h,x),_=a?a+g:g;return h._events[_]?h._events[_].fn?h._events[_]=[h._events[_],b]:h._events[_].push(b):(h._events[_]=b,h._eventsCount++),h}function l(h,g){--h._eventsCount===0?h._events=new r:delete h._events[g]}function f(){this._events=new r,this._eventsCount=0}f.prototype.eventNames=function(){var g=[],p,E;if(this._eventsCount===0)return g;for(E in p=this._events)u.call(p,E)&&g.push(a?E.slice(1):E);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(p)):g},f.prototype.listeners=function(g){var p=a?a+g:g,E=this._events[p];if(!E)return[];if(E.fn)return[E.fn];for(var x=0,b=E.length,_=new Array(b);x<b;x++)_[x]=E[x].fn;return _},f.prototype.listenerCount=function(g){var p=a?a+g:g,E=this._events[p];return E?E.fn?1:E.length:0},f.prototype.emit=function(g,p,E,x,b,_){var L=a?a+g:g;if(!this._events[L])return!1;var k=this._events[L],I=arguments.length,w,O;if(k.fn){switch(k.once&&this.removeListener(g,k.fn,void 0,!0),I){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,p),!0;case 3:return k.fn.call(k.context,p,E),!0;case 4:return k.fn.call(k.context,p,E,x),!0;case 5:return k.fn.call(k.context,p,E,x,b),!0;case 6:return k.fn.call(k.context,p,E,x,b,_),!0}for(O=1,w=new Array(I-1);O<I;O++)w[O-1]=arguments[O];k.fn.apply(k.context,w)}else{var D=k.length,M;for(O=0;O<D;O++)switch(k[O].once&&this.removeListener(g,k[O].fn,void 0,!0),I){case 1:k[O].fn.call(k[O].context);break;case 2:k[O].fn.call(k[O].context,p);break;case 3:k[O].fn.call(k[O].context,p,E);break;case 4:k[O].fn.call(k[O].context,p,E,x);break;default:if(!w)for(M=1,w=new Array(I-1);M<I;M++)w[M-1]=arguments[M];k[O].fn.apply(k[O].context,w)}}return!0},f.prototype.on=function(g,p,E){return i(this,g,p,E,!1)},f.prototype.once=function(g,p,E){return i(this,g,p,E,!0)},f.prototype.removeListener=function(g,p,E,x){var b=a?a+g:g;if(!this._events[b])return this;if(!p)return l(this,b),this;var _=this._events[b];if(_.fn)_.fn===p&&(!x||_.once)&&(!E||_.context===E)&&l(this,b);else{for(var L=0,k=[],I=_.length;L<I;L++)(_[L].fn!==p||x&&!_[L].once||E&&_[L].context!==E)&&k.push(_[L]);k.length?this._events[b]=k.length===1?k[0]:k:l(this,b)}return this},f.prototype.removeAllListeners=function(g){var p;return g?(p=a?a+g:g,this._events[p]&&l(this,p)):(this._events=new r,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=a,f.EventEmitter=f,o.exports=f}(pe)),pe.exports}var je=Re(),Ve=Le(je),ge={exports:{}},at;function Tt(){return at||(at=1,function(o,u){(function(a){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,f={buildAbsoluteURL:function(h,g,p){if(p=p||{},h=h.trim(),g=g.trim(),!g){if(!p.alwaysNormalize)return h;var E=f.parseURL(h);if(!E)throw new Error("Error trying to parse base URL.");return E.path=f.normalizePath(E.path),f.buildURLFromParts(E)}var x=f.parseURL(g);if(!x)throw new Error("Error trying to parse relative URL.");if(x.scheme)return p.alwaysNormalize?(x.path=f.normalizePath(x.path),f.buildURLFromParts(x)):g;var b=f.parseURL(h);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var _=t.exec(b.path);b.netLoc=_[1],b.path=_[2]}b.netLoc&&!b.path&&(b.path="/");var L={scheme:b.scheme,netLoc:x.netLoc,path:null,params:x.params,query:x.query,fragment:x.fragment};if(!x.netLoc&&(L.netLoc=b.netLoc,x.path[0]!=="/"))if(!x.path)L.path=b.path,x.params||(L.params=b.params,x.query||(L.query=b.query));else{var k=b.path,I=k.substring(0,k.lastIndexOf("/")+1)+x.path;L.path=f.normalizePath(I)}return L.path===null&&(L.path=p.alwaysNormalize?f.normalizePath(x.path):x.path),f.buildURLFromParts(L)},parseURL:function(h){var g=r.exec(h);return g?{scheme:g[1]||"",netLoc:g[2]||"",path:g[3]||"",params:g[4]||"",query:g[5]||"",fragment:g[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(i,"");h.length!==(h=h.replace(l,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};o.exports=f})()}(ge)),ge.exports}var ft=Tt(),ae=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},bl=Number.isSafeInteger||function(o){return typeof o=="number"&&Math.abs(o)<=Ll},Ll=Number.MAX_SAFE_INTEGER||9007199254740991,be=function(o){return o.NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",o}({}),$=function(o){return o.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",o.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",o.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",o.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",o.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_PARSING_ERROR="levelParsingError",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.FRAG_GAP="fragGap",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.ASSET_LIST_LOAD_ERROR="assetListLoadError",o.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",o.ASSET_LIST_PARSING_ERROR="assetListParsingError",o.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.ATTACH_MEDIA_ERROR="attachMediaError",o.UNKNOWN="unknown",o}({}),P=function(o){return o.MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.MEDIA_ENDED="hlsMediaEnded",o.STALL_RESOLVED="hlsStallResolved",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFERED_TO_END="hlsBufferedToEnd",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached",o.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",o.ASSET_LIST_LOADING="hlsAssetListLoading",o.ASSET_LIST_LOADED="hlsAssetListLoaded",o.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",o.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",o.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",o.INTERSTITIAL_STARTED="hlsInterstitialStarted",o.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",o.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",o.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",o.INTERSTITIAL_ENDED="hlsInterstitialEnded",o.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",o.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",o.EVENT_CUE_ENTER="hlsEventCueEnter",o}({}),Pe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ce={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},vr=function(){function o(a,r,t){r===void 0&&(r=0),t===void 0&&(t=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=a,this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=r,this.totalWeight_=t}var u=o.prototype;return u.sample=function(r,t){var i=Math.pow(this.alpha_,r);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=r},u.getTotalWeight=function(){return this.totalWeight_},u.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);if(r)return this.estimate_/r}return this.estimate_},o}(),Cl=function(){function o(a,r,t,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=t,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new vr(a),this.fast_=new vr(r),this.defaultTTFB_=i,this.ttfb_=new vr(a)}var u=o.prototype;return u.update=function(r,t){var i=this.slow_,l=this.fast_,f=this.ttfb_;i.halfLife!==r&&(this.slow_=new vr(r,i.getEstimate(),i.getTotalWeight())),l.halfLife!==t&&(this.fast_=new vr(t,l.getEstimate(),l.getTotalWeight())),f.halfLife!==r&&(this.ttfb_=new vr(r,f.getEstimate(),f.getTotalWeight()))},u.sample=function(r,t){r=Math.max(r,this.minDelayMs_);var i=8*t,l=r/1e3,f=i/l;this.fast_.sample(l,f),this.slow_.sample(l,f)},u.sampleTTFB=function(r){var t=r/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(r,5))},u.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},u.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},u.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},u.destroy=function(){},c(o,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])}(),gr=function(u,a){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var r="["+u+"]:";this.trace=Qt,this.debug=a.debug.bind(null,r),this.log=a.log.bind(null,r),this.warn=a.warn.bind(null,r),this.info=a.info.bind(null,r),this.error=a.error.bind(null,r)},Qt=function(){},Al={trace:Qt,debug:Qt,log:Qt,warn:Qt,info:Qt,error:Qt};function Bi(){return T({},Al)}function kl(o,u){var a=self.console[o];return a?a.bind(self.console,(u?"["+u+"] ":"")+"["+o+"] >"):Qt}function la(o,u,a){return u[o]?u[o].bind(u):kl(o,a)}var Ui=Bi();function ua(o,u,a){var r=Bi();if(typeof console=="object"&&o===!0||typeof o=="object"){var t=["debug","log","info","warn","error"];t.forEach(function(i){r[i]=la(i,o,a)});try{r.log('Debug logs enabled for "'+u+'" in hls.js version 1.6.0')}catch{return Bi()}t.forEach(function(i){Ui[i]=la(i,o)})}else T(Ui,r);return r}var Oe=Ui,Hi,fa;function Rl(){return fa||(fa=1,Hi=void 0),Hi}var ca=Rl(),Il=Le(ca);function At(o,u){if(u===void 0&&(u=!1),typeof TextDecoder<"u"){var a=new TextDecoder("utf-8"),r=a.decode(o);if(u){var t=r.indexOf("\0");return t!==-1?r.substring(0,t):r}return r.replace(/\0/g,"")}for(var i=o.length,l,f,h,g="",p=0;p<i;){if(l=o[p++],l===0&&u)return g;if(l===0||l===3)continue;switch(l>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(l);break;case 12:case 13:f=o[p++],g+=String.fromCharCode((l&31)<<6|f&63);break;case 14:f=o[p++],h=o[p++],g+=String.fromCharCode((l&15)<<12|(f&63)<<6|(h&63)<<0);break}}return g}var ha={hexDump:function(u){for(var a="",r=0;r<u.length;r++){var t=u[r].toString(16);t.length<2&&(t="0"+t),a+=t}return a}},Gi=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},Ye={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},da=function(){function o(a){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof a=="string"&&(a={url:a}),this.base=a,wl(this,"stats")}var u=o.prototype;return u.setByteRange=function(r,t){var i=r.split("@",2),l;i.length===1?l=t?.byteRangeEndOffset||0:l=parseInt(i[1]),this._byteRange=[l,parseInt(i[0])+l]},u.clearElementaryStreamInfo=function(){var r=this.elementaryStreams;r[Ye.AUDIO]=null,r[Ye.VIDEO]=null,r[Ye.AUDIOVIDEO]=null},c(o,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){if(this._streams===null){var r;this._streams=(r={},r[Ye.AUDIO]=null,r[Ye.VIDEO]=null,r[Ye.AUDIOVIDEO]=null,r)}return this._streams},set:function(r){this._streams=r}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new Gi),this._stats},set:function(r){this._stats=r}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ft.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}])}();function Mt(o){return o.sn!=="initSegment"}var Vi=function(o){function u(r,t){var i;return i=o.call(this,t)||this,i._decryptdata=null,i._programDateTime=null,i._ref=null,i._bitrate=void 0,i.rawProgramDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.playlistOffset=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=r,i}C(u,o);var a=u.prototype;return a.addStart=function(t){this.setStart(this.start+t)},a.setStart=function(t){this.start=t,this._ref&&(this._ref.start=t)},a.setDuration=function(t){this.duration=t,this._ref&&(this._ref.duration=t)},a.setKeyFormat=function(t){if(this.levelkeys){var i=this.levelkeys[t];i&&!this._decryptdata&&(this._decryptdata=i.getDecryptData(this.sn))}},a.abortRequests=function(){var t,i;(t=this.loader)==null||t.abort(),(i=this.keyLoader)==null||i.abort()},a.setElementaryStreamInfo=function(t,i,l,f,h,g){g===void 0&&(g=!1);var p=this.elementaryStreams,E=p[t];if(!E){p[t]={startPTS:i,endPTS:l,startDTS:f,endDTS:h,partial:g};return}E.startPTS=Math.min(E.startPTS,i),E.endPTS=Math.max(E.endPTS,l),E.startDTS=Math.min(E.startDTS,f),E.endDTS=Math.max(E.endDTS,h)},c(u,[{key:"byteLength",get:function(){if(this.hasStats){var t=this.stats.total;if(t)return t}if(this.byteRange){var i=this.byteRange[0],l=this.byteRange[1];if(ae(i)&&ae(l))return l-i}return null}},{key:"bitrate",get:function(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null},set:function(t){this._bitrate=t}},{key:"decryptdata",get:function(){var t=this.levelkeys;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var i=this.levelkeys.identity;if(i)this._decryptdata=i.getDecryptData(this.sn);else{var l=Object.keys(this.levelkeys);if(l.length===1)return this._decryptdata=this.levelkeys[l[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var t=ae(this.duration)?this.duration:0;return this.programDateTime+t*1e3}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var i=Object.keys(this.levelkeys),l=i.length;if(l>1||l===1&&this.levelkeys[i[0]].encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(t){if(!ae(t)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=t}},{key:"ref",get:function(){return Mt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])}(da),Pl=function(o){function u(a,r,t,i,l){var f;f=o.call(this,t)||this,f.fragOffset=0,f.duration=0,f.gap=!1,f.independent=!1,f.relurl=void 0,f.fragment=void 0,f.index=void 0,f.duration=a.decimalFloatingPoint("DURATION"),f.gap=a.bool("GAP"),f.independent=a.bool("INDEPENDENT"),f.relurl=a.enumeratedString("URI"),f.fragment=r,f.index=i;var h=a.enumeratedString("BYTERANGE");return h&&f.setByteRange(h,l),l&&(f.fragOffset=l.fragOffset+l.duration),f}return C(u,o),c(u,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}])}(da);function va(o,u){var a=Object.getPrototypeOf(o);if(a){var r=Object.getOwnPropertyDescriptor(a,u);return r||va(a,u)}}function wl(o,u){var a=va(o,u);a&&(a.enumerable=!0,Object.defineProperty(o,u,a))}var zr=Math.pow(2,32)-1,Dl=[].push,ga={video:1,audio:2,id3:3,text:4};function tt(o){return String.fromCharCode.apply(null,o)}function pa(o,u){var a=o[u]<<8|o[u+1];return a<0?65536+a:a}function de(o,u){var a=ya(o,u);return a<0?4294967296+a:a}function ma(o,u){var a=de(o,u);return a*=Math.pow(2,32),a+=de(o,u+4),a}function ya(o,u){return o[u]<<24|o[u+1]<<16|o[u+2]<<8|o[u+3]}function Ki(o,u,a){o[u]=a>>24,o[u+1]=a>>16&255,o[u+2]=a>>8&255,o[u+3]=a&255}function Ol(o){for(var u=o.byteLength,a=0;a<u;){var r=de(o,a);if(r>8&&o[a+4]===109&&o[a+5]===111&&o[a+6]===111&&o[a+7]===102)return!0;a=r>1?a+r:u}return!1}function Se(o,u){var a=[];if(!u.length)return a;for(var r=o.byteLength,t=0;t<r;){var i=de(o,t),l=tt(o.subarray(t+4,t+8)),f=i>1?t+i:r;if(l===u[0])if(u.length===1)a.push(o.subarray(t+8,f));else{var h=Se(o.subarray(t+8,f),u.slice(1));h.length&&Dl.apply(a,h)}t=f}return a}function Ml(o){var u=[],a=o[0],r=8,t=de(o,r);r+=4;var i=0,l=0;a===0?(i=de(o,r),l=de(o,r+4),r+=8):(i=ma(o,r),l=ma(o,r+8),r+=16),r+=2;var f=o.length+l,h=pa(o,r);r+=2;for(var g=0;g<h;g++){var p=r,E=de(o,p);p+=4;var x=E&2147483647,b=(E&2147483648)>>>31;if(b===1)return Oe.warn("SIDX has hierarchical references (not supported)"),null;var _=de(o,p);p+=4,u.push({referenceSize:x,subsegmentDuration:_,info:{duration:_/t,start:f,end:f+x-1}}),f+=x,p+=4,r=p}return{earliestPresentationTime:i,timescale:t,version:a,referencesCount:h,references:u}}function Ea(o){for(var u=[],a=Se(o,["moov","trak"]),r=0;r<a.length;r++){var t=a[r],i=Se(t,["tkhd"])[0];if(i){var l=i[0],f=de(i,l===0?12:20),h=Se(t,["mdia","mdhd"])[0];if(h){l=h[0];var g=de(h,l===0?12:20),p=Se(t,["mdia","hdlr"])[0];if(p){var E=tt(p.subarray(8,12)),x={soun:Ye.AUDIO,vide:Ye.VIDEO}[E],b=Se(t,["mdia","minf","stbl","stsd"])[0],_=Fl(b);x?(u[f]={timescale:g,type:x,stsd:_},u[x]=U({timescale:g,id:f},_)):u[f]={timescale:g,type:E,stsd:_}}}}}var L=Se(o,["moov","mvex","trex"]);return L.forEach(function(k){var I=de(k,4),w=u[I];w&&(w.default={duration:de(k,12),flags:de(k,20)})}),u}function Fl(o){var u=o.subarray(8),a=u.subarray(86),r=tt(u.subarray(4,8)),t=r,i,l=r==="enca"||r==="encv";if(l){var f=Se(u,[r])[0],h=f.subarray(r==="enca"?28:78),g=Se(h,["sinf"]);g.forEach(function(ot){var xt=Se(ot,["schm"])[0];if(xt){var We=tt(xt.subarray(4,8));if(We==="cbcs"||We==="cenc"){var lt=Se(ot,["frma"])[0];lt&&(t=tt(lt))}}})}var p=t;switch(t){case"avc1":case"avc2":case"avc3":case"avc4":{var E=Se(a,["avcC"])[0];t+="."+qr(E[1])+qr(E[2])+qr(E[3]),i=$r(p==="avc1"?"dva1":"dvav",a);break}case"mp4a":{var x=Se(u,[r])[0],b=Se(x.subarray(28),["esds"])[0];if(b&&b.length>7){var _=4;if(b[_++]!==3)break;_=Wi(b,_),_+=2;var L=b[_++];if(L&128&&(_+=2),L&64&&(_+=b[_++]),b[_++]!==4)break;_=Wi(b,_);var k=b[_++];if(k===64)t+="."+qr(k);else break;if(_+=12,b[_++]!==5)break;_=Wi(b,_);var I=b[_++],w=(I&248)>>3;w===31&&(w+=1+((I&7)<<3)+((b[_]&224)>>5)),t+="."+w}break}case"hvc1":case"hev1":{var O=Se(a,["hvcC"]);if(O){var D=O[0],M=D[1],G=["","A","B","C"][M>>6],N=M&31,H=de(D,2),X=(M&32)>>5?"H":"L",Y=D[12],V=D.subarray(6,12);t+="."+G+N,t+="."+H.toString(16).toUpperCase(),t+="."+X+Y;for(var j="",Q=V.length;Q--;){var se=V[Q];if(se||j){var re=se.toString(16).toUpperCase();j="."+re+j}}t+=j}i=$r(p=="hev1"?"dvhe":"dvh1",a);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{t=$r(t,a)||t;break}case"vp09":{var Z=Se(a,["vpcC"])[0],oe=Z[4],le=Z[5],ue=Z[6]>>4&15;t+="."+Ft(oe)+"."+Ft(le)+"."+Ft(ue);break}case"av01":{var fe=Se(a,["av1C"])[0],Be=fe[1]>>>5,Ie=fe[1]&31,Ue=fe[2]>>>7?"H":"M",ke=(fe[2]&64)>>6,Qe=(fe[2]&32)>>5,He=Be===2&&ke?Qe?12:10:ke?10:8,qe=(fe[2]&16)>>4,gt=(fe[2]&8)>>3,it=(fe[2]&4)>>2,Ge=fe[2]&3,pt=1,Je=1,ze=1,mt=0;t+="."+Be+"."+Ft(Ie)+Ue+"."+Ft(He)+"."+qe+"."+gt+it+Ge+"."+Ft(pt)+"."+Ft(Je)+"."+Ft(ze)+"."+mt,i=$r("dav1",a);break}}return{codec:t,encrypted:l,supplemental:i}}function $r(o,u){var a=Se(u,["dvvC"]),r=a.length?a[0]:Se(u,["dvcC"])[0];if(r){var t=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return o+"."+Ft(t)+"."+Ft(i)}}function Wi(o,u){for(var a=u+5;o[u++]&128&&u<a;);return u}function qr(o){return("0"+o.toString(16).toUpperCase()).slice(-2)}function Ft(o){return(o<10?"0":"")+o}function Nl(o,u){if(!o||!u)return o;var a=u.keyId;if(a&&u.isCommonEncryption){var r=Se(o,["moov","trak"]);r.forEach(function(t){var i=Se(t,["mdia","minf","stbl","stsd"])[0],l=i.subarray(8),f=Se(l,["enca"]),h=f.length>0;h||(f=Se(l,["encv"])),f.forEach(function(g){var p=h?g.subarray(28):g.subarray(78),E=Se(p,["sinf"]);E.forEach(function(x){var b=Bl(x);if(b){var _=b.subarray(8,24);_.some(function(L){return L!==0})||(Oe.log("[eme] Patching keyId in 'enc"+(h?"a":"v")+">sinf>>tenc' box: "+ha.hexDump(_)+" -> "+ha.hexDump(a)),b.set(a,8))}})})})}return o}function Bl(o){var u=Se(o,["schm"])[0];if(u){var a=tt(u.subarray(4,8));if(a==="cbcs"||a==="cenc")return Se(o,["schi","tenc"])[0]}return null}function Ul(o,u){return Se(u,["moof","traf"]).reduce(function(a,r){var t=Se(r,["tfdt"])[0],i=t[0],l=Se(r,["tfhd"]).reduce(function(f,h){var g=de(h,4),p=o[g];if(p){var E=de(t,4);if(i===1){if(E===zr)return Oe.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),f;E*=zr+1,E+=de(t,8)}var x=p.timescale||9e4,b=E/x;if(ae(b)&&(f===null||b<f))return b}return f},null);return l!==null&&ae(l)&&(a===null||l<a)?l:a},null)}function Hl(o,u){for(var a=0,r=0,t=0,i=Se(o,["moof","traf"]),l=0;l<i.length;l++){var f=i[l],h=Se(f,["tfhd"])[0],g=de(h,4),p=u[g];if(p){var E=p.default,x=de(h,0)|E?.flags,b=E?.duration;x&8&&(x&2?b=de(h,12):b=de(h,8));for(var _=p.timescale||9e4,L=Se(f,["trun"]),k=0;k<L.length;k++){if(a=Gl(L[k]),!a&&b){var I=de(L[k],4);a=b*I}p.type===Ye.VIDEO?r+=a/_:p.type===Ye.AUDIO&&(t+=a/_)}}}if(r===0&&t===0){for(var w=1/0,O=0,D=0,M=Se(o,["sidx"]),G=0;G<M.length;G++){var N=Ml(M[G]);if(N!=null&&N.references){w=Math.min(w,N.earliestPresentationTime/N.timescale);var H=N.references.reduce(function(X,Y){return X+Y.info.duration||0},0);O=Math.max(O,H+N.earliestPresentationTime/N.timescale),D=O-w}}if(D&&ae(D))return D}return r||t}function Gl(o){var u=de(o,0),a=8;u&1&&(a+=4),u&4&&(a+=4);for(var r=0,t=de(o,4),i=0;i<t;i++){if(u&256){var l=de(o,a);r+=l,a+=4}u&512&&(a+=4),u&1024&&(a+=4),u&2048&&(a+=4)}return r}function Vl(o,u,a){Se(u,["moof","traf"]).forEach(function(r){Se(r,["tfhd"]).forEach(function(t){var i=de(t,4),l=o[i];if(l){var f=l.timescale||9e4;Se(r,["tfdt"]).forEach(function(h){var g=h[0],p=a*f;if(p){var E=de(h,4);if(g===0)E-=p,E=Math.max(E,0),Ki(h,4,E);else{E*=Math.pow(2,32),E+=de(h,8),E-=p,E=Math.max(E,0);var x=Math.floor(E/(zr+1)),b=Math.floor(E%(zr+1));Ki(h,4,x),Ki(h,8,b)}}})}})})}function Kl(o){var u={valid:null,remainder:null},a=Se(o,["moof"]);if(a.length<2)return u.remainder=o,u;var r=a[a.length-1];return u.valid=o.slice(0,r.byteOffset-8),u.remainder=o.slice(r.byteOffset-8),u}function kt(o,u){var a=new Uint8Array(o.length+u.length);return a.set(o),a.set(u,o.length),a}function Ta(o,u){var a=[],r=u.samples,t=u.timescale,i=u.id,l=!1,f=Se(r,["moof"]);return f.map(function(h){var g=h.byteOffset-8,p=Se(h,["traf"]);p.map(function(E){var x=Se(E,["tfdt"]).map(function(b){var _=b[0],L=de(b,4);return _===1&&(L*=Math.pow(2,32),L+=de(b,8)),L/t})[0];return x!==void 0&&(o=x),Se(E,["tfhd"]).map(function(b){var _=de(b,4),L=de(b,0)&16777215,k=(L&1)!==0,I=(L&2)!==0,w=(L&8)!==0,O=0,D=(L&16)!==0,M=0,G=(L&32)!==0,N=8;_===i&&(k&&(N+=8),I&&(N+=4),w&&(O=de(b,N),N+=4),D&&(M=de(b,N),N+=4),G&&(N+=4),u.type==="video"&&(l=ji(u.codec)),Se(E,["trun"]).map(function(H){var X=H[0],Y=de(H,0)&16777215,V=(Y&1)!==0,j=0,Q=(Y&4)!==0,se=(Y&256)!==0,re=0,Z=(Y&512)!==0,oe=0,le=(Y&1024)!==0,ue=(Y&2048)!==0,fe=0,Be=de(H,4),Ie=8;V&&(j=de(H,Ie),Ie+=4),Q&&(Ie+=4);for(var Ue=j+g,ke=0;ke<Be;ke++){if(se?(re=de(H,Ie),Ie+=4):re=O,Z?(oe=de(H,Ie),Ie+=4):oe=M,le&&(Ie+=4),ue&&(X===0?fe=de(H,Ie):fe=ya(H,Ie),Ie+=4),u.type===Ye.VIDEO)for(var Qe=0;Qe<oe;){var He=de(r,Ue);if(Ue+=4,Wl(l,r[Ue])){var qe=r.subarray(Ue,Ue+He);Sa(qe,l?2:1,o+fe/t,a)}Ue+=He,Qe+=He+4}o+=re/t}}))})})}),a}function ji(o){if(!o)return!1;var u=o.substring(0,4);return u==="hvc1"||u==="hev1"||u==="dvh1"||u==="dvhe"}function Wl(o,u){if(o){var a=u>>1&63;return a===39||a===40}else{var r=u&31;return r===6}}function Sa(o,u,a,r){var t=xa(o),i=0;i+=u;for(var l=0,f=0,h=0;i<t.length;){l=0;do{if(i>=t.length)break;h=t[i++],l+=h}while(h===255);f=0;do{if(i>=t.length)break;h=t[i++],f+=h}while(h===255);var g=t.length-i,p=i;if(f<g)i+=f;else if(f>g){Oe.error("Malformed SEI payload. "+f+" is too small, only "+g+" bytes left to parse.");break}if(l===4){var E=t[p++];if(E===181){var x=pa(t,p);if(p+=2,x===49){var b=de(t,p);if(p+=4,b===1195456820){var _=t[p++];if(_===3){var L=t[p++],k=31&L,I=64&L,w=I?2+k*3:0,O=new Uint8Array(w);if(I){O[0]=L;for(var D=1;D<w;D++)O[D]=t[p++]}r.push({type:_,payloadType:l,pts:a,bytes:O})}}}}}else if(l===5&&f>16){for(var M=[],G=0;G<16;G++){var N=t[p++].toString(16);M.push(N.length==1?"0"+N:N),(G===3||G===5||G===7||G===9)&&M.push("-")}for(var H=f-16,X=new Uint8Array(H),Y=0;Y<H;Y++)X[Y]=t[p++];r.push({payloadType:l,pts:a,uuid:M.join(""),userData:At(X),userDataBytes:X})}}}function xa(o){for(var u=o.byteLength,a=[],r=1;r<u-2;)o[r]===0&&o[r+1]===0&&o[r+2]===3?(a.push(r+2),r+=2):r++;if(a.length===0)return o;var t=u-a.length,i=new Uint8Array(t),l=0;for(r=0;r<t;l++,r++)l===a[0]&&(l++,a.shift()),i[r]=o[l];return i}function jl(o){var u=o[0],a="",r="",t=0,i=0,l=0,f=0,h=0,g=0;if(u===0){for(;tt(o.subarray(g,g+1))!=="\0";)a+=tt(o.subarray(g,g+1)),g+=1;for(a+=tt(o.subarray(g,g+1)),g+=1;tt(o.subarray(g,g+1))!=="\0";)r+=tt(o.subarray(g,g+1)),g+=1;r+=tt(o.subarray(g,g+1)),g+=1,t=de(o,12),i=de(o,16),f=de(o,20),h=de(o,24),g=28}else if(u===1){g+=4,t=de(o,g),g+=4;var p=de(o,g);g+=4;var E=de(o,g);for(g+=4,l=Math.pow(2,32)*p+E,bl(l)||(l=Number.MAX_SAFE_INTEGER,Oe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),f=de(o,g),g+=4,h=de(o,g),g+=4;tt(o.subarray(g,g+1))!=="\0";)a+=tt(o.subarray(g,g+1)),g+=1;for(a+=tt(o.subarray(g,g+1)),g+=1;tt(o.subarray(g,g+1))!=="\0";)r+=tt(o.subarray(g,g+1)),g+=1;r+=tt(o.subarray(g,g+1)),g+=1}var x=o.subarray(g,o.byteLength);return{schemeIdUri:a,value:r,timeScale:t,presentationTime:l,presentationTimeDelta:i,eventDuration:f,id:h,payload:x}}function Zt(o){if(o===void 0&&(o=!0),!(typeof self>"u")){var u=(o||!self.MediaSource)&&self.ManagedMediaSource;return u||self.MediaSource||self.WebKitMediaSource}}function Yl(o){return typeof self<"u"&&o===self.ManagedMediaSource}function zl(o,u){var a=Object.keys(o),r=Object.keys(u),t=a.length,i=r.length;return!t||!i||t===i&&!a.some(function(l){return r.indexOf(l)===-1})}var _a=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},pr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ba(o,u){var a=pr[u];return!!a&&!!a[o.slice(0,4)]}function Yi(o,u,a){return a===void 0&&(a=!0),!o.split(",").some(function(r){return!La(r,u,a)})}function La(o,u,a){var r;a===void 0&&(a=!0);var t=Zt(a);return(r=t?.isTypeSupported(wr(o,u)))!=null?r:!1}function wr(o,u){return u+"/mp4;codecs="+o}function Ca(o){if(o){var u=o.substring(0,4);return pr.video[u]}return 2}function Xr(o){var u=_a();return o.split(",").reduce(function(a,r){var t=u&&ji(r),i=t?9:pr.video[r];return i?(i*2+a)/(a?3:2):(pr.audio[r]+a)/(a?2:1)},0)}var zi={};function $l(o,u){if(u===void 0&&(u=!0),zi[o])return zi[o];for(var a={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[o],r=0;r<a.length;r++){var t;if(La(a[r],"audio",u))return zi[o]=a[r],a[r];if(a[r]==="mp3"&&(t=Zt(u))!=null&&t.isTypeSupported("audio/mpeg"))return""}return o}var ql=/flac|opus|mp4a\.40\.34/i;function Qr(o,u){return u===void 0&&(u=!0),o.replace(ql,function(a){return $l(a.toLowerCase(),u)})}function Xl(o,u){var a=[];if(o)for(var r=o.split(","),t=0;t<r.length;t++)ba(r[t],"video")||a.push(r[t]);return u&&a.push(u),a.join(",")}function Zr(o,u){if(o&&(o.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(o)!==-1))return o;if(u){var a=u.split(",");if(a.length>1){if(o){for(var r=a.length;r--;)if(a[r].substring(0,4)===o.substring(0,4))return a[r]}return a[0]}}return u||o}function Ql(o){for(var u=o.split(","),a=0;a<u.length;a++){var r=u[a].split(".");if(r.length>2){var t=r.shift()+".";t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).slice(-4),u[a]=t}}return u.join(",")}function Zl(o){if(o.startsWith("av01.")){for(var u=o.split("."),a=["0","111","01","01","01","0"],r=u.length;r>4&&r<10;r++)u[r]=a[r-4];return u.join(".")}return o}function Aa(o){var u=Zt(o)||{isTypeSupported:function(){return!1}};return{mpeg:u.isTypeSupported("audio/mpeg"),mp3:u.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:!1}}function ka(o){return o.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var $i=["NONE","TYPE-0","TYPE-1",null];function Jl(o){return $i.indexOf(o)>-1}var Jr=["SDR","PQ","HLG"];function eu(o){return!!o&&Jr.indexOf(o)>-1}var ei={No:"",Yes:"YES",v2:"v2"};function Ra(o){var u=o.canSkipUntil,a=o.canSkipDateRanges,r=o.age,t=r<u/2;return u&&t?a?ei.v2:ei.Yes:ei.No}var Ia=function(){function o(a,r,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=r,this.skip=t}var u=o.prototype;return u.addDirectives=function(r){var t=new self.URL(r);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},o}(),Pa=function(){function o(a){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[a.url],this._attrs=[a.attrs],this.bitrate=a.bitrate,a.details&&(this.details=a.details),this.id=a.id||0,this.name=a.name,this.width=a.width||0,this.height=a.height||0,this.frameRate=a.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=a.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=a.audioCodec,this.videoCodec=a.videoCodec,this.codecSet=[a.videoCodec,a.audioCodec].filter(function(i){return!!i}).map(function(i){return i.substring(0,4)}).join(","),"supplemental"in a){var r;this.supplemental=a.supplemental;var t=(r=a.supplemental)==null?void 0:r.videoCodec;t&&t!==a.videoCodec&&(this.codecSet+=","+t.substring(0,4))}this.addGroupId("audio",a.attrs.AUDIO),this.addGroupId("text",a.attrs.SUBTITLES)}var u=o.prototype;return u.hasAudioGroup=function(r){return wa(this._audioGroups,r)},u.hasSubtitleGroup=function(r){return wa(this._subtitleGroups,r)},u.addGroupId=function(r,t){if(t){if(r==="audio"){var i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(r==="text"){var l=this._subtitleGroups;l||(l=this._subtitleGroups=[]),l.indexOf(t)===-1&&l.push(t)}}},u.addFallback=function(){},c(o,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(r){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var r;return(r=this.audioGroups)==null?void 0:r[0]}},{key:"textGroupId",get:function(){var r;return(r=this.subtitleGroups)==null?void 0:r[0]}}])}();function wa(o,u){return!u||!o?!1:o.indexOf(u)!==-1}function tu(){if(typeof matchMedia=="function"){var o=matchMedia("(dynamic-range: high)"),u=matchMedia("bad query");if(o.media!==u.media)return o.matches===!0}return!1}function ru(o,u){var a=!1,r=[];if(o&&(a=o!=="SDR",r=[o]),u){r=u.allowedVideoRanges||Jr.slice(0);var t=r.join("")!=="SDR"&&!u.videoCodec;a=u.preferHDR!==void 0?u.preferHDR:t&&tu(),a||(r=["SDR"])}return{preferHDR:a,allowedVideoRanges:r}}var iu=function(u){var a=new WeakSet;return function(r,t){if(u&&(t=u(r,t)),typeof t=="object"&&t!==null){if(a.has(t))return;a.add(t)}return t}},ct=function(u,a){return JSON.stringify(u,iu(a))};function nu(o,u,a,r,t){for(var i=Object.keys(o),l=r?.channels,f=r?.audioCodec,h=t?.videoCodec,g=l&&parseInt(l)===2,p=!1,E=!1,x=1/0,b=1/0,_=1/0,L=1/0,k=0,I=[],w=ru(u,t),O=w.preferHDR,D=w.allowedVideoRanges,M=function(){var j=o[i[G]];p||(p=j.channels[2]>0),x=Math.min(x,j.minHeight),b=Math.min(b,j.minFramerate),_=Math.min(_,j.minBitrate);var Q=D.filter(function(se){return j.videoRanges[se]>0});Q.length>0&&(E=!0)},G=i.length;G--;)M();x=ae(x)?x:0,b=ae(b)?b:0;var N=Math.max(1080,x),H=Math.max(30,b);_=ae(_)?_:a,a=Math.max(_,a),E||(u=void 0);var X=i.length>1,Y=i.reduce(function(V,j){var Q=o[j];if(j===V)return V;if(I=E?D.filter(function(se){return Q.videoRanges[se]>0}):[],X){if(Q.minBitrate>a)return Nt(j,"min bitrate of "+Q.minBitrate+" > current estimate of "+a),V;if(!Q.hasDefaultAudio)return Nt(j,"no renditions with default or auto-select sound found"),V;if(f&&j.indexOf(f.substring(0,4))%5!==0)return Nt(j,'audio codec preference "'+f+'" not found'),V;if(l&&!g){if(!Q.channels[l])return Nt(j,"no renditions with "+l+" channel sound found (channels options: "+Object.keys(Q.channels)+")"),V}else if((!f||g)&&p&&Q.channels[2]===0)return Nt(j,"no renditions with stereo sound found"),V;if(Q.minHeight>N)return Nt(j,"min resolution of "+Q.minHeight+" > maximum of "+N),V;if(Q.minFramerate>H)return Nt(j,"min framerate of "+Q.minFramerate+" > maximum of "+H),V;if(!I.some(function(se){return Q.videoRanges[se]>0}))return Nt(j,"no variants with VIDEO-RANGE of "+ct(I)+" found"),V;if(h&&j.indexOf(h.substring(0,4))%5!==0)return Nt(j,'video codec preference "'+h+'" not found'),V;if(Q.maxScore<k)return Nt(j,"max score of "+Q.maxScore+" < selected max of "+k),V}return V&&(Xr(j)>=Xr(V)||Q.fragmentError>o[V].fragmentError)?V:(L=Q.minIndex,k=Q.maxScore,j)},void 0);return{codecSet:Y,videoRanges:I,preferHDR:O,minFramerate:b,minBitrate:_,minIndex:L}}function Nt(o,u){Oe.log('[abr] start candidates with "'+o+'" ignored because '+u)}function Da(o){return o.reduce(function(u,a){var r=u.groups[a.groupId];r||(r=u.groups[a.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(a);var t=a.channels||"2";return r.channels[t]=(r.channels[t]||0)+1,r.hasDefault=r.hasDefault||a.default,r.hasAutoSelect=r.hasAutoSelect||a.autoselect,r.hasDefault&&(u.hasDefaultAudio=!0),r.hasAutoSelect&&(u.hasAutoSelectAudio=!0),u},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function au(o,u,a,r){return o.slice(a,r+1).reduce(function(t,i,l){if(!i.codecSet)return t;var f=i.audioGroups,h=t[i.codecSet];h||(t[i.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!f,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,i.bitrate);var g=Math.min(i.height,i.width);return h.minHeight=Math.min(h.minHeight,g),h.minFramerate=Math.min(h.minFramerate,i.frameRate),h.minIndex=Math.min(h.minIndex,l),h.maxScore=Math.max(h.maxScore,i.score),h.fragmentError+=i.fragmentError,h.videoRanges[i.videoRange]=(h.videoRanges[i.videoRange]||0)+1,t},{})}function Oa(o,u){var a;return!!o&&o!==((a=u.loadLevelObj)==null?void 0:a.uri)}var su=function(o){function u(r){var t;return t=o.call(this,"abr",r.logger)||this,t.hls=void 0,t.lastLevelLoadSec=0,t.lastLoadedFragLevel=-1,t.firstSelection=-1,t._nextAutoLevel=-1,t.nextAutoLevelKey="",t.audioTracksByGroup=null,t.codecTiers=null,t.timer=-1,t.fragCurrent=null,t.partCurrent=null,t.bitrateTestDelay=0,t.rebufferNotice=-1,t.bwEstimator=void 0,t._abandonRulesCheck=function(i){var l,f=t,h=f.fragCurrent,g=f.partCurrent,p=f.hls,E=p.autoLevelEnabled,x=p.media;if(!(!h||!x)){var b=performance.now(),_=g?g.stats:h.stats,L=g?g.duration:h.duration,k=b-_.loading.start,I=p.minAutoLevel,w=h.level,O=t._nextAutoLevel;if(_.aborted||_.loaded&&_.loaded===_.total||w<=I){t.clearTimer(),t._nextAutoLevel=-1;return}if(E){var D=O>-1&&O!==w,M=!!i||D;if(!(!M&&(x.paused||!x.playbackRate||!x.readyState))){var G=p.mainForwardBufferInfo;if(!(!M&&G===null)){var N=t.bwEstimator.getEstimateTTFB(),H=Math.abs(x.playbackRate);if(!(k<=Math.max(N,1e3*(L/(H*2))))){var X=G?G.len/H:0,Y=_.loading.first?_.loading.first-_.loading.start:-1,V=_.loaded&&Y>-1,j=t.getBwEstimate(),Q=p.levels,se=Q[w],re=Math.max(_.loaded,Math.round(L*(h.bitrate||se.averageBitrate)/8)),Z=V?k-Y:k;Z<1&&V&&(Z=Math.min(k,_.loaded*8/j));var oe=V?_.loaded*1e3/Z:0,le=N/1e3,ue=oe?(re-_.loaded)/oe:re*8/j+le;if(!(ue<=X)){var fe=oe?oe*8:j,Be=((l=i?.details||t.hls.latestLevelDetails)==null?void 0:l.live)===!0,Ie=t.hls.config.abrBandWidthUpFactor,Ue=Number.POSITIVE_INFINITY,ke;for(ke=w-1;ke>I;ke--){var Qe=Q[ke].maxBitrate,He=!Q[ke].details||Be;if(Ue=t.getTimeToLoadFrag(le,fe,L*Qe,He),Ue<Math.min(X,L+le))break}if(!(Ue>=ue)&&!(Ue>L*10)){V?t.bwEstimator.sample(k-Math.min(N,Y),_.loaded):t.bwEstimator.sampleTTFB(k);var qe=Q[ke].maxBitrate;t.getBwEstimate()*Ie>qe&&t.resetEstimator(qe);var gt=t.findBestLevel(qe,I,ke,0,X,1,1);gt>-1&&(ke=gt),t.warn("Fragment "+h.sn+(g?" part "+g.index:"")+" of level "+w+` is loading too slowly;
      Fragment duration: `+h.duration.toFixed(3)+`
      Time to underbuffer: `+X.toFixed(3)+` s
      Estimated load time for current fragment: `+ue.toFixed(3)+` s
      Estimated load time for down switch fragment: `+Ue.toFixed(3)+` s
      TTFB estimate: `+(Y|0)+` ms
      Current BW estimate: `+(ae(j)?j|0:"Unknown")+` bps
      New BW estimate: `+(t.getBwEstimate()|0)+` bps
      Switching to level `+ke+" @ "+(qe|0)+" bps"),p.nextLoadLevel=p.nextAutoLevel=ke,t.clearTimer();var it=function(){if(t.clearTimer(),t.fragCurrent===h&&t.hls.loadLevel===ke&&ke>0){var pt=t.getStarvationDelay();if(t.warn("Aborting inflight request "+(ke>0?"and switching down":"")+`
      Fragment duration: `+h.duration.toFixed(3)+` s
      Time to underbuffer: `+pt.toFixed(3)+" s"),h.abortRequests(),t.fragCurrent=t.partCurrent=null,ke>I){var Je=t.findBestLevel(t.hls.levels[I].bitrate,I,ke,0,pt,1,1);Je===-1&&(Je=I),t.hls.nextLoadLevel=t.hls.nextAutoLevel=Je,t.resetEstimator(t.hls.levels[Je].bitrate)}}};D||ue>Ue*2?it():t.timer=self.setInterval(it,Ue*1e3),p.trigger(P.FRAG_LOAD_EMERGENCY_ABORTED,{frag:h,part:g,stats:_})}}}}}}}},t.hls=r,t.bwEstimator=t.initEstimator(),t.registerListeners(),t}C(u,o);var a=u.prototype;return a.resetEstimator=function(t){t&&(this.log("setting initial bwe to "+t),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},a.initEstimator=function(){var t=this.hls.config;return new Cl(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)},a.registerListeners=function(){var t=this.hls;t.on(P.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.FRAG_LOADING,this.onFragLoading,this),t.on(P.FRAG_LOADED,this.onFragLoaded,this),t.on(P.FRAG_BUFFERED,this.onFragBuffered,this),t.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(P.LEVEL_LOADED,this.onLevelLoaded,this),t.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(P.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(P.ERROR,this.onError,this)},a.unregisterListeners=function(){var t=this.hls;t&&(t.off(P.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.FRAG_LOADING,this.onFragLoading,this),t.off(P.FRAG_LOADED,this.onFragLoaded,this),t.off(P.FRAG_BUFFERED,this.onFragBuffered,this),t.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(P.LEVEL_LOADED,this.onLevelLoaded,this),t.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(P.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(P.ERROR,this.onError,this))},a.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},a.onManifestLoading=function(t,i){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},a.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},a.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},a.onFragLoading=function(t,i){var l=i.frag;if(!this.ignoreFragment(l)){if(!l.bitrateTest){var f;this.fragCurrent=l,this.partCurrent=(f=i.part)!=null?f:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},a.onLevelSwitching=function(t,i){this.clearTimer()},a.onError=function(t,i){if(!i.fatal)switch(i.details){case $.BUFFER_ADD_CODEC_ERROR:case $.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case $.FRAG_LOAD_TIMEOUT:{var l=i.frag,f=this.fragCurrent,h=this.partCurrent;if(l&&f&&l.sn===f.sn&&l.level===f.level){var g=performance.now(),p=h?h.stats:l.stats,E=g-p.loading.start,x=p.loading.first?p.loading.first-p.loading.start:-1,b=p.loaded&&x>-1;if(b){var _=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(E-Math.min(_,x),p.loaded)}else this.bwEstimator.sampleTTFB(E)}break}}},a.getTimeToLoadFrag=function(t,i,l,f){var h=t+l/i,g=f?t+this.lastLevelLoadSec:0;return h+g},a.onLevelLoaded=function(t,i){var l=this.hls.config,f=i.stats.loading,h=f.end-f.first;ae(h)&&(this.lastLevelLoadSec=h/1e3),i.details.live?this.bwEstimator.update(l.abrEwmaSlowLive,l.abrEwmaFastLive):this.bwEstimator.update(l.abrEwmaSlowVoD,l.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(i.levelInfo)},a.onFragLoaded=function(t,i){var l=i.frag,f=i.part,h=f?f.stats:l.stats;if(l.type===Ce.MAIN&&this.bwEstimator.sampleTTFB(h.loading.first-h.loading.start),!this.ignoreFragment(l)){if(this.clearTimer(),l.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var g=f?f.duration:l.duration,p=this.hls.levels[l.level],E=(p.loaded?p.loaded.bytes:0)+h.loaded,x=(p.loaded?p.loaded.duration:0)+g;p.loaded={bytes:E,duration:x},p.realBitrate=Math.round(8*E/x)}if(l.bitrateTest){var b={stats:h,frag:l,part:f,id:l.type};this.onFragBuffered(P.FRAG_BUFFERED,b),l.bitrateTest=!1}else this.lastLoadedFragLevel=l.level}},a.onFragBuffered=function(t,i){var l=i.frag,f=i.part,h=f!=null&&f.stats.loaded?f.stats:l.stats;if(!h.aborted&&!this.ignoreFragment(l)){var g=h.parsing.end-h.loading.start-Math.min(h.loading.first-h.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(g,h.loaded),h.bwEstimate=this.getBwEstimate(),l.bitrateTest?this.bitrateTestDelay=g/1e3:this.bitrateTestDelay=0}},a.ignoreFragment=function(t){return t.type!==Ce.MAIN||t.sn==="initSegment"},a.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},a.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},a.getNextABRAutoLevel=function(){var t=this.fragCurrent,i=this.partCurrent,l=this.hls;if(l.levels.length<=1)return l.loadLevel;var f=l.maxAutoLevel,h=l.config,g=l.minAutoLevel,p=i?i.duration:t?t.duration:0,E=this.getBwEstimate(),x=this.getStarvationDelay(),b=h.abrBandWidthFactor,_=h.abrBandWidthUpFactor;if(x){var L=this.findBestLevel(E,g,f,x,0,b,_);if(L>=0)return this.rebufferNotice=-1,L}var k=p?Math.min(p,h.maxStarvationDelay):h.maxStarvationDelay;if(!x){var I=this.bitrateTestDelay;if(I){var w=p?Math.min(p,h.maxLoadingDelay):h.maxLoadingDelay;k=w-I,this.info("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*k)+" ms"),b=_=1}}var O=this.findBestLevel(E,g,f,x,k,b,_);if(this.rebufferNotice!==O&&(this.rebufferNotice=O,this.info((x?"rebuffering expected":"buffer is empty")+", optimal quality level "+O)),O>-1)return O;var D=l.levels[g],M=l.loadLevelObj;return M&&D?.bitrate<M.bitrate?g:l.loadLevel},a.getStarvationDelay=function(){var t=this.hls,i=t.media;if(!i)return 1/0;var l=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,f=t.mainForwardBufferInfo;return(f?f.len:0)/l},a.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},a.findBestLevel=function(t,i,l,f,h,g,p){var E,x=this,b=f+h,_=this.lastLoadedFragLevel,L=_===-1?this.hls.firstLevel:_,k=this.fragCurrent,I=this.partCurrent,w=this.hls,O=w.levels,D=w.allAudioTracks,M=w.loadLevel,G=w.config;if(O.length===1)return 0;var N=O[L],H=!!((E=this.hls.latestLevelDetails)!=null&&E.live),X=M===-1||_===-1,Y,V="SDR",j=N?.frameRate||0,Q=G.audioPreference,se=G.videoPreference,re=this.audioTracksByGroup||(this.audioTracksByGroup=Da(D)),Z=-1;if(X){if(this.firstSelection!==-1)return this.firstSelection;var oe=this.codecTiers||(this.codecTiers=au(O,re,i,l)),le=nu(oe,V,t,Q,se),ue=le.codecSet,fe=le.videoRanges,Be=le.minFramerate,Ie=le.minBitrate,Ue=le.minIndex,ke=le.preferHDR;Z=Ue,Y=ue,V=ke?fe[fe.length-1]:fe[0],j=Be,t=Math.max(t,Ie),this.log("picked start tier "+ct(le))}else Y=N?.codecSet,V=N?.videoRange;for(var Qe=I?I.duration:k?k.duration:0,He=this.bwEstimator.getEstimateTTFB()/1e3,qe=[],gt=function(){var Je,ze=O[Ge],mt=Ge>L;if(!ze)return 0;if((Y&&ze.codecSet!==Y||V&&ze.videoRange!==V||mt&&j>ze.frameRate||!mt&&j>0&&j<ze.frameRate||ze.supportedResult&&!((Je=ze.supportedResult.decodingInfoResults)!=null&&Je[0].smooth))&&(!X||Ge!==Z))return qe.push(Ge),0;var ot=ze.details,xt=(I?ot?.partTarget:ot?.averagetargetduration)||Qe,We;mt?We=p*t:We=g*t;var lt=Qe&&f>=Qe*2&&h===0?ze.averageBitrate:ze.maxBitrate,et=x.getTimeToLoadFrag(He,We,lt*xt,ot===void 0),yt=We>=lt&&(Ge===_||ze.loadError===0&&ze.fragmentError===0)&&(et<=He||!ae(et)||H&&!x.bitrateTestDelay||et<b);if(yt){var Ur=x.forcedAutoLevel;return Ge!==M&&(Ur===-1||Ur!==M)&&(qe.length&&x.trace("Skipped level(s) "+qe.join(",")+" of "+l+' max with CODECS and VIDEO-RANGE:"'+O[qe[0]].codecs+'" '+O[qe[0]].videoRange+'; not compatible with "'+Y+'" '+V),x.info("switch candidate:"+L+"->"+Ge+" adjustedbw("+Math.round(We)+")-bitrate="+Math.round(We-lt)+" ttfb:"+He.toFixed(1)+" avgDuration:"+xt.toFixed(1)+" maxFetchDuration:"+b.toFixed(1)+" fetchDuration:"+et.toFixed(1)+" firstSelection:"+X+" codecSet:"+ze.codecSet+" videoRange:"+ze.videoRange+" hls.loadLevel:"+M)),X&&(x.firstSelection=Ge),{v:Ge}}},it,Ge=l;Ge>=i;Ge--)if(it=gt(),it!==0&&it)return it.v;return-1},a.deriveNextAutoLevel=function(t){var i=this.hls,l=i.maxAutoLevel,f=i.minAutoLevel;return Math.min(Math.max(t,f),l)},c(u,[{key:"firstAutoLevel",get:function(){var t=this.hls,i=t.maxAutoLevel,l=t.minAutoLevel,f=this.getBwEstimate(),h=this.hls.config.maxStarvationDelay,g=this.findBestLevel(f,l,i,0,h,1,1);if(g>-1)return g;var p=this.hls.firstLevel,E=Math.min(Math.max(p,l),i);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+p+" clamped to "+E),E}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var t=this.forcedAutoLevel,i=this.bwEstimator,l=i.canEstimate(),f=this.lastLoadedFragLevel>-1;if(t!==-1&&(!l||!f||this.nextAutoLevelKey===this.getAutoLevelKey()))return t;var h=l&&f?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){var g=this.hls.levels;if(g.length>Math.max(t,h)&&g[t].loadError<=g[h].loadError)return t}return this._nextAutoLevel=h,this.nextAutoLevelKey=this.getAutoLevelKey(),h},set:function(t){var i=this.deriveNextAutoLevel(t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}}])}(gr),ou=function(){function o(a){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=a}var u=o.prototype;return u.destroy=function(){this.tracks=this.queues=null},u.append=function(r,t,i){if(!(this.queues===null||this.tracks===null)){var l=this.queues[t];l.push(r),l.length===1&&!i&&this.executeNext(t)}},u.appendBlocker=function(r){var t=this;return new Promise(function(i){var l={label:"async-blocker",execute:i,onStart:function(){},onComplete:function(){},onError:function(){}};t.append(l,r)})},u.prependBlocker=function(r){var t=this;return new Promise(function(i){if(t.queues){var l={label:"async-blocker-prepend",execute:i,onStart:function(){},onComplete:function(){},onError:function(){}};t.queues[r].unshift(l)}})},u.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(r){var t,i=(t=r[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(r[0].execute(),r.splice(0,1))})},u.unblockAudio=function(r){if(this.queues!==null){var t=this.queues.audio;t[0]===r&&this.shiftAndExecuteNext("audio")}},u.executeNext=function(r){if(!(this.queues===null||this.tracks===null)){var t=this.queues[r];if(t.length){var i=t[0];try{i.execute()}catch(h){var l;if(i.onError(h),this.queues===null||this.tracks===null)return;var f=(l=this.tracks[r])==null?void 0:l.buffer;f!=null&&f.updating||this.shiftAndExecuteNext(r)}}}},u.shiftAndExecuteNext=function(r){this.queues!==null&&(this.queues[r].shift(),this.executeNext(r))},u.current=function(r){var t;return((t=this.queues)==null?void 0:t[r][0])||null},u.toString=function(){var r=this.queues,t=this.tracks;return r===null||t===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},u.list=function(r){var t,i;return(t=this.queues)!=null&&t[r]||(i=this.tracks)!=null&&i[r]?r+": ("+this.listSbInfo(r)+") "+this.listOps(r):""},u.listSbInfo=function(r){var t,i=(t=this.tracks)==null?void 0:t[r],l=i?.buffer;return l?"SourceBuffer"+(l.updating?" updating":"")+(i.ended?" ended":"")+(i.ending?" ending":""):"none"},u.listOps=function(r){var t;return((t=this.queues)==null?void 0:t[r].map(function(i){return i.label}).join(", "))||""},o}(),Ma={search:function(u,a){for(var r=0,t=u.length-1,i=null,l=null;r<=t;){i=(r+t)/2|0,l=u[i];var f=a(l);if(f>0)r=i+1;else if(f<0)t=i-1;else return l}return null}};function lu(o,u,a){if(u===null||!Array.isArray(o)||!o.length||!ae(u))return null;var r=o[0].programDateTime;if(u<(r||0))return null;var t=o[o.length-1].endProgramDateTime;if(u>=(t||0))return null;a=a||0;for(var i=0;i<o.length;++i){var l=o[i];if(fu(u,a,l))return l}return null}function qi(o,u,a,r,t){a===void 0&&(a=0),r===void 0&&(r=0),t===void 0&&(t=.005);var i=null;if(o){i=u[1+o.sn-u[0].sn]||null;var l=o.endDTS-a;l>0&&l<15e-7&&(a+=15e-7),i&&o.level!==i.level&&i.end<=o.end&&(i=u[2+o.sn-u[0].sn]||null)}else a===0&&u[0].start===0&&(i=u[0]);if(i&&((!o||o.level===i.level)&&Fa(a,r,i)===0||uu(i,o,Math.min(t,r))))return i;var f=Ma.search(u,Fa.bind(null,a,r));return f&&(f!==o||!i)?f:i}function uu(o,u,a){if(u&&u.start===0&&u.level<o.level&&(u.endPTS||0)>0){var r=u.tagList.reduce(function(t,i){return i[0]==="INF"&&(t+=parseFloat(i[1])),t},a);return o.start<=r}return!1}function Fa(o,u,a){if(o===void 0&&(o=0),u===void 0&&(u=0),a.start<=o&&a.start+a.duration>o)return 0;var r=Math.min(u,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.start+a.duration-r<=o?1:a.start-r>o&&a.start?-1:0}function fu(o,u,a){var r=Math.min(u,a.duration+(a.deltaPTS?a.deltaPTS:0))*1e3,t=a.endProgramDateTime||0;return t-r>o}function cu(o,u){return Ma.search(o,function(a){return a.cc<u?1:a.cc>u?-1:0})}function ti(o){switch(o.details){case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_TIMEOUT:case $.LEVEL_LOAD_TIMEOUT:case $.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Na(o,u){var a=ti(u);return o.default[(a?"timeout":"error")+"Retry"]}function Xi(o,u){var a=o.backoff==="linear"?1:Math.pow(2,u);return Math.min(a*o.retryDelayMs,o.maxRetryDelayMs)}function Ba(o){return U(U({},o),{errorRetry:null,timeoutRetry:null})}function ri(o,u,a,r){if(!o)return!1;var t=r?.code,i=u<o.maxNumRetry&&(hu(t)||!!a);return o.shouldRetry?o.shouldRetry(o,u,a,r,i):i}function hu(o){return o===0&&navigator.onLine===!1||!!o&&(o<400||o>499)}var st={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Rt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2},du=function(o){function u(r){var t;return t=o.call(this,"error-controller",r.logger)||this,t.hls=void 0,t.playlistError=0,t.penalizedRenditions={},t.hls=r,t.registerListeners(),t}C(u,o);var a=u.prototype;return a.registerListeners=function(){var t=this.hls;t.on(P.ERROR,this.onError,this),t.on(P.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.LEVEL_UPDATED,this.onLevelUpdated,this)},a.unregisterListeners=function(){var t=this.hls;t&&(t.off(P.ERROR,this.onError,this),t.off(P.ERROR,this.onErrorOut,this),t.off(P.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.LEVEL_UPDATED,this.onLevelUpdated,this))},a.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},a.startLoad=function(t){},a.stopLoad=function(){this.playlistError=0},a.getVariantLevelIndex=function(t){return t?.type===Ce.MAIN?t.level:this.hls.loadLevel},a.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},a.onLevelUpdated=function(){this.playlistError=0},a.onError=function(t,i){var l;if(!i.fatal){var f=this.hls,h=i.context;switch(i.details){case $.FRAG_LOAD_ERROR:case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_ERROR:case $.KEY_LOAD_TIMEOUT:i.errorAction=this.getFragRetryOrSwitchAction(i);return;case $.FRAG_PARSING_ERROR:if((l=i.frag)!=null&&l.gap){i.errorAction=ii();return}case $.FRAG_GAP:case $.FRAG_DECRYPT_ERROR:{i.errorAction=this.getFragRetryOrSwitchAction(i),i.errorAction.action=st.SendAlternateToPenaltyBox;return}case $.LEVEL_EMPTY_ERROR:case $.LEVEL_PARSING_ERROR:{var g,p,E=i.parent===Ce.MAIN?i.level:f.loadLevel;i.details===$.LEVEL_EMPTY_ERROR&&((g=i.context)!=null&&(p=g.levelDetails)!=null&&p.live)?i.errorAction=this.getPlaylistRetryOrSwitchAction(i,E):(i.levelRetry=!1,i.errorAction=this.getLevelSwitchAction(i,E))}return;case $.LEVEL_LOAD_ERROR:case $.LEVEL_LOAD_TIMEOUT:typeof h?.level=="number"&&(i.errorAction=this.getPlaylistRetryOrSwitchAction(i,h.level));return;case $.AUDIO_TRACK_LOAD_ERROR:case $.AUDIO_TRACK_LOAD_TIMEOUT:case $.SUBTITLE_LOAD_ERROR:case $.SUBTITLE_TRACK_LOAD_TIMEOUT:if(h){var x=f.loadLevelObj;if(x&&(h.type===Pe.AUDIO_TRACK&&x.hasAudioGroup(h.groupId)||h.type===Pe.SUBTITLE_TRACK&&x.hasSubtitleGroup(h.groupId))){i.errorAction=this.getPlaylistRetryOrSwitchAction(i,f.loadLevel),i.errorAction.action=st.SendAlternateToPenaltyBox,i.errorAction.flags=Rt.MoveAllAlternatesMatchingHost;return}}return;case $.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var b=f.loadLevelObj,_=b?.attrs["HDCP-LEVEL"];_?i.errorAction={action:st.SendAlternateToPenaltyBox,flags:Rt.MoveAllAlternatesMatchingHDCP,hdcpLevel:_}:this.keySystemError(i)}return;case $.BUFFER_ADD_CODEC_ERROR:case $.REMUX_ALLOC_ERROR:case $.BUFFER_APPEND_ERROR:if(!i.errorAction){var L;i.errorAction=this.getLevelSwitchAction(i,(L=i.level)!=null?L:f.loadLevel)}return;case $.INTERNAL_EXCEPTION:case $.BUFFER_APPENDING_ERROR:case $.BUFFER_FULL_ERROR:case $.LEVEL_SWITCH_ERROR:case $.BUFFER_STALLED_ERROR:case $.BUFFER_SEEK_OVER_HOLE:case $.BUFFER_NUDGE_ON_STALL:i.errorAction=ii();return}i.type===be.KEY_SYSTEM_ERROR&&this.keySystemError(i)}},a.keySystemError=function(t){var i=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,i)},a.getPlaylistRetryOrSwitchAction=function(t,i){var l=this.hls,f=Na(l.config.playlistLoadPolicy,t),h=this.playlistError++,g=ri(f,h,ti(t),t.response);if(g)return{action:st.RetryRequest,flags:Rt.None,retryConfig:f,retryCount:h};var p=this.getLevelSwitchAction(t,i);return f&&(p.retryConfig=f,p.retryCount=h),p},a.getFragRetryOrSwitchAction=function(t){var i=this.hls,l=this.getVariantLevelIndex(t.frag),f=i.levels[l],h=i.config,g=h.fragLoadPolicy,p=h.keyLoadPolicy,E=Na(t.details.startsWith("key")?p:g,t),x=i.levels.reduce(function(L,k){return L+k.fragmentError},0);if(f){t.details!==$.FRAG_GAP&&f.fragmentError++;var b=ri(E,x,ti(t),t.response);if(b)return{action:st.RetryRequest,flags:Rt.None,retryConfig:E,retryCount:x}}var _=this.getLevelSwitchAction(t,l);return E&&(_.retryConfig=E,_.retryCount=x),_},a.getLevelSwitchAction=function(t,i){var l=this.hls;i==null&&(i=l.loadLevel);var f=this.hls.levels[i];if(f){var h,g,p=t.details;f.loadError++,p===$.BUFFER_APPEND_ERROR&&f.fragmentError++;var E=-1,x=l.levels,b=l.loadLevel,_=l.minAutoLevel,L=l.maxAutoLevel;l.autoLevelEnabled||(l.loadLevel=-1);for(var k=(h=t.frag)==null?void 0:h.type,I=k===Ce.AUDIO&&p===$.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(p===$.BUFFER_ADD_CODEC_ERROR||p===$.BUFFER_APPEND_ERROR),w=I&&x.some(function(V){var j=V.audioCodec;return f.audioCodec!==j}),O=t.sourceBufferName==="video"&&(p===$.BUFFER_ADD_CODEC_ERROR||p===$.BUFFER_APPEND_ERROR),D=O&&x.some(function(V){var j=V.codecSet,Q=V.audioCodec;return f.codecSet!==j&&f.audioCodec===Q}),M=(g=t.context)!=null?g:{},G=M.type,N=M.groupId,H=function(){var j=(Y+b)%x.length;if(j!==b&&j>=_&&j<=L&&x[j].loadError===0){var Q,se,re=x[j];if(p===$.FRAG_GAP&&k===Ce.MAIN&&t.frag){var Z=x[j].details;if(Z){var oe=qi(t.frag,Z.fragments,t.frag.start);if(oe!=null&&oe.gap)return 0}}else{if(G===Pe.AUDIO_TRACK&&re.hasAudioGroup(N)||G===Pe.SUBTITLE_TRACK&&re.hasSubtitleGroup(N))return 0;if(k===Ce.AUDIO&&(Q=f.audioGroups)!=null&&Q.some(function(le){return re.hasAudioGroup(le)})||k===Ce.SUBTITLE&&(se=f.subtitleGroups)!=null&&se.some(function(le){return re.hasSubtitleGroup(le)})||w&&f.audioCodec===re.audioCodec||!w&&f.audioCodec!==re.audioCodec||D&&f.codecSet===re.codecSet)return 0}return E=j,1}},X,Y=x.length;Y--&&(X=H(),!(X!==0&&X===1)););if(E>-1&&l.loadLevel!==E)return t.levelRetry=!0,this.playlistError=0,{action:st.SendAlternateToPenaltyBox,flags:Rt.None,nextAutoLevel:E}}return{action:st.SendAlternateToPenaltyBox,flags:Rt.MoveAllAlternatesMatchingHost}},a.onErrorOut=function(t,i){var l;switch((l=i.errorAction)==null?void 0:l.action){case st.DoNothing:break;case st.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(i),!i.errorAction.resolved&&i.details!==$.FRAG_GAP?i.fatal=!0:/MediaSource readyState: ended/.test(i.error.message)&&(this.warn('MediaSource ended after "'+i.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(i.fatal){this.hls.stopLoad();return}},a.sendAlternateToPenaltyBox=function(t){var i=this.hls,l=t.errorAction;if(l){var f=l.flags,h=l.hdcpLevel,g=l.nextAutoLevel;switch(f){case Rt.None:this.switchLevel(t,g);break;case Rt.MoveAllAlternatesMatchingHDCP:h&&(i.maxHdcpLevel=$i[$i.indexOf(h)-1],l.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+i.maxHdcpLevel+'" or lower');break}l.resolved||this.switchLevel(t,g)}},a.switchLevel=function(t,i){if(i!==void 0&&t.errorAction&&(this.warn("switching to level "+i+" after "+t.details),this.hls.nextAutoLevel=i,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===$.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo"))for(var l=ka(t.mimeType),f=this.hls.levels,h=f.length;h--;)f[h][t.sourceBufferName+"Codec"]===l&&this.hls.removeLevel(h)},u}(gr);function ii(o){var u={action:st.DoNothing,flags:Rt.None};return o&&(u.resolved=!0),u}var Ua={length:0,start:function(){return 0},end:function(){return 0}},Ne=function(){function o(){}return o.isBuffered=function(a,r){if(a){for(var t=o.getBuffered(a),i=t.length;i--;)if(r>=t.start(i)&&r<=t.end(i))return!0}return!1},o.bufferedRanges=function(a){if(a){var r=o.getBuffered(a);return o.timeRangesToArray(r)}return[]},o.timeRangesToArray=function(a){for(var r=[],t=0;t<a.length;t++)r.push({start:a.start(t),end:a.end(t)});return r},o.bufferInfo=function(a,r,t){if(a){var i=o.bufferedRanges(a);if(i.length)return o.bufferedInfo(i,r,t)}return{len:0,start:r,end:r,bufferedIndex:-1}},o.bufferedInfo=function(a,r,t){r=Math.max(0,r),a.length>1&&a.sort(function(I,w){return I.start-w.start||w.end-I.end});var i=-1,l=[];if(t)for(var f=0;f<a.length;f++){r>=a[f].start&&r<=a[f].end&&(i=f);var h=l.length;if(h){var g=l[h-1].end;a[f].start-g<t?a[f].end>g&&(l[h-1].end=a[f].end):l.push(a[f])}else l.push(a[f])}else l=a;for(var p=0,E,x=r,b=r,_=0;_<l.length;_++){var L=l[_].start,k=l[_].end;if(i===-1&&r>=L&&r<=k&&(i=_),r+t>=L&&r<k)x=L,b=k,p=b-r;else if(r+t<L){E=L;break}}return{len:p,start:x||0,end:b||0,nextStart:E,buffered:a,bufferedIndex:i}},o.getBuffered=function(a){try{return a.buffered||Ua}catch(r){return Oe.log("failed to get media.buffered",r),Ua}},o}(),Ha=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ga="HlsJsTrackRemovedError",vu=function(o){function u(a){var r;return r=o.call(this,a)||this,r.name=Ga,r}return C(u,o),u}(te(Error)),gu=function(o){function u(r,t){var i;return i=o.call(this,"buffer-controller",r.logger)||this,i.hls=void 0,i.fragmentTracker=void 0,i.details=null,i._objectUrl=null,i.operationQueue=null,i.bufferCodecEventsTotal=0,i.media=null,i.mediaSource=null,i.lastMpegAudioChunk=null,i.blockedAudioAppend=null,i.lastVideoAppendEnd=0,i.appendSource=void 0,i.transferData=void 0,i.overrides=void 0,i.appendErrors={audio:0,video:0,audiovideo:0},i.tracks={},i.sourceBuffers=[[null,null],[null,null]],i._onEndStreaming=function(l){var f;i.hls&&((f=i.mediaSource)==null?void 0:f.readyState)==="open"&&i.hls.pauseBuffering()},i._onStartStreaming=function(l){i.hls&&i.hls.resumeBuffering()},i._onMediaSourceOpen=function(l){var f=i,h=f.media,g=f.mediaSource;l&&i.log("Media source opened"),!(!h||!g)&&(g.removeEventListener("sourceopen",i._onMediaSourceOpen),h.removeEventListener("emptied",i._onMediaEmptied),i.updateDuration(),i.hls.trigger(P.MEDIA_ATTACHED,{media:h,mediaSource:g}),i.mediaSource!==null&&i.checkPendingTracks())},i._onMediaSourceClose=function(){i.log("Media source closed")},i._onMediaSourceEnded=function(){i.log("Media source ended")},i._onMediaEmptied=function(){var l=i,f=l.mediaSrc,h=l._objectUrl;f!==h&&i.error("Media element src was set while attaching MediaSource ("+h+" > "+f+")")},i.hls=r,i.fragmentTracker=t,i.appendSource=Yl(Zt(r.config.preferManagedMediaSource)),i.initTracks(),i.registerListeners(),i}C(u,o);var a=u.prototype;return a.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},a.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},a.registerListeners=function(){var t=this.hls;t.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(P.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.MANIFEST_PARSED,this.onManifestParsed,this),t.on(P.BUFFER_RESET,this.onBufferReset,this),t.on(P.BUFFER_APPENDING,this.onBufferAppending,this),t.on(P.BUFFER_CODECS,this.onBufferCodecs,this),t.on(P.BUFFER_EOS,this.onBufferEos,this),t.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(P.FRAG_PARSED,this.onFragParsed,this),t.on(P.FRAG_CHANGED,this.onFragChanged,this),t.on(P.ERROR,this.onError,this)},a.unregisterListeners=function(){var t=this.hls;t.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(P.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.MANIFEST_PARSED,this.onManifestParsed,this),t.off(P.BUFFER_RESET,this.onBufferReset,this),t.off(P.BUFFER_APPENDING,this.onBufferAppending,this),t.off(P.BUFFER_CODECS,this.onBufferCodecs,this),t.off(P.BUFFER_EOS,this.onBufferEos,this),t.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(P.FRAG_PARSED,this.onFragParsed,this),t.off(P.FRAG_CHANGED,this.onFragChanged,this),t.off(P.ERROR,this.onError,this)},a.transferMedia=function(){var t=this,i=this.media,l=this.mediaSource;if(!i)return null;var f={};if(this.operationQueue){var h=this.isUpdating();h||this.operationQueue.removeBlockers();var g=this.isQueued();(h||g)&&this.warn("Transfering MediaSource with"+(g?" operations in queue":"")+(h?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var p=this.transferData;return!this.sourceBufferCount&&p&&p.mediaSource===l?T(f,p.tracks):this.sourceBuffers.forEach(function(E){var x=E[0];x&&(f[x]=T({},t.tracks[x]),t.removeBuffer(x)),E[0]=E[1]=null}),{media:i,mediaSource:l,tracks:f}},a.initTracks=function(){var t={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=t,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},a.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},a.onManifestParsed=function(t,i){var l,f=2;i.audio&&!i.video||i.altAudio,f=1,this.bufferCodecEventsTotal=f,this.log(f+" bufferCodec event(s) expected."),(l=this.transferData)!=null&&l.mediaSource&&this.sourceBufferCount&&f&&this.bufferCreated()},a.onMediaAttaching=function(t,i){var l=this.media=i.media,f=Zt(this.appendSource);if(this.transferData=this.overrides=void 0,l&&f){var h=!!i.mediaSource;(h||i.overrides)&&(this.transferData=i,this.overrides=i.overrides);var g=this.mediaSource=i.mediaSource||new f;if(this.assignMediaSource(g),h)this._objectUrl=l.src,this.attachTransferred();else{var p=this._objectUrl=self.URL.createObjectURL(g);if(this.appendSource)try{l.removeAttribute("src");var E=self.ManagedMediaSource;l.disableRemotePlayback=l.disableRemotePlayback||E&&g instanceof E,Va(l),pu(l,p),l.load()}catch{l.src=p}else l.src=p}l.addEventListener("emptied",this._onMediaEmptied)}},a.assignMediaSource=function(t){var i,l;this.log((((i=this.transferData)==null?void 0:i.mediaSource)===t?"transferred":"created")+" media source: "+((l=t.constructor)==null?void 0:l.name)),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))},a.attachTransferred=function(){var t=this,i=this.media,l=this.transferData;if(!(!l||!i)){var f=this.tracks,h=l.tracks,g=h?Object.keys(h):null,p=g?g.length:0,E=function(){t.media&&t.mediaSourceOpenOrEnded&&t._onMediaSourceOpen()};if(h&&g&&p){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+ct(f,function(L,k){return L==="initSegment"?void 0:k})+`;
transfer tracks: `+ct(h,function(L,k){return L==="initSegment"?void 0:k})+"}"),!zl(h,f)){l.mediaSource=null,l.tracks=void 0;var x=i.currentTime,b=this.details,_=Math.max(x,b?.fragments[0].start||0);if(_-x>1){this.log("attachTransferred: waiting for playback to reach new tracks start time "+x+" -> "+_);return}this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(h)+'"->"'+Object.keys(f)+'") start time: '+_+" currentTime: "+x),this.onMediaDetaching(P.MEDIA_DETACHING,{}),this.onMediaAttaching(P.MEDIA_ATTACHING,l),i.currentTime=_;return}this.transferData=void 0,g.forEach(function(L){var k=L,I=h[k];if(I){var w=I.buffer;if(w){var O=t.fragmentTracker,D=I.id;if(O.hasFragments(D)||O.hasParts(D)){var M=Ne.getBuffered(w);O.detectEvictedFragments(k,M,D,null,!0)}var G=Qi(k),N=[k,w];t.sourceBuffers[G]=N,w.updating&&t.operationQueue&&t.operationQueue.prependBlocker(k),t.trackSourceBuffer(k,I)}}}),E(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),E()}},a.onMediaDetaching=function(t,i){var l=this,f=!!i.transferMedia;this.transferData=this.overrides=void 0;var h=this.media,g=this.mediaSource,p=this._objectUrl;if(g){if(this.log("media source "+(f?"transferring":"detaching")),f)this.sourceBuffers.forEach(function(_){var L=_[0];L&&l.removeBuffer(L)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var E=g.readyState==="open";try{for(var x=g.sourceBuffers,b=x.length;b--;)E&&x[b].abort(),g.removeSourceBuffer(x[b]);E&&g.endOfStream()}catch(_){this.warn("onMediaDetaching: "+_.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}g.removeEventListener("sourceopen",this._onMediaSourceOpen),g.removeEventListener("sourceended",this._onMediaSourceEnded),g.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(g.removeEventListener("startstreaming",this._onStartStreaming),g.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}h&&(h.removeEventListener("emptied",this._onMediaEmptied),f||(p&&self.URL.revokeObjectURL(p),this.mediaSrc===p?(h.removeAttribute("src"),this.appendSource&&Va(h),h.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(P.MEDIA_DETACHED,i)},a.onBufferReset=function(){var t=this;this.sourceBuffers.forEach(function(i){var l=i[0];l&&t.resetBuffer(l)}),this.initTracks()},a.resetBuffer=function(t){var i,l=(i=this.tracks[t])==null?void 0:i.buffer;if(this.removeBuffer(t),l)try{var f;(f=this.mediaSource)!=null&&f.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(l)}catch(h){this.warn("onBufferReset "+t,h)}delete this.tracks[t]},a.removeBuffer=function(t){this.removeBufferListeners(t),this.sourceBuffers[Qi(t)]=[null,null];var i=this.tracks[t];i&&(i.buffer=void 0)},a.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new ou(this.tracks)},a.onBufferCodecs=function(t,i){var l=this,f=this.tracks,h=Object.keys(i);this.log('BUFFER_CODECS: "'+h+'" (current SB count '+this.sourceBufferCount+")");var g="audiovideo"in i&&(f.audio||f.video)||f.audiovideo&&("audio"in i||"video"in i),p=!g&&this.sourceBufferCount&&this.media&&h.some(function(E){return!f[E]});if(g||p){this.warn('Unsupported transition between "'+Object.keys(f)+'" and "'+h+'" SourceBuffers');return}h.forEach(function(E){var x,b,_,L=i[E],k=L.id,I=L.codec,w=L.levelCodec,O=L.container,D=L.metadata,M=L.supplemental,G=f[E],N=(x=l.transferData)==null||(b=x.tracks)==null?void 0:b[E],H=N!=null&&N.buffer?N:G,X=H?.pendingCodec||H?.codec,Y=H?.levelCodec;G||(G=f[E]={buffer:void 0,listeners:[],codec:I,supplemental:M,container:O,levelCodec:w,metadata:D,id:k});var V=Zr(X,Y),j=V?.replace(Ha,"$1"),Q=Zr(I,w),se=(_=Q)==null?void 0:_.replace(Ha,"$1");Q&&V&&j!==se&&(E.slice(0,5)==="audio"&&(Q=Qr(Q,l.appendSource)),l.log("switching codec "+X+" to "+Q),Q!==(G.pendingCodec||G.codec)&&(G.pendingCodec=Q),G.container=O,l.appendChangeType(E,O,Q))}),(this.tracksReady||this.sourceBufferCount)&&(i.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()},a.appendChangeType=function(t,i,l){var f=this,h=i+";codecs="+l,g={label:"change-type="+h,execute:function(){var E=f.tracks[t];if(E){var x=E.buffer;x!=null&&x.changeType&&(f.log("changing "+t+" sourceBuffer type to "+h),x.changeType(h),E.codec=l,E.container=i)}f.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(E){f.warn("Failed to change "+t+" SourceBuffer type",E)}};this.append(g,t,this.isPending(this.tracks[t]))},a.blockAudio=function(t){var i,l=this,f=t.start,h=f+t.duration*.05,g=((i=this.fragmentTracker.getAppendedFrag(f,Ce.MAIN))==null?void 0:i.gap)===!0;if(!g){var p={label:"block-audio",execute:function(){var x,b=l.tracks.video;(l.lastVideoAppendEnd>h||b!=null&&b.buffer&&Ne.isBuffered(b.buffer,h)||((x=l.fragmentTracker.getAppendedFrag(h,Ce.MAIN))==null?void 0:x.gap)===!0)&&(l.blockedAudioAppend=null,l.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(x){l.warn("Error executing block-audio operation",x)}};this.blockedAudioAppend={op:p,frag:t},this.append(p,"audio",!0)}},a.unblockAudio=function(){var t=this.blockedAudioAppend,i=this.operationQueue;t&&i&&(this.blockedAudioAppend=null,i.unblockAudio(t.op))},a.onBufferAppending=function(t,i){var l=this,f=this.tracks,h=i.data,g=i.type,p=i.parent,E=i.frag,x=i.part,b=i.chunkMeta,_=b.buffering[g],L=E.sn,k=self.performance.now();_.start=k;var I=E.stats.buffering,w=x?x.stats.buffering:null;I.start===0&&(I.start=k),w&&w.start===0&&(w.start=k);var O=f.audio,D=!1;g==="audio"&&O?.container==="audio/mpeg"&&(D=!this.lastMpegAudioChunk||b.id===1||this.lastMpegAudioChunk.sn!==b.sn,this.lastMpegAudioChunk=b);var M=this.tracks.video,G=M?.buffer;if(G&&L!=="initSegment"){var N=x||E,H=this.blockedAudioAppend;if(g==="audio"&&p!=="main"&&!this.blockedAudioAppend){var X=N.start,Y=X+N.duration*.05,V=G.buffered,j=this.currentOp("video");!V.length&&!j?this.blockAudio(N):!j&&!Ne.isBuffered(G,Y)&&this.lastVideoAppendEnd<Y&&this.blockAudio(N)}else if(g==="video"){var Q=N.end;if(H){var se=H.frag.start;(Q>se||Q<this.lastVideoAppendEnd||Ne.isBuffered(G,se))&&this.unblockAudio()}this.lastVideoAppendEnd=Q}}var re=(x||E).start,Z={label:"append-"+g,execute:function(){if(_.executeStart=self.performance.now(),D){var le=l.tracks[g];if(le){var ue=le.buffer;if(ue){var fe=re-ue.timestampOffset;Math.abs(fe)>=.1&&(l.log("Updating audio SourceBuffer timestampOffset to "+re+" (delta: "+fe+") sn: "+L+")"),ue.timestampOffset=re)}}}l.appendExecutor(h,g)},onStart:function(){},onComplete:function(){var le=self.performance.now();_.executeEnd=_.end=le,I.first===0&&(I.first=le),w&&w.first===0&&(w.first=le);var ue={};l.sourceBuffers.forEach(function(fe){var Be=fe[0],Ie=fe[1];Be&&(ue[Be]=Ne.getBuffered(Ie))}),l.appendErrors[g]=0,g==="audio"||g==="video"?l.appendErrors.audiovideo=0:(l.appendErrors.audio=0,l.appendErrors.video=0),l.hls.trigger(P.BUFFER_APPENDED,{type:g,frag:E,part:x,chunkMeta:b,parent:E.type,timeRanges:ue})},onError:function(le){var ue,fe={type:be.MEDIA_ERROR,parent:E.type,details:$.BUFFER_APPEND_ERROR,sourceBufferName:g,frag:E,part:x,chunkMeta:b,error:le,err:le,fatal:!1};if(le.code===DOMException.QUOTA_EXCEEDED_ERR)fe.details=$.BUFFER_FULL_ERROR;else if(le.code===DOMException.INVALID_STATE_ERR&&l.mediaSourceOpenOrEnded&&!((ue=l.media)!=null&&ue.error))fe.errorAction=ii(!0);else if(le.name===Ga)l.sourceBufferCount===0?fe.errorAction=ii(!0):++l.appendErrors[g];else{var Be=++l.appendErrors[g];l.warn("Failed "+Be+"/"+l.hls.config.appendErrorMaxRetry+' times to append segment in "'+g+'" sourceBuffer'),Be>=l.hls.config.appendErrorMaxRetry&&(fe.fatal=!0)}l.hls.trigger(P.ERROR,fe)}};this.append(Z,g,this.isPending(this.tracks[g]))},a.getFlushOp=function(t,i,l){var f=this;return this.log('queuing "'+t+'" remove '+i+"-"+l),{label:"remove",execute:function(){f.removeExecutor(t,i,l)},onStart:function(){},onComplete:function(){f.hls.trigger(P.BUFFER_FLUSHED,{type:t})},onError:function(g){f.warn("Failed to remove "+i+"-"+l+' from "'+t+'" SourceBuffer',g)}}},a.onBufferFlushing=function(t,i){var l=this,f=i.type,h=i.startOffset,g=i.endOffset;f?this.append(this.getFlushOp(f,h,g),f):this.sourceBuffers.forEach(function(p){var E=p[0];E&&l.append(l.getFlushOp(E,h,g),E)})},a.onFragParsed=function(t,i){var l=this,f=i.frag,h=i.part,g=[],p=h?h.elementaryStreams:f.elementaryStreams;p[Ye.AUDIOVIDEO]?g.push("audiovideo"):(p[Ye.AUDIO]&&g.push("audio"),p[Ye.VIDEO]&&g.push("video"));var E=function(){var b=self.performance.now();f.stats.buffering.end=b,h&&(h.stats.buffering.end=b);var _=h?h.stats:f.stats;l.hls.trigger(P.FRAG_BUFFERED,{frag:f,part:h,stats:_,id:f.type})};g.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(E,g)},a.onFragChanged=function(t,i){this.trimBuffers()},a.onBufferEos=function(t,i){var l=this,f;this.sourceBuffers.forEach(function(p){var E=p[0];if(E){var x=l.tracks[E];(!i.type||i.type===E)&&(x.ending=!0,x.ended||(x.ended=!0,l.log(E+" buffer reached EOS")))}});var h=((f=this.overrides)==null?void 0:f.endOfStream)!==!1,g=this.sourceBufferCount>0&&!this.sourceBuffers.some(function(p){var E,x=p[0];return x&&!((E=l.tracks[x])!=null&&E.ended)});g&&(h?(this.log("Queueing EOS"),this.blockUntilOpen(function(){l.tracksEnded();var p=l.mediaSource;if(!p||p.readyState!=="open"){p&&l.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+p.readyState);return}l.log("Calling mediaSource.endOfStream()"),p.endOfStream(),l.hls.trigger(P.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(P.BUFFERED_TO_END,void 0)))},a.tracksEnded=function(){var t=this;this.sourceBuffers.forEach(function(i){var l=i[0];if(l!==null){var f=t.tracks[l];f&&(f.ending=!1)}})},a.onLevelUpdated=function(t,i){var l=i.details;l.fragments.length&&(this.details=l,this.updateDuration())},a.updateDuration=function(){var t=this,i=this.getDurationAndRange();i&&this.blockUntilOpen(function(){return t.updateMediaSource(i)})},a.onError=function(t,i){if(i.details===$.BUFFER_APPEND_ERROR&&i.frag){var l,f=(l=i.errorAction)==null?void 0:l.nextAutoLevel;ae(f)&&f!==i.frag.level&&this.resetAppendErrors()}},a.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},a.trimBuffers=function(){var t=this.hls,i=this.details,l=this.media;if(!(!l||i===null)&&this.sourceBufferCount){var f=t.config,h=l.currentTime,g=i.levelTargetDuration,p=i.live&&f.liveBackBufferLength!==null?f.liveBackBufferLength:f.backBufferLength;if(ae(p)&&p>=0){var E=Math.max(p,g),x=Math.floor(h/g)*g-E;this.flushBackBuffer(h,g,x)}if(ae(f.frontBufferFlushThreshold)&&f.frontBufferFlushThreshold>0){var b=Math.max(f.maxBufferLength,f.frontBufferFlushThreshold),_=Math.max(b,g),L=Math.floor(h/g)*g+_;this.flushFrontBuffer(h,g,L)}}},a.flushBackBuffer=function(t,i,l){var f=this;this.sourceBuffers.forEach(function(h){var g=h[0],p=h[1];if(p){var E=Ne.getBuffered(p);if(E.length>0&&l>E.start(0)){var x;f.hls.trigger(P.BACK_BUFFER_REACHED,{bufferEnd:l});var b=f.tracks[g];if((x=f.details)!=null&&x.live)f.hls.trigger(P.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l});else if(b!=null&&b.ended){f.log("Cannot flush "+g+" back buffer while SourceBuffer is in ended state");return}f.hls.trigger(P.BUFFER_FLUSHING,{startOffset:0,endOffset:l,type:g})}}})},a.flushFrontBuffer=function(t,i,l){var f=this;this.sourceBuffers.forEach(function(h){var g=h[0],p=h[1];if(p){var E=Ne.getBuffered(p),x=E.length;if(x<2)return;var b=E.start(x-1),_=E.end(x-1);if(l>b||t>=b&&t<=_)return;f.hls.trigger(P.BUFFER_FLUSHING,{startOffset:b,endOffset:1/0,type:g})}})},a.getDurationAndRange=function(){var t,i=this.details,l=this.mediaSource;if(!i||!this.media||l?.readyState!=="open")return null;var f=i.edge;if(i.live&&this.hls.config.liveDurationInfinity){var h=i.fragments.length;if(h&&i.live&&l.setLiveSeekableRange){var g=Math.max(0,i.fragmentStart),p=Math.max(g,f);return{duration:1/0,start:g,end:p}}return{duration:1/0}}var E=(t=this.overrides)==null?void 0:t.duration;if(E)return ae(E)?{duration:E}:null;var x=this.media.duration,b=ae(l.duration)?l.duration:0;return f>b&&f>x||!ae(x)?{duration:f}:null},a.updateMediaSource=function(t){var i=t.duration,l=t.start,f=t.end,h=this.mediaSource;!this.media||!h||h.readyState!=="open"||(h.duration!==i&&(ae(i)&&this.log("Updating MediaSource duration to "+i.toFixed(3)),h.duration=i),l!==void 0&&f!==void 0&&(this.log("MediaSource duration is set to "+h.duration+". Setting seekable range to "+l+"-"+f+"."),h.setLiveSeekableRange(l,f)))},a.checkPendingTracks=function(){var t=this.bufferCodecEventsTotal,i=this.pendingTrackCount,l=this.tracks;if(this.log("checkPendingTracks (pending: "+i+" codec events expected: "+t+") "+ct(l)),this.tracksReady){var f,h=(f=this.transferData)==null?void 0:f.tracks;h&&Object.keys(h).length?this.attachTransferred():this.createSourceBuffers()}},a.bufferCreated=function(){var t=this;if(this.sourceBufferCount){var i={};this.sourceBuffers.forEach(function(f){var h=f[0],g=f[1];if(h){var p=t.tracks[h];i[h]={buffer:g,container:p.container,codec:p.codec,supplemental:p.supplemental,levelCodec:p.levelCodec,id:p.id,metadata:p.metadata}}}),this.hls.trigger(P.BUFFER_CREATED,{tracks:i}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(f){var h=f[0];t.executeNext(h)})}else{var l=new Error("could not create source buffer for media codec(s)");this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:l,reason:l.message})}},a.createSourceBuffers=function(){var t=this.tracks,i=this.sourceBuffers,l=this.mediaSource;if(!l)throw new Error("createSourceBuffers called when mediaSource was null");for(var f in t){var h=f,g=t[h];if(this.isPending(g)){var p=this.getTrackCodec(g,h),E=g.container+";codecs="+p;g.codec=p,this.log("creating sourceBuffer("+E+")"+(this.currentOp(h)?" Queued":"")+" "+ct(g));try{var x=l.addSourceBuffer(E),b=Qi(h),_=[h,x];i[b]=_,g.buffer=x}catch(k){var L;this.error("error while trying to add sourceBuffer: "+k.message),this.shiftAndExecuteNext(h),(L=this.operationQueue)==null||L.removeBlockers(),delete this.tracks[h],this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:k,sourceBufferName:h,mimeType:E,parent:g.id});return}this.trackSourceBuffer(h,g)}}this.bufferCreated()},a.getTrackCodec=function(t,i){var l=t.supplemental,f=t.codec;l&&(i==="video"||i==="audiovideo")&&Yi(l,"video")&&(f=Xl(f,l));var h=Zr(f,t.levelCodec);return h?i.slice(0,5)==="audio"?Qr(h,this.appendSource):h:""},a.trackSourceBuffer=function(t,i){var l=this,f=i.buffer;if(f){var h=this.getTrackCodec(i,t);this.tracks[t]={buffer:f,codec:h,container:i.container,levelCodec:i.levelCodec,supplemental:i.supplemental,metadata:i.metadata,id:i.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",function(g,p){var E=p.removedRanges;E!=null&&E.length&&l.hls.trigger(P.BUFFER_FLUSHED,{type:g})})}},a.onSBUpdateStart=function(t){var i=this.currentOp(t);i&&i.onStart()},a.onSBUpdateEnd=function(t){var i;if(((i=this.mediaSource)==null?void 0:i.readyState)==="closed"){this.resetBuffer(t);return}var l=this.currentOp(t);l&&(l.onComplete(),this.shiftAndExecuteNext(t))},a.onSBUpdateError=function(t,i){var l,f=new Error(t+" SourceBuffer error. MediaSource readyState: "+((l=this.mediaSource)==null?void 0:l.readyState));this.error(""+f,i),this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:f,fatal:!1});var h=this.currentOp(t);h&&h.onError(f)},a.removeExecutor=function(t,i,l){var f=this.media,h=this.mediaSource,g=this.tracks[t],p=g?.buffer;if(!f||!h||!p){this.warn("Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),this.shiftAndExecuteNext(t);return}var E=ae(f.duration)?f.duration:1/0,x=ae(h.duration)?h.duration:1/0,b=Math.max(0,i),_=Math.min(l,E,x);_>b&&(!g.ending||g.ended)?(g.ended=!1,this.log("Removing ["+b+","+_+"] from the "+t+" SourceBuffer"),p.remove(b,_)):this.shiftAndExecuteNext(t)},a.appendExecutor=function(t,i){var l=this.tracks[i],f=l?.buffer;if(!f)throw new vu("Attempting to append to the "+i+" SourceBuffer, but it does not exist");l.ending=!1,l.ended=!1,f.appendBuffer(t)},a.blockUntilOpen=function(t){this.isUpdating()||this.isQueued()?this.blockBuffers(t):t()},a.isUpdating=function(){return this.sourceBuffers.some(function(t){var i=t[0],l=t[1];return i&&l.updating})},a.isQueued=function(){var t=this;return this.sourceBuffers.some(function(i){var l=i[0];return l&&!!t.currentOp(l)})},a.isPending=function(t){return!!t&&!t.buffer},a.blockBuffers=function(t,i){var l=this;if(i===void 0&&(i=this.sourceBufferTypes),!i.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}var f=this.operationQueue,h=i.map(function(p){return l.appendBlocker(p)}),g=i.length>1&&!!this.blockedAudioAppend;g&&this.unblockAudio(),Promise.all(h).then(function(p){f===l.operationQueue&&(t(),l.stepOperationQueue(i))})},a.stepOperationQueue=function(t){var i=this;t.forEach(function(l){var f,h=(f=i.tracks[l])==null?void 0:f.buffer;!h||h.updating||i.shiftAndExecuteNext(l)})},a.append=function(t,i,l){this.operationQueue&&this.operationQueue.append(t,i,l)},a.appendBlocker=function(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)},a.currentOp=function(t){return this.operationQueue?this.operationQueue.current(t):null},a.executeNext=function(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)},a.shiftAndExecuteNext=function(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)},a.addBufferListener=function(t,i,l){var f=this.tracks[t];if(f){var h=f.buffer;if(h){var g=l.bind(this,t);f.listeners.push({event:i,listener:g}),h.addEventListener(i,g)}}},a.removeBufferListeners=function(t){var i=this.tracks[t];if(i){var l=i.buffer;l&&(i.listeners.forEach(function(f){l.removeEventListener(f.event,f.listener)}),i.listeners.length=0)}},c(u,[{key:"mediaSourceOpenOrEnded",get:function(){var t,i=(t=this.mediaSource)==null?void 0:t.readyState;return i==="open"||i==="ended"}},{key:"sourceBufferTracks",get:function(){var t=this;return Object.keys(this.tracks).reduce(function(i,l){var f=t.tracks[l];return i[l]={id:f.id,container:f.container,codec:f.codec,levelCodec:f.levelCodec},i},{})}},{key:"bufferedToEnd",get:function(){var t=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(i){var l,f,h=i[0];return h&&(!((l=t.tracks[h])!=null&&l.ended)||((f=t.tracks[h])==null?void 0:f.ending))})}},{key:"tracksReady",get:function(){var t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var t,i,l=((t=this.media)==null||(i=t.querySelector)==null?void 0:i.call(t,"source"))||this.media;return l?.src}},{key:"pendingTrackCount",get:function(){var t=this;return Object.keys(this.tracks).reduce(function(i,l){return i+(t.isPending(t.tracks[l])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(t,i){var l=i[0];return t+(l?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(t){var i=t[0];return i}).filter(function(t){return!!t})}}])}(gr);function Va(o){var u=o.querySelectorAll("source");[].slice.call(u).forEach(function(a){o.removeChild(a)})}function pu(o,u){var a=self.document.createElement("source");a.type="video/mp4",a.src=u,o.appendChild(a)}function Qi(o){return o==="audio"?1:0}var mu=function(){function o(a){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=a,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var u=o.prototype;return u.setStreamController=function(r){this.streamController=r},u.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},u.registerListeners=function(){var r=this.hls;r.on(P.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(P.MANIFEST_PARSED,this.onManifestParsed,this),r.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(P.BUFFER_CODECS,this.onBufferCodecs,this),r.on(P.MEDIA_DETACHING,this.onMediaDetaching,this)},u.unregisterListener=function(){var r=this.hls;r.off(P.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(P.MANIFEST_PARSED,this.onManifestParsed,this),r.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(P.BUFFER_CODECS,this.onBufferCodecs,this),r.off(P.MEDIA_DETACHING,this.onMediaDetaching,this)},u.onFpsDropLevelCapping=function(r,t){var i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})},u.onMediaAttaching=function(r,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},u.onManifestParsed=function(r,t){var i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},u.onLevelsUpdated=function(r,t){this.timer&&ae(this.autoLevelCapping)&&this.detectPlayerSize()},u.onBufferCodecs=function(r,t){var i=this.hls;i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},u.onMediaDetaching=function(){this.stopCapping(),this.media=null},u.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var r=this.hls.levels;if(r.length){var t=this.hls,i=this.getMaxLevel(r.length-1);i!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to "+i+": "+r[i].height+"p@"+r[i].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},u.getMaxLevel=function(r){var t=this,i=this.hls.levels;if(!i.length)return-1;var l=i.filter(function(f,h){return t.isLevelAllowed(f)&&h<=r});return this.clientRect=null,o.getMaxLevelByMediaSize(l,this.mediaWidth,this.mediaHeight)},u.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},u.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},u.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,t={width:0,height:0};if(r){var i=r.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||r.width||0,t.height=i.bottom-i.top||r.height||0)}return this.clientRect=t,t},u.isLevelAllowed=function(r){var t=this.restrictedLevels;return!t.some(function(i){return r.bitrate===i.bitrate&&r.width===i.width&&r.height===i.height})},o.getMaxLevelByMediaSize=function(r,t,i){if(!(r!=null&&r.length))return-1;for(var l=function(x,b){return b?x.width!==b.width||x.height!==b.height:!0},f=r.length-1,h=Math.max(t,i),g=0;g<r.length;g+=1){var p=r[g];if((p.width>=h||p.height>=h)&&l(p,r[g+1])){f=g;break}}return f},c(o,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return Math.min(r,this.hls.config.maxDevicePixelRatio)}}])}(),yu=/^(\d+)x(\d+)$/,Ka=/(.+?)=(".*?"|.*?)(?:,|$)/g,Ze=function(){function o(a,r){typeof a=="string"&&(a=o.parseAttrList(a,r)),T(this,a)}var u=o.prototype;return u.decimalInteger=function(r){var t=parseInt(this[r],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},u.hexadecimalInteger=function(r){if(this[r]){var t=(this[r]||"0x").slice(2);t=(t.length&1?"0":"")+t;for(var i=new Uint8Array(t.length/2),l=0;l<t.length/2;l++)i[l]=parseInt(t.slice(l*2,l*2+2),16);return i}return null},u.hexadecimalIntegerAsNumber=function(r){var t=parseInt(this[r],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},u.decimalFloatingPoint=function(r){return parseFloat(this[r])},u.optionalFloat=function(r,t){var i=this[r];return i?parseFloat(i):t},u.enumeratedString=function(r){return this[r]},u.enumeratedStringList=function(r,t){var i=this[r];return(i?i.split(/[ ,]+/):[]).reduce(function(l,f){return l[f.toLowerCase()]=!0,l},t)},u.bool=function(r){return this[r]==="YES"},u.decimalResolution=function(r){var t=yu.exec(this[r]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},o.parseAttrList=function(r,t){var i,l={},f='"';for(Ka.lastIndex=0;(i=Ka.exec(r))!==null;){var h=i[1].trim(),g=i[2],p=g.indexOf(f)===0&&g.lastIndexOf(f)===g.length-1,E=!1;if(p)g=g.slice(1,-1);else switch(h){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":E=!0}if(!(t&&(p||E))){if(!E&&!p)switch(h){case"CLOSED-CAPTIONS":if(g==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Oe.warn(r+": attribute "+h+" is missing quotes")}}l[h]=g}return l},c(o,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(r){return r.substring(0,2)==="X-"})}}])}(),Eu="com.apple.hls.interstitial";function Tu(o){return o!=="ID"&&o!=="CLASS"&&o!=="CUE"&&o!=="START-DATE"&&o!=="DURATION"&&o!=="END-DATE"&&o!=="END-ON-NEXT"}function Su(o){return o==="SCTE35-OUT"||o==="SCTE35-IN"||o==="SCTE35-CMD"}var Wa=function(){function o(u,a,r){var t;if(r===void 0&&(r=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=a?.tagAnchor||null,this.tagOrder=(t=a?.tagOrder)!=null?t:r,a){var i=a.attr;for(var l in i)if(Object.prototype.hasOwnProperty.call(u,l)&&u[l]!==i[l]){Oe.warn('DATERANGE tag attribute: "'+l+'" does not match for tags with ID: "'+u.ID+'"'),this._badValueForSameId=l;break}u=T(new Ze({}),i,u)}if(this.attr=u,a?(this._startDate=a._startDate,this._cue=a._cue,this._endDate=a._endDate,this._dateAtEnd=a._dateAtEnd):this._startDate=new Date(u["START-DATE"]),"END-DATE"in this.attr){var f=a?.endDate||new Date(this.attr["END-DATE"]);ae(f.getTime())&&(this._endDate=f)}}return c(o,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var a=this._cue;return a===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):a}},{key:"startTime",get:function(){var a=this.tagAnchor;return a===null||a.programDateTime===null?(Oe.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+a),NaN):a.start+(this.startDate.getTime()-a.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var a=this._endDate||this._dateAtEnd;if(a)return a;var r=this.duration;return r!==null?this._dateAtEnd=new Date(this._startDate.getTime()+r*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var a=this.attr.decimalFloatingPoint("DURATION");if(ae(a))return a}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class===Eu}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&ae(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])}(),xu=10,_u=function(){function o(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=a}var u=o.prototype;return u.reloaded=function(r){if(!r){this.advanced=!0,this.updated=!0;return}var t=this.lastPartSn-r.lastPartSn,i=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>r.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(r.misses*.6):this.misses=r.misses+1},c(o,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?ae(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||xu}},{key:"drift",get:function(){var r=this.driftEndTime-this.driftStartTime;if(r>0){var t=this.driftEnd-this.driftStart;return t*1e3/r}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var r=this.partList;if(r){var t=this.lastPartIndex;if(t!==-1){for(var i=r.length;i--;)if(r[i].index>t)return r[i].index;return t}}return 0}},{key:"lastPartSn",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var r=this.partEnd-this.fragmentStart;return this.age>Math.max(r,this.totalduration)+this.levelTargetDuration}return!1}}])}(),Jt={cbc:0,ctr:1};function Dr(o){return o==="AES-128"||o==="AES-256"||o==="AES-256-CTR"}function ja(o){switch(o){case"AES-128":case"AES-256":return Jt.cbc;case"AES-256-CTR":return Jt.ctr;default:throw new Error("invalid full segment method "+o)}}var bu=function(){function o(a,r,t,i,l){i===void 0&&(i=[1]),l===void 0&&(l=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=a,this.uri=r,this.keyFormat=t,this.keyFormatVersions=i,this.iv=l,this.encrypted=a?a!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Dr(a)}o.clearKeyUriToKeyIdMap=function(){};var u=o.prototype;return u.isSupported=function(){if(this.method){if(Dr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES"}return!1},u.getDecryptData=function(r){if(!this.encrypted||!this.uri)return null;if(Dr(this.method)&&this.uri&&!this.iv){typeof r!="number"&&(Oe.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),r=0);var t=Lu(r),i=new o(this.method,this.uri,"identity",this.keyFormatVersions,t);return i}return this},o}();function Lu(o){for(var u=new Uint8Array(16),a=12;a<16;a++)u[a]=o>>8*(15-a)&255;return u}var Ya=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,za=/#EXT-X-MEDIA:(.*)/g,Cu=/^#EXT(?:INF|-X-TARGETDURATION):/m,Zi=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Au=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Or=function(){function o(){}return o.findGroup=function(a,r){for(var t=0;t<a.length;t++){var i=a[t];if(i.id===r)return i}},o.resolve=function(a,r){return ft.buildAbsoluteURL(r,a,{alwaysNormalize:!0})},o.isMediaPlaylist=function(a){return Cu.test(a)},o.parseMasterPlaylist=function(a,r){var t=!1,i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:t},l=[];Ya.lastIndex=0;for(var f;(f=Ya.exec(a))!=null;)if(f[1]){var h,g=new Ze(f[1],i),p=f[2],E={attrs:g,bitrate:g.decimalInteger("BANDWIDTH")||g.decimalInteger("AVERAGE-BANDWIDTH"),name:g.NAME,url:o.resolve(p,r)},x=g.decimalResolution("RESOLUTION");x&&(E.width=x.width,E.height=x.height),Qa(g.CODECS,E);var b=g["SUPPLEMENTAL-CODECS"];b&&(E.supplemental={},Qa(b,E.supplemental)),(h=E.unknownCodecs)!=null&&h.length||l.push(E),i.levels.push(E)}else if(f[3]){var _=f[3],L=f[4];switch(_){case"SESSION-DATA":{var k=new Ze(L,i),I=k["DATA-ID"];I&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[I]=k);break}case"SESSION-KEY":{var w=qa(L,r,i);w.encrypted&&w.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(w)):Oe.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+L+'"');break}case"DEFINE":break;case"CONTENT-STEERING":{var O=new Ze(L,i);i.contentSteering={uri:o.resolve(O["SERVER-URI"],r),pathwayId:O["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Xa(L);break}}}var D=l.length>0&&l.length<i.levels.length;return i.levels=D?l:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i},o.parseMasterPlaylistMedia=function(a,r,t){var i,l={},f=t.levels,h={AUDIO:f.map(function(M){return{id:M.attrs.AUDIO,audioCodec:M.audioCodec}}),SUBTITLES:f.map(function(M){return{id:M.attrs.SUBTITLES,textCodec:M.textCodec}}),"CLOSED-CAPTIONS":[]},g=0;for(za.lastIndex=0;(i=za.exec(a))!==null;){var p=new Ze(i[1],t),E=p.TYPE;if(E){var x=h[E],b=l[E]||[];l[E]=b;var _=p.LANGUAGE,L=p["ASSOC-LANGUAGE"],k=p.CHANNELS,I=p.CHARACTERISTICS,w=p["INSTREAM-ID"],O={attrs:p,bitrate:0,id:g++,groupId:p["GROUP-ID"]||"",name:p.NAME||_||"",type:E,default:p.bool("DEFAULT"),autoselect:p.bool("AUTOSELECT"),forced:p.bool("FORCED"),lang:_,url:p.URI?o.resolve(p.URI,r):""};if(L&&(O.assocLang=L),k&&(O.channels=k),I&&(O.characteristics=I),w&&(O.instreamId=w),x!=null&&x.length){var D=o.findGroup(x,O.groupId)||x[0];Za(O,D,"audioCodec"),Za(O,D,"textCodec")}b.push(O)}}return l},o.parseLevelPlaylist=function(a,r,t,i,l,f){var h,g={url:r},p=new _u(r),E=p.fragments,x=[],b=null,_=0,L=0,k=0,I=0,w=0,O=null,D=new Vi(i,g),M,G,N,H=-1,X=!1,Y=null,V;if(Zi.lastIndex=0,p.m3u8=a,p.hasVariableRefs=!1,((h=Zi.exec(a))==null?void 0:h[0])!=="#EXTM3U")return p.playlistParsingError=new Error("Missing format identifier #EXTM3U"),p;for(;(M=Zi.exec(a))!==null;){X&&(X=!1,D=new Vi(i,g),D.playlistOffset=k,D.start=k,D.sn=_,D.cc=I,w&&(D.bitrate=w),D.level=t,b&&(D.initSegment=b,b.rawProgramDateTime&&(D.rawProgramDateTime=b.rawProgramDateTime,b.rawProgramDateTime=null),Y&&(D.setByteRange(Y),Y=null)));var j=M[1];if(j){D.duration=parseFloat(j);var Q=(" "+M[2]).slice(1);D.title=Q||null,D.tagList.push(Q?["INF",j,Q]:["INF",j])}else if(M[3]){if(ae(D.duration)){D.playlistOffset=k,D.start=k,N&&es(D,N,p),D.sn=_,D.level=t,D.cc=I,E.push(D);var se=(" "+M[3]).slice(1);D.relurl=se,Ji(D,O,x),O=D,k+=D.duration,_++,L=0,X=!0}}else{if(M=M[0].match(Au),!M){Oe.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<M.length&&M[G]===void 0;G++);var re=(" "+M[G]).slice(1),Z=(" "+M[G+1]).slice(1),oe=M[G+2]?(" "+M[G+2]).slice(1):null;switch(re){case"BYTERANGE":O?D.setByteRange(Z,O):D.setByteRange(Z);break;case"PROGRAM-DATE-TIME":D.rawProgramDateTime=Z,D.tagList.push(["PROGRAM-DATE-TIME",Z]),H===-1&&(H=E.length);break;case"PLAYLIST-TYPE":p.type&&Vt(p,re,M),p.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":p.startSN!==0?Vt(p,re,M):E.length>0&&ts(p,re,M),_=p.startSN=parseInt(Z);break;case"SKIP":{p.skippedSegments&&Vt(p,re,M);var le=new Ze(Z,p),ue=le.decimalInteger("SKIPPED-SEGMENTS");if(ae(ue)){p.skippedSegments+=ue;for(var fe=ue;fe--;)E.push(null);_+=ue}var Be=le.enumeratedString("RECENTLY-REMOVED-DATERANGES");Be&&(p.recentlyRemovedDateranges=(p.recentlyRemovedDateranges||[]).concat(Be.split("	")));break}case"TARGETDURATION":p.targetduration!==0&&Vt(p,re,M),p.targetduration=Math.max(parseInt(Z),1);break;case"VERSION":p.version!==null&&Vt(p,re,M),p.version=parseInt(Z);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":p.live||Vt(p,re,M),p.live=!1;break;case"#":(Z||oe)&&D.tagList.push(oe?[Z,oe]:[Z]);break;case"DISCONTINUITY":I++,D.tagList.push(["DIS"]);break;case"GAP":D.gap=!0,D.tagList.push([re]);break;case"BITRATE":D.tagList.push([re,Z]),w=parseInt(Z)*1e3,ae(w)?D.bitrate=w:w=0;break;case"DATERANGE":{var Ie=new Ze(Z,p),Ue=new Wa(Ie,p.dateRanges[Ie.ID],p.dateRangeTagCount);p.dateRangeTagCount++,Ue.isValid||p.skippedSegments?p.dateRanges[Ue.id]=Ue:Oe.warn('Ignoring invalid DATERANGE tag: "'+Z+'"'),D.tagList.push(["EXT-X-DATERANGE",Z]);break}case"DEFINE":break;case"DISCONTINUITY-SEQUENCE":p.startCC!==0?Vt(p,re,M):E.length>0&&ts(p,re,M),p.startCC=I=parseInt(Z);break;case"KEY":{var ke=qa(Z,r,p);if(ke.isSupported()){if(ke.method==="NONE"){N=void 0;break}N||(N={}),N[ke.keyFormat]&&(N=T({},N)),N[ke.keyFormat]=ke}else Oe.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Z+'"');break}case"START":p.startTimeOffset=Xa(Z);break;case"MAP":{var Qe=new Ze(Z,p);if(D.duration){var He=new Vi(i,g);Ja(He,Qe,t,N),b=He,D.initSegment=b,b.rawProgramDateTime&&!D.rawProgramDateTime&&(D.rawProgramDateTime=b.rawProgramDateTime)}else{var qe=D.byteRangeEndOffset;if(qe){var gt=D.byteRangeStartOffset;Y=qe-gt+"@"+gt}else Y=null;Ja(D,Qe,t,N),b=D,X=!0}b.cc=I;break}case"SERVER-CONTROL":{V&&Vt(p,re,M),V=new Ze(Z),p.canBlockReload=V.bool("CAN-BLOCK-RELOAD"),p.canSkipUntil=V.optionalFloat("CAN-SKIP-UNTIL",0),p.canSkipDateRanges=p.canSkipUntil>0&&V.bool("CAN-SKIP-DATERANGES"),p.partHoldBack=V.optionalFloat("PART-HOLD-BACK",0),p.holdBack=V.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{p.partTarget&&Vt(p,re,M);var it=new Ze(Z);p.partTarget=it.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ge=p.partList;Ge||(Ge=p.partList=[]);var pt=L>0?Ge[Ge.length-1]:void 0,Je=L++,ze=new Ze(Z,p),mt=new Pl(ze,D,g,Je,pt);Ge.push(mt),D.duration+=mt.duration;break}case"PRELOAD-HINT":{var ot=new Ze(Z,p);p.preloadHint=ot;break}case"RENDITION-REPORT":{var xt=new Ze(Z,p);p.renditionReports=p.renditionReports||[],p.renditionReports.push(xt);break}default:Oe.warn("line parsed but not handled: "+M);break}}}O&&!O.relurl?(E.pop(),k-=O.duration,p.partList&&(p.fragmentHint=O)):p.partList&&(Ji(D,O,x),D.cc=I,p.fragmentHint=D,N&&es(D,N,p)),p.targetduration||(p.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var We=E.length,lt=E[0],et=E[We-1];if(k+=p.skippedSegments*p.targetduration,k>0&&We&&et){p.averagetargetduration=k/We;var yt=et.sn;p.endSN=yt!=="initSegment"?yt:0,p.live||(et.endList=!0),lt&&p.startCC===void 0&&(p.startCC=lt.cc),H>0&&(Ru(E,H),lt&&x.unshift(lt))}else p.endSN=0,p.startCC=0;return p.fragmentHint&&(k+=p.fragmentHint.duration),p.totalduration=k,x.length&&p.dateRangeTagCount&&lt&&$a(x,p),p.endCC=I,p},o}();function $a(o,u){for(var a=o.length,r=o[a-1],t=u.live?1/0:u.totalduration,i=Object.keys(u.dateRanges),l=i.length;l--;){var f=u.dateRanges[i[l]],h=f.startDate.getTime();f.tagAnchor=r.ref;for(var g=a;g--;){var p=ku(u,h,o,g,t);if(p!==-1){f.tagAnchor=u.fragments[p].ref;break}}}}function ku(o,u,a,r,t){var i=a[r];if(i){var l=i.programDateTime;if(u>=l||r===0){var f,h=(((f=a[r+1])==null?void 0:f.start)||t)-i.start;if(u<=l+h*1e3){var g=a[r].sn-o.startSN,p=o.fragments;if(p.length>a.length)for(var E=a[r+1]||p[p.length-1],x=E.sn-o.startSN,b=x;b>g;b--){var _=p[b].programDateTime;if(u>=_&&u<_+p[b].duration*1e3)return b}return g}}}return-1}function qa(o,u,a){var r,t,i=new Ze(o,a),l=(r=i.METHOD)!=null?r:"",f=i.URI,h=i.hexadecimalInteger("IV"),g=i.KEYFORMATVERSIONS,p=(t=i.KEYFORMAT)!=null?t:"identity";f&&i.IV&&!h&&Oe.error("Invalid IV: "+i.IV);var E=f?Or.resolve(f,u):"",x=(g||"1").split("/").map(Number).filter(Number.isFinite);return new bu(l,E,p,x,h)}function Xa(o){var u=new Ze(o),a=u.decimalFloatingPoint("TIME-OFFSET");return ae(a)?a:null}function Qa(o,u){var a=(o||"").split(/[ ,]+/).filter(function(r){return r});["video","audio","text"].forEach(function(r){var t=a.filter(function(i){return ba(i,r)});t.length&&(u[r+"Codec"]=t.map(function(i){return i.split("/")[0]}).join(","),a=a.filter(function(i){return t.indexOf(i)===-1}))}),u.unknownCodecs=a}function Za(o,u,a){var r=u[a];r&&(o[a]=r)}function Ru(o,u){for(var a=o[u],r=u;r--;){var t=o[r];if(!t)return;t.programDateTime=a.programDateTime-t.duration*1e3,a=t}}function Ji(o,u,a){o.rawProgramDateTime?a.push(o):u!=null&&u.programDateTime&&(o.programDateTime=u.endProgramDateTime)}function Ja(o,u,a,r){o.relurl=u.URI,u.BYTERANGE&&o.setByteRange(u.BYTERANGE),o.level=a,o.sn="initSegment",r&&(o.levelkeys=r),o.initSegment=null}function es(o,u,a){o.levelkeys=u;var r=a.encryptedFragments;(!r.length||r[r.length-1].levelkeys!==u)&&Object.keys(u).some(function(t){return u[t].isCommonEncryption})&&r.push(o)}function Vt(o,u,a){o.playlistParsingError=new Error("#EXT-X-"+u+" must not appear more than once ("+a[0]+")")}function ts(o,u,a){o.playlistParsingError=new Error("#EXT-X-"+u+" must appear before the first Media Segment ("+a[0]+")")}function en(o,u){var a=u.startPTS;if(ae(a)){var r=0,t;u.sn>o.sn?(r=a-o.start,t=o):(r=o.start-a,t=u),t.duration!==r&&t.setDuration(r)}else if(u.sn>o.sn){var i=o.cc===u.cc;i&&o.minEndPTS?u.setStart(o.start+(o.minEndPTS-o.start)):u.setStart(o.start+o.duration)}else u.setStart(Math.max(o.start-u.duration,0))}function rs(o,u,a,r,t,i){var l=r-a;l<=0&&(Oe.warn("Fragment should have a positive duration",u),r=a+u.duration,i=t+u.duration);var f=a,h=r,g=u.startPTS,p=u.endPTS;if(ae(g)){var E=Math.abs(g-a);ae(u.deltaPTS)?u.deltaPTS=Math.max(E,u.deltaPTS):u.deltaPTS=E,f=Math.max(a,g),a=Math.min(a,g),t=Math.min(t,u.startDTS),h=Math.min(r,p),r=Math.max(r,p),i=Math.max(i,u.endDTS)}var x=a-u.start;u.start!==0&&u.setStart(a),u.setDuration(r-u.start),u.startPTS=a,u.maxStartPTS=f,u.startDTS=t,u.endPTS=r,u.minEndPTS=h,u.endDTS=i;var b=u.sn;if(!o||b<o.startSN||b>o.endSN)return 0;var _,L=b-o.startSN,k=o.fragments;for(k[L]=u,_=L;_>0;_--)en(k[_],k[_-1]);for(_=L;_<k.length-1;_++)en(k[_],k[_+1]);return o.fragmentHint&&en(k[k.length-1],o.fragmentHint),o.PTSKnown=o.alignedSliding=!0,x}function Iu(o,u){if(o!==u){for(var a=null,r=o.fragments,t=r.length-1;t>=0;t--){var i=r[t].initSegment;if(i){a=i;break}}o.fragmentHint&&delete o.fragmentHint.endPTS;var l;Du(o,u,function(_,L,k,I){if(u.skippedSegments&&L.cc!==_.cc)for(var w=_.cc-L.cc,O=k;O<I.length;O++)I[O].cc+=w;ae(_.startPTS)&&ae(_.endPTS)&&(L.setStart(L.startPTS=_.startPTS),L.startDTS=_.startDTS,L.maxStartPTS=_.maxStartPTS,L.endPTS=_.endPTS,L.endDTS=_.endDTS,L.minEndPTS=_.minEndPTS,L.setDuration(_.endPTS-_.startPTS),L.duration&&(l=L),u.PTSKnown=u.alignedSliding=!0),_.hasStreams&&(L.elementaryStreams=_.elementaryStreams),L.loader=_.loader,_.hasStats&&(L.stats=_.stats),_.initSegment&&(L.initSegment=_.initSegment,a=_.initSegment)});var f=u.fragments,h=u.fragmentHint?f.concat(u.fragmentHint):f;if(a&&h.forEach(function(_){var L;_&&(!_.initSegment||_.initSegment.relurl===((L=a)==null?void 0:L.relurl))&&(_.initSegment=a)}),u.skippedSegments)if(u.deltaUpdateFailed=f.some(function(_){return!_}),u.deltaUpdateFailed){Oe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var g=u.skippedSegments;g--;)f.shift();u.startSN=f[0].sn}else{u.endCC=f[f.length-1].cc,u.canSkipDateRanges&&(u.dateRanges=Pu(o.dateRanges,u));var p=o.fragments.filter(function(_){return _.rawProgramDateTime});if(o.hasProgramDateTime&&!u.hasProgramDateTime)for(var E=1;E<h.length;E++)h[E].programDateTime===null&&Ji(h[E],h[E-1],p);$a(p,u)}wu(o.partList,u.partList,function(_,L){L.elementaryStreams=_.elementaryStreams,L.stats=_.stats}),l?rs(u,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):ns(o,u),f.length&&(u.totalduration=u.edge-f[0].start),u.driftStartTime=o.driftStartTime,u.driftStart=o.driftStart;var x=u.advancedDateTime;if(u.advanced&&x){var b=u.edge;u.driftStart||(u.driftStartTime=x,u.driftStart=b),u.driftEndTime=x,u.driftEnd=b}else u.driftEndTime=o.driftEndTime,u.driftEnd=o.driftEnd,u.advancedDateTime=o.advancedDateTime;u.requestScheduled===-1&&(u.requestScheduled=o.requestScheduled)}}function Pu(o,u){var a=u.dateRanges,r=u.recentlyRemovedDateranges,t=T({},o);r&&r.forEach(function(f){delete t[f]});var i=Object.keys(t),l=i.length;return l&&Object.keys(a).forEach(function(f){var h=t[f],g=new Wa(a[f].attr,h);g.isValid?(t[f]=g,h||(g.tagOrder+=l)):Oe.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+ct(a[f].attr)+'"')}),t}function wu(o,u,a){if(o&&u)for(var r=0,t=0,i=o.length;t<=i;t++){var l=o[t],f=u[t+r];l&&f&&l.index===f.index&&l.fragment.sn===f.fragment.sn?a(l,f):r--}}function Du(o,u,a){for(var r=u.skippedSegments,t=Math.max(o.startSN,u.startSN)-u.startSN,i=(o.fragmentHint?1:0)+(r?u.endSN:Math.min(o.endSN,u.endSN))-u.startSN,l=u.startSN-o.startSN,f=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments,h=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,g=t;g<=i;g++){var p=h[l+g],E=f[g];if(r&&!E&&p&&(E=u.fragments[g]=p),p&&E){if(a(p,E,g,f),p.url&&p.url!==E.url){u.playlistParsingError=is("media sequence mismatch "+E.sn+":",o,u,p,E);return}else if(p.cc!==E.cc){u.playlistParsingError=is("discontinuity sequence mismatch ("+p.cc+"!="+E.cc+")",o,u,p,E);return}}}}function is(o,u,a,r,t){return new Error(o+" "+t.url+`
Playlist starting @`+u.startSN+`
`+u.m3u8+`

Playlist starting @`+a.startSN+`
`+a.m3u8)}function ns(o,u,a){a===void 0&&(a=!0);var r=u.startSN+u.skippedSegments-o.startSN,t=o.fragments,i=r>=0,l=0;if(i&&r<t.length)l=t[r].start;else if(i&&u.startSN===o.endSN+1)l=o.fragmentEnd;else if(i&&a)l=o.fragmentStart+r*u.levelTargetDuration;else if(!u.skippedSegments&&u.fragmentStart===0)l=o.fragmentStart;else return;Ou(u,l)}function Ou(o,u){if(u){for(var a=o.fragments,r=o.skippedSegments;r<a.length;r++)a[r].addStart(u);o.fragmentHint&&o.fragmentHint.addStart(u)}}function as(o,u){u===void 0&&(u=1/0);var a=1e3*o.targetduration;if(o.updated){var r=o.fragments,t=4;if(r.length&&a*t>u){var i=r[r.length-1].duration*1e3;i<a&&(a=i)}}else a/=2;return Math.round(a)}function Mu(o,u,a){if(!o)return null;var r=o.fragments[u-o.startSN];return r||(r=o.fragmentHint,r&&r.sn===u)?r:u<o.startSN&&a&&a.sn===u?a:null}function ss(o,u,a){return o?os(o.partList,u,a):null}function os(o,u,a){if(o)for(var r=o.length;r--;){var t=o[r];if(t.index===a&&t.fragment.sn===u)return t}return null}function ls(o){o.forEach(function(u,a){var r;(r=u.details)==null||r.fragments.forEach(function(t){t.level=a,t.initSegment&&(t.initSegment.level=a)})})}var Fu=3e5,Nu=function(o){function u(r){var t;return t=o.call(this,"content-steering",r.logger)||this,t.hls=void 0,t.loader=null,t.uri=null,t.pathwayId=".",t._pathwayPriority=null,t.timeToLoad=300,t.reloadTimer=-1,t.updated=0,t.started=!1,t.enabled=!0,t.levels=null,t.audioTracks=null,t.subtitleTracks=null,t.penalizedPathways={},t.hls=r,t.registerListeners(),t}C(u,o);var a=u.prototype;return a.registerListeners=function(){var t=this.hls;t.on(P.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(P.MANIFEST_PARSED,this.onManifestParsed,this),t.on(P.ERROR,this.onError,this)},a.unregisterListeners=function(){var t=this.hls;t&&(t.off(P.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(P.MANIFEST_PARSED,this.onManifestParsed,this),t.off(P.ERROR,this.onError,this))},a.pathways=function(){return(this.levels||[]).reduce(function(t,i){return t.indexOf(i.pathwayId)===-1&&t.push(i.pathwayId),t},[])},a.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var t=this.timeToLoad*1e3-(performance.now()-this.updated);if(t>0){this.scheduleRefresh(this.uri,t);return}}this.loadSteeringManifest(this.uri)}},a.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},a.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},a.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},a.removeLevel=function(t){var i=this.levels;i&&(this.levels=i.filter(function(l){return l!==t}))},a.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},a.onManifestLoaded=function(t,i){var l=i.contentSteering;l!==null&&(this.pathwayId=l.pathwayId,this.uri=l.uri,this.started&&this.startLoad())},a.onManifestParsed=function(t,i){this.audioTracks=i.audioTracks,this.subtitleTracks=i.subtitleTracks},a.onError=function(t,i){var l=i.errorAction;if(l?.action===st.SendAlternateToPenaltyBox&&l.flags===Rt.MoveAllAlternatesMatchingHost){var f=this.levels,h=this._pathwayPriority,g=this.pathwayId;if(i.context){var p=i.context,E=p.groupId,x=p.pathwayId,b=p.type;E&&f?g=this.getPathwayForGroupId(E,b,g):x&&(g=x)}g in this.penalizedPathways||(this.penalizedPathways[g]=performance.now()),!h&&f&&(h=this.pathways()),h&&h.length>1&&(this.updatePathwayPriority(h),l.resolved=this.pathwayId!==g),l.resolved||this.warn("Could not resolve "+i.details+' ("'+i.error.message+'") with content-steering for Pathway: '+g+" levels: "+(f&&f.length)+" priorities: "+ct(h)+" penalized: "+ct(this.penalizedPathways))}},a.filterParsedLevels=function(t){this.levels=t;var i=this.getLevelsForPathway(this.pathwayId);if(i.length===0){var l=t[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+l+'"'),i=this.getLevelsForPathway(l),this.pathwayId=l}return i.length!==t.length&&this.log("Found "+i.length+"/"+t.length+' levels in Pathway "'+this.pathwayId+'"'),i},a.getLevelsForPathway=function(t){return this.levels===null?[]:this.levels.filter(function(i){return t===i.pathwayId})},a.updatePathwayPriority=function(t){this._pathwayPriority=t;var i,l=this.penalizedPathways,f=performance.now();Object.keys(l).forEach(function(b){f-l[b]>Fu&&delete l[b]});for(var h=0;h<t.length;h++){var g=t[h];if(!(g in l)){if(g===this.pathwayId)return;var p=this.hls.nextLoadLevel,E=this.hls.levels[p];if(i=this.getLevelsForPathway(g),i.length>0){this.log('Setting Pathway to "'+g+'"'),this.pathwayId=g,ls(i),this.hls.trigger(P.LEVELS_UPDATED,{levels:i});var x=this.hls.levels[p];E&&x&&this.levels&&(x.attrs["STABLE-VARIANT-ID"]!==E.attrs["STABLE-VARIANT-ID"]&&x.bitrate!==E.bitrate&&this.log("Unstable Pathways change from bitrate "+E.bitrate+" to "+x.bitrate),this.hls.nextLoadLevel=p);break}}}},a.getPathwayForGroupId=function(t,i,l){for(var f=this.getLevelsForPathway(l).concat(this.levels||[]),h=0;h<f.length;h++)if(i===Pe.AUDIO_TRACK&&f[h].hasAudioGroup(t)||i===Pe.SUBTITLE_TRACK&&f[h].hasSubtitleGroup(t))return f[h].pathwayId;return l},a.clonePathways=function(t){var i=this,l=this.levels;if(l){var f={},h={};t.forEach(function(g){var p=g.ID,E=g["BASE-ID"],x=g["URI-REPLACEMENT"];if(!l.some(function(_){return _.pathwayId===p})){var b=i.getLevelsForPathway(E).map(function(_){var L=new Ze(_.attrs);L["PATHWAY-ID"]=p;var k=L.AUDIO&&L.AUDIO+"_clone_"+p,I=L.SUBTITLES&&L.SUBTITLES+"_clone_"+p;k&&(f[L.AUDIO]=k,L.AUDIO=k),I&&(h[L.SUBTITLES]=I,L.SUBTITLES=I);var w=fs(_.uri,L["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",x),O=new Pa({attrs:L,audioCodec:_.audioCodec,bitrate:_.bitrate,height:_.height,name:_.name,url:w,videoCodec:_.videoCodec,width:_.width});if(_.audioGroups)for(var D=1;D<_.audioGroups.length;D++)O.addGroupId("audio",_.audioGroups[D]+"_clone_"+p);if(_.subtitleGroups)for(var M=1;M<_.subtitleGroups.length;M++)O.addGroupId("text",_.subtitleGroups[M]+"_clone_"+p);return O});l.push.apply(l,b),us(i.audioTracks,f,x,p),us(i.subtitleTracks,h,x,p)}})}},a.loadSteeringManifest=function(t){var i=this,l=this.hls.config,f=l.loader;this.loader&&this.loader.destroy(),this.loader=new f(l);var h;try{h=new self.URL(t)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+t);return}if(h.protocol!=="data:"){var g=(this.hls.bandwidthEstimate||l.abrEwmaDefaultEstimate)|0;h.searchParams.set("_HLS_pathway",this.pathwayId),h.searchParams.set("_HLS_throughput",""+g)}var p={responseType:"json",url:h.href},E=l.steeringManifestLoadPolicy.default,x=E.errorRetry||E.timeoutRetry||{},b={loadPolicy:E,timeout:E.maxLoadTimeMs,maxRetry:x.maxNumRetry||0,retryDelay:x.retryDelayMs||0,maxRetryDelay:x.maxRetryDelayMs||0},_={onSuccess:function(k,I,w,O){i.log('Loaded steering manifest: "'+h+'"');var D=k.data;if(D?.VERSION!==1){i.log("Steering VERSION "+D.VERSION+" not supported!");return}i.updated=performance.now(),i.timeToLoad=D.TTL;var M=D["RELOAD-URI"],G=D["PATHWAY-CLONES"],N=D["PATHWAY-PRIORITY"];if(M)try{i.uri=new self.URL(M,h).href}catch{i.enabled=!1,i.log("Failed to parse Steering Manifest RELOAD-URI: "+M);return}i.scheduleRefresh(i.uri||w.url),G&&i.clonePathways(G);var H={steeringManifest:D,url:h.toString()};i.hls.trigger(P.STEERING_MANIFEST_LOADED,H),N&&i.updatePathwayPriority(N)},onError:function(k,I,w,O){if(i.log("Error loading steering manifest: "+k.code+" "+k.text+" ("+I.url+")"),i.stopLoad(),k.code===410){i.enabled=!1,i.log("Steering manifest "+I.url+" no longer available");return}var D=i.timeToLoad*1e3;if(k.code===429){var M=i.loader;if(typeof M?.getResponseHeader=="function"){var G=M.getResponseHeader("Retry-After");G&&(D=parseFloat(G)*1e3)}i.log("Steering manifest "+I.url+" rate limited");return}i.scheduleRefresh(i.uri||I.url,D)},onTimeout:function(k,I,w){i.log("Timeout loading steering manifest ("+I.url+")"),i.scheduleRefresh(i.uri||I.url)}};this.log("Requesting steering manifest: "+h),this.loader.load(p,b,_)},a.scheduleRefresh=function(t,i){var l=this;i===void 0&&(i=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var f,h=(f=l.hls)==null?void 0:f.media;if(h&&!h.ended){l.loadSteeringManifest(t);return}l.scheduleRefresh(t,l.timeToLoad*1e3)},i)},c(u,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(t){this.updatePathwayPriority(t)}}])}(gr);function us(o,u,a,r){o&&Object.keys(u).forEach(function(t){var i=o.filter(function(l){return l.groupId===t}).map(function(l){var f=T({},l);return f.details=void 0,f.attrs=new Ze(f.attrs),f.url=f.attrs.URI=fs(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",a),f.groupId=f.attrs["GROUP-ID"]=u[t],f.attrs["PATHWAY-ID"]=r,f});o.push.apply(o,i)})}function fs(o,u,a,r){var t=r.HOST,i=r.PARAMS,l=r[a],f;u&&(f=l?.[u],f&&(o=f));var h=new self.URL(o);return t&&!f&&(h.host=t),i&&Object.keys(i).sort().forEach(function(g){g&&h.searchParams.set(g,i[g])}),h.href}var Bu=function(){function o(a){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=a,this.registerListeners()}var u=o.prototype;return u.setStreamController=function(r){this.streamController=r},u.registerListeners=function(){this.hls.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(P.MEDIA_DETACHING,this.onMediaDetaching,this)},u.unregisterListeners=function(){this.hls.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(P.MEDIA_DETACHING,this.onMediaDetaching,this)},u.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},u.onMediaAttaching=function(r,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var l=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=l,l&&typeof l.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},u.onMediaDetaching=function(){this.media=null},u.checkFPS=function(r,t,i){var l=performance.now();if(t){if(this.lastTime){var f=l-this.lastTime,h=i-this.lastDroppedFrames,g=t-this.lastDecodedFrames,p=1e3*h/f,E=this.hls;if(E.trigger(P.FPS_DROP,{currentDropped:h,currentDecoded:g,totalDroppedFrames:i}),p>0&&h>E.config.fpsDroppedMonitoringThreshold*g){var x=E.currentLevel;E.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+x),x>0&&(E.autoLevelCapping===-1||E.autoLevelCapping>=x)&&(x=x-1,E.trigger(P.FPS_DROP_LEVEL_CAPPING,{level:x,droppedLevel:E.currentLevel}),E.autoLevelCapping=x,this.streamController.nextLevelSwitch())}}this.lastTime=l,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},u.checkFPSInterval=function(){var r=this.media;if(r)if(this.isVideoPlaybackQualityAvailable){var t=r.getVideoPlaybackQuality();this.checkFPS(r,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},o}(),Uu=function(){function o(){this.chunks=[],this.dataLength=0}var u=o.prototype;return u.push=function(r){this.chunks.push(r),this.dataLength+=r.length},u.flush=function(){var r=this.chunks,t=this.dataLength,i;if(r.length)r.length===1?i=r[0]:i=Hu(r,t);else return new Uint8Array(0);return this.reset(),i},u.reset=function(){this.chunks.length=0,this.dataLength=0},o}();function Hu(o,u){for(var a=new Uint8Array(u),r=0,t=0;t<o.length;t++){var i=o[t];a.set(i,r),r+=i.length}return a}function cs(o,u){return u+10<=o.length&&o[u]===51&&o[u+1]===68&&o[u+2]===73&&o[u+3]<255&&o[u+4]<255&&o[u+6]<128&&o[u+7]<128&&o[u+8]<128&&o[u+9]<128}function tn(o,u){return u+10<=o.length&&o[u]===73&&o[u+1]===68&&o[u+2]===51&&o[u+3]<255&&o[u+4]<255&&o[u+6]<128&&o[u+7]<128&&o[u+8]<128&&o[u+9]<128}function ni(o,u){var a=0;return a=(o[u]&127)<<21,a|=(o[u+1]&127)<<14,a|=(o[u+2]&127)<<7,a|=o[u+3]&127,a}function ai(o,u){for(var a=u,r=0;tn(o,u);){r+=10;var t=ni(o,u+6);r+=t,cs(o,u+10)&&(r+=10),u+=r}if(r>0)return o.subarray(a,a+r)}function Gu(o,u,a,r){var t=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=u[a+2],l=i>>2&15;if(l>12){var f=new Error("invalid ADTS sampling index:"+l);o.emit(P.ERROR,P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}var h=(i>>6&3)+1,g=u[a+3]>>6&3|(i&1)<<2,p="mp4a.40."+h,E=t[l],x=l;(h===5||h===29)&&(x-=3);var b=[h<<3|(x&14)>>1,(x&1)<<7|g<<3];return Oe.log("manifest codec:"+r+", parsed codec:"+p+", channels:"+g+", rate:"+E+" (ADTS object type:"+h+" sampling index:"+l+")"),{config:b,samplerate:E,channelCount:g,codec:p,parsedCodec:p,manifestCodec:r}}function hs(o,u){return o[u]===255&&(o[u+1]&246)===240}function ds(o,u){return o[u+1]&1?7:9}function rn(o,u){return(o[u+3]&3)<<11|o[u+4]<<3|(o[u+5]&224)>>>5}function Vu(o,u){return u+5<o.length}function si(o,u){return u+1<o.length&&hs(o,u)}function Ku(o,u){return Vu(o,u)&&hs(o,u)&&rn(o,u)<=o.length-u}function Wu(o,u){if(si(o,u)){var a=ds(o,u);if(u+a>=o.length)return!1;var r=rn(o,u);if(r<=a)return!1;var t=u+r;return t===o.length||si(o,t)}return!1}function vs(o,u,a,r,t){if(!o.samplerate){var i=Gu(u,a,r,t);if(!i)return;T(o,i)}}function gs(o){return 1024*9e4/o}function ju(o,u){var a=ds(o,u);if(u+a<=o.length){var r=rn(o,u)-a;if(r>0)return{headerLength:a,frameLength:r}}}function ps(o,u,a,r,t){var i=gs(o.samplerate),l=r+t*i,f=ju(u,a),h;if(f){var g=f.frameLength,p=f.headerLength,E=p+g,x=Math.max(0,a+E-u.length);x?(h=new Uint8Array(E-p),h.set(u.subarray(a+p,u.length),0)):h=u.subarray(a+p,a+E);var b={unit:h,pts:l};return x||o.samples.push(b),{sample:b,length:E,missing:x}}var _=u.length-a;h=new Uint8Array(_),h.set(u.subarray(a,u.length),0);var L={unit:h,pts:l};return{sample:L,length:_,missing:-1}}function Yu(o,u){return tn(o,u)&&ni(o,u+6)+10<=o.length-u}function zu(o){if(!(o.size<2)){var u=At(o.data,!0),a=new Uint8Array(o.data.subarray(u.length+1));return{key:o.type,info:u,data:a.buffer}}}function $u(o){if(!(o.size<2)){if(o.type==="TXXX"){var u=1,a=At(o.data.subarray(u),!0);u+=a.length+1;var r=At(o.data.subarray(u));return{key:o.type,info:a,data:r}}var t=At(o.data.subarray(1));return{key:o.type,info:"",data:t}}}function qu(o){if(o.type==="WXXX"){if(o.size<2)return;var u=1,a=At(o.data.subarray(u),!0);u+=a.length+1;var r=At(o.data.subarray(u));return{key:o.type,info:a,data:r}}var t=At(o.data);return{key:o.type,info:"",data:t}}function Xu(o){return o instanceof ArrayBuffer?o:o.byteOffset==0&&o.byteLength==o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer}function nn(o,u,a){return u===void 0&&(u=0),a===void 0&&(a=1/0),Qu(o,u,a,Uint8Array)}function Qu(o,u,a,r){var t=Zu(o),i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);var l=Ju(o)?o.byteOffset:0,f=(l+o.byteLength)/i,h=(l+u)/i,g=Math.floor(Math.max(0,Math.min(h,f))),p=Math.floor(Math.min(g+Math.max(a,0),f));return new r(t,g,p-g)}function Zu(o){return o instanceof ArrayBuffer?o:o.buffer}function Ju(o){return o&&o.buffer instanceof ArrayBuffer&&o.byteLength!==void 0&&o.byteOffset!==void 0}function ef(o){var u={key:o.type,description:"",data:"",mimeType:null,pictureType:null},a=3;if(!(o.size<2)){if(o.data[0]!==a){console.log("Ignore frame with unrecognized character encoding");return}var r=o.data.subarray(1).indexOf(0);if(r!==-1){var t=At(nn(o.data,1,r)),i=o.data[2+r],l=o.data.subarray(3+r).indexOf(0);if(l!==-1){var f=At(nn(o.data,3+r,l)),h;return t==="-->"?h=At(nn(o.data,4+r+l)):h=Xu(o.data.subarray(4+r+l)),u.mimeType=t,u.pictureType=i,u.description=f,u.data=h,u}}}}function tf(o){return o.type==="PRIV"?zu(o):o.type[0]==="W"?qu(o):o.type==="APIC"?ef(o):$u(o)}function rf(o){var u=String.fromCharCode(o[0],o[1],o[2],o[3]),a=ni(o,4),r=10;return{type:u,size:a,data:o.subarray(r,r+a)}}var oi=10,nf=10;function ms(o){for(var u=0,a=[];tn(o,u);){var r=ni(o,u+6);o[u+5]>>6&1&&(u+=oi),u+=oi;for(var t=u+r;u+nf<t;){var i=rf(o.subarray(u)),l=tf(i);l&&a.push(l),u+=i.size+oi}cs(o,u)&&(u+=oi)}return a}function ys(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"}function af(o){if(o.data.byteLength===8){var u=new Uint8Array(o.data),a=u[3]&1,r=(u[4]<<23)+(u[5]<<15)+(u[6]<<7)+u[7];return r/=45,a&&(r+=4772185884e-2),Math.round(r)}}function Es(o){for(var u=ms(o),a=0;a<u.length;a++){var r=u[a];if(ys(r))return af(r)}}var St=function(o){return o.audioId3="org.id3",o.dateRange="com.apple.quicktime.HLS",o.emsg="https://aomedia.org/emsg/ID3",o.misbklv="urn:misb:KLV:bin:1910.1",o}({});function Bt(o,u){return o===void 0&&(o=""),u===void 0&&(u=9e4),{type:o,id:-1,pid:-1,inputTimeScale:u,sequenceNumber:-1,samples:[],dropped:0}}var Ts=function(){function o(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var u=o.prototype;return u.resetInitSegment=function(r,t,i,l){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},u.resetTimeStamp=function(r){this.initPTS=r,this.resetContiguity()},u.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},u.canParse=function(r,t){return!1},u.appendFrame=function(r,t,i){},u.demux=function(r,t){this.cachedData&&(r=kt(this.cachedData,r),this.cachedData=null);var i=ai(r,0),l=i?i.length:0,f,h=this._audioTrack,g=this._id3Track,p=i?Es(i):void 0,E=r.length;for((this.basePTS===null||this.frameIndex===0&&ae(p))&&(this.basePTS=sf(p,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&g.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:St.audioId3,duration:Number.POSITIVE_INFINITY});l<E;){if(this.canParse(r,l)){var x=this.appendFrame(h,r,l);x?(this.frameIndex++,this.lastPTS=x.sample.pts,l+=x.length,f=l):l=E}else Yu(r,l)?(i=ai(r,l),g.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:St.audioId3,duration:Number.POSITIVE_INFINITY}),l+=i.length,f=l):l++;if(l===E&&f!==E){var b=r.slice(f);this.cachedData?this.cachedData=kt(this.cachedData,b):this.cachedData=b}}return{audioTrack:h,videoTrack:Bt(),id3Track:g,textTrack:Bt()}},u.demuxSampleAes=function(r,t,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},u.flush=function(r){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Bt(),id3Track:this._id3Track,textTrack:Bt()}},u.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},o}(),sf=function(u,a,r){if(ae(u))return u*90;var t=r?r.baseTime*9e4/r.timescale:0;return a*9e4+t},li=null,of=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],lf=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],uf=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ff=[0,1,1,4];function Ss(o,u,a,r,t){if(!(a+24>u.length)){var i=xs(u,a);if(i&&a+i.frameLength<=u.length){var l=i.samplesPerFrame*9e4/i.sampleRate,f=r+t*l,h={unit:u.subarray(a,a+i.frameLength),pts:f,dts:f};return o.config=[],o.channelCount=i.channelCount,o.samplerate=i.sampleRate,o.samples.push(h),{sample:h,length:i.frameLength,missing:0}}}}function xs(o,u){var a=o[u+1]>>3&3,r=o[u+1]>>1&3,t=o[u+2]>>4&15,i=o[u+2]>>2&3;if(a!==1&&t!==0&&t!==15&&i!==3){var l=o[u+2]>>1&1,f=o[u+3]>>6,h=a===3?3-r:r===3?3:4,g=of[h*14+t-1]*1e3,p=a===3?0:a===2?1:2,E=lf[p*3+i],x=f===3?1:2,b=uf[a][r],_=ff[r],L=b*8*_,k=Math.floor(b*g/E+l)*_;if(li===null){var I=navigator.userAgent||"",w=I.match(/Chrome\/(\d+)/i);li=w?parseInt(w[1]):0}var O=!!li&&li<=87;return O&&r===2&&g>=224e3&&f===0&&(o[u+3]=o[u+3]|128),{sampleRate:E,channelCount:x,frameLength:k,samplesPerFrame:L}}}function an(o,u){return o[u]===255&&(o[u+1]&224)===224&&(o[u+1]&6)!==0}function _s(o,u){return u+1<o.length&&an(o,u)}function cf(o,u){var a=4;return an(o,u)&&a<=o.length-u}function bs(o,u){if(u+1<o.length&&an(o,u)){var a=4,r=xs(o,u),t=a;r!=null&&r.frameLength&&(t=r.frameLength);var i=u+t;return i===o.length||_s(o,i)}return!1}var hf=function(o){function u(r,t){var i;return i=o.call(this)||this,i.observer=void 0,i.config=void 0,i.observer=r,i.config=t,i}C(u,o);var a=u.prototype;return a.resetInitSegment=function(t,i,l,f){o.prototype.resetInitSegment.call(this,t,i,l,f),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:f,inputTimeScale:9e4,dropped:0}},u.probe=function(t,i){if(!t)return!1;var l=ai(t,0),f=l?.length||0;if(bs(t,f))return!1;for(var h=t.length;f<h;f++)if(Wu(t,f))return i.log("ADTS sync word found !"),!0;return!1},a.canParse=function(t,i){return Ku(t,i)},a.appendFrame=function(t,i,l){vs(t,this.observer,i,l,t.manifestCodec);var f=ps(t,i,l,this.basePTS,this.frameIndex);if(f&&f.missing===0)return f},u}(Ts),df=function(u,a){var r=0,t=5;a+=t;for(var i=new Uint32Array(1),l=new Uint32Array(1),f=new Uint8Array(1);t>0;){f[0]=u[a];var h=Math.min(t,8),g=8-h;l[0]=4278190080>>>24+g<<g,i[0]=(f[0]&l[0])>>g,r=r?r<<h|i[0]:i[0],a+=1,t-=h}return r},vf=function(o){function u(){return o.apply(this,arguments)||this}C(u,o);var a=u.prototype;return a.resetInitSegment=function(t,i,l,f){o.prototype.resetInitSegment.call(this,t,i,l,f),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:f,inputTimeScale:9e4,dropped:0}},u.probe=function(t){if(!t)return!1;var i=ai(t,0),l=i?.length||0;if(i&&t[l]===11&&t[l+1]===119&&Es(i)!==void 0&&df(t,l)<=16)return!1;for(var f=t.length;l<f;l++)if(bs(t,l))return Oe.log("MPEG Audio sync word found !"),!0;return!1},a.canParse=function(t,i){return cf(t,i)},a.appendFrame=function(t,i,l){if(this.basePTS!==null)return Ss(t,i,l,this.basePTS,this.frameIndex)},u}(Ts),gf=function(){function o(a,r,t){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=a,this.aesIV=r,this.aesMode=t}var u=o.prototype;return u.decrypt=function(r,t){switch(this.aesMode){case Jt.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,r);case Jt.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,r);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},o}();function pf(o){var u=o.byteLength,a=u&&new DataView(o.buffer).getUint8(u-1);return a?o.slice(0,u-a):o}var mf=function(){function o(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var u=o.prototype;return u.uint8ArrayToUint32Array_=function(r){for(var t=new DataView(r),i=new Uint32Array(4),l=0;l<4;l++)i[l]=t.getUint32(l*4);return i},u.initTable=function(){var r=this.sBox,t=this.invSBox,i=this.subMix,l=i[0],f=i[1],h=i[2],g=i[3],p=this.invSubMix,E=p[0],x=p[1],b=p[2],_=p[3],L=new Uint32Array(256),k=0,I=0,w=0;for(w=0;w<256;w++)w<128?L[w]=w<<1:L[w]=w<<1^283;for(w=0;w<256;w++){var O=I^I<<1^I<<2^I<<3^I<<4;O=O>>>8^O&255^99,r[k]=O,t[O]=k;var D=L[k],M=L[D],G=L[M],N=L[O]*257^O*16843008;l[k]=N<<24|N>>>8,f[k]=N<<16|N>>>16,h[k]=N<<8|N>>>24,g[k]=N,N=G*16843009^M*65537^D*257^k*16843008,E[O]=N<<24|N>>>8,x[O]=N<<16|N>>>16,b[O]=N<<8|N>>>24,_[O]=N,k?(k=D^L[L[L[G^D]]],I^=L[L[I]]):k=I=1}},u.expandKey=function(r){for(var t=this.uint8ArrayToUint32Array_(r),i=!0,l=0;l<t.length&&i;)i=t[l]===this.key[l],l++;if(!i){this.key=t;var f=this.keySize=t.length;if(f!==4&&f!==6&&f!==8)throw new Error("Invalid aes key size="+f);var h=this.ksRows=(f+6+1)*4,g,p,E=this.keySchedule=new Uint32Array(h),x=this.invKeySchedule=new Uint32Array(h),b=this.sBox,_=this.rcon,L=this.invSubMix,k=L[0],I=L[1],w=L[2],O=L[3],D,M;for(g=0;g<h;g++){if(g<f){D=E[g]=t[g];continue}M=D,g%f===0?(M=M<<8|M>>>24,M=b[M>>>24]<<24|b[M>>>16&255]<<16|b[M>>>8&255]<<8|b[M&255],M^=_[g/f|0]<<24):f>6&&g%f===4&&(M=b[M>>>24]<<24|b[M>>>16&255]<<16|b[M>>>8&255]<<8|b[M&255]),E[g]=D=(E[g-f]^M)>>>0}for(p=0;p<h;p++)g=h-p,p&3?M=E[g]:M=E[g-4],p<4||g<=4?x[p]=M:x[p]=k[b[M>>>24]]^I[b[M>>>16&255]]^w[b[M>>>8&255]]^O[b[M&255]],x[p]=x[p]>>>0}},u.networkToHostOrderSwap=function(r){return r<<24|(r&65280)<<8|(r&16711680)>>8|r>>>24},u.decrypt=function(r,t,i){for(var l=this.keySize+6,f=this.invKeySchedule,h=this.invSBox,g=this.invSubMix,p=g[0],E=g[1],x=g[2],b=g[3],_=this.uint8ArrayToUint32Array_(i),L=_[0],k=_[1],I=_[2],w=_[3],O=new Int32Array(r),D=new Int32Array(O.length),M,G,N,H,X,Y,V,j,Q,se,re,Z,oe,le,ue=this.networkToHostOrderSwap;t<O.length;){for(Q=ue(O[t]),se=ue(O[t+1]),re=ue(O[t+2]),Z=ue(O[t+3]),X=Q^f[0],Y=Z^f[1],V=re^f[2],j=se^f[3],oe=4,le=1;le<l;le++)M=p[X>>>24]^E[Y>>16&255]^x[V>>8&255]^b[j&255]^f[oe],G=p[Y>>>24]^E[V>>16&255]^x[j>>8&255]^b[X&255]^f[oe+1],N=p[V>>>24]^E[j>>16&255]^x[X>>8&255]^b[Y&255]^f[oe+2],H=p[j>>>24]^E[X>>16&255]^x[Y>>8&255]^b[V&255]^f[oe+3],X=M,Y=G,V=N,j=H,oe=oe+4;M=h[X>>>24]<<24^h[Y>>16&255]<<16^h[V>>8&255]<<8^h[j&255]^f[oe],G=h[Y>>>24]<<24^h[V>>16&255]<<16^h[j>>8&255]<<8^h[X&255]^f[oe+1],N=h[V>>>24]<<24^h[j>>16&255]<<16^h[X>>8&255]<<8^h[Y&255]^f[oe+2],H=h[j>>>24]<<24^h[X>>16&255]<<16^h[Y>>8&255]<<8^h[V&255]^f[oe+3],D[t]=ue(M^L),D[t+1]=ue(H^k),D[t+2]=ue(N^I),D[t+3]=ue(G^w),L=Q,k=se,I=re,w=Z,t=t+4}return D.buffer},o}(),yf=function(){function o(a,r,t){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=a,this.key=r,this.aesMode=t}var u=o.prototype;return u.expandKey=function(){var r=Ef(this.aesMode);return this.subtle.importKey("raw",this.key,{name:r},!1,["encrypt","decrypt"])},o}();function Ef(o){switch(o){case Jt.cbc:return"AES-CBC";case Jt.ctr:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+o)}}var Tf=16,sn=function(){function o(a,r){var t=r===void 0?{}:r,i=t.removePKCS7Padding,l=i===void 0?!0:i;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=a.enableSoftwareAES,this.removePKCS7Padding=l,l)try{var f=self.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var u=o.prototype;return u.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},u.isSync=function(){return this.useSoftware},u.flush=function(){var r=this.currentResult,t=this.remainderData;if(!r||t)return this.reset(),null;var i=new Uint8Array(r);return this.reset(),this.removePKCS7Padding?pf(i):i},u.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},u.decrypt=function(r,t,i,l){var f=this;return this.useSoftware?new Promise(function(h,g){var p=ArrayBuffer.isView(r)?r:new Uint8Array(r);f.softwareDecrypt(p,t,i,l);var E=f.flush();E?h(E.buffer):g(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(r),t,i,l)},u.softwareDecrypt=function(r,t,i,l){var f=this.currentIV,h=this.currentResult,g=this.remainderData;if(l!==Jt.cbc||t.byteLength!==16)return Oe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),g&&(r=kt(g,r),this.remainderData=null);var p=this.getValidChunk(r);if(!p.length)return null;f&&(i=f);var E=this.softwareDecrypter;E||(E=this.softwareDecrypter=new mf),E.expandKey(t);var x=h;return this.currentResult=E.decrypt(p.buffer,0,i),this.currentIV=p.slice(-16).buffer,x||null},u.webCryptoDecrypt=function(r,t,i,l){var f=this;if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(r,t,i,l));this.key=t,this.fastAesKey=new yf(this.subtle,t,l)}return this.fastAesKey.expandKey().then(function(h){if(!f.subtle)return Promise.reject(new Error("web crypto not initialized"));f.logOnce("WebCrypto AES decrypt");var g=new gf(f.subtle,new Uint8Array(i),l);return g.decrypt(r.buffer,h)}).catch(function(h){return Oe.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+h.name+": "+h.message),f.onWebCryptoError(r,t,i,l)})},u.onWebCryptoError=function(r,t,i,l){var f=this.enableSoftwareAES;if(f){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,t,i,l);var h=this.flush();if(h)return h.buffer}throw new Error("WebCrypto"+(f?" and softwareDecrypt":"")+": failed to decrypt data")},u.getValidChunk=function(r){var t=r,i=r.length-r.length%Tf;return i!==r.length&&(t=r.slice(0,i),this.remainderData=r.slice(i)),t},u.logOnce=function(r){this.logEnabled&&(Oe.log("[decrypter]: "+r),this.logEnabled=!1)},o}(),Sf=/\/emsg[-/]ID3/i,xf=function(){function o(a,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}var u=o.prototype;return u.resetTimeStamp=function(){},u.resetInitSegment=function(r,t,i,l){var f=this.videoTrack=Bt("video",1),h=this.audioTrack=Bt("audio",1),g=this.txtTrack=Bt("text",1);if(this.id3Track=Bt("id3",1),this.timeOffset=0,!!(r!=null&&r.byteLength)){var p=Ea(r);if(p.video){var E=p.video,x=E.id,b=E.timescale,_=E.codec,L=E.supplemental;f.id=x,f.timescale=g.timescale=b,f.codec=_,f.supplemental=L}if(p.audio){var k=p.audio,I=k.id,w=k.timescale,O=k.codec;h.id=I,h.timescale=w,h.codec=O}g.id=ga.text,f.sampleDuration=0,f.duration=h.duration=l}},u.resetContiguity=function(){this.remainderData=null},o.probe=function(r){return Ol(r)},u.demux=function(r,t){this.timeOffset=t;var i=r,l=this.videoTrack,f=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=kt(this.remainderData,r));var h=Kl(i);this.remainderData=h.remainder,l.samples=h.valid||new Uint8Array}else l.samples=i;var g=this.extractID3Track(l,t);return f.samples=Ta(t,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:g,textTrack:this.txtTrack}},u.flush=function(){var r=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(t,this.timeOffset);return i.samples=Ta(r,t),{videoTrack:t,audioTrack:Bt(),id3Track:l,textTrack:Bt()}},u.extractID3Track=function(r,t){var i=this,l=this.id3Track;if(r.samples.length){var f=Se(r.samples,["emsg"]);f&&f.forEach(function(h){var g=jl(h);if(Sf.test(g.schemeIdUri)){var p=Ls(g,t),E=g.eventDuration===4294967295?Number.POSITIVE_INFINITY:g.eventDuration/g.timeScale;E<=.001&&(E=Number.POSITIVE_INFINITY);var x=g.payload;l.samples.push({data:x,len:x.byteLength,dts:p,pts:p,type:St.emsg,duration:E})}else if(i.config.enableEmsgKLVMetadata&&g.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var b=Ls(g,t);l.samples.push({data:g.payload,len:g.payload.byteLength,dts:b,pts:b,type:St.misbklv,duration:Number.POSITIVE_INFINITY})}})}return l},u.demuxSampleAes=function(r,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},u.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},o}();function Ls(o,u){return ae(o.presentationTime)?o.presentationTime/o.timeScale:u+o.presentationTimeDelta/o.timeScale}var _f=function(){function o(a,r,t){this.keyData=void 0,this.decrypter=void 0,this.keyData=t,this.decrypter=new sn(r,{removePKCS7Padding:!1})}var u=o.prototype;return u.decryptBuffer=function(r){return this.decrypter.decrypt(r,this.keyData.key.buffer,this.keyData.iv.buffer,Jt.cbc)},u.decryptAacSample=function(r,t,i){var l=this,f=r[t].unit;if(!(f.length<=16)){var h=f.subarray(16,f.length-f.length%16),g=h.buffer.slice(h.byteOffset,h.byteOffset+h.length);this.decryptBuffer(g).then(function(p){var E=new Uint8Array(p);f.set(E,16),l.decrypter.isSync()||l.decryptAacSamples(r,t+1,i)})}},u.decryptAacSamples=function(r,t,i){for(;;t++){if(t>=r.length){i();return}if(!(r[t].unit.length<32)&&(this.decryptAacSample(r,t,i),!this.decrypter.isSync()))return}},u.getAvcEncryptedData=function(r){for(var t=Math.floor((r.length-48)/160)*16+16,i=new Int8Array(t),l=0,f=32;f<r.length-16;f+=160,l+=16)i.set(r.subarray(f,f+16),l);return i},u.getAvcDecryptedUnit=function(r,t){for(var i=new Uint8Array(t),l=0,f=32;f<r.length-16;f+=160,l+=16)r.set(i.subarray(l,l+16),f);return r},u.decryptAvcSample=function(r,t,i,l,f){var h=this,g=xa(f.data),p=this.getAvcEncryptedData(g);this.decryptBuffer(p.buffer).then(function(E){f.data=h.getAvcDecryptedUnit(g,E),h.decrypter.isSync()||h.decryptAvcSamples(r,t,i+1,l)})},u.decryptAvcSamples=function(r,t,i,l){if(r instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=r.length){l();return}for(var f=r[t].units;!(i>=f.length);i++){var h=f[i];if(!(h.data.length<=48||h.type!==1&&h.type!==5)&&(this.decryptAvcSample(r,t,i,l,h),!this.decrypter.isSync()))return}}},o}(),bf=function(){function o(){this.VideoSample=null}var u=o.prototype;return u.createVideoSample=function(r,t,i){return{key:r,frame:!1,pts:t,dts:i,units:[],length:0}},u.getLastNalUnit=function(r){var t,i=this.VideoSample,l;if((!i||i.units.length===0)&&(i=r[r.length-1]),(t=i)!=null&&t.units){var f=i.units;l=f[f.length-1]}return l},u.pushAccessUnit=function(r,t){if(r.units.length&&r.frame){if(r.pts===void 0){var i=t.samples,l=i.length;if(l){var f=i[l-1];r.pts=f.pts,r.dts=f.dts}else{t.dropped++;return}}t.samples.push(r)}},u.parseNALu=function(r,t,i){var l=t.byteLength,f=r.naluState||0,h=f,g=[],p=0,E,x,b,_=-1,L=0;for(f===-1&&(_=0,L=this.getNALuType(t,0),f=0,p=1);p<l;){if(E=t[p++],!f){f=E?0:1;continue}if(f===1){f=E?0:2;continue}if(!E)f=3;else if(E===1){if(x=p-f-1,_>=0){var k={data:t.subarray(_,x),type:L};g.push(k)}else{var I=this.getLastNalUnit(r.samples);I&&(h&&p<=4-h&&I.state&&(I.data=I.data.subarray(0,I.data.byteLength-h)),x>0&&(I.data=kt(I.data,t.subarray(0,x)),I.state=0))}p<l?(b=this.getNALuType(t,p),_=p,L=b,f=0):f=-1}else f=0}if(_>=0&&f>=0){var w={data:t.subarray(_,l),type:L,state:f};g.push(w)}if(g.length===0){var O=this.getLastNalUnit(r.samples);O&&(O.data=kt(O.data,t))}return r.naluState=f,g},o}(),Cs=function(){function o(a){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}var u=o.prototype;return u.loadWord=function(){var r=this.data,t=this.bytesAvailable,i=r.byteLength-t,l=new Uint8Array(4),f=Math.min(4,t);if(f===0)throw new Error("no bytes available");l.set(r.subarray(i,i+f)),this.word=new DataView(l.buffer).getUint32(0),this.bitsAvailable=f*8,this.bytesAvailable-=f},u.skipBits=function(r){var t;r=Math.min(r,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>r?(this.word<<=r,this.bitsAvailable-=r):(r-=this.bitsAvailable,t=r>>3,r-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=r,this.bitsAvailable-=r)},u.readBits=function(r){var t=Math.min(this.bitsAvailable,r),i=this.word>>>32-t;if(r>32&&Oe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=r-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i},u.skipLZ=function(){var r;for(r=0;r<this.bitsAvailable;++r)if((this.word&2147483648>>>r)!==0)return this.word<<=r,this.bitsAvailable-=r,r;return this.loadWord(),r+this.skipLZ()},u.skipUEG=function(){this.skipBits(1+this.skipLZ())},u.skipEG=function(){this.skipBits(1+this.skipLZ())},u.readUEG=function(){var r=this.skipLZ();return this.readBits(r+1)-1},u.readEG=function(){var r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)},u.readBoolean=function(){return this.readBits(1)===1},u.readUByte=function(){return this.readBits(8)},u.readUShort=function(){return this.readBits(16)},u.readUInt=function(){return this.readBits(32)},o}(),As=function(o){function u(){return o.apply(this,arguments)||this}C(u,o);var a=u.prototype;return a.parsePES=function(t,i,l,f){var h=this,g=this.parseNALu(t,l.data,f),p=this.VideoSample,E,x=!1;l.data=null,p&&g.length&&!t.audFound&&(this.pushAccessUnit(p,t),p=this.VideoSample=this.createVideoSample(!1,l.pts,l.dts)),g.forEach(function(b){var _,L;switch(b.type){case 1:{var k=!1;E=!0;var I=b.data;if(x&&I.length>4){var w=h.readSliceType(I);(w===2||w===4||w===7||w===9)&&(k=!0)}if(k){var O;(O=p)!=null&&O.frame&&!p.key&&(h.pushAccessUnit(p,t),p=h.VideoSample=null)}p||(p=h.VideoSample=h.createVideoSample(!0,l.pts,l.dts)),p.frame=!0,p.key=k;break}case 5:E=!0,(_=p)!=null&&_.frame&&!p.key&&(h.pushAccessUnit(p,t),p=h.VideoSample=null),p||(p=h.VideoSample=h.createVideoSample(!0,l.pts,l.dts)),p.key=!0,p.frame=!0;break;case 6:{E=!0,Sa(b.data,1,l.pts,i.samples);break}case 7:{var D,M;E=!0,x=!0;var G=b.data,N=h.readSPS(G);if(!t.sps||t.width!==N.width||t.height!==N.height||((D=t.pixelRatio)==null?void 0:D[0])!==N.pixelRatio[0]||((M=t.pixelRatio)==null?void 0:M[1])!==N.pixelRatio[1]){t.width=N.width,t.height=N.height,t.pixelRatio=N.pixelRatio,t.sps=[G];for(var H=G.subarray(1,4),X="avc1.",Y=0;Y<3;Y++){var V=H[Y].toString(16);V.length<2&&(V="0"+V),X+=V}t.codec=X}break}case 8:E=!0,t.pps=[b.data];break;case 9:E=!0,t.audFound=!0,(L=p)!=null&&L.frame&&(h.pushAccessUnit(p,t),p=null),p||(p=h.VideoSample=h.createVideoSample(!1,l.pts,l.dts));break;case 12:E=!0;break;default:E=!1;break}if(p&&E){var j=p.units;j.push(b)}}),f&&p&&(this.pushAccessUnit(p,t),this.VideoSample=null)},a.getNALuType=function(t,i){return t[i]&31},a.readSliceType=function(t){var i=new Cs(t);return i.readUByte(),i.readUEG(),i.readUEG()},a.skipScalingList=function(t,i){for(var l=8,f=8,h,g=0;g<t;g++)f!==0&&(h=i.readEG(),f=(l+h+256)%256),l=f===0?l:f},a.readSPS=function(t){var i=new Cs(t),l=0,f=0,h=0,g=0,p,E,x,b=i.readUByte.bind(i),_=i.readBits.bind(i),L=i.readUEG.bind(i),k=i.readBoolean.bind(i),I=i.skipBits.bind(i),w=i.skipEG.bind(i),O=i.skipUEG.bind(i),D=this.skipScalingList.bind(this);b();var M=b();if(_(5),I(3),b(),O(),M===100||M===110||M===122||M===244||M===44||M===83||M===86||M===118||M===128){var G=L();if(G===3&&I(1),O(),O(),I(1),k())for(E=G!==3?8:12,x=0;x<E;x++)k()&&(x<6?D(16,i):D(64,i))}O();var N=L();if(N===0)L();else if(N===1)for(I(1),w(),w(),p=L(),x=0;x<p;x++)w();O(),I(1);var H=L(),X=L(),Y=_(1);Y===0&&I(1),I(1),k()&&(l=L(),f=L(),h=L(),g=L());var V=[1,1];if(k()&&k()){var j=b();switch(j){case 1:V=[1,1];break;case 2:V=[12,11];break;case 3:V=[10,11];break;case 4:V=[16,11];break;case 5:V=[40,33];break;case 6:V=[24,11];break;case 7:V=[20,11];break;case 8:V=[32,11];break;case 9:V=[80,33];break;case 10:V=[18,11];break;case 11:V=[15,11];break;case 12:V=[64,33];break;case 13:V=[160,99];break;case 14:V=[4,3];break;case 15:V=[3,2];break;case 16:V=[2,1];break;case 255:{V=[b()<<8|b(),b()<<8|b()];break}}}return{width:Math.ceil((H+1)*16-l*2-f*2),height:(2-Y)*(X+1)*16-(Y?2:4)*(h+g),pixelRatio:V}},u}(bf),rt=188,Lf=function(){function o(a,r,t,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=a,this.config=r,this.typeSupported=t,this.logger=i,this.videoParser=null}o.probe=function(r,t){var i=o.syncOffset(r);return i>0&&t.warn("MPEG2-TS detected but first sync word found @ offset "+i),i!==-1},o.syncOffset=function(r){for(var t=r.length,i=Math.min(rt*5,t-rt)+1,l=0;l<i;){for(var f=!1,h=-1,g=0,p=l;p<t;p+=rt)if(r[p]===71&&(t-p===rt||r[p+rt]===71)){if(g++,h===-1&&(h=p,h!==0&&(i=Math.min(h+rt*99,r.length-rt)+1)),f||(f=on(r,p)===0),f&&g>1&&(h===0&&g>2||p+rt>i))return h}else{if(g)return-1;break}l++}return-1},o.createTrack=function(r,t){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:ga[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?t:void 0}};var u=o.prototype;return u.resetInitSegment=function(r,t,i,l){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=o.createTrack("video"),this._videoTrack.duration=l,this._audioTrack=o.createTrack("audio",l),this._id3Track=o.createTrack("id3"),this._txtTrack=o.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i},u.resetTimeStamp=function(){},u.resetContiguity=function(){var r=this._audioTrack,t=this._videoTrack,i=this._id3Track;r&&(r.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null},u.demux=function(r,t,i,l){i===void 0&&(i=!1),l===void 0&&(l=!1),i||(this.sampleAes=null);var f,h=this._videoTrack,g=this._audioTrack,p=this._id3Track,E=this._txtTrack,x=h.pid,b=h.pesData,_=g.pid,L=p.pid,k=g.pesData,I=p.pesData,w=null,O=this.pmtParsed,D=this._pmtId,M=r.length;if(this.remainderData&&(r=kt(this.remainderData,r),M=r.length,this.remainderData=null),M<rt&&!l)return this.remainderData=r,{audioTrack:g,videoTrack:h,id3Track:p,textTrack:E};var G=Math.max(0,o.syncOffset(r));M-=(M-G)%rt,M<r.byteLength&&!l&&(this.remainderData=new Uint8Array(r.buffer,M,r.buffer.byteLength-M));for(var N=0,H=G;H<M;H+=rt)if(r[H]===71){var X=!!(r[H+1]&64),Y=on(r,H),V=(r[H+3]&48)>>4,j=void 0;if(V>1){if(j=H+5+r[H+4],j===H+rt)continue}else j=H+4;switch(Y){case x:if(X){if(b&&(f=mr(b,this.logger))){if(this.videoParser===null)switch(h.segmentCodec){case"avc":this.videoParser=new As;break}this.videoParser!==null&&this.videoParser.parsePES(h,E,f,!1)}b={data:[],size:0}}b&&(b.data.push(r.subarray(j,H+rt)),b.size+=H+rt-j);break;case _:if(X){if(k&&(f=mr(k,this.logger)))switch(g.segmentCodec){case"aac":this.parseAACPES(g,f);break;case"mp3":this.parseMPEGPES(g,f);break}k={data:[],size:0}}k&&(k.data.push(r.subarray(j,H+rt)),k.size+=H+rt-j);break;case L:X&&(I&&(f=mr(I,this.logger))&&this.parseID3PES(p,f),I={data:[],size:0}),I&&(I.data.push(r.subarray(j,H+rt)),I.size+=H+rt-j);break;case 0:X&&(j+=r[j]+1),D=this._pmtId=Cf(r,j);break;case D:{X&&(j+=r[j]+1);var Q=Af(r,j,this.typeSupported,i,this.observer,this.logger);x=Q.videoPid,x>0&&(h.pid=x,h.segmentCodec=Q.segmentVideoCodec),_=Q.audioPid,_>0&&(g.pid=_,g.segmentCodec=Q.segmentAudioCodec),L=Q.id3Pid,L>0&&(p.pid=L),w!==null&&!O&&(this.logger.warn("MPEG-TS PMT found at "+H+" after unknown PID '"+w+"'. Backtracking to sync byte @"+G+" to parse all TS packets."),w=null,H=G-188),O=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=Y;break}}else N++;N>0&&ui(this.observer,new Error("Found "+N+" TS packet/s that do not start with 0x47"),void 0,this.logger),h.pesData=b,g.pesData=k,p.pesData=I;var se={audioTrack:g,videoTrack:h,id3Track:p,textTrack:E};return l&&this.extractRemainingSamples(se),se},u.flush=function(){var r=this.remainderData;this.remainderData=null;var t;return r?t=this.demux(r,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},u.extractRemainingSamples=function(r){var t=r.audioTrack,i=r.videoTrack,l=r.id3Track,f=r.textTrack,h=i.pesData,g=t.pesData,p=l.pesData,E;if(h&&(E=mr(h,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new As;break}this.videoParser!==null&&(this.videoParser.parsePES(i,f,E,!0),i.pesData=null)}else i.pesData=h;if(g&&(E=mr(g,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,E);break;case"mp3":this.parseMPEGPES(t,E);break}t.pesData=null}else g!=null&&g.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=g;p&&(E=mr(p,this.logger))?(this.parseID3PES(l,E),l.pesData=null):l.pesData=p},u.demuxSampleAes=function(r,t,i){var l=this.demux(r,i,!0,!this.config.progressive),f=this.sampleAes=new _f(this.observer,this.config,t);return this.decrypt(l,f)},u.decrypt=function(r,t){return new Promise(function(i){var l=r.audioTrack,f=r.videoTrack;l.samples&&l.segmentCodec==="aac"?t.decryptAacSamples(l.samples,0,function(){f.samples?t.decryptAvcSamples(f.samples,0,0,function(){i(r)}):i(r)}):f.samples&&t.decryptAvcSamples(f.samples,0,0,function(){i(r)})})},u.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},u.parseAACPES=function(r,t){var i=0,l=this.aacOverFlow,f=t.data;if(l){this.aacOverFlow=null;var h=l.missing,g=l.sample.unit.byteLength;if(h===-1)f=kt(l.sample.unit,f);else{var p=g-h;l.sample.unit.set(f.subarray(0,h),p),r.samples.push(l.sample),i=l.missing}}var E,x;for(E=i,x=f.length;E<x-1&&!si(f,E);E++);if(E!==i){var b,_=E<x-1;if(_?b="AAC PES did not start with ADTS header,offset:"+E:b="No ADTS header found in AAC PES",ui(this.observer,new Error(b),_,this.logger),!_)return}vs(r,this.observer,f,E,this.audioCodec);var L;if(t.pts!==void 0)L=t.pts;else if(l){var k=gs(r.samplerate);L=l.sample.pts+k}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var I=0,w;E<x;)if(w=ps(r,f,E,L,I),E+=w.length,w.missing){this.aacOverFlow=w;break}else for(I++;E<x-1&&!si(f,E);E++);},u.parseMPEGPES=function(r,t){var i=t.data,l=i.length,f=0,h=0,g=t.pts;if(g===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<l;)if(_s(i,h)){var p=Ss(r,i,h,g,f);if(p)h+=p.length,f++;else break}else h++},u.parseAC3PES=function(r,t){},u.parseID3PES=function(r,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var i=T({},t,{type:this._videoTrack?St.emsg:St.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(i)},o}();function on(o,u){return((o[u+1]&31)<<8)+o[u+2]}function Cf(o,u){return(o[u+10]&31)<<8|o[u+11]}function Af(o,u,a,r,t,i){var l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},f=(o[u+1]&15)<<8|o[u+2],h=u+3+f-4,g=(o[u+10]&15)<<8|o[u+11];for(u+=12+g;u<h;){var p=on(o,u),E=(o[u+3]&15)<<8|o[u+4];switch(o[u]){case 207:if(!r){ln("ADTS AAC",i);break}case 15:l.audioPid===-1&&(l.audioPid=p);break;case 21:l.id3Pid===-1&&(l.id3Pid=p);break;case 219:if(!r){ln("H.264",i);break}case 27:l.videoPid===-1&&(l.videoPid=p);break;case 3:case 4:!a.mpeg&&!a.mp3?i.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=p,l.segmentAudioCodec="mp3");break;case 193:if(!r){ln("AC-3",i);break}case 129:i.warn("AC-3 in M2TS support not included in build");break;case 6:if(l.audioPid===-1&&E>0)for(var x=u+5,b=E;b>2;){var _=o[x];switch(_){case 106:i.warn("AC-3 in M2TS support not included in build");break}var L=o[x+1]+2;x+=L,b-=L}break;case 194:case 135:return ui(t,new Error("Unsupported EC-3 in M2TS found"),void 0,i),l;case 36:return ui(t,new Error("Unsupported HEVC in M2TS found"),void 0,i),l}u+=E+5}return l}function ui(o,u,a,r){r.warn("parsing error: "+u.message),o.emit(P.ERROR,P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!1,levelRetry:a,error:u,reason:u.message})}function ln(o,u){u.log(o+" with AES-128-CBC encryption found in unencrypted stream")}function mr(o,u){var a=0,r,t,i,l,f,h=o.data;if(!o||o.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=kt(h[0],h[1]),h.splice(1,1);r=h[0];var g=(r[0]<<16)+(r[1]<<8)+r[2];if(g===1){if(t=(r[4]<<8)+r[5],t&&t>o.size-6)return null;var p=r[7];p&192&&(l=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,p&64?(f=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,l-f>60*9e4&&(u.warn(Math.round((l-f)/9e4)+"s delta between PTS and DTS, align them"),l=f)):f=l),i=r[8];var E=i+9;if(o.size<=E)return null;o.size-=E;for(var x=new Uint8Array(o.size),b=0,_=h.length;b<_;b++){r=h[b];var L=r.byteLength;if(E)if(E>L){E-=L;continue}else r=r.subarray(E),L-=E,E=0;x.set(r,a),a+=L}return t&&(t-=i+3),{data:x,pts:l,dts:f,len:t}}return null}var kf=function(){function o(){}return o.getSilentFrame=function(a,r){switch(a){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},o}(),er=Math.pow(2,32)-1,nt=function(){function o(){}return o.init=function(){o.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var a;for(a in o.types)o.types.hasOwnProperty(a)&&(o.types[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);o.HDLR_TYPES={video:r,audio:t};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);o.STTS=o.STSC=o.STCO=l,o.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),o.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),o.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),o.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var f=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),g=new Uint8Array([0,0,0,1]);o.FTYP=o.box(o.types.ftyp,f,g,f,h),o.DINF=o.box(o.types.dinf,o.box(o.types.dref,i))},o.box=function(a){for(var r=8,t=arguments.length,i=new Array(t>1?t-1:0),l=1;l<t;l++)i[l-1]=arguments[l];for(var f=i.length,h=f;f--;)r+=i[f].byteLength;var g=new Uint8Array(r);for(g[0]=r>>24&255,g[1]=r>>16&255,g[2]=r>>8&255,g[3]=r&255,g.set(a,4),f=0,r=8;f<h;f++)g.set(i[f],r),r+=i[f].byteLength;return g},o.hdlr=function(a){return o.box(o.types.hdlr,o.HDLR_TYPES[a])},o.mdat=function(a){return o.box(o.types.mdat,a)},o.mdhd=function(a,r){r*=a;var t=Math.floor(r/(er+1)),i=Math.floor(r%(er+1));return o.box(o.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,a&255,t>>24,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))},o.mdia=function(a){return o.box(o.types.mdia,o.mdhd(a.timescale||0,a.duration||0),o.hdlr(a.type),o.minf(a))},o.mfhd=function(a){return o.box(o.types.mfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255]))},o.minf=function(a){return a.type==="audio"?o.box(o.types.minf,o.box(o.types.smhd,o.SMHD),o.DINF,o.stbl(a)):o.box(o.types.minf,o.box(o.types.vmhd,o.VMHD),o.DINF,o.stbl(a))},o.moof=function(a,r,t){return o.box(o.types.moof,o.mfhd(a),o.traf(t,r))},o.moov=function(a){for(var r=a.length,t=[];r--;)t[r]=o.trak(a[r]);return o.box.apply(null,[o.types.moov,o.mvhd(a[0].timescale||0,a[0].duration||0)].concat(t).concat(o.mvex(a)))},o.mvex=function(a){for(var r=a.length,t=[];r--;)t[r]=o.trex(a[r]);return o.box.apply(null,[o.types.mvex].concat(t))},o.mvhd=function(a,r){r*=a;var t=Math.floor(r/(er+1)),i=Math.floor(r%(er+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,a&255,t>>24,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o.box(o.types.mvhd,l)},o.sdtp=function(a){var r=a.samples||[],t=new Uint8Array(4+r.length),i,l;for(i=0;i<r.length;i++)l=r[i].flags,t[i+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return o.box(o.types.sdtp,t)},o.stbl=function(a){return o.box(o.types.stbl,o.stsd(a),o.box(o.types.stts,o.STTS),o.box(o.types.stsc,o.STSC),o.box(o.types.stsz,o.STSZ),o.box(o.types.stco,o.STCO))},o.avc1=function(a){var r=[],t=[],i,l,f;for(i=0;i<a.sps.length;i++)l=a.sps[i],f=l.byteLength,r.push(f>>>8&255),r.push(f&255),r=r.concat(Array.prototype.slice.call(l));for(i=0;i<a.pps.length;i++)l=a.pps[i],f=l.byteLength,t.push(f>>>8&255),t.push(f&255),t=t.concat(Array.prototype.slice.call(l));var h=o.box(o.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|a.sps.length].concat(r).concat([a.pps.length]).concat(t))),g=a.width,p=a.height,E=a.pixelRatio[0],x=a.pixelRatio[1];return o.box(o.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,o.box(o.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),o.box(o.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,x>>24,x>>16&255,x>>8&255,x&255])))},o.esds=function(a){var r=a.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(r,[6,1,2]))},o.audioStsd=function(a){var r=a.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount||0,0,16,0,0,0,0,r>>8&255,r&255,0,0])},o.mp4a=function(a){return o.box(o.types.mp4a,o.audioStsd(a),o.box(o.types.esds,o.esds(a)))},o.mp3=function(a){return o.box(o.types[".mp3"],o.audioStsd(a))},o.ac3=function(a){return o.box(o.types["ac-3"],o.audioStsd(a),o.box(o.types.dac3,a.config))},o.stsd=function(a){var r=a.segmentCodec;if(a.type==="audio"){if(r==="aac")return o.box(o.types.stsd,o.STSD,o.mp4a(a));if(r==="mp3"&&a.codec==="mp3")return o.box(o.types.stsd,o.STSD,o.mp3(a))}else if(a.pps&&a.sps){if(r==="avc")return o.box(o.types.stsd,o.STSD,o.avc1(a))}else throw new Error("video track missing pps or sps");throw new Error("unsupported "+a.type+" segment codec ("+r+"/"+a.codec+")")},o.tkhd=function(a){var r=a.id,t=(a.duration||0)*(a.timescale||0),i=a.width||0,l=a.height||0,f=Math.floor(t/(er+1)),h=Math.floor(t%(er+1));return o.box(o.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,l>>8&255,l&255,0,0]))},o.traf=function(a,r){var t=o.sdtp(a),i=a.id,l=Math.floor(r/(er+1)),f=Math.floor(r%(er+1));return o.box(o.types.traf,o.box(o.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),o.box(o.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,f>>24,f>>16&255,f>>8&255,f&255])),o.trun(a,t.length+16+20+8+16+8+8),t)},o.trak=function(a){return a.duration=a.duration||4294967295,o.box(o.types.trak,o.tkhd(a),o.mdia(a))},o.trex=function(a){var r=a.id;return o.box(o.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},o.trun=function(a,r){var t=a.samples||[],i=t.length,l=12+16*i,f=new Uint8Array(l),h,g,p,E,x,b;for(r+=8+l,f.set([a.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),h=0;h<i;h++)g=t[h],p=g.duration,E=g.size,x=g.flags,b=g.cts,f.set([p>>>24&255,p>>>16&255,p>>>8&255,p&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255,x.isLeading<<2|x.dependsOn,x.isDependedOn<<6|x.hasRedundancy<<4|x.paddingValue<<1|x.isNonSync,x.degradPrio&61440,x.degradPrio&15,b>>>24&255,b>>>16&255,b>>>8&255,b&255],12+16*h);return o.box(o.types.trun,f)},o.initSegment=function(a){o.types||o.init();var r=o.moov(a),t=kt(o.FTYP,r);return t},o.hvc1=function(a){return new Uint8Array},o}();nt.types=void 0,nt.HDLR_TYPES=void 0,nt.STTS=void 0,nt.STSC=void 0,nt.STCO=void 0,nt.STSZ=void 0,nt.VMHD=void 0,nt.SMHD=void 0,nt.STSD=void 0,nt.FTYP=void 0,nt.DINF=void 0;var Rf=9e4;function If(o,u,a,r){var t=o*u*a;return Math.round(t)}function Mr(o,u){return If(o,1e3,1/Rf)}var Pf=10*1e3,wf=1024,Df=1152,Of=1536,yr=null,un=null;function ks(o,u,a,r){return{duration:u,size:a,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:o?2:1,isNonSync:o?0:1}}}var fn=function(){function o(a,r,t,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=a,this.config=r,this.typeSupported=t,this.logger=i,this.ISGenerated=!1,yr===null){var l=navigator.userAgent||"",f=l.match(/Chrome\/(\d+)/i);yr=f?parseInt(f[1]):0}if(un===null){var h=navigator.userAgent.match(/Safari\/(\d+)/i);un=h?parseInt(h[1]):0}}var u=o.prototype;return u.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},u.resetTimeStamp=function(r){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=r},u.resetNextTimestamp=function(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},u.getVideoStartPts=function(r){var t=!1,i=r[0].pts,l=r.reduce(function(f,h){var g=h.pts,p=g-f;return p<-4294967296&&(t=!0,g=It(g,i),p=g-f),p>0?f:g},i);return t&&this.logger.debug("PTS rollover detected"),l},u.remux=function(r,t,i,l,f,h,g,p){var E,x,b,_,L,k,I=f,w=f,O=r.pid>-1,D=t.pid>-1,M=t.samples.length,G=r.samples.length>0,N=g&&M>0||M>1,H=(!O||G)&&(!D||N)||this.ISGenerated||g;if(H){if(this.ISGenerated){var X,Y,V,j,Q=this.videoTrackConfig;(Q&&(t.width!==Q.width||t.height!==Q.height||((X=t.pixelRatio)==null?void 0:X[0])!==((Y=Q.pixelRatio)==null?void 0:Y[0])||((V=t.pixelRatio)==null?void 0:V[1])!==((j=Q.pixelRatio)==null?void 0:j[1]))||!Q&&N||this.nextAudioPts===null&&G)&&this.resetInitSegment()}this.ISGenerated||(b=this.generateIS(r,t,f,h));var se=this.isVideoContiguous,re=-1,Z;if(N&&(re=Mf(t.samples),!se&&this.config.forceKeyFrameOnDiscontinuity))if(k=!0,re>0){this.logger.warn("[mp4-remuxer]: Dropped "+re+" out of "+M+" video samples due to a missing keyframe");var oe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(re),t.dropped+=re,w+=(t.samples[0].pts-oe)/t.inputTimeScale,Z=w}else re===-1&&(this.logger.warn("[mp4-remuxer]: No keyframe found out of "+M+" video samples"),k=!1);if(this.ISGenerated){if(G&&N){var le=this.getVideoStartPts(t.samples),ue=It(r.samples[0].pts,le)-le,fe=ue/t.inputTimeScale;I+=Math.max(0,fe),w+=Math.max(0,-fe)}if(G){if(r.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),b=this.generateIS(r,t,f,h)),x=this.remuxAudio(r,I,this.isAudioContiguous,h,D||N||p===Ce.AUDIO?w:void 0),N){var Be=x?x.endPTS-x.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),b=this.generateIS(r,t,f,h)),E=this.remuxVideo(t,w,se,Be)}}else N&&(E=this.remuxVideo(t,w,se,0));E&&(E.firstKeyFrame=re,E.independent=re!==-1,E.firstKeyFramePTS=Z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(L=Rs(i,f,this._initPTS,this._initDTS)),l.samples.length&&(_=Is(l,f,this._initPTS))),{audio:x,video:E,initSegment:b,independent:k,text:_,id3:L}},u.generateIS=function(r,t,i,l){var f=r.samples,h=t.samples,g=this.typeSupported,p={},E=this._initPTS,x=!E||l,b="audio/mp4",_,L,k;if(x&&(_=L=1/0),r.config&&f.length){switch(r.timescale=r.samplerate,r.segmentCodec){case"mp3":g.mpeg?(b="audio/mpeg",r.codec=""):g.mp3&&(r.codec="mp3");break;case"ac3":r.codec="ac-3";break}p.audio={id:"audio",container:b,codec:r.codec,initSegment:r.segmentCodec==="mp3"&&g.mpeg?new Uint8Array(0):nt.initSegment([r]),metadata:{channelCount:r.channelCount}},x&&(k=r.inputTimeScale,!E||k!==E.timescale?_=L=f[0].pts-Math.round(k*i):x=!1)}if(t.sps&&t.pps&&h.length){if(t.timescale=t.inputTimeScale,p.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:nt.initSegment([t]),metadata:{width:t.width,height:t.height}},x)if(k=t.inputTimeScale,!E||k!==E.timescale){var I=this.getVideoStartPts(h),w=Math.round(k*i);L=Math.min(L,It(h[0].dts,I)-w),_=Math.min(_,I-w)}else x=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(p).length)return this.ISGenerated=!0,x?(this._initPTS={baseTime:_,timescale:k},this._initDTS={baseTime:L,timescale:k}):_=k=void 0,{tracks:p,initPTS:_,timescale:k}},u.remuxVideo=function(r,t,i,l){var f=r.inputTimeScale,h=r.samples,g=[],p=h.length,E=this._initPTS,x=this.nextAvcDts,b=8,_=this.videoSampleDuration,L,k,I=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,O=!1;if(!i||x===null){var D=t*f,M=h[0].pts-It(h[0].dts,h[0].pts);yr&&x!==null&&Math.abs(D-M-x)<15e3?i=!0:x=D-M}for(var G=E.baseTime*f/E.timescale,N=0;N<p;N++){var H=h[N];H.pts=It(H.pts-G,x),H.dts=It(H.dts-G,x),H.dts<h[N>0?N-1:N].dts&&(O=!0)}O&&h.sort(function(pi,oo){var Xc=pi.dts-oo.dts,Qc=pi.pts-oo.pts;return Xc||Qc}),L=h[0].dts,k=h[h.length-1].dts;var X=k-L,Y=X?Math.round(X/(p-1)):_||r.inputTimeScale/30;if(i){var V=L-x,j=V>Y,Q=V<-1;if((j||Q)&&(j?this.logger.warn((r.segmentCodec||"").toUpperCase()+": "+Mr(V)+" ms ("+V+"dts) hole between fragments detected at "+t.toFixed(3)):this.logger.warn((r.segmentCodec||"").toUpperCase()+": "+Mr(-V)+" ms ("+V+"dts) overlapping between fragments detected at "+t.toFixed(3)),!Q||x>=h[0].pts||yr)){L=x;var se=h[0].pts-V;if(j)h[0].dts=L,h[0].pts=se;else for(var re=!0,Z=0;Z<h.length&&!(h[Z].dts>se&&re);Z++){var oe=h[Z].pts;if(h[Z].dts-=V,h[Z].pts-=V,Z<h.length-1){var le=h[Z+1].pts,ue=h[Z].pts,fe=le<=ue,Be=le<=oe;re=fe==Be}}this.logger.log("Video: Initial PTS/DTS adjusted: "+Mr(se)+"/"+Mr(L)+", delta: "+Mr(V)+" ms")}}L=Math.max(0,L);for(var Ie=0,Ue=0,ke=L,Qe=0;Qe<p;Qe++){for(var He=h[Qe],qe=He.units,gt=qe.length,it=0,Ge=0;Ge<gt;Ge++)it+=qe[Ge].data.length;Ue+=it,Ie+=gt,He.length=it,He.dts<ke?(He.dts=ke,ke+=Y/4|0||1):ke=He.dts,I=Math.min(He.pts,I),w=Math.max(He.pts,w)}k=h[p-1].dts;var pt=Ue+4*Ie+8,Je;try{Je=new Uint8Array(pt)}catch(pi){this.observer.emit(P.ERROR,P.ERROR,{type:be.MUX_ERROR,details:$.REMUX_ALLOC_ERROR,fatal:!1,error:pi,bytes:pt,reason:"fail allocating video mdat "+pt});return}var ze=new DataView(Je.buffer);ze.setUint32(0,pt),Je.set(nt.types.mdat,4);for(var mt=!1,ot=Number.POSITIVE_INFINITY,xt=Number.POSITIVE_INFINITY,We=Number.NEGATIVE_INFINITY,lt=Number.NEGATIVE_INFINITY,et=0;et<p;et++){for(var yt=h[et],Ur=yt.units,to=0,En=0,Gc=Ur.length;En<Gc;En++){var ro=Ur[En],Vc=ro.data,Tn=ro.data.byteLength;ze.setUint32(b,Tn),b+=4,Je.set(Vc,b),b+=Tn,to+=4+Tn}var vi=void 0;if(et<p-1)_=h[et+1].dts-yt.dts,vi=h[et+1].pts-yt.pts;else{var io=this.config,gi=et>0?yt.dts-h[et-1].dts:Y;if(vi=et>0?yt.pts-h[et-1].pts:Y,io.stretchShortVideoTrack&&this.nextAudioPts!==null){var Kc=Math.floor(io.maxBufferHole*f),Sn=(l?I+l*f:this.nextAudioPts)-yt.pts;Sn>Kc?(_=Sn-gi,_<0?_=gi:mt=!0,this.logger.log("[mp4-remuxer]: It is approximately "+Sn/90+" ms to the next segment; using duration "+_/90+" ms for the last video frame.")):_=gi}else _=gi}var Wc=Math.round(yt.pts-yt.dts);ot=Math.min(ot,_),We=Math.max(We,_),xt=Math.min(xt,vi),lt=Math.max(lt,vi),g.push(ks(yt.key,_,to,Wc))}if(g.length){if(yr){if(yr<70){var no=g[0].flags;no.dependsOn=2,no.isNonSync=0}}else if(un&&lt-xt<We-ot&&Y/We<.025&&g[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var xn=L,Pt=0,ao=g.length;Pt<ao;Pt++){var so=xn+g[Pt].duration,jc=xn+g[Pt].cts;if(Pt<ao-1){var Yc=so+g[Pt+1].cts;g[Pt].duration=Yc-jc}else g[Pt].duration=Pt?g[Pt-1].duration:Y;g[Pt].cts=0,xn=so}}}_=mt||!_?Y:_,this.nextAvcDts=x=k+_,this.videoSampleDuration=_,this.isVideoContiguous=!0;var zc=nt.moof(r.sequenceNumber++,L,T(r,{samples:g})),$c="video",qc={data1:zc,data2:Je,startPTS:I/f,endPTS:(w+_)/f,startDTS:L/f,endDTS:x/f,type:$c,hasAudio:!1,hasVideo:!0,nb:g.length,dropped:r.dropped};return r.samples=[],r.dropped=0,qc},u.getSamplesPerFrame=function(r){switch(r.segmentCodec){case"mp3":return Df;case"ac3":return Of;default:return wf}},u.remuxAudio=function(r,t,i,l,f){var h=r.inputTimeScale,g=r.samplerate?r.samplerate:h,p=h/g,E=this.getSamplesPerFrame(r),x=E*p,b=this._initPTS,_=r.segmentCodec==="mp3"&&this.typeSupported.mpeg,L=[],k=f!==void 0,I=r.samples,w=_?0:8,O=this.nextAudioPts||-1,D=t*h,M=b.baseTime*h/b.timescale;if(this.isAudioContiguous=i=i||I.length&&O>0&&(l&&Math.abs(D-O)<9e3||Math.abs(It(I[0].pts-M,D)-O)<20*x),I.forEach(function(We){We.pts=It(We.pts-M,D)}),!i||O<0){if(I=I.filter(function(We){return We.pts>=0}),!I.length)return;f===0?O=0:l&&!k?O=Math.max(0,D):O=I[0].pts}if(r.segmentCodec==="aac")for(var G=this.config.maxAudioFramesDrift,N=0,H=O;N<I.length;N++){var X=I[N],Y=X.pts,V=Y-H,j=Math.abs(1e3*V/h);if(V<=-G*x&&k)N===0&&(this.logger.warn("Audio frame @ "+(Y/h).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*V/h)+" ms."),this.nextAudioPts=O=H=Y);else if(V>=G*x&&j<Pf&&k){var Q=Math.round(V/x);H=Y-Q*x,H<0&&(Q--,H+=x),N===0&&(this.nextAudioPts=O=H),this.logger.warn("[mp4-remuxer]: Injecting "+Q+" audio frame @ "+(H/h).toFixed(3)+"s due to "+Math.round(1e3*V/h)+" ms gap.");for(var se=0;se<Q;se++){var re=Math.max(H,0),Z=kf.getSilentFrame(r.parsedCodec||r.manifestCodec||r.codec,r.channelCount);Z||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Z=X.unit.subarray()),I.splice(N,0,{unit:Z,pts:re}),H+=x,N++}}X.pts=H,H+=x}for(var oe=null,le=null,ue,fe=0,Be=I.length;Be--;)fe+=I[Be].unit.byteLength;for(var Ie=0,Ue=I.length;Ie<Ue;Ie++){var ke=I[Ie],Qe=ke.unit,He=ke.pts;if(le!==null){var qe=L[Ie-1];qe.duration=Math.round((He-le)/p)}else if(i&&r.segmentCodec==="aac"&&(He=O),oe=He,fe>0){fe+=w;try{ue=new Uint8Array(fe)}catch(We){this.observer.emit(P.ERROR,P.ERROR,{type:be.MUX_ERROR,details:$.REMUX_ALLOC_ERROR,fatal:!1,error:We,bytes:fe,reason:"fail allocating audio mdat "+fe});return}if(!_){var gt=new DataView(ue.buffer);gt.setUint32(0,fe),ue.set(nt.types.mdat,4)}}else return;ue.set(Qe,w);var it=Qe.byteLength;w+=it,L.push(ks(!0,E,it,0)),le=He}var Ge=L.length;if(Ge){var pt=L[L.length-1];this.nextAudioPts=O=le+p*pt.duration;var Je=_?new Uint8Array(0):nt.moof(r.sequenceNumber++,oe/p,T({},r,{samples:L}));r.samples=[];var ze=oe/h,mt=O/h,ot="audio",xt={data1:Je,data2:ue,startPTS:ze,endPTS:mt,startDTS:ze,endDTS:mt,type:ot,hasAudio:!0,hasVideo:!1,nb:Ge};return this.isAudioContiguous=!0,xt}},o}();function It(o,u){var a;if(u===null)return o;for(u<o?a=-8589934592:a=8589934592;Math.abs(o-u)>4294967296;)o+=a;return o}function Mf(o){for(var u=0;u<o.length;u++)if(o[u].key)return u;return-1}function Rs(o,u,a,r){var t=o.samples.length;if(t){for(var i=o.inputTimeScale,l=0;l<t;l++){var f=o.samples[l];f.pts=It(f.pts-a.baseTime*i/a.timescale,u*i)/i,f.dts=It(f.dts-r.baseTime*i/r.timescale,u*i)/i}var h=o.samples;return o.samples=[],{samples:h}}}function Is(o,u,a){var r=o.samples.length;if(r){for(var t=o.inputTimeScale,i=0;i<r;i++){var l=o.samples[i];l.pts=It(l.pts-a.baseTime*t/a.timescale,u*t)/t}o.samples.sort(function(h,g){return h.pts-g.pts});var f=o.samples;return o.samples=[],{samples:f}}}var Ff=function(){function o(a,r,t,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}var u=o.prototype;return u.destroy=function(){},u.resetTimeStamp=function(r){this.initPTS=r,this.lastEndTime=null},u.resetNextTimestamp=function(){this.lastEndTime=null},u.resetInitSegment=function(r,t,i,l){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(Nl(r,l)),this.emitInitSegment=!0},u.generateInitSegment=function(r){var t=this.audioCodec,i=this.videoCodec;if(!(r!=null&&r.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var l=this.initData=Ea(r);l.audio&&(t=Ps(l.audio,Ye.AUDIO)),l.video&&(i=Ps(l.video,Ye.VIDEO));var f={};l.audio&&l.video?f.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:l.video.supplemental,initSegment:r,id:"main"}:l.audio?f.audio={container:"audio/mp4",codec:t,initSegment:r,id:"audio"}:l.video?f.video={container:"video/mp4",codec:i,supplemental:l.video.supplemental,initSegment:r,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=f},u.remux=function(r,t,i,l,f,h){var g,p,E=this.initPTS,x=this.lastEndTime,b={audio:void 0,video:void 0,text:l,id3:i,initSegment:void 0};ae(x)||(x=this.lastEndTime=f||0);var _=t.samples;if(!(_!=null&&_.length))return b;var L={initPTS:void 0,timescale:1},k=this.initData;if((g=k)!=null&&g.length||(this.generateInitSegment(_),k=this.initData),!((p=k)!=null&&p.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),b;this.emitInitSegment&&(L.tracks=this.initTracks,this.emitInitSegment=!1);var I=Hl(_,k),w=Ul(k,_),O=w===null?f:w;(h||!E)&&(Nf(E,O,f,I)||L.timescale!==E.timescale)&&(L.initPTS=O-f,E&&E.timescale===1&&this.logger.warn("Adjusting initPTS @"+f+" from "+E.baseTime/E.timescale+" to "+L.initPTS),this.initPTS=E={baseTime:L.initPTS,timescale:1});var D=r?O-E.baseTime/E.timescale:x,M=D+I;Vl(k,_,E.baseTime/E.timescale),I>0?this.lastEndTime=M:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var G=!!k.audio,N=!!k.video,H="";G&&(H+="audio"),N&&(H+="video");var X={data1:_,startPTS:D,startDTS:D,endPTS:M,endDTS:M,type:H,hasAudio:G,hasVideo:N,nb:1,dropped:0};return b.audio=X.type==="audio"?X:void 0,b.video=X.type!=="audio"?X:void 0,b.initSegment=L,b.id3=Rs(i,f,E,E),l.samples.length&&(b.text=Is(l,f,E)),b},o}();function Nf(o,u,a,r){if(o===null)return!0;var t=Math.max(r,1),i=u-o.baseTime/o.timescale;return Math.abs(i-a)>t}function Ps(o,u){var a=o?.codec;if(a&&a.length>4)return a;if(u===Ye.AUDIO){if(a==="ec-3"||a==="ac-3"||a==="alac")return a;if(a==="fLaC"||a==="Opus"){var r=!1;return Qr(a,r)}return Oe.warn('Unhandled audio codec "'+a+'" in mp4 MAP'),a||"mp4a"}return Oe.warn('Unhandled video codec "'+a+'" in mp4 MAP'),a||"avc1"}var Kt;try{Kt=self.performance.now.bind(self.performance)}catch{Kt=Date.now}var cn=[{demux:xf,remux:Ff},{demux:Lf,remux:fn},{demux:hf,remux:fn},{demux:vf,remux:fn}],hn=function(){function o(a,r,t,i,l,f){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=a,this.typeSupported=r,this.config=t,this.id=l,this.logger=f}var u=o.prototype;return u.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},u.push=function(r,t,i,l){var f=this,h=i.transmuxing;h.executeStart=Kt();var g=new Uint8Array(r),p=this.currentTransmuxState,E=this.transmuxConfig;l&&(this.currentTransmuxState=l);var x=l||p,b=x.contiguous,_=x.discontinuity,L=x.trackSwitch,k=x.accurateTimeOffset,I=x.timeOffset,w=x.initSegmentChange,O=E.audioCodec,D=E.videoCodec,M=E.defaultInitPts,G=E.duration,N=E.initSegmentData,H=Bf(g,t);if(H&&Dr(H.method)){var X=this.getDecrypter(),Y=ja(H.method);if(X.isSync()){var V=X.softwareDecrypt(g,H.key.buffer,H.iv.buffer,Y),j=i.part>-1;if(j){var Q=X.flush();V=Q&&Q.buffer}if(!V)return h.executeEnd=Kt(),dn(i);g=new Uint8Array(V)}else return this.asyncResult=!0,this.decryptionPromise=X.webCryptoDecrypt(g,H.key.buffer,H.iv.buffer,Y).then(function(le){var ue=f.push(le,null,i);return f.decryptionPromise=null,ue}),this.decryptionPromise}var se=this.needsProbing(_,L);if(se){var re=this.configureTransmuxer(g);if(re)return this.logger.warn("[transmuxer] "+re.message),this.observer.emit(P.ERROR,P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!1,error:re,reason:re.message}),h.executeEnd=Kt(),dn(i)}(_||L||w||se)&&this.resetInitSegment(N,O,D,G,t),(_||w||se)&&this.resetInitialTimestamp(M),b||this.resetContiguity();var Z=this.transmux(g,H,I,k,i);this.asyncResult=or(Z);var oe=this.currentTransmuxState;return oe.contiguous=!0,oe.discontinuity=!1,oe.trackSwitch=!1,h.executeEnd=Kt(),Z},u.flush=function(r){var t=this,i=r.transmuxing;i.executeStart=Kt();var l=this.decrypter,f=this.currentTransmuxState,h=this.decryptionPromise;if(h)return this.asyncResult=!0,h.then(function(){return t.flush(r)});var g=[],p=f.timeOffset;if(l){var E=l.flush();E&&g.push(this.push(E.buffer,null,r))}var x=this.demuxer,b=this.remuxer;if(!x||!b){i.executeEnd=Kt();var _=[dn(r)];return this.asyncResult?Promise.resolve(_):_}var L=x.flush(p);return or(L)?(this.asyncResult=!0,L.then(function(k){return t.flushRemux(g,k,r),g})):(this.flushRemux(g,L,r),this.asyncResult?Promise.resolve(g):g)},u.flushRemux=function(r,t,i){var l=t.audioTrack,f=t.videoTrack,h=t.id3Track,g=t.textTrack,p=this.currentTransmuxState,E=p.accurateTimeOffset,x=p.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+i.sn+(i.part>-1?" part: "+i.part:"")+" of "+(this.id===Ce.MAIN?"level":"track")+" "+i.level);var b=this.remuxer.remux(l,f,h,g,x,E,!0,this.id);r.push({remuxResult:b,chunkMeta:i}),i.transmuxing.executeEnd=Kt()},u.resetInitialTimestamp=function(r){var t=this.demuxer,i=this.remuxer;!t||!i||(t.resetTimeStamp(r),i.resetTimeStamp(r))},u.resetContiguity=function(){var r=this.demuxer,t=this.remuxer;!r||!t||(r.resetContiguity(),t.resetNextTimestamp())},u.resetInitSegment=function(r,t,i,l,f){var h=this.demuxer,g=this.remuxer;!h||!g||(h.resetInitSegment(r,t,i,l),g.resetInitSegment(r,t,i,f))},u.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},u.transmux=function(r,t,i,l,f){var h;return t&&t.method==="SAMPLE-AES"?h=this.transmuxSampleAes(r,t,i,l,f):h=this.transmuxUnencrypted(r,i,l,f),h},u.transmuxUnencrypted=function(r,t,i,l){var f=this.demuxer.demux(r,t,!1,!this.config.progressive),h=f.audioTrack,g=f.videoTrack,p=f.id3Track,E=f.textTrack,x=this.remuxer.remux(h,g,p,E,t,i,!1,this.id);return{remuxResult:x,chunkMeta:l}},u.transmuxSampleAes=function(r,t,i,l,f){var h=this;return this.demuxer.demuxSampleAes(r,t,i).then(function(g){var p=h.remuxer.remux(g.audioTrack,g.videoTrack,g.id3Track,g.textTrack,i,l,!1,h.id);return{remuxResult:p,chunkMeta:f}})},u.configureTransmuxer=function(r){for(var t=this.config,i=this.observer,l=this.typeSupported,f,h=0,g=cn.length;h<g;h++){var p;if((p=cn[h].demux)!=null&&p.probe(r,this.logger)){f=cn[h];break}}if(!f)return new Error("Failed to find demuxer by probing fragment data");var E=this.demuxer,x=this.remuxer,b=f.remux,_=f.demux;(!x||!(x instanceof b))&&(this.remuxer=new b(i,t,l,this.logger)),(!E||!(E instanceof _))&&(this.demuxer=new _(i,t,l,this.logger),this.probe=_.probe)},u.needsProbing=function(r,t){return!this.demuxer||!this.remuxer||r||t},u.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new sn(this.config)),r},o}();function Bf(o,u){var a=null;return o.byteLength>0&&u?.key!=null&&u.iv!==null&&u.method!=null&&(a=u),a}var dn=function(u){return{remuxResult:{},chunkMeta:u}};function or(o){return"then"in o&&o.then instanceof Function}var Uf=function(u,a,r,t,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=u,this.videoCodec=a,this.initSegmentData=r,this.duration=t,this.defaultInitPts=i||null},Hf=function(u,a,r,t,i,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=u,this.contiguous=a,this.accurateTimeOffset=r,this.trackSwitch=t,this.timeOffset=i,this.initSegmentChange=l};function Gf(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Vf=/(\d+)-(\d+)\/(\d+)/,ws=function(){function o(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||Yf,this.controller=new self.AbortController,this.stats=new Gi}var u=o.prototype;return u.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},u.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},u.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},u.load=function(r,t,i){var l=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var h=Kf(r,this.controller.signal),g=r.responseType==="arraybuffer",p=g?"byteLength":"length",E=t.loadPolicy,x=E.maxTimeToFirstByteMs,b=E.maxLoadTimeMs;this.context=r,this.config=t,this.callbacks=i,this.request=this.fetchSetup(r,h),self.clearTimeout(this.requestTimeout),t.timeout=x&&ae(x)?x:b,this.requestTimeout=self.setTimeout(function(){l.callbacks&&(l.abortInternal(),l.callbacks.onTimeout(f,r,l.response))},t.timeout);var _=or(this.request)?this.request.then(self.fetch):self.fetch(this.request);_.then(function(L){var k;l.response=l.loader=L;var I=Math.max(self.performance.now(),f.loading.start);if(self.clearTimeout(l.requestTimeout),t.timeout=b,l.requestTimeout=self.setTimeout(function(){l.callbacks&&(l.abortInternal(),l.callbacks.onTimeout(f,r,l.response))},b-(I-f.loading.start)),!L.ok){var w=L.status,O=L.statusText;throw new zf(O||"fetch, bad network response",w,L)}f.loading.first=I,f.total=jf(L.headers)||f.total;var D=(k=l.callbacks)==null?void 0:k.onProgress;return D&&ae(t.highWaterMark)?l.loadProgressively(L,f,r,t.highWaterMark,D):g?L.arrayBuffer():r.responseType==="json"?L.json():L.text()}).then(function(L){var k,I,w=l.response;if(!w)throw new Error("loader destroyed");self.clearTimeout(l.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first);var O=L[p];O&&(f.loaded=f.total=O);var D={url:w.url,data:L,code:w.status},M=(k=l.callbacks)==null?void 0:k.onProgress;M&&!ae(t.highWaterMark)&&M(f,r,L,w),(I=l.callbacks)==null||I.onSuccess(D,f,r,w)}).catch(function(L){var k;if(self.clearTimeout(l.requestTimeout),!f.aborted){var I=L&&L.code||0,w=L?L.message:null;(k=l.callbacks)==null||k.onError({code:I,text:w},r,L?L.details:null,f)}})},u.getCacheAge=function(){var r=null;if(this.response){var t=this.response.headers.get("age");r=t?parseFloat(t):null}return r},u.getResponseHeader=function(r){return this.response?this.response.headers.get(r):null},u.loadProgressively=function(r,t,i,l,f){l===void 0&&(l=0);var h=new Uu,g=r.body.getReader(),p=function(){return g.read().then(function(x){if(x.done)return h.dataLength&&f(t,i,h.flush().buffer,r),Promise.resolve(new ArrayBuffer(0));var b=x.value,_=b.length;return t.loaded+=_,_<l||h.dataLength?(h.push(b),h.dataLength>=l&&f(t,i,h.flush().buffer,r)):f(t,i,b.buffer,r),p()}).catch(function(){return Promise.reject()})};return p()},o}();function Kf(o,u){var a={method:"GET",mode:"cors",credentials:"same-origin",signal:u,headers:new self.Headers(T({},o.headers))};return o.rangeEnd&&a.headers.set("Range","bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)),a}function Wf(o){var u=Vf.exec(o);if(u)return parseInt(u[2])-parseInt(u[1])+1}function jf(o){var u=o.get("Content-Range");if(u){var a=Wf(u);if(ae(a))return a}var r=o.get("Content-Length");if(r)return parseInt(r)}function Yf(o,u){return new self.Request(o.url,u)}var zf=function(o){function u(a,r,t){var i;return i=o.call(this,a)||this,i.code=void 0,i.details=void 0,i.code=r,i.details=t,i}return C(u,o),u}(te(Error)),$f=/^age:\s*[\d.]+\s*$/im,Ds=function(){function o(a){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=a&&a.xhrSetup||null,this.stats=new Gi,this.retryDelay=0}var u=o.prototype;return u.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},u.abortInternal=function(){var r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))},u.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},u.load=function(r,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=t,this.callbacks=i,this.loadInternal()},u.loadInternal=function(){var r=this,t=this.config,i=this.context;if(!(!t||!i)){var l=this.loader=new self.XMLHttpRequest,f=this.stats;f.loading.first=0,f.loaded=0,f.aborted=!1;var h=this.xhrSetup;h?Promise.resolve().then(function(){if(!(r.loader!==l||r.stats.aborted))return h(l,i.url)}).catch(function(g){if(!(r.loader!==l||r.stats.aborted))return l.open("GET",i.url,!0),h(l,i.url)}).then(function(){r.loader!==l||r.stats.aborted||r.openAndSendXhr(l,i,t)}).catch(function(g){var p;(p=r.callbacks)==null||p.onError({code:l.status,text:g.message},i,l,f)}):this.openAndSendXhr(l,i,t)}},u.openAndSendXhr=function(r,t,i){r.readyState||r.open("GET",t.url,!0);var l=t.headers,f=i.loadPolicy,h=f.maxTimeToFirstByteMs,g=f.maxLoadTimeMs;if(l)for(var p in l)r.setRequestHeader(p,l[p]);t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=h&&ae(h)?h:g,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),r.send()},u.readystatechange=function(){var r=this.context,t=this.loader,i=this.stats;if(!(!r||!t)){var l=t.readyState,f=this.config;if(!i.aborted&&l>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),f.timeout!==f.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),f.timeout=f.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),f.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),l===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var h=t.status,g=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){var p=g??t.response;if(p!=null){var E,x;i.loading.end=Math.max(self.performance.now(),i.loading.first);var b=t.responseType==="arraybuffer"?p.byteLength:p.length;i.loaded=i.total=b,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);var _=(E=this.callbacks)==null?void 0:E.onProgress;_&&_(i,r,p,t);var L={url:t.responseURL,data:p,code:h};(x=this.callbacks)==null||x.onSuccess(L,i,r,t);return}}var k=f.loadPolicy.errorRetry,I=i.retry,w={url:r.url,data:void 0,code:h};if(ri(k,I,!1,w))this.retry(k);else{var O;Oe.error(h+" while loading "+r.url),(O=this.callbacks)==null||O.onError({code:h,text:t.statusText},r,t,i)}}}},u.loadtimeout=function(){if(this.config){var r=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(ri(r,t,!0))this.retry(r);else{var i;Oe.warn("timeout while loading "+((i=this.context)==null?void 0:i.url));var l=this.callbacks;l&&(this.abortInternal(),l.onTimeout(this.stats,this.context,this.loader))}}},u.retry=function(r){var t=this.context,i=this.stats;this.retryDelay=Xi(r,i.retry),i.retry++,Oe.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t?.url+", retrying "+i.retry+"/"+r.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},u.loadprogress=function(r){var t=this.stats;t.loaded=r.loaded,r.lengthComputable&&(t.total=r.total)},u.getCacheAge=function(){var r=null;if(this.loader&&$f.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");r=t?parseFloat(t):null}return r},u.getResponseHeader=function(r){return this.loader&&new RegExp("^"+r+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(r):null},o}(),Os={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},qf=U(U({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ds,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:su,bufferController:gu,capLevelController:mu,errorController:du,fpsController:Bu,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!1,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!1,certLoadPolicy:{default:Os},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:Os},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Xf()),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:Nu,interstitialsController:void 0});function Xf(){return{cueHandler:Il,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Qf(o,u,a){if((u.liveSyncDurationCount||u.liveMaxLatencyDurationCount)&&(u.liveSyncDuration||u.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(u.liveMaxLatencyDurationCount!==void 0&&(u.liveSyncDurationCount===void 0||u.liveMaxLatencyDurationCount<=u.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(u.liveMaxLatencyDuration!==void 0&&(u.liveSyncDuration===void 0||u.liveMaxLatencyDuration<=u.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=vn(o),t=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return t.forEach(function(l){var f=(l==="level"?"playlist":l)+"LoadPolicy",h=u[f]===void 0,g=[];i.forEach(function(p){var E=l+"Loading"+p,x=u[E];if(x!==void 0&&h){g.push(E);var b=r[f].default;switch(u[f]={default:b},p){case"TimeOut":b.maxLoadTimeMs=x,b.maxTimeToFirstByteMs=x;break;case"MaxRetry":b.errorRetry.maxNumRetry=x,b.timeoutRetry.maxNumRetry=x;break;case"RetryDelay":b.errorRetry.retryDelayMs=x,b.timeoutRetry.retryDelayMs=x;break;case"MaxRetryTimeout":b.errorRetry.maxRetryDelayMs=x,b.timeoutRetry.maxRetryDelayMs=x;break}}}),g.length&&a.warn('hls.js config: "'+g.join('", "')+'" setting(s) are deprecated, use "'+f+'": '+ct(u[f]))}),U(U({},r),u)}function vn(o){return o&&typeof o=="object"?Array.isArray(o)?o.map(vn):Object.keys(o).reduce(function(u,a){return u[a]=vn(o[a]),u},{}):o}function Zf(o,u){var a=o.loader;if(a!==ws&&a!==Ds)u.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1;else{var r=Gf();r&&(o.loader=ws,o.progressive=!0,o.enableSoftwareAES=!0,u.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var vt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Jf=function(){function o(a){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=a,this._registerListeners()}var u=o.prototype;return u._registerListeners=function(){var r=this.hls;r.on(P.MANIFEST_LOADING,this.onManifestLoading,this),r.on(P.BUFFER_APPENDED,this.onBufferAppended,this),r.on(P.FRAG_BUFFERED,this.onFragBuffered,this),r.on(P.FRAG_LOADED,this.onFragLoaded,this)},u._unregisterListeners=function(){var r=this.hls;r.off(P.MANIFEST_LOADING,this.onManifestLoading,this),r.off(P.BUFFER_APPENDED,this.onBufferAppended,this),r.off(P.FRAG_BUFFERED,this.onFragBuffered,this),r.off(P.FRAG_LOADED,this.onFragLoaded,this)},u.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},u.getAppendedFrag=function(r,t){var i=this.activePartLists[t];if(i)for(var l=i.length;l--;){var f=i[l];if(!f)break;var h=f.end;if(f.start<=r&&h!==null&&r<=h)return f}return this.getBufferedFrag(r,t)},u.getBufferedFrag=function(r,t){return this.getFragAtPos(r,t,!0)},u.getFragAtPos=function(r,t,i){for(var l=this.fragments,f=Object.keys(l),h=f.length;h--;){var g=l[f[h]];if(g?.body.type===t&&(!i||g.buffered)){var p=g.body;if(p.start<=r&&r<=p.end)return p}}return null},u.detectEvictedFragments=function(r,t,i,l,f){var h=this;this.timeRanges&&(this.timeRanges[r]=t);var g=l?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(p){var E=h.fragments[p];if(E&&!(g>=E.body.sn)){if(!E.buffered&&(!E.loaded||f)){E.body.type===i&&h.removeFragment(E.body);return}var x=E.range[r];if(x){if(x.time.length===0){h.removeFragment(E.body);return}x.time.some(function(b){var _=!h.isTimeBuffered(b.startPTS,b.endPTS,t);return _&&h.removeFragment(E.body),_})}}})},u.detectPartialFragments=function(r){var t=this,i=this.timeRanges;if(!(!i||r.frag.sn==="initSegment")){var l=r.frag,f=Er(l),h=this.fragments[f];if(!(!h||h.buffered&&l.gap)){var g=!l.relurl;if(Object.keys(i).forEach(function(E){var x=l.elementaryStreams[E];if(x){var b=i[E],_=g||x.partial===!0;h.range[E]=t.getBufferedTimes(l,r.part,_,b)}}),h.loaded=null,Object.keys(h.range).length){h.buffered=!0;var p=h.body.endList=l.endList||h.body.endList;p&&(this.endListFragments[h.body.type]=h),fi(h)||this.removeParts(l.sn-1,l.type)}else this.removeFragment(h.body)}}},u.removeParts=function(r,t){var i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter(function(l){return l.fragment.sn>=r}))},u.fragBuffered=function(r,t){var i=Er(r),l=this.fragments[i];!l&&t&&(l=this.fragments[i]={body:r,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},r.gap&&(this.hasGaps=!0)),l&&(l.loaded=null,l.buffered=!0)},u.getBufferedTimes=function(r,t,i,l){for(var f={time:[],partial:i},h=r.start,g=r.end,p=r.minEndPTS||g,E=r.maxStartPTS||h,x=0;x<l.length;x++){var b=l.start(x)-this.bufferPadding,_=l.end(x)+this.bufferPadding;if(E>=b&&p<=_){f.time.push({startPTS:Math.max(h,l.start(x)),endPTS:Math.min(g,l.end(x))});break}else if(h<_&&g>b){var L=Math.max(h,l.start(x)),k=Math.min(g,l.end(x));k>L&&(f.partial=!0,f.time.push({startPTS:L,endPTS:k}))}else if(g<=b)break}return f},u.getPartialFragment=function(r){var t=null,i,l,f,h=0,g=this.bufferPadding,p=this.fragments;return Object.keys(p).forEach(function(E){var x=p[E];x&&fi(x)&&(l=x.body.start-g,f=x.body.end+g,r>=l&&r<=f&&(i=Math.min(r-l,f-r),h<=i&&(t=x.body,h=i)))}),t},u.isEndListAppended=function(r){var t=this.endListFragments[r];return t!==void 0&&(t.buffered||fi(t))},u.getState=function(r){var t=Er(r),i=this.fragments[t];return i?i.buffered?fi(i)?vt.PARTIAL:vt.OK:vt.APPENDING:vt.NOT_LOADED},u.isTimeBuffered=function(r,t,i){for(var l,f,h=0;h<i.length;h++){if(l=i.start(h)-this.bufferPadding,f=i.end(h)+this.bufferPadding,r>=l&&t<=f)return!0;if(t<=l)return!1}return!1},u.onManifestLoading=function(){this.removeAllFragments()},u.onFragLoaded=function(r,t){if(!(t.frag.sn==="initSegment"||t.frag.bitrateTest)){var i=t.frag,l=t.part?null:t,f=Er(i);this.fragments[f]={body:i,appendedPTS:null,loaded:l,buffered:!1,range:Object.create(null)}}},u.onBufferAppended=function(r,t){var i=t.frag,l=t.part,f=t.timeRanges,h=t.type;if(i.sn!=="initSegment"){var g=i.type;if(l){var p=this.activePartLists[g];p||(this.activePartLists[g]=p=[]),p.push(l)}this.timeRanges=f;var E=f[h];this.detectEvictedFragments(h,E,g,l)}},u.onFragBuffered=function(r,t){this.detectPartialFragments(t)},u.hasFragment=function(r){var t=Er(r);return!!this.fragments[t]},u.hasFragments=function(r){var t=this.fragments,i=Object.keys(t);if(!r)return i.length>0;for(var l=i.length;l--;){var f=t[i[l]];if(f?.body.type===r)return!0}return!1},u.hasParts=function(r){var t;return!!((t=this.activePartLists[r])!=null&&t.length)},u.removeFragmentsInRange=function(r,t,i,l,f){var h=this;l&&!this.hasGaps||Object.keys(this.fragments).forEach(function(g){var p=h.fragments[g];if(p){var E=p.body;E.type!==i||l&&!E.gap||E.start<t&&E.end>r&&(p.buffered||f)&&h.removeFragment(E)}})},u.removeFragment=function(r){var t=Er(r);r.clearElementaryStreamInfo();var i=this.activePartLists[r.type];if(i){var l=r.sn;this.activePartLists[r.type]=i.filter(function(f){return f.fragment.sn!==l})}delete this.fragments[t],r.endList&&delete this.endListFragments[r.type]},u.removeAllFragments=function(){var r,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var i=(r=this.hls)==null||(t=r.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(function(l){return l.clearElementaryStreamInfo()})},o}();function fi(o){var u,a,r;return o.buffered&&(o.body.gap||((u=o.range.video)==null?void 0:u.partial)||((a=o.range.audio)==null?void 0:a.partial)||((r=o.range.audiovideo)==null?void 0:r.partial))}function Er(o){return o.type+"_"+o.level+"_"+o.sn}var Ms=Math.pow(2,17),ec=function(){function o(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var u=o.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(r,t){var i=this,l=r.url;if(!l)return Promise.reject(new Wt({type:be.NETWORK_ERROR,details:$.FRAG_LOAD_ERROR,fatal:!1,frag:r,error:new Error("Fragment does not have a "+(l?"part list":"url")),networkDetails:null}));this.abort();var f=this.config,h=f.fLoader,g=f.loader;return new Promise(function(p,E){if(i.loader&&i.loader.destroy(),r.gap)if(r.tagList.some(function(I){return I[0]==="GAP"})){E(Ns(r));return}else r.gap=!1;var x=i.loader=h?new h(f):new g(f),b=Fs(r);r.loader=x;var _=Ba(f.fragLoadPolicy.default),L={loadPolicy:_,timeout:_.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:r.sn==="initSegment"?1/0:Ms};r.stats=x.stats;var k={onSuccess:function(w,O,D,M){i.resetLoader(r,x);var G=w.data;D.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(G.slice(0,16)),G=G.slice(16)),p({frag:r,part:null,payload:G,networkDetails:M})},onError:function(w,O,D,M){i.resetLoader(r,x),E(new Wt({type:be.NETWORK_ERROR,details:$.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:U({url:l,data:void 0},w),error:new Error("HTTP Error "+w.code+" "+w.text),networkDetails:D,stats:M}))},onAbort:function(w,O,D){i.resetLoader(r,x),E(new Wt({type:be.NETWORK_ERROR,details:$.INTERNAL_ABORTED,fatal:!1,frag:r,error:new Error("Aborted"),networkDetails:D,stats:w}))},onTimeout:function(w,O,D){i.resetLoader(r,x),E(new Wt({type:be.NETWORK_ERROR,details:$.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,error:new Error("Timeout after "+L.timeout+"ms"),networkDetails:D,stats:w}))}};t&&(k.onProgress=function(I,w,O,D){return t({frag:r,part:null,payload:O,networkDetails:D})}),x.load(b,L,k)})},u.loadPart=function(r,t,i){var l=this;this.abort();var f=this.config,h=f.fLoader,g=f.loader;return new Promise(function(p,E){if(l.loader&&l.loader.destroy(),r.gap||t.gap){E(Ns(r,t));return}var x=l.loader=h?new h(f):new g(f),b=Fs(r,t);r.loader=x;var _=Ba(f.fragLoadPolicy.default),L={loadPolicy:_,timeout:_.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ms};t.stats=x.stats,x.load(b,L,{onSuccess:function(I,w,O,D){l.resetLoader(r,x),l.updateStatsFromPart(r,t);var M={frag:r,part:t,payload:I.data,networkDetails:D};i(M),p(M)},onError:function(I,w,O,D){l.resetLoader(r,x),E(new Wt({type:be.NETWORK_ERROR,details:$.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:t,response:U({url:b.url,data:void 0},I),error:new Error("HTTP Error "+I.code+" "+I.text),networkDetails:O,stats:D}))},onAbort:function(I,w,O){r.stats.aborted=t.stats.aborted,l.resetLoader(r,x),E(new Wt({type:be.NETWORK_ERROR,details:$.INTERNAL_ABORTED,fatal:!1,frag:r,part:t,error:new Error("Aborted"),networkDetails:O,stats:I}))},onTimeout:function(I,w,O){l.resetLoader(r,x),E(new Wt({type:be.NETWORK_ERROR,details:$.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:t,error:new Error("Timeout after "+L.timeout+"ms"),networkDetails:O,stats:I}))}})})},u.updateStatsFromPart=function(r,t){var i=r.stats,l=t.stats,f=l.total;if(i.loaded+=l.loaded,f){var h=Math.round(r.duration/t.duration),g=Math.min(Math.round(i.loaded/f),h),p=h-g,E=p*Math.round(i.loaded/g);i.total=i.loaded+E}else i.total=Math.max(i.loaded,i.total);var x=i.loading,b=l.loading;x.start?x.first+=b.first-b.start:(x.start=b.start,x.first=b.first),x.end=b.end},u.resetLoader=function(r,t){r.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},o}();function Fs(o,u){u===void 0&&(u=null);var a=u||o,r={frag:o,part:u,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},t=a.byteRangeStartOffset,i=a.byteRangeEndOffset;if(ae(t)&&ae(i)){var l,f=t,h=i;if(o.sn==="initSegment"&&tc((l=o.decryptdata)==null?void 0:l.method)){var g=i-t;g%16&&(h=i+(16-g%16)),t!==0&&(r.resetIV=!0,f=t-16)}r.rangeStart=f,r.rangeEnd=h}return r}function Ns(o,u){var a=new Error("GAP "+(o.gap?"tag":"attribute")+" found"),r={type:be.MEDIA_ERROR,details:$.FRAG_GAP,fatal:!1,frag:o,error:a,networkDetails:null};return u&&(r.part=u),(u||o).stats.aborted=!0,new Wt(r)}function tc(o){return o==="AES-128"||o==="AES-256"}var Wt=function(o){function u(a){var r;return r=o.call(this,a.error.message)||this,r.data=void 0,r.data=a,r}return C(u,o),u}(te(Error)),Bs=function(o){function u(r,t){var i;return i=o.call(this,r,t)||this,i._boundTick=void 0,i._tickTimer=null,i._tickInterval=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}C(u,o);var a=u.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.onHandlerDestroyed=function(){},a.hasInterval=function(){return!!this._tickInterval},a.hasNextTick=function(){return!!this._tickTimer},a.setInterval=function(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)},a.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},a.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},a.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},a.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},a.doTick=function(){},u}(gr),Us=function(u,a,r,t,i,l){t===void 0&&(t=0),i===void 0&&(i=-1),l===void 0&&(l=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ci(),this.buffering={audio:ci(),video:ci(),audiovideo:ci()},this.level=u,this.sn=a,this.id=r,this.size=t,this.part=i,this.partial=l};function ci(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Fr(o,u){for(var a=0,r=o.length;a<r;a++){var t;if(((t=o[a])==null?void 0:t.cc)===u)return o[a]}return null}function rc(o,u){return!!(o&&u.startCC<o.endCC&&u.endCC>o.startCC)}function Hs(o,u){if(o){var a=o.start+u;o.start=o.startPTS=a,o.endPTS=a+o.duration}}function Gs(o,u){for(var a=u.fragments,r=0,t=a.length;r<t;r++)Hs(a[r],o);u.fragmentHint&&Hs(u.fragmentHint,o),u.alignedSliding=!0}function ic(o,u){o&&(nc(u,o),!u.alignedSliding&&o&&ac(u,o),!u.alignedSliding&&o&&!u.skippedSegments&&ns(o,u,!1))}function nc(o,u){if(rc(u,o)){var a=Math.min(u.endCC,o.endCC),r=Fr(u.fragments,a),t=Fr(o.fragments,a);if(!(!r||!t)){Oe.log("Aligning playlist at start of dicontinuity sequence "+a);var i=r.start-t.start;Gs(i,o)}}}function ac(o,u){if(!(!o.hasProgramDateTime||!u.hasProgramDateTime)){var a=o.fragments,r=u.fragments;if(!(!a.length||!r.length)){var t,i,l=Math.min(u.endCC,o.endCC);u.startCC<l&&o.startCC<l&&(t=Fr(r,l),i=Fr(a,l)),(!t||!i)&&(t=r[Math.floor(r.length/2)],i=Fr(a,t.cc)||a[Math.floor(a.length/2)]);var f=t.programDateTime,h=i.programDateTime;if(!(!f||!h)){var g=(h-f)/1e3-(i.start-t.start);Gs(g,o)}}}}var sc={toString:function(u){for(var a="",r=u.length,t=0;t<r;t++)a+="["+u.start(t).toFixed(3)+"-"+u.end(t).toFixed(3)+"]";return a}},ie={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_LEVEL:"WAITING_LEVEL"},oc=function(o){function u(r,t,i,l,f){var h;return h=o.call(this,l,r.logger)||this,h.hls=void 0,h.fragPrevious=null,h.fragCurrent=null,h.fragmentTracker=void 0,h.transmuxer=null,h._state=ie.STOPPED,h.playlistType=void 0,h.media=null,h.mediaBuffer=null,h.config=void 0,h.bitrateTest=!1,h.lastCurrentTime=0,h.nextLoadPosition=0,h.startPosition=0,h.startTimeOffset=null,h.retryDate=0,h.levels=null,h.fragmentLoader=void 0,h.keyLoader=void 0,h.levelLastLoaded=null,h.startFragRequested=!1,h.decrypter=void 0,h.initPTS=[],h.buffering=!0,h.loadingParts=!1,h.loopSn=void 0,h.onMediaSeeking=function(){var g=h,p=g.config,E=g.fragCurrent,x=g.media,b=g.mediaBuffer,_=g.state,L=x?x.currentTime:0,k=Ne.bufferInfo(b||x,L,p.maxBufferHole);if(h.log("media seeking to "+(ae(L)?L.toFixed(3):L)+", state: "+_),h.state===ie.ENDED)h.resetLoadingState();else if(E){var I=p.maxFragLookUpTolerance,w=E.start-I,O=E.start+E.duration+I;if(!k.len||O<k.start||w>k.end){var D=L>O;(L<w||D)&&(D&&E.loader&&(h.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),E.abortRequests(),h.resetLoadingState()),h.fragPrevious=null)}}if(x){h.fragmentTracker.removeFragmentsInRange(L,1/0,h.playlistType,!0);var M=h.lastCurrentTime;if(L>M&&(h.lastCurrentTime=L),!h.loadingParts){var G=Math.max(k.end,L),N=h.shouldLoadParts(h.getLevelDetails(),G);N&&(h.log("LL-Part loading ON after seeking to "+L.toFixed(2)+" with buffer @"+G.toFixed(2)),h.loadingParts=N)}}!h.hls.hasEnoughToStart&&!k.len&&(h.log("setting startPosition to "+L+" because of seek before start"),h.nextLoadPosition=h.startPosition=L),h.tickImmediate()},h.onMediaEnded=function(){h.log("setting startPosition to 0 because media ended"),h.startPosition=h.lastCurrentTime=0},h.playlistType=f,h.hls=r,h.fragmentLoader=new ec(r.config),h.keyLoader=i,h.fragmentTracker=t,h.config=r.config,h.decrypter=new sn(r.config),h}C(u,o);var a=u.prototype;return a.registerListeners=function(){var t=this.hls;t.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(P.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(P.ERROR,this.onError,this)},a.unregisterListeners=function(){var t=this.hls;t.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(P.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(P.ERROR,this.onError,this)},a.doTick=function(){this.onTickEnd()},a.onTickEnd=function(){},a.startLoad=function(t){},a.stopLoad=function(){if(this.state!==ie.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ie.STOPPED}},a.pauseBuffering=function(){this.buffering=!1},a.resumeBuffering=function(){this.buffering=!0},a._streamEnded=function(t,i){if(i.live||!this.media)return!1;var l=t.end||0,f=this.config.timelineOffset||0;if(l<=f)return!1;var h=t.nextStart,g=h&&h>f&&h<i.edge;if(g||this.media.currentTime<t.start)return!1;var p=i.partList;if(p!=null&&p.length){var E=p[p.length-1],x=Ne.isBuffered(this.media,E.start+E.duration/2);return x}var b=i.fragments[i.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(b)},a.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var t;return(t=this.levelLastLoaded)==null?void 0:t.details}},a.onMediaAttached=function(t,i){var l=this.media=this.mediaBuffer=i.media;l.removeEventListener("seeking",this.onMediaSeeking),l.removeEventListener("ended",this.onMediaEnded),l.addEventListener("seeking",this.onMediaSeeking),l.addEventListener("ended",this.onMediaEnded);var f=this.config;this.levels&&f.autoStartLoad&&this.state===ie.STOPPED&&this.startLoad(f.startPosition)},a.onMediaDetaching=function(t,i){var l=!!i.transferMedia,f=this.media;if(f!==null){if(f.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),f.removeEventListener("seeking",this.onMediaSeeking),f.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!l&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,l){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},a.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},a.onError=function(t,i){},a.onManifestLoaded=function(t,i){this.startTimeOffset=i.startTimeOffset},a.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),o.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},a.onHandlerDestroyed=function(){this.state=ie.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,o.prototype.onHandlerDestroyed.call(this)},a.loadFragment=function(t,i,l){this.startFragRequested=!0,this._loadFragForPlayback(t,i,l)},a._loadFragForPlayback=function(t,i,l){var f=this,h=function(p){var E=p.frag;if(f.fragContextChanged(E)){f.warn(E.type+" sn: "+E.sn+(p.part?" part: "+p.part.index:"")+" of "+f.fragInfo(E,!1,p.part)+") was dropped during download."),f.fragmentTracker.removeFragment(E);return}E.stats.chunkCount++,f._handleFragmentLoadProgress(p)};this._doFragLoad(t,i,l,h).then(function(g){if(g){var p=f.state,E=g.frag;if(f.fragContextChanged(E)){(p===ie.FRAG_LOADING||!f.fragCurrent&&p===ie.PARSING)&&(f.fragmentTracker.removeFragment(E),f.state=ie.IDLE);return}"payload"in g&&(f.log("Loaded "+E.type+" sn: "+E.sn+" of "+f.playlistLabel()+" "+E.level),f.hls.trigger(P.FRAG_LOADED,g)),f._handleFragmentLoadComplete(g)}}).catch(function(g){f.state===ie.STOPPED||f.state===ie.ERROR||(f.warn("Frag error: "+(g?.message||g)),f.resetFragmentLoading(t))})},a.clearTrackerIfNeeded=function(t){var i,l=this.fragmentTracker,f=l.getState(t);if(f===vt.APPENDING){var h=t.type,g=this.getFwdBufferInfo(this.mediaBuffer,h),p=Math.max(t.duration,g?g.len:this.config.maxBufferLength),E=this.backtrackFragment,x=E?t.sn-E.sn:0;(x===1||this.reduceMaxBufferLength(p,t.duration))&&l.removeFragment(t)}else((i=this.mediaBuffer)==null?void 0:i.buffered.length)===0?l.removeAllFragments():l.hasParts(t.type)&&(l.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),l.getState(t)===vt.PARTIAL&&l.removeFragment(t))},a.checkLiveUpdate=function(t){if(t.updated&&!t.live){var i=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)},a.waitForLive=function(t){var i=t.details;return i?.live&&i.type!=="EVENT"&&(this.levelLastLoaded!==t||i.expired)},a.flushMainBuffer=function(t,i,l){if(l===void 0&&(l=null),!!(t-i)){var f={startOffset:t,endOffset:i,type:l};this.hls.trigger(P.BUFFER_FLUSHING,f)}},a._loadInitSegment=function(t,i){var l=this;this._doFragLoad(t,i).then(function(f){var h=f?.frag;if(!h||l.fragContextChanged(h)||!l.levels)throw new Error("init load aborted");return f}).then(function(f){var h=l.hls,g=f.frag,p=f.payload,E=g.decryptdata;if(p&&p.byteLength>0&&E!=null&&E.key&&E.iv&&Dr(E.method)){var x=self.performance.now();return l.decrypter.decrypt(new Uint8Array(p),E.key.buffer,E.iv.buffer,ja(E.method)).catch(function(b){throw h.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_DECRYPT_ERROR,fatal:!1,error:b,reason:b.message,frag:g}),b}).then(function(b){var _=self.performance.now();return h.trigger(P.FRAG_DECRYPTED,{frag:g,payload:b,stats:{tstart:x,tdecrypt:_}}),f.payload=b,l.completeInitSegmentLoad(f)})}return l.completeInitSegmentLoad(f)}).catch(function(f){l.state===ie.STOPPED||l.state===ie.ERROR||(l.warn(f),l.resetFragmentLoading(t))})},a.completeInitSegmentLoad=function(t){var i=this.levels;if(!i)throw new Error("init load aborted, missing levels");var l=t.frag.stats;this.state!==ie.STOPPED&&(this.state=ie.IDLE),t.frag.data=new Uint8Array(t.payload),l.parsing.start=l.buffering.start=self.performance.now(),l.parsing.end=l.buffering.end=self.performance.now(),this.tick()},a.fragContextChanged=function(t){var i=this.fragCurrent;return!t||!i||t.sn!==i.sn||t.level!==i.level},a.fragBufferedComplete=function(t,i){var l=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+t.type+" sn: "+t.sn+(i?" part: "+i.index:"")+" of "+this.fragInfo(t,!1,i)+" > buffer:"+(l?sc.toString(Ne.getBuffered(l)):"(detached)")+")"),Mt(t)){var f;if(t.type!==Ce.SUBTITLE){var h=t.elementaryStreams;if(!Object.keys(h).some(function(p){return!!h[p]})){this.state=ie.IDLE;return}}var g=(f=this.levels)==null?void 0:f[t.level];g!=null&&g.fragmentError&&(this.log("Resetting level fragment error count of "+g.fragmentError+" on frag buffered"),g.fragmentError=0)}this.state=ie.IDLE},a._handleFragmentLoadComplete=function(t){var i=this.transmuxer;if(i){var l=t.frag,f=t.part,h=t.partsLoaded,g=!h||h.length===0||h.some(function(E){return!E}),p=new Us(l.level,l.sn,l.stats.chunkCount+1,0,f?f.index:-1,!g);i.flush(p)}},a._handleFragmentLoadProgress=function(t){},a._doFragLoad=function(t,i,l,f){var h,g=this;l===void 0&&(l=null),this.fragCurrent=t;var p=i?.details;if(!this.levels||!p)throw new Error("frag load aborted, missing level"+(p?"":" detail")+"s");var E=null;t.encrypted&&!((h=t.decryptdata)!=null&&h.key)?(this.log("Loading key for "+t.sn+" of ["+p.startSN+"-"+p.endSN+"], "+this.playlistLabel()+" "+t.level),this.state=ie.KEY_LOADING,this.fragCurrent=t,E=this.keyLoader.load(t).then(function(D){if(!g.fragContextChanged(D.frag))return g.hls.trigger(P.KEY_LOADED,D),g.state===ie.KEY_LOADING&&(g.state=ie.IDLE),D}),this.hls.trigger(P.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(E=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!t.encrypted&&p.encryptedFragments.length&&this.keyLoader.loadClear(t,p.encryptedFragments);var x=this.fragPrevious;if(Mt(t)&&(!x||t.sn!==x.sn)){var b=this.shouldLoadParts(i.details,t.end);b!==this.loadingParts&&(this.log("LL-Part loading "+(b?"ON":"OFF")+" loading sn "+x?.sn+"->"+t.sn),this.loadingParts=b)}if(l=Math.max(t.start,l||0),this.loadingParts&&Mt(t)){var _=p.partList;if(_&&f){l>t.end&&p.fragmentHint&&(t=p.fragmentHint);var L=this.getNextPart(_,t,l);if(L>-1){var k=_[L];t=this.fragCurrent=k.fragment,this.log("Loading "+t.type+" sn: "+t.sn+" part: "+k.index+" ("+L+"/"+(_.length-1)+") of "+this.fragInfo(t,!1,k)+") cc: "+t.cc+" ["+p.startSN+"-"+p.endSN+"], target: "+parseFloat(l.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=ie.FRAG_LOADING;var I;return E?I=E.then(function(D){return!D||g.fragContextChanged(D.frag)?null:g.doFragPartsLoad(t,k,i,f)}).catch(function(D){return g.handleFragLoadError(D)}):I=this.doFragPartsLoad(t,k,i,f).catch(function(D){return g.handleFragLoadError(D)}),this.hls.trigger(P.FRAG_LOADING,{frag:t,part:k,targetBufferTime:l}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):I}else if(!t.url||this.loadedEndOfParts(_,l))return Promise.resolve(null)}}if(Mt(t)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @"+l.toFixed(2)),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log("Loading "+t.type+" sn: "+t.sn+" of "+this.fragInfo(t,!1)+") cc: "+t.cc+" "+(p?"["+p.startSN+"-"+p.endSN+"]":"")+", target: "+parseFloat(l.toFixed(3))),ae(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=ie.FRAG_LOADING;var w=this.config.progressive,O;return w&&E?O=E.then(function(D){return!D||g.fragContextChanged(D?.frag)?null:g.fragmentLoader.load(t,f)}).catch(function(D){return g.handleFragLoadError(D)}):O=Promise.all([this.fragmentLoader.load(t,w?f:void 0),E]).then(function(D){var M=D[0];return!w&&M&&f&&f(M),M}).catch(function(D){return g.handleFragLoadError(D)}),this.hls.trigger(P.FRAG_LOADING,{frag:t,targetBufferTime:l}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):O},a.doFragPartsLoad=function(t,i,l,f){var h=this;return new Promise(function(g,p){var E,x=[],b=(E=l.details)==null?void 0:E.partList,_=function(k){h.fragmentLoader.loadPart(t,k,f).then(function(I){x[k.index]=I;var w=I.part;h.hls.trigger(P.FRAG_LOADED,I);var O=ss(l.details,t.sn,k.index+1)||os(b,t.sn,k.index+1);if(O)_(O);else return g({frag:t,part:w,partsLoaded:x})}).catch(p)};_(i)})},a.handleFragLoadError=function(t){if("data"in t){var i=t.data;t.data&&i.details===$.INTERNAL_ABORTED?this.handleFragLoadAborted(i.frag,i.part):this.hls.trigger(P.ERROR,i)}else this.hls.trigger(P.ERROR,{type:be.OTHER_ERROR,details:$.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},a._handleTransmuxerFlush=function(t){var i=this.getCurrentContext(t);if(!i||this.state!==ie.PARSING){!this.fragCurrent&&this.state!==ie.STOPPED&&this.state!==ie.ERROR&&(this.state=ie.IDLE);return}var l=i.frag,f=i.part,h=i.level,g=self.performance.now();l.stats.parsing.end=g,f&&(f.stats.parsing.end=g);var p=this.getLevelDetails(),E=p&&l.sn>p.endSN,x=E||this.shouldLoadParts(p,l.end);x!==this.loadingParts&&(this.log("LL-Part loading "+(x?"ON":"OFF")+" after parsing segment ending @"+l.end.toFixed(2)),this.loadingParts=x),this.updateLevelTiming(l,f,h,t.partial)},a.shouldLoadParts=function(t,i){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t!=null&&t.partList){var l,f=t.partList[0],h=f.end+(((l=t.fragmentHint)==null?void 0:l.duration)||0);if(i>=h){var g,p=this.hls.hasEnoughToStart?((g=this.media)==null?void 0:g.currentTime)||this.lastCurrentTime:this.getLoadPosition();if(p>f.start-f.fragment.duration)return!0}}}return!1},a.getCurrentContext=function(t){var i=this.levels,l=this.fragCurrent,f=t.level,h=t.sn,g=t.part;if(!(i!=null&&i[f]))return this.warn("Levels object was unset while buffering fragment "+h+" of "+this.playlistLabel()+" "+f+". The current chunk will not be buffered."),null;var p=i[f],E=p.details,x=g>-1?ss(E,h,g):null,b=x?x.fragment:Mu(E,h,l);return b?(l&&l!==b&&(b.stats=l.stats),{frag:b,part:x,level:p}):null},a.bufferFragmentData=function(t,i,l,f,h){var g;if(!(!t||this.state!==ie.PARSING)){var p=t.data1,E=t.data2,x=p;if(p&&E&&(x=kt(p,E)),!!((g=x)!=null&&g.length)){var b={type:t.type,frag:i,part:l,chunkMeta:f,parent:i.type,data:x};if(this.hls.trigger(P.BUFFER_APPENDING,b),t.dropped&&t.independent&&!l){if(h)return;this.flushBufferGap(i)}}}},a.flushBufferGap=function(t){var i=this.media;if(i){if(!Ne.isBuffered(i,i.currentTime)){this.flushMainBuffer(0,t.start);return}var l=i.currentTime,f=Ne.bufferInfo(i,l,0),h=t.duration,g=Math.min(this.config.maxFragLookUpTolerance*2,h*.25),p=Math.max(Math.min(t.start-g,f.end-g),l+g);t.start-p>g&&this.flushMainBuffer(p,t.start)}},a.getFwdBufferInfo=function(t,i){var l,f=this.getLoadPosition();if(!ae(f))return null;var h=this.lastCurrentTime>f,g=h||(l=this.media)!=null&&l.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,f,i,g)},a.getFwdBufferInfoAtPos=function(t,i,l,f){var h=Ne.bufferInfo(t,i,f);if(h.len===0&&h.nextStart!==void 0){var g=this.fragmentTracker.getBufferedFrag(i,l);if(g&&(h.nextStart<=g.end||g.gap)){var p=Math.max(Math.min(h.nextStart,g.end)-i,f);return Ne.bufferInfo(t,i,p)}}return h},a.getMaxBufferLength=function(t){var i=this.config,l;return t?l=Math.max(8*i.maxBufferSize/t,i.maxBufferLength):l=i.maxBufferLength,Math.min(l,i.maxMaxBufferLength)},a.reduceMaxBufferLength=function(t,i){var l=this.config,f=Math.max(Math.min(t-i,l.maxBufferLength),i),h=Math.max(t-i*3,l.maxMaxBufferLength/2,f);return h>=f?(l.maxMaxBufferLength=h,this.warn("Reduce max buffer length to "+h+"s"),!0):!1},a.getAppendedFrag=function(t,i){var l;i===void 0&&(i=Ce.MAIN);var f=(l=this.fragmentTracker)==null?void 0:l.getAppendedFrag(t,i);return f&&"fragment"in f?f.fragment:f},a.getNextFragment=function(t,i){var l=i.fragments,f=l.length;if(!f)return null;var h=this.config,g=l[0].start,p=h.lowLatencyMode&&!!i.partList,E=null;if(i.live){var x=h.initialLiveManifestSize;if(f<x)return this.warn("Not enough fragments to start playback (have: "+f+", need: "+x+")"),null;if(!i.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<g){var b;p&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),E=this.getInitialLiveFragment(i,l);var _=this.hls.startPosition,L=this.hls.liveSyncPosition,k=E?(_!==-1&&_>=g?_:L)||E.start:t;this.log("Setting startPosition to "+k+" to match start frag at live edge. mainStart: "+_+" liveSyncPosition: "+L+" frag.start: "+((b=E)==null?void 0:b.start)),this.startPosition=this.nextLoadPosition=k}}else t<=g&&(E=l[0]);if(!E){var I=this.loadingParts?i.partEnd:i.fragmentEnd;E=this.getFragmentAtPosition(t,I,i)}var w=this.filterReplacedPrimary(E,i);if(!w&&E){var O=E.sn-i.startSN;w=this.filterReplacedPrimary(l[O+1]||null,i)}return this.mapToInitFragWhenRequired(w)},a.isLoopLoading=function(t,i){var l=this.fragmentTracker.getState(t);return(l===vt.OK||l===vt.PARTIAL&&!!t.gap)&&this.nextLoadPosition>i},a.getNextFragmentLoopLoading=function(t,i,l,f,h){var g=null;if(t.gap&&(g=this.getNextFragment(this.nextLoadPosition,i),g&&!g.gap&&l.nextStart)){var p=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,l.nextStart,f,0);if(p!==null&&l.len+p.len>=h){var E=g.sn;return this.loopSn!==E&&(this.log('buffer full after gaps in "'+f+'" playlist starting at sn: '+E),this.loopSn=E),null}}return this.loopSn=void 0,g},a.filterReplacedPrimary=function(t,i){return t&&(Vs(this.hls.config),t)},a.mapToInitFragWhenRequired=function(t){return t!=null&&t.initSegment&&!(t!=null&&t.initSegment.data)&&!this.bitrateTest?t.initSegment:t},a.getNextPart=function(t,i,l){for(var f=-1,h=!1,g=!0,p=0,E=t.length;p<E;p++){var x=t[p];if(g=g&&!x.independent,f>-1&&l<x.start)break;var b=x.loaded;b?f=-1:(h||x.independent||g)&&x.fragment===i&&(f=p),h=b}return f},a.loadedEndOfParts=function(t,i){var l=t[t.length-1];return l&&i>l.start&&l.loaded},a.getInitialLiveFragment=function(t,i){var l=this.fragPrevious,f=null;if(l){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),f=lu(i,l.endProgramDateTime,this.config.maxFragLookUpTolerance)),!f){var h=l.sn+1;if(h>=t.startSN&&h<=t.endSN){var g=i[h-t.startSN];l.cc===g.cc&&(f=g,this.log("Live playlist, switching playlist, load frag with next SN: "+f.sn))}f||(f=cu(i,l.cc),f&&this.log("Live playlist, switching playlist, load frag with same CC: "+f.sn))}}else{var p=this.hls.liveSyncPosition;p!==null&&(f=this.getFragmentAtPosition(p,this.bitrateTest?t.fragmentEnd:t.edge,t))}return f},a.getFragmentAtPosition=function(t,i,l){var f=this.config,h=this.fragPrevious,g=l.fragments,p=l.endSN,E=l.fragmentHint,x=f.maxFragLookUpTolerance,b=l.partList,_=!!(this.loadingParts&&b!=null&&b.length&&E);_&&E&&!this.bitrateTest&&b[b.length-1].fragment.sn===E.sn&&(g=g.concat(E),p=E.sn);var L;if(t<i){var k,I=t<this.lastCurrentTime,w=I||t>i-x||(k=this.media)!=null&&k.paused||!this.startFragRequested?0:x;L=qi(h,g,t,w)}else L=g[g.length-1];if(L){var O=L.sn-l.startSN,D=this.fragmentTracker.getState(L);if((D===vt.OK||D===vt.PARTIAL&&L.gap)&&(h=L),h&&L.sn===h.sn&&(!_||b[0].fragment.sn>L.sn||!l.live&&!_)){var M=h&&L.level===h.level;if(M){var G=g[O+1];L.sn<p&&this.fragmentTracker.getState(G)!==vt.OK?L=G:L=null}}}return L},a.alignPlaylists=function(t,i,l){var f=t.fragments.length;if(!f)return this.warn("No fragments in live playlist"),0;var h=t.fragmentStart,g=!i,p=t.alignedSliding&&ae(h);if(g||!p&&!h){ic(l,t);var E=t.fragmentStart;return this.log("Live playlist sliding: "+E.toFixed(2)+" start-sn: "+(i?i.startSN:"na")+"->"+t.startSN+" fragments: "+f),E}return h},a.waitForCdnTuneIn=function(t){var i=3;return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*i)},a.setStartPosition=function(t,i){var l=this.startPosition;l<i&&(l=-1);var f=this.timelineOffset;if(l===-1){var h=this.startTimeOffset!==null,g=h?this.startTimeOffset:t.startTimeOffset;g!==null&&ae(g)?(l=i+g,g<0&&(l+=t.edge),l=Math.min(Math.max(i,l),i+t.totalduration),this.log("Setting startPosition to "+l+" for start time offset "+g+" found in "+(h?"multivariant":"media")+" playlist"),this.startPosition=l):t.live?(l=this.hls.liveSyncPosition||i,this.log("Setting startPosition to -1 to start at live edge "+l),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=l=0),this.lastCurrentTime=l+f}this.nextLoadPosition=l+f},a.getLoadPosition=function(){var t,i=this.media,l=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&i?l=i.currentTime:this.nextLoadPosition>=0&&(l=this.nextLoadPosition),l},a.handleFragLoadAborted=function(t,i){this.transmuxer&&t.type===this.playlistType&&Mt(t)&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(i?" part "+i.index:"")+" of "+this.playlistLabel()+" "+t.level+" was aborted"),this.resetFragmentLoading(t))},a.resetFragmentLoading=function(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==ie.FRAG_LOADING_WAITING_RETRY)&&(this.state=ie.IDLE)},a.onFragmentOrKeyLoadError=function(t,i){if(i.chunkMeta&&!i.frag){var l=this.getCurrentContext(i.chunkMeta);l&&(i.frag=l.frag)}var f=i.frag;if(!(!f||f.type!==t||!this.levels)){if(this.fragContextChanged(f)){var h;this.warn("Frag load error must match current frag to retry "+f.url+" > "+((h=this.fragCurrent)==null?void 0:h.url));return}var g=i.details===$.FRAG_GAP;g&&this.fragmentTracker.fragBuffered(f,!0);var p=i.errorAction,E=p||{},x=E.action,b=E.flags,_=E.retryCount,L=_===void 0?0:_,k=E.retryConfig,I=!!p&&!!k,w=I&&x===st.RetryRequest,O=I&&!p.resolved&&b===Rt.MoveAllAlternatesMatchingHost;if(!w&&O&&Mt(f)&&!f.endList)this.resetFragmentErrors(t),this.treatAsGap(f),p.resolved=!0;else if((w||O)&&L<k.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);var D=Xi(k,L);this.warn("Fragment "+f.sn+" of "+t+" "+f.level+" errored with "+i.details+", retrying loading "+(L+1)+"/"+k.maxNumRetry+" in "+D+"ms"),p.resolved=!0,this.retryDate=self.performance.now()+D,this.state=ie.FRAG_LOADING_WAITING_RETRY}else if(k&&p)if(this.resetFragmentErrors(t),L<k.maxNumRetry)!g&&x!==st.RemoveAlternatePermanently&&(p.resolved=!0);else{this.warn(i.details+" reached or exceeded max retry ("+L+")");return}else x===st.SendAlternateToPenaltyBox?this.state=ie.WAITING_LEVEL:this.state=ie.ERROR;this.tickImmediate()}},a.reduceLengthAndFlushBuffer=function(t){if(this.state===ie.PARSING||this.state===ie.PARSED){var i=t.frag,l=t.parent,f=this.getFwdBufferInfo(this.mediaBuffer,l),h=f&&f.len>.5;h&&this.reduceMaxBufferLength(f.len,i?.duration||10);var g=!h;return g&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+l+" buffer"),i&&(this.fragmentTracker.removeFragment(i),this.nextLoadPosition=i.start),this.resetLoadingState(),g}return!1},a.resetFragmentErrors=function(t){t===Ce.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ie.STOPPED&&(this.state=ie.IDLE)},a.afterBufferFlushed=function(t,i,l){if(t){var f=Ne.getBuffered(t);this.fragmentTracker.detectEvictedFragments(i,f,l),this.state===ie.ENDED&&this.resetLoadingState()}},a.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ie.STOPPED&&(this.state=ie.IDLE)},a.resetStartWhenNotLoaded=function(t){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var i=t?t.details:null;i!=null&&i.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(i,i.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},a.resetWhenMissingContext=function(t){this.warn("The loading context changed while buffering fragment "+t.sn+" of "+this.playlistLabel()+" "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},a.removeUnbufferedFrags=function(t){t===void 0&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},a.updateLevelTiming=function(t,i,l,f){var h=this,g=l.details;if(!g){this.warn("level.details undefined");return}var p=Object.keys(t.elementaryStreams).reduce(function(b,_){var L=t.elementaryStreams[_];if(L){var k=L.endPTS-L.startPTS;if(k<=0)return h.warn("Could not parse fragment "+t.sn+" "+_+" duration reliably ("+k+")"),b||!1;var I=f?0:rs(g,t,L.startPTS,L.endPTS,L.startDTS,L.endDTS);return h.hls.trigger(P.LEVEL_PTS_UPDATED,{details:g,level:l,drift:I,type:_,frag:t,start:L.startPTS,end:L.endPTS}),!0}return b},!1);if(!p){var E;if(l.fragmentError===0&&this.treatAsGap(t,l),((E=this.transmuxer)==null?void 0:E.error)===null){var x=new Error("Found no media in fragment "+t.sn+" of "+this.playlistLabel()+" "+t.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(x.message),this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!1,error:x,frag:t,reason:"Found no media in msn "+t.sn+" of "+this.playlistLabel()+' "'+l.url+'"'}),!this.hls)return;this.resetTransmuxer()}}this.state=ie.PARSED,this.log("Parsed "+t.type+" sn: "+t.sn+(i?" part: "+i.index:"")+" of "+this.fragInfo(t,!1,i)+")"),this.hls.trigger(P.FRAG_PARSED,{frag:t,part:i})},a.playlistLabel=function(){return this.playlistType===Ce.MAIN?"level":"track"},a.fragInfo=function(t,i,l){var f,h;return i===void 0&&(i=!0),this.playlistLabel()+" "+t.level+" ("+(l?"part":"frag")+":["+((f=i&&!l?t.startPTS:(l||t).start)!=null?f:NaN).toFixed(3)+"-"+((h=i&&!l?t.endPTS:(l||t).end)!=null?h:NaN).toFixed(3)+"]"+(l&&t.type==="main"?"INDEPENDENT="+(l.independent?"YES":"NO"):"")},a.treatAsGap=function(t,i){i&&i.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)},a.resetTransmuxer=function(){var t;(t=this.transmuxer)==null||t.reset()},a.recoverWorkerError=function(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},c(u,[{key:"startPositionValue",get:function(){var t=this.nextLoadPosition,i=this.startPosition;return i===-1&&t?t:i}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var t=this.config.timelineOffset;if(t){var i;return((i=this.getLevelDetails())==null?void 0:i.appliedTimelineOffset)||t}return 0}},{key:"primaryPrefetch",get:function(){return Vs(this.hls.config),!1}},{key:"state",get:function(){return this._state},set:function(t){var i=this._state;i!==t&&(this._state=t,this.log(i+"->"+t))}}])}(Bs);function Vs(o){return!1}function Nr(o,u,a){Tr(o,u,a),o.addEventListener(u,a)}function Tr(o,u,a){o.removeEventListener(u,a)}var hi=2,lc=.1,uc=.05,fc=100,cc=function(o){function u(r,t){var i;return i=o.call(this,"gap-controller",r.logger)||this,i.hls=null,i.fragmentTracker=null,i.media=null,i.mediaSource=void 0,i.nudgeRetry=0,i.stallReported=!1,i.stalled=null,i.moved=!1,i.seeking=!1,i.buffered={},i.lastCurrentTime=0,i.ended=0,i.waiting=0,i.onMediaPlaying=function(){i.ended=0,i.waiting=0},i.onMediaWaiting=function(){var l;(l=i.media)!=null&&l.seeking||(i.waiting=self.performance.now(),i.tick())},i.onMediaEnded=function(){if(i.hls){var l;i.ended=((l=i.media)==null?void 0:l.currentTime)||1,i.hls.trigger(P.MEDIA_ENDED,{stalled:!1})}},i.hls=r,i.fragmentTracker=t,i.registerListeners(),i}C(u,o);var a=u.prototype;return a.registerListeners=function(){var t=this.hls;t&&(t.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(P.BUFFER_APPENDED,this.onBufferAppended,this))},a.unregisterListeners=function(){var t=this.hls;t&&(t.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(P.BUFFER_APPENDED,this.onBufferAppended,this))},a.destroy=function(){o.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},a.onMediaAttached=function(t,i){this.setInterval(fc),this.mediaSource=i.mediaSource;var l=this.media=i.media;Nr(l,"playing",this.onMediaPlaying),Nr(l,"waiting",this.onMediaWaiting),Nr(l,"ended",this.onMediaEnded)},a.onMediaDetaching=function(t,i){this.clearInterval();var l=this.media;l&&(Tr(l,"playing",this.onMediaPlaying),Tr(l,"waiting",this.onMediaWaiting),Tr(l,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},a.onBufferAppended=function(t,i){this.buffered=i.timeRanges},a.tick=function(){var t;if(!(!((t=this.media)!=null&&t.readyState)||!this.hasBuffered)){var i=this.media.currentTime;this.poll(i,this.lastCurrentTime),this.lastCurrentTime=i}},a.poll=function(t,i){var l,f,h=(l=this.hls)==null?void 0:l.config;if(h){var g=this.media,p=this.stalled;if(g){var E=g.seeking,x=this.seeking&&!E,b=!this.seeking&&E,_=g.paused&&!E||g.ended||g.playbackRate===0;if(this.seeking=E,t!==i){i&&(this.ended=0),this.moved=!0,E||(this.nudgeRetry=0,h.nudgeOnVideoHole&&!_&&t>i&&this.nudgeOnVideoHole(t,i)),this.waiting===0&&this.stallResolved(t);return}if(b||x){x&&this.stallResolved(t);return}if(_){this.nudgeRetry=0,this.stallResolved(t),!this.ended&&g.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!1}));return}if(!Ne.getBuffered(g).length){this.nudgeRetry=0;return}var L=Ne.bufferInfo(g,t,0),k=L.nextStart||0,I=this.fragmentTracker;if(E&&I&&this.hls){var w=Ks(this.hls.inFlightFragments,t),O=L.len>hi,D=!k||w||k-t>hi&&!I.getPartialFragment(t);if(O||D)return;this.moved=!1}var M=(f=this.hls)==null?void 0:f.latestLevelDetails;if(!this.moved&&this.stalled!==null&&I){var G=L.len>0;if(!G&&!k)return;var N=Math.max(k,L.start||0)-t,H=!!(M!=null&&M.live),X=H?M.targetduration*2:hi,Y=I.getPartialFragment(t);if(N>0&&(N<=X||Y)){g.paused||this._trySkipBufferHole(Y);return}}var V=h.detectStallWithCurrentTimeMs,j=self.performance.now(),Q=this.waiting;if(p===null){Q>0&&j-Q<V?this.stalled=Q:this.stalled=j;return}var se=j-p;if(!E&&(se>=V||Q)&&this.hls){var re;if(((re=this.mediaSource)==null?void 0:re.readyState)==="ended"&&!(M!=null&&M.live)&&Math.abs(t-(M?.edge||0))<1){if(this.ended)return;this.ended=t||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(L),!this.media||!this.hls)return}var Z=Ne.bufferInfo(g,t,h.maxBufferHole);this._tryFixBufferStall(Z,se)}}},a.stallResolved=function(t){var i=this.stalled;if(i&&this.hls&&(this.stalled=null,this.stallReported)){var l=self.performance.now()-i;this.log("playback not stuck anymore @"+t+", after "+Math.round(l)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(P.STALL_RESOLVED,{})}},a.nudgeOnVideoHole=function(t,i){var l,f=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(l=this.buffered.audio)!=null&&l.length&&f&&f.length>1&&t>f.end(0)){var h=Ne.bufferedInfo(Ne.timeRangesToArray(this.buffered.audio),t,0);if(h.len>1&&i>=h.start){var g=Ne.timeRangesToArray(f),p=Ne.bufferedInfo(g,i,0).bufferedIndex;if(p>-1&&p<g.length-1){var E=Ne.bufferedInfo(g,t,0).bufferedIndex,x=g[p].end,b=g[p+1].start;if((E===-1||E>p)&&b-x<1&&t-x<2){var _=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+t+" hole: "+x+" -> "+b+" buffered index: "+E);this.warn(_.message),this.media.currentTime+=1e-6;var L=this.fragmentTracker.getPartialFragment(t)||void 0,k=Ne.bufferInfo(this.media,t,0);this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:_,reason:_.message,frag:L,buffer:k.len,bufferInfo:k})}}}}},a._tryFixBufferStall=function(t,i){var l,f,h=this.fragmentTracker,g=this.media,p=(l=this.hls)==null?void 0:l.config;if(!(!g||!h||!p)){var E=g.currentTime,x=(f=this.hls)==null?void 0:f.latestLevelDetails,b=h.getPartialFragment(E);if(b||x!=null&&x.live&&E<x.fragmentStart){var _=this._trySkipBufferHole(b);if(_||!this.media)return}var L=t.buffered;(L&&L.length>1&&t.len>p.maxBufferHole||t.nextStart&&t.nextStart-E<p.maxBufferHole)&&(i>p.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}},a._reportStall=function(t){var i=this.hls,l=this.media,f=this.stallReported,h=this.stalled;if(!f&&h!==null&&l&&i){this.stallReported=!0;var g=new Error("Playback stalling at @"+l.currentTime+" due to low buffer ("+ct(t)+")");this.warn(g.message),i.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_STALLED_ERROR,fatal:!1,error:g,buffer:t.len,bufferInfo:t,stalled:{start:h}})}},a._trySkipBufferHole=function(t){var i,l=this.fragmentTracker,f=this.media,h=(i=this.hls)==null?void 0:i.config;if(!f||!l||!h)return 0;var g=f.currentTime,p=Ne.bufferInfo(f,g,0),E=g<p.start?p.start:p.nextStart;if(E&&this.hls){var x=p.len<=h.maxBufferHole,b=p.len>0&&p.len<1&&f.readyState<3,_=E-g;if(_>0&&(x||b)){if(_>h.maxBufferHole){var L=!1;if(g===0){var k=l.getAppendedFrag(0,Ce.MAIN);k&&E<k.end&&(L=!0)}if(!L){var I=t||l.getAppendedFrag(g,Ce.MAIN);if(I){var w;if(!((w=this.hls.loadLevelObj)!=null&&w.details))return 0;var O=Ks(this.hls.inFlightFragments,E);if(O)return 0;for(var D=!1,M=I.end;M<E;){var G=l.getPartialFragment(M);if(G)M+=G.duration;else{D=!0;break}}if(D)return 0}}}var N=Math.max(E+uc,g+lc);if(this.warn("skipping hole, adjusting currentTime from "+g+" to "+N),this.moved=!0,f.currentTime=N,!(t!=null&&t.gap)){var H=new Error("fragment loaded with buffer holes, seeking from "+g+" to "+N);this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:H,reason:H.message,frag:t||void 0,buffer:p.len,bufferInfo:p})}return N}}return 0},a._tryNudgeBuffer=function(t){var i=this.hls,l=this.media,f=this.nudgeRetry,h=i?.config;if(!l||!h)return 0;var g=l.currentTime;if(this.nudgeRetry++,f<h.nudgeMaxRetry){var p=g+(f+1)*h.nudgeOffset,E=new Error("Nudging 'currentTime' from "+g+" to "+p);this.warn(E.message),l.currentTime=p,i.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_NUDGE_ON_STALL,error:E,fatal:!1,buffer:t.len,bufferInfo:t})}else{var x=new Error("Playhead still not moving while enough data buffered @"+g+" after "+h.nudgeMaxRetry+" nudges");this.error(x.message),i.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.BUFFER_STALLED_ERROR,error:x,fatal:!0,buffer:t.len,bufferInfo:t})}},c(u,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])}(Bs);function Ks(o,u){var a=Ws(o.main);if(a&&a.start<=u)return a;var r=Ws(o.audio);return r&&r.start<=u?r:null}function Ws(o){if(!o)return null;switch(o.state){case ie.IDLE:case ie.STOPPED:case ie.ENDED:case ie.ERROR:return null}return o.frag}function hc(o,u){var a;try{a=new Event("addtrack")}catch{a=document.createEvent("Event"),a.initEvent("addtrack",!1,!1)}a.track=o,u.dispatchEvent(a)}function dc(o,u){var a=o.mode;if(a==="disabled"&&(o.mode="hidden"),o.cues)for(var r=o.cues.length;r--;)u&&o.cues[r].removeEventListener("enter",u),o.removeCue(o.cues[r]);a==="disabled"&&(o.mode=a)}function vc(o,u,a,r){var t=o.mode;if(t==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var i=pc(o.cues,u,a),l=0;l<i.length;l++)(!r||r(i[l]))&&o.removeCue(i[l]);t==="disabled"&&(o.mode=t)}function gc(o,u){if(u<=o[0].startTime)return 0;var a=o.length-1;if(u>o[a].endTime)return-1;for(var r=0,t=a,i;r<=t;)if(i=Math.floor((t+r)/2),u<o[i].startTime)t=i-1;else if(u>o[i].startTime&&r<a)r=i+1;else return i;return o[r].startTime-u<u-o[t].startTime?r:t}function pc(o,u,a){var r=[],t=gc(o,u);if(t>-1)for(var i=t,l=o.length;i<l;i++){var f=o[i];if(f.startTime>=u&&f.endTime<=a)r.push(f);else if(f.startTime>a)return r}return r}var mc=.25;function gn(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function js(o,u,a,r,t){var i=new o(u,a,"");try{i.value=r,t&&(i.type=t)}catch{i=new o(u,a,ct(t?U({type:t},r):r))}return i}var di=function(){var o=gn();try{o&&new o(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function yc(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var Ec=function(){function o(a){var r=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=function(){r.hls&&r.hls.trigger(P.EVENT_CUE_ENTER,{})},this.hls=a,this._registerListeners()}var u=o.prototype;return u.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},u._registerListeners=function(){var r=this.hls;r.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(P.MANIFEST_LOADING,this.onManifestLoading,this),r.on(P.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(P.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},u._unregisterListeners=function(){var r=this.hls;r.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(P.MANIFEST_LOADING,this.onManifestLoading,this),r.off(P.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(P.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},u.onMediaAttaching=function(r,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)},u.onMediaAttached=function(){var r=this.hls.latestLevelDetails;r&&this.updateDateRangeCues(r)},u.onMediaDetaching=function(r,t){this.media=null;var i=!!t.transferMedia;i||(this.id3Track&&(this.removeCues&&dc(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},u.onManifestLoading=function(){this.dateRangeCuesAppended={}},u.createTrack=function(r){var t=this.getID3Track(r.textTracks);return t.mode="hidden",t},u.getID3Track=function(r){if(this.media){for(var t=0;t<r.length;t++){var i=r[t];if(i.kind==="metadata"&&i.label==="id3")return hc(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},u.onFragParsingMetadata=function(r,t){if(this.media){var i=this.hls.config,l=i.enableEmsgMetadataCues,f=i.enableID3MetadataCues;if(!(!l&&!f)){var h=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var g=gn();if(g)for(var p=0;p<h.length;p++){var E=h[p].type;if(!(E===St.emsg&&!l||!f)){var x=ms(h[p].data);if(x){var b=h[p].pts,_=b+h[p].duration;_>di&&(_=di);var L=_-b;L<=0&&(_=b+mc);for(var k=0;k<x.length;k++){var I=x[k];if(!ys(I)){this.updateId3CueEnds(b,E);var w=js(g,b,_,I,E);w&&this.id3Track.addCue(w)}}}}}}}},u.updateId3CueEnds=function(r,t){var i,l=(i=this.id3Track)==null?void 0:i.cues;if(l)for(var f=l.length;f--;){var h=l[f];h.type===t&&h.startTime<r&&h.endTime===di&&(h.endTime=r)}},u.onBufferFlushing=function(r,t){var i=t.startOffset,l=t.endOffset,f=t.type,h=this.id3Track,g=this.hls;if(g){var p=g.config,E=p.enableEmsgMetadataCues,x=p.enableID3MetadataCues;if(h&&(E||x)){var b;f==="audio"?b=function(L){return L.type===St.audioId3&&x}:f==="video"?b=function(L){return L.type===St.emsg&&E}:b=function(L){return L.type===St.audioId3&&x||L.type===St.emsg&&E},vc(h,i,l,b)}}},u.onLevelUpdated=function(r,t){var i=t.details;this.updateDateRangeCues(i,!0)},u.onLevelPtsUpdated=function(r,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)},u.updateDateRangeCues=function(r,t){var i=this;if(!(!this.media||!r.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var l=this.id3Track,f=r.dateRanges,h=Object.keys(f),g=this.dateRangeCuesAppended;if(l&&t){var p;if((p=l.cues)!=null&&p.length)for(var E=Object.keys(g).filter(function(w){return!h.includes(w)}),x=function(){var O=E[b],D=g[O].cues;delete g[O],Object.keys(D).forEach(function(M){try{var G=D[M];G.removeEventListener("enter",i.onEventCueEnter),l.removeCue(G)}catch{}})},b=E.length;b--;)x();else g=this.dateRangeCuesAppended={}}var _=r.fragments[r.fragments.length-1];if(!(h.length===0||!ae(_?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var L=gn(),k=function(){var O=h[I],D=f[O],M=D.startTime,G=g[O],N=G?.cues||{},H=G?.durationKnown||!1,X=di,Y=D.duration,V=D.endDate;if(V&&Y!==null)X=M+Y,H=!0;else if(D.endOnNext&&!H){var j=h.reduce(function(fe,Be){if(Be!==D.id){var Ie=f[Be];if(Ie.class===D.class&&Ie.startDate>D.startDate&&(!fe||D.startDate<fe.startDate))return Ie}return fe},null);j&&(X=j.startTime,H=!0)}for(var Q=Object.keys(D.attr),se=0;se<Q.length;se++){var re=Q[se];if(Tu(re)){var Z=N[re];if(Z)H&&!G.durationKnown?Z.endTime=X:Math.abs(Z.startTime-M)>.01&&(Z.startTime=M,Z.endTime=X);else if(L){var oe=D.attr[re];Su(re)&&(oe=yc(oe));var le={key:re,data:oe},ue=js(L,M,X,le,St.dateRange);ue&&(ue.id=O,i.id3Track.addCue(ue),N[re]=ue)}}}g[O]={cues:N,dateRange:D,durationKnown:H}},I=0;I<h.length;I++)k()}}},o}(),Tc=function(){function o(a){var r=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var t=r.media,i=r.levelDetails;if(!(!t||!i)){r.currentTime=t.currentTime;var l=r.computeLatency();if(l!==null){r._latency=l;var f=r.config,h=f.lowLatencyMode,g=f.maxLiveSyncPlaybackRate;if(!(!h||g===1||!i.live)){var p=r.targetLatency;if(p!==null){var E=l-p,x=Math.min(r.maxLatency,p+i.targetduration),b=E<x;if(b&&E>.05&&r.forwardBufferLength>1){var _=Math.min(2,Math.max(1,g)),L=Math.round(2/(1+Math.exp(-.75*E-r.edgeStalled))*20)/20,k=Math.min(_,Math.max(1,L));r.changeMediaPlaybackRate(t,k)}else t.playbackRate!==1&&t.playbackRate!==0&&r.changeMediaPlaybackRate(t,1)}}}}},this.hls=a,this.config=a.config,this.registerListeners()}var u=o.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},u.registerListeners=function(){var r=this.hls;r&&(r.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(P.MANIFEST_LOADING,this.onManifestLoading,this),r.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(P.ERROR,this.onError,this))},u.unregisterListeners=function(){var r=this.hls;r&&(r.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(P.MANIFEST_LOADING,this.onManifestLoading,this),r.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(P.ERROR,this.onError,this))},u.onMediaAttached=function(r,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},u.onManifestLoading=function(){this._latency=null,this.stallCount=0},u.onLevelUpdated=function(r,t){var i=t.details;i.advanced&&this.onTimeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},u.onError=function(r,t){var i;t.details===$.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},u.changeMediaPlaybackRate=function(r,t){var i,l;r.playbackRate!==t&&((i=this.hls)==null||i.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((l=this.targetLatency)==null?void 0:l.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+r.playbackRate+" to "+t),r.playbackRate=t)},u.estimateLiveEdge=function(){var r=this.levelDetails;return r===null?null:r.edge+r.age},u.computeLatency=function(){var r=this.estimateLiveEdge();return r===null?null:r-this.currentTime},c(o,[{key:"levelDetails",get:function(){var r;return((r=this.hls)==null?void 0:r.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config;if(r.liveMaxLatencyDuration!==void 0)return r.liveMaxLatencyDuration;var t=this.levelDetails;return t?r.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(r===null||this.hls===null)return null;var t=r.holdBack,i=r.partHoldBack,l=r.targetduration,f=this.config,h=f.liveSyncDuration,g=f.liveSyncDurationCount,p=f.lowLatencyMode,E=this.hls.userConfig,x=p&&i||t;(this._targetLatencyUpdated||E.liveSyncDuration||E.liveSyncDurationCount||x===0)&&(x=h!==void 0?h:g*l);var b=l;return x+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,b)},set:function(r){this.stallCount=0,this.config.liveSyncDuration=r,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),t=this.targetLatency;if(r===null||t===null)return null;var i=this.levelDetails;if(i===null)return null;var l=i.edge,f=r-t-this.edgeStalled,h=l-i.totalduration,g=l-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(h,f),g)}},{key:"drift",get:function(){var r=this.levelDetails;return r===null?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;if(r===null)return 0;var t=(this.config.lowLatencyMode&&r.partTarget||r.targetduration)*3;return Math.max(r.age-t,0)}},{key:"forwardBufferLength",get:function(){var r=this.media,t=this.levelDetails;if(!r||!t)return 0;var i=r.buffered.length;return(i?r.buffered.end(i-1):t.edge)-this.currentTime}}])}(),Sc=function(o){function u(r,t){var i;return i=o.call(this,t,r.logger)||this,i.hls=void 0,i.canLoad=!1,i.timer=-1,i.hls=r,i}C(u,o);var a=u.prototype;return a.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},a.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},a.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},a.stopLoad=function(){this.canLoad=!1,this.clearTimer()},a.switchParams=function(t,i,l){var f=i?.renditionReports;if(f){for(var h=-1,g=0;g<f.length;g++){var p=f[g],E=void 0;try{E=new self.URL(p.URI,i.url).href}catch(I){this.warn("Could not construct new URL for Rendition Report: "+I),E=p.URI||""}if(E===t){h=g;break}else E===t.substring(0,E.length)&&(h=g)}if(h!==-1){var x=f[h],b=parseInt(x["LAST-MSN"])||i?.lastPartSn,_=parseInt(x["LAST-PART"])||i?.lastPartIndex;if(this.hls.config.lowLatencyMode){var L=Math.min(i.age-i.partTarget,i.targetduration);_>=0&&L>i.partTarget&&(_+=1)}var k=l&&Ra(l);return new Ia(b,_>=0?_:void 0,k)}}},a.loadPlaylist=function(t){this.clearTimer()},a.loadingPlaylist=function(t,i){this.clearTimer()},a.shouldLoadPlaylist=function(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)},a.getUrlWithDirectives=function(t,i){if(i)try{return i.addDirectives(t)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}return t},a.playlistLoaded=function(t,i,l){var f=i.details,h=i.stats,g=self.performance.now(),p=h.loading.first?Math.max(0,g-h.loading.first):0;f.advancedDateTime=Date.now()-p;var E=this.hls.config.timelineOffset;if(E!==f.appliedTimelineOffset){var x=Math.max(E||0,0);f.appliedTimelineOffset=x,f.fragments.forEach(function(fe){fe.start=fe.playlistOffset+x})}if(f.live||l!=null&&l.live){var b="levelInfo"in i?i.levelInfo:i.track;if(f.reloaded(l),l&&f.fragments.length>0){Iu(l,f);var _=f.playlistParsingError;if(_){this.warn(_);var L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var k,I=i.networkDetails;L.trigger(P.ERROR,{type:be.NETWORK_ERROR,details:$.LEVEL_PARSING_ERROR,fatal:!1,url:f.url,error:_,reason:_.message,level:i.level||void 0,parent:(k=f.fragments[0])==null?void 0:k.type,networkDetails:I,stats:h});return}f.playlistParsingError=null}}f.requestScheduled===-1&&(f.requestScheduled=h.loading.start);var w=this.hls.mainForwardBufferInfo,O=w?w.end-w.len:0,D=(f.edge-O)*1e3,M=as(f,D);if(f.requestScheduled+M<g?f.requestScheduled=g:f.requestScheduled+=M,this.log("live playlist "+t+" "+(f.advanced?"REFRESHED "+f.lastPartSn+"-"+f.lastPartIndex:f.updated?"UPDATED":"MISSED")),!this.canLoad||!f.live)return;var G,N=void 0,H=void 0;if(f.canBlockReload&&f.endSN&&f.advanced){var X=this.hls.config.lowLatencyMode,Y=f.lastPartSn,V=f.endSN,j=f.lastPartIndex,Q=j!==-1,se=Y===V;Q?se?(N=V+1,H=X?0:j):(N=Y,H=X?j+1:f.maxPartIndex):N=V+1;var re=f.age,Z=re+f.ageHeader,oe=Math.min(Z-f.partTarget,f.targetduration*1.5);if(oe>0){if(Z>f.targetduration*3)this.log("Playlist last advanced "+re.toFixed(2)+"s ago. Omitting segment and part directives."),N=void 0,H=void 0;else if(l!=null&&l.tuneInGoal&&Z-f.partTarget>l.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+l.tuneInGoal+" to: "+oe+" with playlist age: "+f.age),oe=0;else{var le=Math.floor(oe/f.targetduration);if(N+=le,H!==void 0){var ue=Math.round(oe%f.targetduration/f.partTarget);H+=ue}this.log("CDN Tune-in age: "+f.ageHeader+"s last advanced "+re.toFixed(2)+"s goal: "+oe+" skip sn "+le+" to part "+H)}f.tuneInGoal=oe}if(G=this.getDeliveryDirectives(f,i.deliveryDirectives,N,H),X||!se){f.requestScheduled=g,this.loadingPlaylist(b,G);return}}else(f.canBlockReload||f.canSkipUntil)&&(G=this.getDeliveryDirectives(f,i.deliveryDirectives,N,H));G&&N!==void 0&&f.canBlockReload&&(f.requestScheduled=h.loading.first+Math.max(M-p*2,M/2)),this.scheduleLoading(b,G,f)}else this.clearTimer()},a.scheduleLoading=function(t,i,l){var f=this,h=l||t.details;if(!h){this.loadingPlaylist(t,i);return}var g=self.performance.now(),p=h.requestScheduled;if(g>=p){this.loadingPlaylist(t,i);return}var E=p-g;this.log("reload live playlist "+(t.name||t.bitrate+"bps")+" in "+Math.round(E)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return f.loadingPlaylist(t,i)},E)},a.getDeliveryDirectives=function(t,i,l,f){var h=Ra(t);return i!=null&&i.skip&&t.deltaUpdateFailed&&(l=i.msn,f=i.part,h=ei.No),new Ia(l,f,h)},a.checkRetry=function(t){var i=this,l=t.details,f=ti(t),h=t.errorAction,g=h||{},p=g.action,E=g.retryCount,x=E===void 0?0:E,b=g.retryConfig,_=!!h&&!!b&&(p===st.RetryRequest||!h.resolved&&p===st.SendAlternateToPenaltyBox);if(_){var L;if(x>=b.maxNumRetry)return!1;if(f&&(L=t.context)!=null&&L.deliveryDirectives)this.warn("Retrying playlist loading "+(x+1)+"/"+b.maxNumRetry+' after "'+l+'" without delivery-directives'),this.loadPlaylist();else{var k=Xi(b,x);this.clearTimer(),this.timer=self.setTimeout(function(){return i.loadPlaylist()},k),this.warn("Retrying playlist loading "+(x+1)+"/"+b.maxNumRetry+' after "'+l+'" in '+k+"ms")}t.levelRetry=!0,h.resolved=!0}return _},u}(gr),xc=function(o){function u(r,t){var i;return i=o.call(this,r,"level-controller")||this,i._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=t,i._registerListeners(),i}C(u,o);var a=u.prototype;return a._registerListeners=function(){var t=this.hls;t.on(P.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(P.LEVEL_LOADED,this.onLevelLoaded,this),t.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(P.FRAG_BUFFERED,this.onFragBuffered,this),t.on(P.ERROR,this.onError,this)},a._unregisterListeners=function(){var t=this.hls;t.off(P.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(P.LEVEL_LOADED,this.onLevelLoaded,this),t.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(P.FRAG_BUFFERED,this.onFragBuffered,this),t.off(P.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),o.prototype.destroy.call(this)},a.stopLoad=function(){var t=this._levels;t.forEach(function(i){i.loadError=0,i.fragmentError=0}),o.prototype.stopLoad.call(this)},a.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},a.onManifestLoading=function(t,i){this.resetLevels()},a.onManifestLoaded=function(t,i){var l=this,f=this.hls.config.preferManagedMediaSource,h=[],g={},p={},E=!1,x=!1,b=!1;i.levels.forEach(function(_){var L,k=_.attrs,I=_.audioCodec,w=_.videoCodec;I&&(_.audioCodec=I=Qr(I,f)||void 0),((L=w)==null?void 0:L.indexOf("avc1"))===0&&(w=_.videoCodec=Ql(w));var O=_.width,D=_.height,M=_.unknownCodecs,G=M?M.length:0;if(M)for(var N=G;N--;){var H=M[N];l.isAudioSupported(H)?(_.audioCodec=I=I?I+","+H:H,G--,pr.audio[I.substring(0,4)]=2):l.isVideoSupported(H)&&(_.videoCodec=w=w?w+","+H:H,G--,pr.video[w.substring(0,4)]=2)}if(E||(E=!!(O&&D)),x||(x=!!w),b||(b=!!I),G||I&&!l.isAudioSupported(I)||w&&!l.isVideoSupported(w)){l.log('Some or all CODECS not supported "'+k.CODECS+'"');return}var X=k.CODECS,Y=k["FRAME-RATE"],V=k["HDCP-LEVEL"],j=k["PATHWAY-ID"],Q=k.RESOLUTION,se=k["VIDEO-RANGE"],re=(j||".")+"-",Z=""+re+_.bitrate+"-"+Q+"-"+Y+"-"+X+"-"+se+"-"+V;if(g[Z])if(g[Z].uri!==_.url&&!_.attrs["PATHWAY-ID"]){var le=p[Z]+=1;_.attrs["PATHWAY-ID"]=new Array(le+1).join(".");var ue=l.createLevel(_);g[Z]=ue,h.push(ue)}else g[Z].addGroupId("audio",k.AUDIO),g[Z].addGroupId("text",k.SUBTITLES);else{var oe=l.createLevel(_);g[Z]=oe,p[Z]=1,h.push(oe)}}),this.filterAndSortMediaOptions(h,i,E,x,b)},a.createLevel=function(t){var i=new Pa(t),l=t.supplemental;if(l!=null&&l.videoCodec&&!this.isVideoSupported(l.videoCodec)){var f=new Error('SUPPLEMENTAL-CODECS not supported "'+l.videoCodec+'"');this.log(f.message),i.supportedResult=ca.getUnsupportedResult(f,[])}return i},a.isAudioSupported=function(t){return Yi(t,"audio",this.hls.config.preferManagedMediaSource)},a.isVideoSupported=function(t){return Yi(t,"video",this.hls.config.preferManagedMediaSource)},a.filterAndSortMediaOptions=function(t,i,l,f,h){var g=this,p=[],E=[],x=t;if((l||f)&&h&&(x=x.filter(function(N){var H=N.videoCodec,X=N.videoRange,Y=N.width,V=N.height;return(!!H||!!(Y&&V))&&eu(X)})),x.length===0){Promise.resolve().then(function(){if(g.hls){var N="no level with compatible codecs found in manifest",H=N;i.levels.length&&(H="one or more CODECS in variant not supported: "+ct(i.levels.map(function(Y){return Y.attrs.CODECS}).filter(function(Y,V,j){return j.indexOf(Y)===V})),g.warn(H),N+=" ("+H+")");var X=new Error(N);g.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,error:X,reason:H})}});return}i.audioTracks&&(p=i.audioTracks.filter(function(N){return!N.audioCodec||g.isAudioSupported(N.audioCodec)}),Ys(p)),i.subtitles&&(E=i.subtitles,Ys(E));var b=x.slice(0);x.sort(function(N,H){if(N.attrs["HDCP-LEVEL"]!==H.attrs["HDCP-LEVEL"])return(N.attrs["HDCP-LEVEL"]||"")>(H.attrs["HDCP-LEVEL"]||"")?1:-1;if(l&&N.height!==H.height)return N.height-H.height;if(N.frameRate!==H.frameRate)return N.frameRate-H.frameRate;if(N.videoRange!==H.videoRange)return Jr.indexOf(N.videoRange)-Jr.indexOf(H.videoRange);if(N.videoCodec!==H.videoCodec){var X=Ca(N.videoCodec),Y=Ca(H.videoCodec);if(X!==Y)return Y-X}if(N.uri===H.uri&&N.codecSet!==H.codecSet){var V=Xr(N.codecSet),j=Xr(H.codecSet);if(V!==j)return j-V}return N.averageBitrate!==H.averageBitrate?N.averageBitrate-H.averageBitrate:0});var _=b[0];if(this.steering&&(x=this.steering.filterParsedLevels(x),x.length!==b.length)){for(var L=0;L<b.length;L++)if(b[L].pathwayId===x[0].pathwayId){_=b[L];break}}this._levels=x;for(var k=0;k<x.length;k++)if(x[k]===_){var I;this._firstLevel=k;var w=_.bitrate,O=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+x.length+" level(s) found, first bitrate: "+w),((I=this.hls.userConfig)==null?void 0:I.abrEwmaDefaultEstimate)===void 0){var D=Math.min(w,this.hls.config.abrEwmaDefaultEstimateMax);D>O&&O===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=D)}break}var M=h&&!f,G={levels:x,audioTracks:p,subtitleTracks:E,sessionData:i.sessionData,sessionKeys:i.sessionKeys,firstLevel:this._firstLevel,stats:i.stats,audio:h,video:f,altAudio:!M&&p.some(function(N){return!!N.url})};this.hls.trigger(P.MANIFEST_PARSED,G)},a.onError=function(t,i){i.fatal||!i.context||i.context.type===Pe.LEVEL&&i.context.level===this.level&&this.checkRetry(i)},a.onFragBuffered=function(t,i){var l=i.frag;if(l!==void 0&&l.type===Ce.MAIN){var f=l.elementaryStreams;if(!Object.keys(f).some(function(g){return!!f[g]}))return;var h=this._levels[l.level];h!=null&&h.loadError&&(this.log("Resetting level error count of "+h.loadError+" on frag buffered"),h.loadError=0)}},a.onLevelLoaded=function(t,i){var l,f=i.level,h=i.details,g=i.levelInfo;if(!g){var p;this.warn("Invalid level index "+f),(p=i.deliveryDirectives)!=null&&p.skip&&(h.deltaUpdateFailed=!0);return}if(g===this.currentLevel||i.withoutMultiVariant){g.fragmentError===0&&(g.loadError=0);var E=g.details;E===i.details&&E.advanced&&(E=void 0),this.playlistLoaded(f,i,E)}else(l=i.deliveryDirectives)!=null&&l.skip&&(h.deltaUpdateFailed=!0)},a.loadPlaylist=function(t){o.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)},a.loadingPlaylist=function(t,i){o.prototype.loadingPlaylist.call(this,t,i);var l=this.getUrlWithDirectives(t.uri,i),f=this.currentLevelIndex,h=t.attrs["PATHWAY-ID"],g=t.details,p=g?.age;this.log("Loading level index "+f+(i?.msn!==void 0?" at sn "+i.msn+" part "+i.part:"")+(h?" Pathway "+h:"")+(p&&g.live?" age "+p.toFixed(1)+(g.type&&" "+g.type||""):"")+" "+l),this.hls.trigger(P.LEVEL_LOADING,{url:l,level:f,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:i||null})},a.removeLevel=function(t){var i=this,l;if(this._levels.length!==1){var f=this._levels.filter(function(g,p){return p!==t?!0:(i.steering&&i.steering.removeLevel(g),g===i.currentLevel&&(i.currentLevel=null,i.currentLevelIndex=-1,g.details&&g.details.fragments.forEach(function(E){return E.level=-1})),!1)});ls(f),this._levels=f,this.currentLevelIndex>-1&&(l=this.currentLevel)!=null&&l.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var h=f.length-1;this._firstLevel=Math.min(this._firstLevel,h),this._startLevel&&(this._startLevel=Math.min(this._startLevel,h)),this.hls.trigger(P.LEVELS_UPDATED,{levels:f})}},a.onLevelsUpdated=function(t,i){var l=i.levels;this._levels=l},a.checkMaxAutoUpdated=function(){var t=this.hls,i=t.autoLevelCapping,l=t.maxAutoLevel,f=t.maxHdcpLevel;this._maxAutoLevel!==l&&(this._maxAutoLevel=l,this.hls.trigger(P.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:i,levels:this.levels,maxAutoLevel:l,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:f}))},c(u,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var i=this._levels;if(i.length!==0){if(t<0||t>=i.length){var l=new Error("invalid level idx"),f=t<0;if(this.hls.trigger(P.ERROR,{type:be.OTHER_ERROR,details:$.LEVEL_SWITCH_ERROR,level:t,fatal:f,error:l,reason:l.message}),f)return;t=Math.min(t,i.length-1)}var h=this.currentLevelIndex,g=this.currentLevel,p=g?g.attrs["PATHWAY-ID"]:void 0,E=i[t],x=E.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=E,!(h===t&&g&&p===x)){this.log("Switching to level "+t+" ("+(E.height?E.height+"p ":"")+(E.videoRange?E.videoRange+" ":"")+(E.codecSet?E.codecSet+" ":"")+"@"+E.bitrate+")"+(x?" with Pathway "+x:"")+" from level "+h+(p?" with Pathway "+p:""));var b={level:t,attrs:E.attrs,details:E.details,bitrate:E.bitrate,averageBitrate:E.averageBitrate,maxBitrate:E.maxBitrate,realBitrate:E.realBitrate,width:E.width,height:E.height,codecSet:E.codecSet,audioCodec:E.audioCodec,videoCodec:E.videoCodec,audioGroups:E.audioGroups,subtitleGroups:E.subtitleGroups,loaded:E.loaded,loadError:E.loadError,fragmentError:E.fragmentError,name:E.name,id:E.id,uri:E.uri,url:E.url,urlId:0,audioGroupIds:E.audioGroupIds,textGroupIds:E.textGroupIds};this.hls.trigger(P.LEVEL_SWITCHING,b);var _=E.details;if(!_||_.live){var L=this.switchParams(E.uri,g?.details,_);this.loadPlaylist(L)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(t){if(this.steering){var i=this.steering.pathways(),l=t.filter(function(f){return i.indexOf(f)!==-1});if(t.length<1){this.warn("pathwayPriority "+t+" should contain at least one pathway from list: "+i);return}this.steering.pathwayPriority=l}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}])}(Sc);function Ys(o){var u={};o.forEach(function(a){var r=a.groupId||"";a.id=u[r]=u[r]||0,u[r]++})}var pn=[];typeof n<"u"&&n&&_c();function _c(){self.addEventListener("message",function(o){var u=o.data,a=u.instanceNo;if(a!==void 0){var r=pn[a];if(u.cmd==="reset"&&(delete pn[u.resetNo],r&&r.destroy(),u.cmd="init"),u.cmd==="init"){var t=JSON.parse(u.config),i=new Ve;i.on(P.FRAG_DECRYPTED,Sr),i.on(P.ERROR,Sr);var l=ua(t.debug,u.id);bc(l,a),pn[a]=new hn(i,u.typeSupported,t,"",u.id,l),Sr("init",null,a);return}if(r)switch(u.cmd){case"configure":{r.configure(u.config);break}case"demux":{var f=r.push(u.data,u.decryptdata,u.chunkMeta,u.state);or(f)?f.then(function(p){mn(self,p,a)}).catch(function(p){Sr(P.ERROR,{instanceNo:a,type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,chunkMeta:u.chunkMeta,fatal:!1,error:p,err:p,reason:"transmuxer-worker push error"},a)}):mn(self,f,a);break}case"flush":{var h=u.chunkMeta,g=r.flush(h);or(g)?g.then(function(p){$s(self,p,h,a)}).catch(function(p){Sr(P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,chunkMeta:u.chunkMeta,fatal:!1,error:p,err:p,reason:"transmuxer-worker flush error"},a)}):$s(self,g,h,a);break}}}})}function mn(o,u,a){if(Lc(u.remuxResult))return!1;var r=[],t=u.remuxResult,i=t.audio,l=t.video;return i&&zs(r,i),l&&zs(r,l),o.postMessage({event:"transmuxComplete",data:u,instanceNo:a},r),!0}function zs(o,u){u.data1&&o.push(u.data1.buffer),u.data2&&o.push(u.data2.buffer)}function $s(o,u,a,r){var t=u.reduce(function(i,l){return mn(o,l,r)||i},!1);t||o.postMessage({event:"transmuxComplete",data:u[0],instanceNo:r}),o.postMessage({event:"flush",data:a,instanceNo:r})}function Sr(o,u,a){self.postMessage({event:o,data:u,instanceNo:a})}function bc(o,u){var a=function(i){var l=function(h){Sr("workerLog",{logType:i,message:h},u)};o[i]=l};for(var r in o)a(r)}function Lc(o){return!o.audio&&!o.video&&!o.text&&!o.id3&&!o.initSegment}var Br="1.6.0",xr={};function Cc(){return typeof d=="function"}function Ac(){var o=xr[Br];if(o)return o.clientCount++,o;var u=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+d.toString()+")(true);"],{type:"text/javascript"}),a=self.URL.createObjectURL(u),r=new self.Worker(a),t={worker:r,objectURL:a,clientCount:1};return xr[Br]=t,t}function kc(o){var u=xr[o];if(u)return u.clientCount++,u;var a=new self.URL(o,self.location.href).href,r=new self.Worker(a),t={worker:r,scriptURL:a,clientCount:1};return xr[o]=t,t}function Rc(o){var u=xr[o||Br];if(u){var a=u.clientCount--;if(a===1){var r=u.worker,t=u.objectURL;delete xr[o||Br],t&&self.URL.revokeObjectURL(t),r.terminate()}}}var qs=0,Ic=function(){function o(a,r,t,i){var l=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=qs++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(b){var _=b.data,L=l.hls;if(!(!L||!(_!=null&&_.event)||_.instanceNo!==l.instanceNo))switch(_.event){case"init":{var k,I=(k=l.workerContext)==null?void 0:k.objectURL;I&&self.URL.revokeObjectURL(I);break}case"transmuxComplete":{l.handleTransmuxComplete(_.data);break}case"flush":{l.onFlush(_.data);break}case"workerLog":{L.logger[_.data.logType]&&L.logger[_.data.logType](_.data.message);break}default:{_.data=_.data||{},_.data.frag=l.frag,_.data.part=l.part,_.data.id=l.id,L.trigger(_.event,_.data);break}}},this.onWorkerError=function(b){if(l.hls){var _=new Error(b.message+"  ("+b.filename+":"+b.lineno+")");l.hls.config.enableWorker=!1,l.hls.logger.warn('Error in "'+l.id+'" Web Worker, fallback to inline'),l.hls.trigger(P.ERROR,{type:be.OTHER_ERROR,details:$.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:_})}};var f=a.config;this.hls=a,this.id=r,this.useWorker=!!f.enableWorker,this.onTransmuxComplete=t,this.onFlush=i;var h=function(_,L){L=L||{},L.frag=l.frag||void 0,_===P.ERROR&&(L=L,L.parent=l.id,L.part=l.part,l.error=L.error),l.hls.trigger(_,L)};this.observer=new Ve,this.observer.on(P.FRAG_DECRYPTED,h),this.observer.on(P.ERROR,h);var g=Aa(f.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var p=this.hls.logger,E=f.workerPath||Cc();if(E){try{f.workerPath?(p.log("loading Web Worker "+f.workerPath+' for "'+r+'"'),this.workerContext=kc(f.workerPath)):(p.log('injecting Web Worker for "'+r+'"'),this.workerContext=Ac());var x=this.workerContext.worker;x.addEventListener("message",this.onWorkerMessage),x.addEventListener("error",this.onWorkerError),x.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:g,id:r,config:ct(f)})}catch(b){p.warn('Error setting up "'+r+'" Web Worker, fallback to inline',b),this.terminateWorker(),this.error=null,this.transmuxer=new hn(this.observer,g,f,"",r,a.logger)}return}}this.transmuxer=new hn(this.observer,g,f,"",r,a.logger)}var u=o.prototype;return u.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var r=this.instanceNo;this.instanceNo=qs++;var t=this.hls.config,i=Aa(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:r,typeSupported:i,id:this.id,config:ct(t)})}},u.terminateWorker=function(){if(this.workerContext){var r=this.workerContext.worker;this.workerContext=null,r.removeEventListener("message",this.onWorkerMessage),r.removeEventListener("error",this.onWorkerError),Rc(this.hls.config.workerPath)}},u.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},u.push=function(r,t,i,l,f,h,g,p,E,x){var b,_,L=this;E.transmuxing.start=self.performance.now();var k=this.instanceNo,I=this.transmuxer,w=h?h.start:f.start,O=f.decryptdata,D=this.frag,M=!(D&&f.cc===D.cc),G=!(D&&E.level===D.level),N=D?E.sn-D.sn:-1,H=this.part?E.part-this.part.index:-1,X=N===0&&E.id>1&&E.id===D?.stats.chunkCount,Y=!G&&(N===1||N===0&&(H===1||X&&H<=0)),V=self.performance.now();(G||N||f.stats.parsing.start===0)&&(f.stats.parsing.start=V),h&&(H||!Y)&&(h.stats.parsing.start=V);var j=!(D&&((b=f.initSegment)==null?void 0:b.url)===((_=D.initSegment)==null?void 0:_.url)),Q=new Hf(M,Y,p,G,w,j);if(!Y||M||j){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+f.type+" sn: "+E.sn+(E.part>-1?" part: "+E.part:"")+" "+(this.id===Ce.MAIN?"level":"track")+": "+E.level+" id: "+E.id+`
        discontinuity: `+M+`
        trackSwitch: `+G+`
        contiguous: `+Y+`
        accurateTimeOffset: `+p+`
        timeOffset: `+w+`
        initSegmentChange: `+j);var se=new Uf(i,l,t,g,x);this.configureTransmuxer(se)}if(this.frag=f,this.part=h,this.workerContext)this.workerContext.worker.postMessage({instanceNo:k,cmd:"demux",data:r,decryptdata:O,chunkMeta:E,state:Q},r instanceof ArrayBuffer?[r]:[]);else if(I){var re=I.push(r,O,E,Q);or(re)?re.then(function(Z){L.handleTransmuxComplete(Z)}).catch(function(Z){L.transmuxerError(Z,E,"transmuxer-interface push error")}):this.handleTransmuxComplete(re)}},u.flush=function(r){var t=this;r.transmuxing.start=self.performance.now();var i=this.instanceNo,l=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:i,cmd:"flush",chunkMeta:r});else if(l){var f=l.flush(r);or(f)?f.then(function(h){t.handleFlushResult(h,r)}).catch(function(h){t.transmuxerError(h,r,"transmuxer-interface flush error")}):this.handleFlushResult(f,r)}},u.transmuxerError=function(r,t,i){this.hls&&(this.error=r,this.hls.trigger(P.ERROR,{type:be.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:r,err:r,reason:i}))},u.handleFlushResult=function(r,t){var i=this;r.forEach(function(l){i.handleTransmuxComplete(l)}),this.onFlush(t)},u.configureTransmuxer=function(r){var t=this.instanceNo,i=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:r}):i&&i.configure(r)},u.handleTransmuxComplete=function(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)},o}();function Xs(){return self.SourceBuffer||self.WebKitSourceBuffer}function Qs(){var o=Zt();if(!o)return!1;var u=Xs();return!u||u.prototype&&typeof u.prototype.appendBuffer=="function"&&typeof u.prototype.remove=="function"}function Pc(){if(!Qs())return!1;var o=Zt();return typeof o?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(u){return o.isTypeSupported(wr(u,"video"))})||["mp4a.40.2","fLaC"].some(function(u){return o.isTypeSupported(wr(u,"audio"))}))}function wc(){var o,u=Xs();return typeof(u==null||(o=u.prototype)==null?void 0:o.changeType)=="function"}var Dc=100,Oc=function(o){function u(r,t,i){var l;return l=o.call(this,r,t,i,"stream-controller",Ce.MAIN)||this,l.audioCodecSwap=!1,l.level=-1,l._forceStartLoad=!1,l._hasEnoughToStart=!1,l.altAudio=0,l.audioOnly=!1,l.fragPlaying=null,l.fragLastKbps=0,l.couldBacktrack=!1,l.backtrackFragment=null,l.audioCodecSwitch=!1,l.videoBuffer=null,l.onMediaPlaying=function(){l.tick()},l.onMediaSeeked=function(){var f=l.media,h=f?f.currentTime:null;if(!(h===null||!ae(h))&&(l.log("Media seeked to "+h.toFixed(3)),!!l.getBufferedFrag(h))){var g=l.getFwdBufferInfoAtPos(f,h,Ce.MAIN,0);if(g===null||g.len===0){l.warn("Main forward buffer length at "+h+' on "seeked" event '+(g?g.len:"empty")+")");return}l.tick()}},l.registerListeners(),l}C(u,o);var a=u.prototype;return a.registerListeners=function(){o.prototype.registerListeners.call(this);var t=this.hls;t.on(P.MANIFEST_PARSED,this.onManifestParsed,this),t.on(P.LEVEL_LOADING,this.onLevelLoading,this),t.on(P.LEVEL_LOADED,this.onLevelLoaded,this),t.on(P.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(P.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(P.BUFFER_CREATED,this.onBufferCreated,this),t.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(P.FRAG_BUFFERED,this.onFragBuffered,this)},a.unregisterListeners=function(){o.prototype.unregisterListeners.call(this);var t=this.hls;t.off(P.MANIFEST_PARSED,this.onManifestParsed,this),t.off(P.LEVEL_LOADED,this.onLevelLoaded,this),t.off(P.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(P.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(P.BUFFER_CREATED,this.onBufferCreated,this),t.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(P.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),o.prototype.onHandlerDestroying.call(this)},a.startLoad=function(t,i){if(this.levels){var l=this.lastCurrentTime,f=this.hls;if(this.stopLoad(),this.setInterval(Dc),this.level=-1,!this.startFragRequested){var h=f.startLevel;h===-1&&(f.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=f.firstAutoLevel),f.nextLoadLevel=h,this.level=f.loadLevel,this._hasEnoughToStart=!!i}l>0&&t===-1&&!i&&(this.log("Override startPosition with lastCurrentTime @"+l.toFixed(3)),t=l),this.state=ie.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=i?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=ie.STOPPED},a.stopLoad=function(){this._forceStartLoad=!1,o.prototype.stopLoad.call(this)},a.doTick=function(){switch(this.state){case ie.WAITING_LEVEL:{var t=this.levels,i=this.level,l=t?.[i],f=l?.details;if(f&&(!f.live||this.levelLastLoaded===l&&!this.waitForLive(l))){if(this.waitForCdnTuneIn(f))break;this.state=ie.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ie.IDLE;break}break}case ie.FRAG_LOADING_WAITING_RETRY:{var h,g=self.performance.now(),p=this.retryDate;if(!p||g>=p||(h=this.media)!=null&&h.seeking){var E=this.levels,x=this.level,b=E?.[x];this.resetStartWhenNotLoaded(b||null),this.state=ie.IDLE}}break}this.state===ie.IDLE&&this.doTickIdle(),this.onTickEnd()},a.onTickEnd=function(){var t;o.prototype.onTickEnd.call(this),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},a.doTickIdle=function(){var t=this.hls,i=this.levelLastLoaded,l=this.levels,f=this.media;if(!(i===null||!f&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var h=this.buffering?t.nextLoadLevel:t.loadLevel;if(l!=null&&l[h]){var g=l[h],p=this.getMainFwdBufferInfo();if(p!==null){var E=this.getLevelDetails();if(E&&this._streamEnded(p,E)){var x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(P.BUFFER_EOS,x),this.state=ie.ENDED;return}if(this.buffering){t.loadLevel!==h&&t.manualLevel===-1&&this.log("Adapting to level "+h+" from level "+this.level),this.level=t.nextLoadLevel=h;var b=g.details;if(!b||this.state===ie.WAITING_LEVEL||this.waitForLive(g)){this.level=h,this.state=ie.WAITING_LEVEL,this.startFragRequested=!1;return}var _=p.len,L=this.getMaxBufferLength(g.maxBitrate);if(!(_>=L)){this.backtrackFragment&&this.backtrackFragment.start>p.end&&(this.backtrackFragment=null);var k=this.backtrackFragment?this.backtrackFragment.start:p.end,I=this.getNextFragment(k,b);if(this.couldBacktrack&&!this.fragPrevious&&I&&Mt(I)&&this.fragmentTracker.getState(I)!==vt.OK){var w,O=((w=this.backtrackFragment)!=null?w:I).sn,D=O-b.startSN,M=b.fragments[D-1];M&&I.cc===M.cc&&(I=M,this.fragmentTracker.removeFragment(M))}else this.backtrackFragment&&p.len&&(this.backtrackFragment=null);if(I&&this.isLoopLoading(I,k)){var G=I.gap;if(!G){var N=this.audioOnly&&!this.altAudio?Ye.AUDIO:Ye.VIDEO,H=(N===Ye.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;H&&this.afterBufferFlushed(H,N,Ce.MAIN)}I=this.getNextFragmentLoopLoading(I,b,p,Ce.MAIN,L)}I&&(I.initSegment&&!I.initSegment.data&&!this.bitrateTest&&(I=I.initSegment),this.loadFragment(I,g,k))}}}}}},a.loadFragment=function(t,i,l){var f=this.fragmentTracker.getState(t);f===vt.NOT_LOADED||f===vt.PARTIAL?Mt(t)?this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,i)):o.prototype.loadFragment.call(this,t,i,l):this._loadInitSegment(t,i):this.clearTrackerIfNeeded(t)},a.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,Ce.MAIN)},a.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},a.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function(){var t=this.levels,i=this.media;if(i!=null&&i.readyState){var l,f=this.getAppendedFrag(i.currentTime);f&&f.start>1&&this.flushMainBuffer(0,f.start-1);var h=this.getLevelDetails();if(h!=null&&h.live){var g=this.getMainFwdBufferInfo();if(!g||g.len<h.targetduration*2)return}if(!i.paused&&t){var p=this.hls.nextLoadLevel,E=t[p],x=this.fragLastKbps;x&&this.fragCurrent?l=this.fragCurrent.duration*E.maxBitrate/(1e3*x)+1:l=0}else l=0;var b=this.getBufferedFrag(i.currentTime+l);if(b){var _=this.followingBufferedFrag(b);if(_){this.abortCurrentFrag();var L=_.maxStartPTS?_.maxStartPTS:_.start,k=_.duration,I=Math.max(b.end,L+Math.min(Math.max(k-this.config.maxFragLookUpTolerance,k*(this.couldBacktrack?.5:.125)),k*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(I,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case ie.KEY_LOADING:case ie.FRAG_LOADING:case ie.FRAG_LOADING_WAITING_RETRY:case ie.PARSING:case ie.PARSED:this.state=ie.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function(t,i){o.prototype.flushMainBuffer.call(this,t,i,this.altAudio===2?"video":null)},a.onMediaAttached=function(t,i){o.prototype.onMediaAttached.call(this,t,i);var l=i.media;Nr(l,"playing",this.onMediaPlaying),Nr(l,"seeked",this.onMediaSeeked)},a.onMediaDetaching=function(t,i){var l=this.media;l&&(Tr(l,"playing",this.onMediaPlaying),Tr(l,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,o.prototype.onMediaDetaching.call(this,t,i);var f=!!i.transferMedia;f||(this._hasEnoughToStart=!1)},a.onManifestLoading=function(){o.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(P.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},a.onManifestParsed=function(t,i){var l=!1,f=!1;i.levels.forEach(function(h){var g=h.audioCodec;g&&(l=l||g.indexOf("mp4a.40.2")!==-1,f=f||g.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=l&&f&&!wc(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},a.onLevelLoading=function(t,i){var l=this.levels;if(!(!l||this.state!==ie.IDLE)){var f=i.levelInfo;(!f.details||f.details.live&&(this.levelLastLoaded!==f||f.details.expired)||this.waitForCdnTuneIn(f.details))&&(this.state=ie.WAITING_LEVEL)}},a.onLevelLoaded=function(t,i){var l,f=this.levels,h=this.startFragRequested,g=i.level,p=i.details,E=p.totalduration;if(!f){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+p.startSN+","+p.endSN+"]"+(p.lastPartSn?"[part-"+p.lastPartSn+"-"+p.lastPartIndex+"]":"")+", cc ["+p.startCC+", "+p.endCC+"] duration:"+E);var x=i.levelInfo,b=this.fragCurrent;b&&(this.state===ie.FRAG_LOADING||this.state===ie.FRAG_LOADING_WAITING_RETRY)&&b.level!==i.level&&b.loader&&this.abortCurrentFrag();var _=0;if(p.live||(l=x.details)!=null&&l.live){var L;if(this.checkLiveUpdate(p),p.deltaUpdateFailed)return;_=this.alignPlaylists(p,x.details,(L=this.levelLastLoaded)==null?void 0:L.details)}if(x.details=p,this.levelLastLoaded=x,h||this.setStartPosition(p,_),this.hls.trigger(P.LEVEL_UPDATED,{details:p,level:g}),this.state===ie.WAITING_LEVEL){if(this.waitForCdnTuneIn(p))return;this.state=ie.IDLE}h&&p.live&&this.synchronizeToLiveEdge(p),this.tick()},a.synchronizeToLiveEdge=function(t){var i=this.config,l=this.media;if(l){var f=this.hls.liveSyncPosition,h=this.getLoadPosition(),g=t.fragmentStart,p=t.edge,E=h>=g-i.maxFragLookUpTolerance&&h<=p;if(f!==null&&l.duration>f&&(h<f||!E)){var x=i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*t.targetduration;(!E&&l.readyState<4||h<p-x)&&(this._hasEnoughToStart||(this.nextLoadPosition=f),l.readyState&&(this.warn("Playback: "+h.toFixed(3)+" is located too far from the end of live sliding playlist: "+p+", reset currentTime to : "+f.toFixed(3)),l.currentTime=f))}}},a._handleFragmentLoadProgress=function(t){var i,l=t.frag,f=t.part,h=t.payload,g=this.levels;if(!g){this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered");return}var p=g[l.level];if(!p){this.warn("Level "+l.level+" not found on progress");return}var E=p.details;if(!E){this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset"),this.fragmentTracker.removeFragment(l);return}var x=p.videoCodec,b=E.PTSKnown||!E.live,_=(i=l.initSegment)==null?void 0:i.data,L=this._getAudioCodec(p),k=this.transmuxer=this.transmuxer||new Ic(this.hls,Ce.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),I=f?f.index:-1,w=I!==-1,O=new Us(l.level,l.sn,l.stats.chunkCount,h.byteLength,I,w),D=this.initPTS[l.cc];k.push(h,_,L,x,l,f,E.totalduration,b,O,D)},a.onAudioTrackSwitching=function(t,i){var l=this,f=this.hls,h=this.altAudio===2,g=Oa(i.url,f);if(g)this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var p=this.fragCurrent;p&&(this.log("Switching to main audio track, cancel main fragment load"),p.abortRequests(),this.fragmentTracker.removeFragment(p)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(h){this.fragmentTracker.removeAllFragments(),f.once(P.BUFFER_FLUSHED,function(){var E;(E=l.hls)==null||E.trigger(P.AUDIO_TRACK_SWITCHED,i)}),f.trigger(P.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}f.trigger(P.AUDIO_TRACK_SWITCHED,i)}},a.onAudioTrackSwitched=function(t,i){var l=Oa(i.url,this.hls);if(l){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=l?2:0,this.tick()},a.onBufferCreated=function(t,i){var l=i.tracks,f,h,g=!1;for(var p in l){var E=l[p];if(E.id==="main"){if(h=p,f=E,p==="video"){var x=l[p];x&&(this.videoBuffer=x.buffer)}}else g=!0}g&&f?(this.log("Alternate track found, use "+h+".buffered to schedule main fragment loading"),this.mediaBuffer=f.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function(t,i){var l=i.frag,f=i.part,h=l.type===Ce.MAIN;if(h){if(this.fragContextChanged(l)){this.warn("Fragment "+l.sn+(f?" p: "+f.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),this.state===ie.PARSED&&(this.state=ie.IDLE);return}var g=f?f.stats:l.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),Mt(l)&&(this.fragPrevious=l),this.fragBufferedComplete(l,f)}var p=this.media;p&&(!this._hasEnoughToStart&&Ne.getBuffered(p).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),h&&this.tick())},a.onError=function(t,i){var l;if(i.fatal){this.state=ie.ERROR;return}switch(i.details){case $.FRAG_GAP:case $.FRAG_PARSING_ERROR:case $.FRAG_DECRYPT_ERROR:case $.FRAG_LOAD_ERROR:case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_ERROR:case $.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ce.MAIN,i);break;case $.LEVEL_LOAD_ERROR:case $.LEVEL_LOAD_TIMEOUT:case $.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===ie.WAITING_LEVEL&&((l=i.context)==null?void 0:l.type)===Pe.LEVEL&&(this.state=ie.IDLE);break;case $.BUFFER_ADD_CODEC_ERROR:case $.BUFFER_APPEND_ERROR:if(i.parent!=="main")return;this.resetLoadingState();break;case $.BUFFER_FULL_ERROR:if(i.parent!=="main")return;this.reduceLengthAndFlushBuffer(i)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case $.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}},a.onFragLoadEmergencyAborted=function(){this.state=ie.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},a.onBufferFlushed=function(t,i){var l=i.type;if(l!==Ye.AUDIO||!this.altAudio){var f=(l===Ye.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;f&&(this.afterBufferFlushed(f,l,Ce.MAIN),this.tick())}},a.onLevelsUpdated=function(t,i){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=i.levels},a.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function(){var t=this.media;if(t){var i=t.currentTime,l=this.startPosition;if(l>=0&&i<l){if(t.seeking){this.log("could not seek to "+l+", already seeking at "+i);return}var f=this.timelineOffset;f&&l&&(l+=f);var h=this.getLevelDetails(),g=Ne.getBuffered(t),p=g.length?g.start(0):0,E=p-l,x=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);E>0&&(E<x||this.loadingParts&&E<2*(h?.partTarget||0))&&(this.log("adjusting start position by "+E+" to match buffer start"),l+=E,this.startPosition=l),i<l&&(this.log("seek to target start position "+l+" from current time "+i+" buffer start "+p),t.currentTime=l)}}},a._getAudioCodec=function(t){var i=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i.indexOf("mp4a.40.5")!==-1?i="mp4a.40.2":i="mp4a.40.5"),i},a._loadBitrateTestFrag=function(t,i){var l=this;t.bitrateTest=!0,this._doFragLoad(t,i).then(function(f){var h=l.hls,g=f?.frag;if(!(!g||l.fragContextChanged(g))){i.fragmentError=0,l.state=ie.IDLE,l.startFragRequested=!1,l.bitrateTest=!1;var p=g.stats;p.parsing.start=p.parsing.end=p.buffering.start=p.buffering.end=self.performance.now(),h.trigger(P.FRAG_LOADED,f),g.bitrateTest=!1}})},a._handleTransmuxComplete=function(t){var i,l=this.playlistType,f=this.hls,h=t.remuxResult,g=t.chunkMeta,p=this.getCurrentContext(g);if(!p){this.resetWhenMissingContext(g);return}var E=p.frag,x=p.part,b=p.level,_=h.video,L=h.text,k=h.id3,I=h.initSegment,w=b.details,O=this.altAudio?void 0:h.audio;if(this.fragContextChanged(E)){this.fragmentTracker.removeFragment(E);return}if(this.state=ie.PARSING,I){if(I!=null&&I.tracks){var D=E.initSegment||E;this._bufferInitSegment(b,I.tracks,D,g),f.trigger(P.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:l,tracks:I.tracks})}var M=I.initPTS,G=I.timescale;ae(M)&&(this.initPTS[E.cc]={baseTime:M,timescale:G},f.trigger(P.INIT_PTS_FOUND,{frag:E,id:l,initPTS:M,timescale:G}))}if(_&&w){var N=w.fragments[E.sn-1-w.startSN],H=E.sn===w.startSN,X=!N||E.cc>N.cc;if(h.independent!==!1){var Y=_.startPTS,V=_.endPTS,j=_.startDTS,Q=_.endDTS;if(x)x.elementaryStreams[_.type]={startPTS:Y,endPTS:V,startDTS:j,endDTS:Q};else if(_.firstKeyFrame&&_.independent&&g.id===1&&!X&&(this.couldBacktrack=!0),_.dropped&&_.independent){var se=this.getMainFwdBufferInfo(),re=(se?se.end:this.getLoadPosition())+this.config.maxBufferHole,Z=_.firstKeyFramePTS?_.firstKeyFramePTS:Y;if(!H&&re<Z-this.config.maxBufferHole&&!X){this.backtrack(E);return}else X&&(E.gap=!0);E.setElementaryStreamInfo(_.type,E.start,V,E.start,Q,!0)}else H&&Y-(w.appliedTimelineOffset||0)>hi&&(E.gap=!0);E.setElementaryStreamInfo(_.type,Y,V,j,Q),this.backtrackFragment&&(this.backtrackFragment=E),this.bufferFragmentData(_,E,x,g,H||X)}else if(H||X)E.gap=!0;else{this.backtrack(E);return}}if(O){var oe=O.startPTS,le=O.endPTS,ue=O.startDTS,fe=O.endDTS;x&&(x.elementaryStreams[Ye.AUDIO]={startPTS:oe,endPTS:le,startDTS:ue,endDTS:fe}),E.setElementaryStreamInfo(Ye.AUDIO,oe,le,ue,fe),this.bufferFragmentData(O,E,x,g)}if(w&&k!=null&&(i=k.samples)!=null&&i.length){var Be={id:l,frag:E,details:w,samples:k.samples};f.trigger(P.FRAG_PARSING_METADATA,Be)}if(w&&L){var Ie={id:l,frag:E,details:w,samples:L.samples};f.trigger(P.FRAG_PARSING_USERDATA,Ie)}},a._bufferInitSegment=function(t,i,l,f){var h=this;if(this.state===ie.PARSING){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var g=i.audio,p=i.video,E=i.audiovideo;if(g){var x=Zr(g.codec,t.audioCodec);x==="mp4a"&&(x="mp4a.40.5");var b=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){x&&(x.indexOf("mp4a.40.5")!==-1?x="mp4a.40.2":x="mp4a.40.5");var _=g.metadata;_&&"channelCount"in _&&(_.channelCount||1)!==1&&b.indexOf("firefox")===-1&&(x="mp4a.40.5")}x&&x.indexOf("mp4a.40.5")!==-1&&b.indexOf("android")!==-1&&g.container!=="audio/mpeg"&&(x="mp4a.40.2",this.log("Android: force audio codec to "+x)),t.audioCodec&&t.audioCodec!==x&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+x+'"'),g.levelCodec=x,g.id=Ce.MAIN,this.log("Init audio buffer, container:"+g.container+", codecs[selected/level/parsed]=["+(x||"")+"/"+(t.audioCodec||"")+"/"+g.codec+"]"),delete i.audiovideo}if(p){p.levelCodec=t.videoCodec,p.id=Ce.MAIN;var L=p.codec;if(L?.length===4)switch(L){case"hvc1":case"hev1":p.codec="hvc1.1.6.L120.90";break;case"av01":p.codec="av01.0.04M.08";break;case"avc1":p.codec="avc1.42e01e";break}this.log("Init video buffer, container:"+p.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+L+"]"+(p.codec!==L?" parsed-corrected="+p.codec:"")+(p.supplemental?" supplemental="+p.supplemental:"")),delete i.audiovideo}E&&(this.log("Init audiovideo buffer, container:"+E.container+", codecs[level/parsed]=["+t.codecs+"/"+E.codec+"]"),delete i.video,delete i.audio);var k=Object.keys(i);if(k.length){if(this.hls.trigger(P.BUFFER_CODECS,i),!this.hls)return;k.forEach(function(I){var w=i[I],O=w.initSegment;O!=null&&O.byteLength&&h.hls.trigger(P.BUFFER_APPENDING,{type:I,data:O,frag:l,part:null,chunkMeta:f,parent:l.type})})}this.tickImmediate()}},a.getMainFwdBufferInfo=function(){var t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,Ce.MAIN)},a.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=ie.IDLE},a.checkFragmentChanged=function(){var t=this.media,i=null;if(t&&t.readyState>1&&t.seeking===!1){var l=t.currentTime;if(Ne.isBuffered(t,l)?i=this.getAppendedFrag(l):Ne.isBuffered(t,l+.1)&&(i=this.getAppendedFrag(l+.1)),i){this.backtrackFragment=null;var f=this.fragPlaying,h=i.level;(!f||i.sn!==f.sn||f.level!==h)&&(this.fragPlaying=i,this.hls.trigger(P.FRAG_CHANGED,{frag:i}),(!f||f.level!==h)&&this.hls.trigger(P.LEVEL_SWITCHED,{level:h}))}}},c(u,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var t=this.levels,i=this.level,l=t?.[i];return l?this.getMaxBufferLength(l.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t;if(this.fragPlaying)return this.fragPlaying;var i=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return ae(i)?this.getAppendedFrag(i):null}},{key:"currentProgramDateTime",get:function(){var t,i=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(ae(i)){var l=this.getLevelDetails(),f=this.currentFrag||(l?qi(null,l.fragments,i):null);if(f){var h=f.programDateTime;if(h!==null){var g=h+(i-f.start)*1e3;return new Date(g)}}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(oc),Mc=function(){function o(a){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=a}var u=o.prototype;return u.abort=function(r){for(var t in this.keyUriToKeyInfo){var i=this.keyUriToKeyInfo[t].loader;if(i){var l;if(r&&r!==((l=i.context)==null?void 0:l.frag.type))return;i.abort()}}},u.detach=function(){for(var r in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[r];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[r]}},u.destroy=function(){this.detach();for(var r in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[r].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},u.createKeyLoadError=function(r,t,i,l,f){return t===void 0&&(t=$.KEY_LOAD_ERROR),new Wt({type:be.NETWORK_ERROR,details:t,fatal:!1,frag:r,response:f,error:i,networkDetails:l})},u.loadClear=function(r,t){var i=this;if(this.emeController&&this.config.emeEnabled)for(var l=r.sn,f=r.cc,h=function(){var E=t[g];if(f<=E.cc&&(l==="initSegment"||E.sn==="initSegment"||l<E.sn))return i.emeController.selectKeySystemFormat(E).then(function(x){E.setKeyFormat(x)}),1},g=0;g<t.length&&!h();g++);},u.load=function(r){var t=this;return!r.decryptdata&&r.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(r).then(function(i){return t.loadInternal(r,i)}):this.loadInternal(r)},u.loadInternal=function(r,t){var i,l;t&&r.setKeyFormat(t);var f=r.decryptdata;if(!f){var h=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(r,$.KEY_LOAD_ERROR,h))}var g=f.uri;if(!g)return Promise.reject(this.createKeyLoadError(r,$.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+g+'"')));var p=this.keyUriToKeyInfo[g];if((i=p)!=null&&i.decryptdata.key)return f.key=p.decryptdata.key,Promise.resolve({frag:r,keyInfo:p});if((l=p)!=null&&l.keyLoadPromise){var E;switch((E=p.mediaKeySessionContext)==null?void 0:E.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return p.keyLoadPromise.then(function(x){return f.key=x.keyInfo.decryptdata.key,{frag:r,keyInfo:p}})}}switch(p=this.keyUriToKeyInfo[g]={decryptdata:f,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},f.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return f.keyFormat==="identity"?this.loadKeyHTTP(p,r):this.loadKeyEME(p,r);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(p,r);default:return Promise.reject(this.createKeyLoadError(r,$.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+f.method+'"')))}},u.loadKeyEME=function(r,t){var i={frag:t,keyInfo:r};if(this.emeController&&this.config.emeEnabled){var l=this.emeController.loadKey(i);if(l)return(r.keyLoadPromise=l.then(function(f){return r.mediaKeySessionContext=f,i})).catch(function(f){throw r.keyLoadPromise=null,f})}return Promise.resolve(i)},u.loadKeyHTTP=function(r,t){var i=this,l=this.config,f=l.loader,h=new f(l);return t.keyLoader=r.loader=h,r.keyLoadPromise=new Promise(function(g,p){var E={keyInfo:r,frag:t,responseType:"arraybuffer",url:r.decryptdata.uri},x=l.keyLoadPolicy.default,b={loadPolicy:x,timeout:x.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},_={onSuccess:function(k,I,w,O){var D=w.frag,M=w.keyInfo,G=w.url;if(!D.decryptdata||M!==i.keyUriToKeyInfo[G])return p(i.createKeyLoadError(D,$.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),O));M.decryptdata.key=D.decryptdata.key=new Uint8Array(k.data),D.keyLoader=null,M.loader=null,g({frag:D,keyInfo:M})},onError:function(k,I,w,O){i.resetLoader(I),p(i.createKeyLoadError(t,$.KEY_LOAD_ERROR,new Error("HTTP Error "+k.code+" loading key "+k.text),w,U({url:E.url,data:void 0},k)))},onTimeout:function(k,I,w){i.resetLoader(I),p(i.createKeyLoadError(t,$.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),w))},onAbort:function(k,I,w){i.resetLoader(I),p(i.createKeyLoadError(t,$.INTERNAL_ABORTED,new Error("key loading aborted"),w))}};h.load(E,b,_)})},u.resetLoader=function(r){var t=r.frag,i=r.keyInfo,l=r.url,f=i.loader;t.keyLoader===f&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[l],f&&f.destroy()},o}();function Zs(o){var u=o.type;switch(u){case Pe.AUDIO_TRACK:return Ce.AUDIO;case Pe.SUBTITLE_TRACK:return Ce.SUBTITLE;default:return Ce.MAIN}}function yn(o,u){var a=o.url;return(a===void 0||a.indexOf("data:")===0)&&(a=u.url),a}var Fc=function(){function o(a){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=a,this.registerListeners()}var u=o.prototype;return u.startLoad=function(r){},u.stopLoad=function(){this.destroyInternalLoaders()},u.registerListeners=function(){var r=this.hls;r.on(P.MANIFEST_LOADING,this.onManifestLoading,this),r.on(P.LEVEL_LOADING,this.onLevelLoading,this),r.on(P.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(P.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this)},u.unregisterListeners=function(){var r=this.hls;r.off(P.MANIFEST_LOADING,this.onManifestLoading,this),r.off(P.LEVEL_LOADING,this.onLevelLoading,this),r.off(P.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(P.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this)},u.createInternalLoader=function(r){var t=this.hls.config,i=t.pLoader,l=t.loader,f=i||l,h=new f(t);return this.loaders[r.type]=h,h},u.getInternalLoader=function(r){return this.loaders[r.type]},u.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},u.destroyInternalLoaders=function(){for(var r in this.loaders){var t=this.loaders[r];t&&t.destroy(),this.resetInternalLoader(r)}},u.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},u.onManifestLoading=function(r,t){var i=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Pe.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})},u.onLevelLoading=function(r,t){var i=t.id,l=t.level,f=t.pathwayId,h=t.url,g=t.deliveryDirectives,p=t.levelInfo;this.load({id:i,level:l,pathwayId:f,responseType:"text",type:Pe.LEVEL,url:h,deliveryDirectives:g,levelOrTrack:p})},u.onAudioTrackLoading=function(r,t){var i=t.id,l=t.groupId,f=t.url,h=t.deliveryDirectives,g=t.track;this.load({id:i,groupId:l,level:null,responseType:"text",type:Pe.AUDIO_TRACK,url:f,deliveryDirectives:h,levelOrTrack:g})},u.onSubtitleTrackLoading=function(r,t){var i=t.id,l=t.groupId,f=t.url,h=t.deliveryDirectives,g=t.track;this.load({id:i,groupId:l,level:null,responseType:"text",type:Pe.SUBTITLE_TRACK,url:f,deliveryDirectives:h,levelOrTrack:g})},u.onLevelsUpdated=function(r,t){var i=this.loaders[Pe.LEVEL];if(i){var l=i.context;l&&!t.levels.some(function(f){return f===l.levelOrTrack})&&(i.abort(),delete this.loaders[Pe.LEVEL])}},u.load=function(r){var t,i=this,l=this.hls.config,f=this.getInternalLoader(r);if(f){var h=this.hls.logger,g=f.context;if(g&&g.levelOrTrack===r.levelOrTrack&&(g.url===r.url||g.deliveryDirectives&&!r.deliveryDirectives)){g.url===r.url?h.log("[playlist-loader]: ignore "+r.url+" ongoing request"):h.log("[playlist-loader]: ignore "+r.url+" in favor of "+g.url);return}h.log("[playlist-loader]: aborting previous loader for type: "+r.type),f.abort()}var p;if(r.type===Pe.MANIFEST?p=l.manifestLoadPolicy.default:p=T({},l.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),f=this.createInternalLoader(r),ae((t=r.deliveryDirectives)==null?void 0:t.part)){var E;if(r.type===Pe.LEVEL&&r.level!==null?E=this.hls.levels[r.level].details:r.type===Pe.AUDIO_TRACK&&r.id!==null?E=this.hls.audioTracks[r.id].details:r.type===Pe.SUBTITLE_TRACK&&r.id!==null&&(E=this.hls.subtitleTracks[r.id].details),E){var x=E.partTarget,b=E.targetduration;if(x&&b){var _=Math.max(x*3,b*.8)*1e3;p=T({},p,{maxTimeToFirstByteMs:Math.min(_,p.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(_,p.maxTimeToFirstByteMs)})}}}var L=p.errorRetry||p.timeoutRetry||{},k={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:L.maxNumRetry||0,retryDelay:L.retryDelayMs||0,maxRetryDelay:L.maxRetryDelayMs||0},I={onSuccess:function(O,D,M,G){var N=i.getInternalLoader(M);i.resetInternalLoader(M.type);var H=O.data;if(H.indexOf("#EXTM3U")!==0){i.handleManifestParsingError(O,M,new Error("no EXTM3U delimiter"),G||null,D);return}D.parsing.start=performance.now(),Or.isMediaPlaylist(H)||M.type!==Pe.MANIFEST?i.handleTrackOrLevelPlaylist(O,D,M,G||null,N):i.handleMasterPlaylist(O,D,M,G)},onError:function(O,D,M,G){i.handleNetworkError(D,M,!1,O,G)},onTimeout:function(O,D,M){i.handleNetworkError(D,M,!0,void 0,O)}};f.load(r,k,I)},u.checkAutostartLoad=function(){if(this.hls){var r=this.hls,t=r.config,i=t.autoStartLoad,l=t.startPosition,f=r.forceStartLoad;(i||f)&&(this.hls.logger.log((i?"auto":"force")+" startLoad with configured startPosition "+l),this.hls.startLoad(l))}},u.handleMasterPlaylist=function(r,t,i,l){var f=this.hls,h=r.data,g=yn(r,i),p=Or.parseMasterPlaylist(h,g);if(p.playlistParsingError){this.handleManifestParsingError(r,i,p.playlistParsingError,l,t);return}var E=p.contentSteering,x=p.levels,b=p.sessionData,_=p.sessionKeys,L=p.startTimeOffset,k=p.variableList;this.variableList=k;var I=Or.parseMasterPlaylistMedia(h,g,p),w=I.AUDIO,O=w===void 0?[]:w,D=I.SUBTITLES,M=I["CLOSED-CAPTIONS"];if(O.length){var G=O.some(function(N){return!N.url});!G&&x[0].audioCodec&&!x[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),O.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ze({}),bitrate:0,url:""}))}f.trigger(P.MANIFEST_LOADED,{levels:x,audioTracks:O,subtitles:D,captions:M,contentSteering:E,url:g,stats:t,networkDetails:l,sessionData:b,sessionKeys:_,startTimeOffset:L,variableList:k})},u.handleTrackOrLevelPlaylist=function(r,t,i,l,f){var h=this.hls,g=i.id,p=i.level,E=i.type,x=yn(r,i),b=ae(p)?p:ae(g)?g:0,_=Zs(i),L=Or.parseLevelPlaylist(r.data,x,b,_,0,this.variableList);if(E===Pe.MANIFEST){var k={attrs:new Ze({}),bitrate:0,details:L,name:"",url:x};L.requestScheduled=t.loading.start+as(L,0),h.trigger(P.MANIFEST_LOADED,{levels:[k],audioTracks:[],url:x,stats:t,networkDetails:l,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=L,this.handlePlaylistLoaded(L,r,t,i,l,f)},u.handleManifestParsingError=function(r,t,i,l,f){this.hls.trigger(P.ERROR,{type:be.NETWORK_ERROR,details:$.MANIFEST_PARSING_ERROR,fatal:t.type===Pe.MANIFEST,url:r.url,err:i,error:i,reason:i.message,response:r,context:t,networkDetails:l,stats:f})},u.handleNetworkError=function(r,t,i,l,f){i===void 0&&(i=!1);var h="A network "+(i?"timeout":"error"+(l?" (status "+l.code+")":""))+" occurred while loading "+r.type;r.type===Pe.LEVEL?h+=": "+r.level+" id: "+r.id:(r.type===Pe.AUDIO_TRACK||r.type===Pe.SUBTITLE_TRACK)&&(h+=" id: "+r.id+' group-id: "'+r.groupId+'"');var g=new Error(h);this.hls.logger.warn("[playlist-loader]: "+h);var p=$.UNKNOWN,E=!1,x=this.getInternalLoader(r);switch(r.type){case Pe.MANIFEST:p=i?$.MANIFEST_LOAD_TIMEOUT:$.MANIFEST_LOAD_ERROR,E=!0;break;case Pe.LEVEL:p=i?$.LEVEL_LOAD_TIMEOUT:$.LEVEL_LOAD_ERROR,E=!1;break;case Pe.AUDIO_TRACK:p=i?$.AUDIO_TRACK_LOAD_TIMEOUT:$.AUDIO_TRACK_LOAD_ERROR,E=!1;break;case Pe.SUBTITLE_TRACK:p=i?$.SUBTITLE_TRACK_LOAD_TIMEOUT:$.SUBTITLE_LOAD_ERROR,E=!1;break}x&&this.resetInternalLoader(r.type);var b={type:be.NETWORK_ERROR,details:p,fatal:E,url:r.url,loader:x,context:r,error:g,networkDetails:t,stats:f};if(l){var _=t?.url||r.url;b.response=U({url:_,data:void 0},l)}this.hls.trigger(P.ERROR,b)},u.handlePlaylistLoaded=function(r,t,i,l,f,h){var g=this.hls,p=l.type,E=l.level,x=l.id,b=l.groupId,_=l.deliveryDirectives,L=yn(t,l),k=Zs(l),I=typeof l.level=="number"&&k===Ce.MAIN?E:void 0;if(!r.fragments.length){var w=r.playlistParsingError=new Error("No Segments found in Playlist");g.trigger(P.ERROR,{type:be.NETWORK_ERROR,details:$.LEVEL_EMPTY_ERROR,fatal:!1,url:L,error:w,reason:w.message,response:t,context:l,level:I,parent:k,networkDetails:f,stats:i});return}r.targetduration||(r.playlistParsingError=new Error("Missing Target Duration"));var O=r.playlistParsingError;if(O){if(this.hls.logger.warn(O),!g.config.ignorePlaylistParsingErrors){g.trigger(P.ERROR,{type:be.NETWORK_ERROR,details:$.LEVEL_PARSING_ERROR,fatal:!1,url:L,error:O,reason:O.message,response:t,context:l,level:I,parent:k,networkDetails:f,stats:i});return}r.playlistParsingError=null}switch(r.live&&h&&(h.getCacheAge&&(r.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(r.ageHeader))&&(r.ageHeader=0)),p){case Pe.MANIFEST:case Pe.LEVEL:g.trigger(P.LEVEL_LOADED,{details:r,levelInfo:l.levelOrTrack||g.levels[0],level:I||0,id:x||0,stats:i,networkDetails:f,deliveryDirectives:_,withoutMultiVariant:p===Pe.MANIFEST});break;case Pe.AUDIO_TRACK:g.trigger(P.AUDIO_TRACK_LOADED,{details:r,track:l.levelOrTrack,id:x||0,groupId:b||"",stats:i,networkDetails:f,deliveryDirectives:_});break;case Pe.SUBTITLE_TRACK:g.trigger(P.SUBTITLE_TRACK_LOADED,{details:r,track:l.levelOrTrack,id:x||0,groupId:b||"",stats:i,networkDetails:f,deliveryDirectives:_});break}},o}(),Nc={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Bc(o,u){return{supported:!1,configurations:u,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:o}}var Js={};function Uc(o,u,a){var r=o.videoCodec,t=o.audioCodec;if(!r&&!t||!a)return Promise.resolve(Nc);var i=[];if(r){var l={width:o.width,height:o.height,bitrate:Math.ceil(Math.max(o.bitrate*.9,o.averageBitrate)),framerate:o.frameRate||30},f=o.videoRange;f!=="SDR"&&(l.transferFunction=f.toLowerCase());var h=r.split(","),g=navigator.userAgent;if(h.some(function(p){return ji(p)})&&_a())return Promise.resolve(Bc(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: ("+g+")"),i));i.push.apply(i,h.map(function(p){return{type:"media-source",video:U(U({},l),{},{contentType:wr(Zl(p),"video")})}}))}return t&&o.audioGroups&&o.audioGroups.forEach(function(p){var E;p&&((E=u.groups[p])==null||E.tracks.forEach(function(x){if(x.groupId===p){var b=x.channels||"",_=parseFloat(b);ae(_)&&_>2&&i.push.apply(i,t.split(",").map(function(L){return{type:"media-source",audio:{contentType:wr(L,"audio"),channels:""+_}}}))}}))}),Promise.all(i.map(function(p){var E=Hc(p);return Js[E]||(Js[E]=a.decodingInfo(p))})).then(function(p){return{supported:!p.some(function(E){return!E.supported}),configurations:i,decodingInfoResults:p}}).catch(function(p){return{supported:!1,configurations:i,decodingInfoResults:[],error:p}})}function Hc(o){var u=o.audio,a=o.video,r=a||u;if(r){var t=ka(r.contentType);if(a)return"r"+a.height+"x"+a.width+"f"+Math.ceil(a.framerate)+(a.transferFunction||"sd")+"_"+t+"_"+Math.ceil(a.bitrate/1e5);if(u)return"c"+u.channels+(u.spatialRendering?"s":"n")+"_"+t}return""}var eo=function(){function o(a){a===void 0&&(a={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ve,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var r=this.logger=ua(a.debug||!1,"Hls instance",a.assetPlayerId),t=this.config=Qf(o.DefaultConfig,a,r);this.userConfig=a,t.progressive&&Zf(t,r);var i=t.abrController,l=t.bufferController,f=t.capLevelController,h=t.errorController,g=t.fpsController,p=new h(this),E=this.abrController=new i(this),x=new Jf(this),b=t.interstitialsController,_=b?this.interstitialsController=new b(this,o):null,L=this.bufferController=new l(this,x),k=this.capLevelController=new f(this),I=new g(this),w=new Fc(this),O=t.contentSteeringController,D=O?new O(this):null,M=this.levelController=new xc(this,D),G=new Ec(this),N=new Mc(this.config),H=this.streamController=new Oc(this,x,N),X=this.gapController=new cc(this,x);k.setStreamController(H),I.setStreamController(H);var Y=[w,M,H];_&&Y.splice(1,0,_),D&&Y.splice(1,0,D),this.networkControllers=Y;var V=[E,L,X,k,I,G,x];this.audioTrackController=this.createController(t.audioTrackController,Y);var j=t.audioStreamController;j&&Y.push(this.audioStreamController=new j(this,x,N)),this.subtitleTrackController=this.createController(t.subtitleTrackController,Y);var Q=t.subtitleStreamController;Q&&Y.push(this.subtititleStreamController=new Q(this,x,N)),this.createController(t.timelineController,V),N.emeController=this.emeController=this.createController(t.emeController,V),this.cmcdController=this.createController(t.cmcdController,V),this.latencyController=this.createController(Tc,V),this.coreComponents=V,Y.push(p);var se=p.onErrorOut;typeof se=="function"&&this.on(P.ERROR,se,p),this.on(P.MANIFEST_LOADED,w.onManifestLoaded,w)}o.isMSESupported=function(){return Qs()},o.isSupported=function(){return Pc()},o.getMediaSource=function(){return Zt()};var u=o.prototype;return u.createController=function(r,t){if(r){var i=new r(this);return t&&t.push(i),i}return null},u.on=function(r,t,i){i===void 0&&(i=this),this._emitter.on(r,t,i)},u.once=function(r,t,i){i===void 0&&(i=this),this._emitter.once(r,t,i)},u.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},u.off=function(r,t,i,l){i===void 0&&(i=this),this._emitter.off(r,t,i,l)},u.listeners=function(r){return this._emitter.listeners(r)},u.emit=function(r,t,i){return this._emitter.emit(r,t,i)},u.trigger=function(r,t){if(this.config.debug)return this.emit(r,r,t);try{return this.emit(r,r,t)}catch(l){if(this.logger.error("An internal error happened while handling event "+r+'. Error message: "'+l.message+'". Here is a stacktrace:',l),!this.triggeringException){this.triggeringException=!0;var i=r===P.ERROR;this.trigger(P.ERROR,{type:be.OTHER_ERROR,details:$.INTERNAL_EXCEPTION,fatal:i,event:r,error:l}),this.triggeringException=!1}}return!1},u.listenerCount=function(r){return this._emitter.listenerCount(r)},u.destroy=function(){this.logger.log("destroy"),this.trigger(P.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var r=this.config;r.xhrSetup=r.fetchSetup=void 0,this.userConfig=null},u.attachMedia=function(r){if(!r||"media"in r&&!r.media){var t=new Error("attachMedia failed: invalid argument ("+r+")");this.trigger(P.ERROR,{type:be.OTHER_ERROR,details:$.ATTACH_MEDIA_ERROR,fatal:!0,error:t});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var i="media"in r,l=i?r.media:r,f=i?r:{media:l};this._media=l,this.trigger(P.MEDIA_ATTACHING,f)},u.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(P.MEDIA_DETACHING,{}),this._media=null},u.transferMedia=function(){this._media=null;var r=this.bufferController.transferMedia();return this.trigger(P.MEDIA_DETACHING,{transferMedia:r}),r},u.loadSource=function(r){this.stopLoad();var t=this.media,i=this._url,l=this._url=ft.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+l),t&&i&&(i!==l||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(P.MANIFEST_LOADING,{url:r})},u.startLoad=function(r,t){r===void 0&&(r=-1),this.logger.log("startLoad("+(r+(t?", <skip seek to start>":""))+")"),this.started=!0,this.resumeBuffering();for(var i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(r,t),!(!this.started||!this.networkControllers));i++);},u.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].stopLoad(),!(this.started||!this.networkControllers));r++);},u.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(r){r.resumeBuffering&&r.resumeBuffering()}))},u.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(r){r.pauseBuffering&&r.pauseBuffering()}))},u.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},u.recoverMediaError=function(){this.logger.log("recoverMediaError");var r=this._media,t=r?.currentTime;this.detachMedia(),r&&(this.attachMedia(r),t&&this.startLoad(t))},u.removeLevel=function(r){this.levelController.removeLevel(r)},u.setAudioOption=function(r){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(r))||null},u.setSubtitleOption=function(r){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(r))||null},u.getMediaDecodingInfo=function(r,t){t===void 0&&(t=this.allAudioTracks);var i=Da(t);return Uc(r,i,navigator.mediaCapabilities)},c(o,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var r,t=(r={},r[Ce.MAIN]=this.streamController.inFlightFrag,r);return this.audioStreamController&&(t[Ce.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[Ce.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}},{key:"sessionId",get:function(){var r=this._sessionId;return r||(r=this._sessionId=J()),r}},{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){this.logger.log("set currentLevel:"+r),this.levelController.manualLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){this.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){this.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){this.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){var r=this.levelController.startLevel;return r===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:r},set:function(r){this.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var t=!!r;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(this.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN},set:function(r){this.abrController.resetEstimator(r)}},{key:"abrEwmaDefaultEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(r){Jl(r)&&this._maxHdcpLevel!==r&&(this._maxHdcpLevel=r,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,t=this.config.minAutoBitrate;if(!r)return 0;for(var i=r.length,l=0;l<i;l++)if(r[l].maxBitrate>=t)return l;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,t=this.autoLevelCapping,i=this.maxHdcpLevel,l;if(t===-1&&r!=null&&r.length?l=r.length-1:l=t,i)for(var f=l;f--;){var h=r[f].attrs["HDCP-LEVEL"];if(h&&h<=i)return f}return l}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(r){this.abrController.nextAutoLevel=r}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var r=this.audioTrackController;return r?r.allAudioTracks:[]}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var t=this.audioTrackController;t&&(t.audioTrack=r)}},{key:"allSubtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var t=this.subtitleTrackController;t&&(t.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(r){this.latencyController.targetLatency=r}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(r){this.levelController.pathwayPriority=r}},{key:"bufferedToEnd",get:function(){var r;return!!((r=this.bufferController)!=null&&r.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var r;return((r=this.interstitialsController)==null?void 0:r.interstitialsManager)||null}}],[{key:"version",get:function(){return Br}},{key:"Events",get:function(){return P}},{key:"MetadataSchema",get:function(){return St}},{key:"ErrorTypes",get:function(){return be}},{key:"ErrorDetails",get:function(){return $}},{key:"DefaultConfig",get:function(){return o.defaultConfig?o.defaultConfig:qf},set:function(r){o.defaultConfig=r}}])}();return eo.defaultConfig=void 0,eo})})(!1)}(Hn)),Hn.exports}var Fv=Mv();const jt=Di(Fv);var _l={};_l.getBrowserVersion=function(){var y=navigator.userAgent;if(y.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(y.indexOf("Firefox")>-1){var m=y.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Firefox "+m}else if(y.indexOf("Edge")>-1){var d=y.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Edge "+d}else{if(y.indexOf("rv:11")>-1)return"IE 11";if(y.indexOf("Opera")>-1||y.indexOf("OPR")>-1){if(y.indexOf("Opera")>-1){var n=y.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+n}if(y.indexOf("OPR")>-1){var e=y.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+e}}else if(y.indexOf("Chrome")>-1){var s=y.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Chrome "+s}else if(y.indexOf("Safari")>-1){var c=y.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Safari "+c}else if(y.indexOf("MSIE")>-1||y.indexOf("Trident")>-1){if(y.indexOf("MSIE")>-1){var v=y.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+v}if(y.indexOf("Trident")>-1){var T=y.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0],S=parseInt(T)+4;return"IE "+S}}else return"Unknown"}};var Nv=function(y){kv(d,y);var m=wv(d);function d(n){var e;return Cv(this,d),e=m.call(this,n),e.browser=_l.getBrowserVersion(),e.hls=null,e.hlsOpts={},e.player.handleSource=!1,e}return Av(d,[{key:"_adaptHlsJsConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.playerConfig;return!(e!=null&&e.startPosition)&&typeof s.startTime=="number"&&(e.startPosition=s.startTime),e}},{key:"afterCreate",value:function(){var e=this,s=this.config.hlsOpts;this.hlsOpts=this._adaptHlsJsConfig(s),this.on(Yr,function(c){/^blob/.test(c)||(e.playerConfig.url=c,e.register(c))});try{Dt.defineGetterOrSetter(this.player,{url:{get:function(){try{return e.player.video.src}catch{return null}},configurable:!0}})}catch{}}},{key:"beforePlayerInit",value:function(){this.register(this.player.config.url)}},{key:"destroy",value:function(){this.hls&&this.hls.destroy();var e=this.player;Dt.defineGetterOrSetter(e,{url:{get:function(){try{return e.__url}catch{return null}},configurable:!0}})}},{key:"register",value:function(e){var s=this,c=this.player;this.hls&&this.hls.destroy(),this.hls=new jt(this.hlsOpts),this.hls.once(jt.Events.MEDIA_ATTACHED,function(){s.hls.loadSource(e)}),this.hls.on(jt.Events.ERROR,function(v,T){var S;if(c.emit("HLS_ERROR",{errorType:T.type,errorDetails:T.details,errorFatal:T.fatal}),T.fatal)switch(T.type){case jt.ErrorTypes.NETWORK_ERROR:(T==null||(S=T.networkDetails)===null||S===void 0?void 0:S.status)!==404&&s.hls.startLoad();break;case jt.ErrorTypes.MEDIA_ERROR:s.hls.recoverMediaError();break;default:c.emit("error",T)}}),this.hls.attachMedia(this.player.media||this.player.video),this._statistics()}},{key:"_statistics",value:function(){var e={speed:0,playerType:"HlsPlayer"},s={videoDataRate:0,audioDataRate:0},c=this.player,v=this.hls;v.on(jt.Events.FRAG_LOAD_PROGRESS,function(T,S){e.speed=S.stats.loaded/1e3}),v.on(jt.Events.FRAG_PARSING_DATA,function(T,S){S.type==="video"&&(s.fps=parseInt(S.nb/(S.endPTS-S.startPTS)))}),v.on(jt.Events.FRAG_PARSING_INIT_SEGMENT,function(T,S){if(s.hasAudio=!!(S.tracks&&S.tracks.audio),s.hasVideo=!!(S.tracks&&S.tracks.audio),s.hasAudio){var C=S.tracks.audio;s.audioChannelCount=C.metadata&&C.metadata.channelCount?C.metadata.channelCount:0,s.audioCodec=C.codec}if(s.hasVideo){var R=S.tracks.video;s.videoCodec=R.codec,s.width=R.metadata&&R.metadata.width?R.metadata.width:0,s.height=R.metadata&&R.metadata.height?R.metadata.height:0}s.duration=S.frag&&S.frag.duration?S.frag.duration:0,s.level=S.frag&&S.frag.levels?S.frag.levels:0,(s.videoCodec||s.audioCodec)&&(s.mimeType='video/hls; codecs="'.concat(s.videoCodec,";").concat(s.audioCodec,'"')),c.mediainfo=s,c.emit("media_info",s)}),this._statisticsTimmer=setInterval(function(){c.emit("statistics_info",e),e.speed=0},1e3)}}],[{key:"pluginName",get:function(){return"HlsJsPlugin"}},{key:"defaultConfig",get:function(){return{hlsOpts:{}}}},{key:"isSupported",get:function(){return jt.isSupported}}]),d}(Dt);const Bv=["id"],Uv=qn({name:"VabPlayerHls",__name:"VabPlayerHls",props:{config:{type:Object,default(){return{id:"mse",url:""}}}},emits:["player"],setup(y,{emit:m}){const d=y,n=Gn(null),e=m,s=()=>{d.config.url&&d.config.url!==""&&(n.value=new Ot({plugins:[Nv],...d.config}),e("player",n.value))};return rh(d.config,()=>{s()},{deep:!0}),ih(()=>{s()}),nh(()=>{n.value&&typeof n.value.destroy=="function"&&n.value.destroy()}),(c,v)=>(Ir(),Vr("div",{id:y.config.id},null,8,Bv))}}),Hv={class:"monitor-container no-background-container"},Gv=qn({name:"Monitor",__name:"monitor",setup(y){const m=uo({url:"https://gcalic.v.myalicdn.com/gc/bsszjs_1/index.m3u8?contentid=2820180516001",id:ch("uuid_hls_"),lang:"zh",volume:0,autoplay:!0,screenShot:!0,playbackRate:[.5,.75,1,1.5,2],width:"100%",height:"100%"}),d=Gn("1"),n=uo({text:""}),e=[{value:"1",label:"全部"}],s=Gn("普通直播");let c;const v=T=>{c=T};return ah(()=>{c.play()}),sh(()=>{c.pause()}),(T,S)=>{const C=_t("vab-icon"),R=_t("el-option"),F=_t("el-select"),B=_t("el-scrollbar"),U=_t("el-input"),W=_t("el-button"),z=_t("el-form-item"),ne=_t("el-form"),te=uh,J=_t("el-col"),Le=Uv,pe=_t("el-radio-button"),De=_t("el-radio-group"),Re=_t("el-tag"),je=vh,Ve=_t("el-row");return Ir(),Vr("div",Hv,[ve(Ve,{gutter:20},{default:Ee(()=>[ve(J,{lg:5,md:24,sm:24,xl:5,xs:24},{default:Ee(()=>[ve(te,{"body-style":{padding:"20px 0 20px 20px"},style:{height:"var(--el-container-height)"}},{header:Ee(()=>[ve(C,{icon:"chat-1-line"}),S[3]||(S[3]=$e(" 聊天窗口 "))]),default:Ee(()=>[ve(F,{modelValue:ur(d),"onUpdate:modelValue":S[0]||(S[0]=ge=>fo(d)?d.value=ge:null),style:{width:"80px"}},{default:Ee(()=>[(Ir(),Vr(oh,null,lh(e,ge=>ve(R,{key:ge.value,label:ge.label,value:ge.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),ve(B,{style:{height:"calc(var(--el-container-height) - 160px)","padding-right":"20px"}},{default:Ee(()=>S[4]||(S[4]=[xe("div",{class:"chat-list"},[xe("div",{class:"chat-item"},[xe("div",{class:"chat-item-user"},"用户admin"),xe("div",{class:"chat-item-content"},"马上就开始了，好激动！"),xe("div",{class:"chat-item-time"},"13:09:12")]),xe("div",{class:"chat-item"},[xe("div",{class:"chat-item-user"},"用户admin"),xe("div",{class:"chat-item-content"},"马上就开始了，好激动！"),xe("div",{class:"chat-item-time"},"13:09:12")]),xe("div",{class:"chat-item"},[xe("div",{class:"chat-item-user"},"用户admin"),xe("div",{class:"chat-item-content"},"马上就开始了，好激动！"),xe("div",{class:"chat-item-time"},"13:09:12")]),xe("div",{class:"chat-item"},[xe("div",{class:"chat-item-user"},"用户admin"),xe("div",{class:"chat-item-content"},"马上就开始了，好激动！"),xe("div",{class:"chat-item-time"},"13:09:12")]),xe("div",{class:"chat-item"},[xe("div",{class:"chat-item-user"},"用户admin"),xe("div",{class:"chat-item-content"},"马上就开始了，好激动！"),xe("div",{class:"chat-item-time"},"13:09:12")])],-1)])),_:1}),ve(ne,{model:ur(n)},{default:Ee(()=>[ve(z,null,{default:Ee(()=>[ve(U,{modelValue:ur(n).text,"onUpdate:modelValue":S[1]||(S[1]=ge=>ur(n).text=ge),class:"chat-input"},null,8,["modelValue"]),ve(W,{class:"chat-send",type:"primary"},{default:Ee(()=>S[5]||(S[5]=[$e("发送")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),ve(J,{lg:14,md:24,sm:24,xl:14,xs:24},{default:Ee(()=>[ve(te,{"body-style":{padding:"0",height:"calc(var(--el-container-height) - 207px)"},style:{height:"calc(var(--el-container-height) - 150px)"}},{header:Ee(()=>[ve(C,{icon:"vidicon-line"}),S[6]||(S[6]=$e(" 直播预览 "))]),default:Ee(()=>[ve(Le,{config:ur(m),style:{"background-color":"rgba(0, 0, 0, 0.87)"},onPlayer:v},null,8,["config"])]),_:1}),ve(te,{style:{height:"130px"}},{header:Ee(()=>[ve(C,{icon:"emoji-sticker-line"}),S[7]||(S[7]=$e(" 直播方式 "))]),default:Ee(()=>[ve(De,{modelValue:ur(s),"onUpdate:modelValue":S[2]||(S[2]=ge=>fo(s)?s.value=ge:null)},{default:Ee(()=>[ve(pe,{label:"普通直播"}),ve(pe,{label:"控流直播"}),ve(pe,{label:"视频直播"}),ve(pe,{label:"网页开播"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),ve(J,{lg:5,md:24,sm:24,xl:5,xs:24},{default:Ee(()=>[ve(te,null,{header:Ee(()=>[ve(C,{icon:"cursor-line"}),S[8]||(S[8]=$e(" 快捷操作 "))]),default:Ee(()=>[ve(W,{bg:"",class:"live-button",text:"",type:"primary"},{default:Ee(()=>S[9]||(S[9]=[$e("切换清晰度")])),_:1}),ve(W,{bg:"",class:"live-button",text:"",type:"primary"},{default:Ee(()=>S[10]||(S[10]=[$e("主备流切换")])),_:1}),ve(W,{bg:"",class:"live-button",text:"",type:"primary"},{default:Ee(()=>S[11]||(S[11]=[$e("推流垫片")])),_:1})]),_:1}),ve(te,{style:{height:"calc(var(--el-container-height) - 255px)","min-height":"430px"}},{header:Ee(()=>[ve(C,{icon:"stack-line"}),S[13]||(S[13]=$e(" 直播状态 ")),ve(Re,{style:{position:"absolute",top:"15px",right:"var(--el-margin)"},type:"success"},{default:Ee(()=>S[12]||(S[12]=[$e("流畅")])),_:1})]),default:Ee(()=>[ve(Ve,{gutter:20},{default:Ee(()=>[ve(J,{span:24},{default:Ee(()=>[ve(je,{"content-position":"left"},{default:Ee(()=>S[14]||(S[14]=[$e("主流")])),_:1})]),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[15]||(S[15]=[xe("div",{class:"live-item"},[xe("span",null,"码率"),$e(" 6 Mbps ")],-1)])),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[16]||(S[16]=[xe("div",{class:"live-item"},[xe("span",null,"帧率"),$e(" 60 ")],-1)])),_:1}),ve(J,{span:24},{default:Ee(()=>[ve(je,{"content-position":"left"},{default:Ee(()=>S[17]||(S[17]=[$e("热备")])),_:1})]),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[18]||(S[18]=[xe("div",{class:"live-item"},[xe("span",null,"码率"),$e(" 6 Mbps ")],-1)])),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[19]||(S[19]=[xe("div",{class:"live-item"},[xe("span",null,"帧率"),$e(" 60 ")],-1)])),_:1}),ve(J,{span:24},{default:Ee(()=>[ve(je,{"content-position":"left"},{default:Ee(()=>S[20]||(S[20]=[$e("冷备")])),_:1})]),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[21]||(S[21]=[xe("div",{class:"live-item"},[xe("span",null,"码率"),$e(" 6 Mbps ")],-1)])),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[22]||(S[22]=[xe("div",{class:"live-item"},[xe("span",null,"帧率"),$e(" 60 ")],-1)])),_:1}),ve(J,{span:24},{default:Ee(()=>[ve(je,{"content-position":"left"},{default:Ee(()=>S[23]||(S[23]=[$e("画面信息")])),_:1})]),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[24]||(S[24]=[xe("div",{class:"live-item"},[xe("span",null,"线路"),$e(" 热备 ")],-1)])),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[25]||(S[25]=[xe("div",{class:"live-item"},[xe("span",null,"CDN"),$e(" KS ")],-1)])),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[26]||(S[26]=[xe("div",{class:"live-item"},[xe("span",null,"播放格式"),$e(" Hls ")],-1)])),_:1}),ve(J,{lg:12,md:12,sm:12,xl:12,xs:12},{default:Ee(()=>S[27]||(S[27]=[xe("div",{class:"live-item"},[xe("span",null,"画质"),$e(" 原画 ")],-1)])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Wv=zo(Gv,[["__scopeId","data-v-eb48c37d"]]);export{Wv as default};
