/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CIA3YA7G.js";import{d as ae,H as re,aE as le,e as ie,r as a,f as ce,b as ue,g as m,h as me,k,o as f,m as o,c as q,w as K,j as n,F as fe,n as pe,a as s,i as B,l as w,v as u,t as D,K as de,z as _e,X as ge,aM as ve,aN as ke}from"./index-BdmDrM2Y.js";import{b as ye}from"./formCreate-CdOY-8fL.js";import{a as Ce}from"./index-B5oLC0ma.js";import{g as Te}from"./index-ILFGuW6l.js";import{a as De,r as $e,g as be}from"./index-DS7aqjKl.js";import{_ as Fe}from"./TaskUpdateAssigneeForm.vue_vue_type_script_setup_true_lang-CWnP9ych.js";import{_ as we}from"./ProcessInstanceBpmnViewer.vue_vue_type_style_index_0_lang-D8JzOaup.js";import{_ as he}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-eqK_pgEw.js";import{_ as xe}from"./TaskReturnDialogForm.vue_vue_type_script_name_TaskRollbackDialogForm_setup_true_lang-B5jWXjPy.js";import{_ as Ue}from"./TaskDelegateForm.vue_vue_type_script_setup_true_lang-GleR25Nh.js";import{_ as Ve}from"./TaskAddSignDialogForm.vue_vue_type_script_setup_true_lang-D9kKKHIg.js";import"./index-BXAiRI9b.js";import"./bpmn-embedded-UJNTeCAt.js";import"./XTextButton-pTj8pxAx.js";import"./XButton-BTFQ9ZCN.js";import"./dict-Cm-9nniQ.js";import"./DictTag.vue_vue_type_script_lang-bjcRCBWf.js";import"./color-B5phLuB-.js";import"./ProcessInstanceChildrenTaskList.vue_vue_type_script_setup_true_lang-yHv7oCQv.js";import"./TaskSubSignDialogForm.vue_vue_type_script_name_TaskRollbackDialogForm_setup_true_lang-8PZSsaaX.js";const Be={class:"el-icon-picture-outline"},Ie={style:{"margin-bottom":"20px","margin-left":"10%","font-size":"14px"}},Re={class:"el-icon-document"},Ae={key:1},ts=ae({name:"BpmProcessInstanceDetail",__name:"index",setup(Se){const{query:H}=re(),h=_e(),{proxy:O}=le(),W=ie().getUser.id,x=H.id,y=a(!1),r=a({}),I=a(""),U=a(!0),d=a([]),$=a([]),_=a([]),G=ce({reason:[{required:!0,message:"审批建议不能为空",trigger:"blur"}]}),b=a(),C=a({rule:[],option:{},value:{}}),R=async(t,e)=>{const l=$.value.indexOf(t),V=O.$refs[`form${l}`][0],F=s(V);if(!F||!await F.validate())return;const i={id:t.id,reason:_.value[l].reason};e?(await De(i),h.success("审批通过成功")):(await $e(i),h.success("审批不通过成功")),g()},A=a(),J=t=>{A.value.open(t)},S=a(),Q=async t=>{S.value.open(t.id)},L=a(),Y=async t=>{L.value.open(t.id)},N=a(),Z=async t=>{N.value.open(t.id)},g=()=>{ee(),se()},P=a(null),ee=async()=>{try{y.value=!0;const t=await Te(x);if(!t){h.error("查询不到流程信息！");return}r.value=t;const e=t.processDefinition;e.formType===10?(ye(C,e.formConf,e.formFields,t.formVariables),ge().then(()=>{b.value?.fapi?.btn.show(!1),b.value?.fapi?.resetBtn.show(!1),b.value?.fapi?.disabled(!0)})):P.value=ve(t.processDefinition.formCustomViewPath),I.value=await Ce(e.id)}finally{y.value=!1}},se=async()=>{try{U.value=!0;const t=await be(x);d.value=[],t.forEach(e=>{e.result!==4&&d.value.push(e)}),d.value.sort((e,l)=>e.endTime&&l.endTime?l.endTime-e.endTime:e.endTime?1:l.endTime?-1:l.createTime-e.createTime),$.value=[],_.value=[],E(d.value)}finally{U.value=!1}},E=t=>{t.forEach(e=>{ke(e.children)||E(e.children),!(e.result!==1&&e.result!==6)&&(!e.assigneeUser||e.assigneeUser.id!==W||($.value.push({...e}),_.value.push({reason:""})))})};return ue(()=>{g()}),(t,e)=>{const l=m("el-form-item"),V=m("el-tag"),F=m("el-input"),M=m("el-form"),i=de,v=m("el-button"),z=m("el-col"),X=m("el-card"),ne=m("form-create"),te=oe,j=me("loading");return f(),k(te,null,{default:o(()=>[(f(!0),q(fe,null,pe(s($),(c,T)=>K((f(),k(X,{key:T,class:"box-card"},{header:o(()=>[B("span",Be,"审批任务【"+D(c.name)+"】",1)]),default:o(()=>[n(z,{offset:6,span:16},{default:o(()=>[n(M,{ref_for:!0,ref:"form"+T,"label-width":"100px",model:s(_)[T],rules:s(G)},{default:o(()=>[s(r)&&s(r).name?(f(),k(l,{key:0,label:"流程名"},{default:o(()=>[u(D(s(r).name),1)]),_:1})):w("",!0),s(r)&&s(r).startUser?(f(),k(l,{key:1,label:"流程发起人"},{default:o(()=>[u(D(s(r).startUser.nickname)+" ",1),n(V,{size:"small",type:"info"},{default:o(()=>[u(D(s(r).startUser.deptName),1)]),_:1})]),_:1})):w("",!0),n(l,{label:"审批建议",prop:"reason"},{default:o(()=>[n(F,{modelValue:s(_)[T].reason,"onUpdate:modelValue":p=>s(_)[T].reason=p,placeholder:"请输入审批建议",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"]),B("div",Ie,[n(v,{type:"success",onClick:p=>R(c,!0)},{default:o(()=>[n(i,{icon:"ep:select"}),e[1]||(e[1]=u(" 通过 "))]),_:2},1032,["onClick"]),n(v,{type:"danger",onClick:p=>R(c,!1)},{default:o(()=>[n(i,{icon:"ep:close"}),e[2]||(e[2]=u(" 不通过 "))]),_:2},1032,["onClick"]),n(v,{type:"primary",onClick:p=>J(c.id)},{default:o(()=>[n(i,{icon:"ep:edit"}),e[3]||(e[3]=u(" 转办 "))]),_:2},1032,["onClick"]),n(v,{type:"primary",onClick:p=>Q(c)},{default:o(()=>[n(i,{icon:"ep:position"}),e[4]||(e[4]=u(" 委派 "))]),_:2},1032,["onClick"]),n(v,{type:"primary",onClick:p=>Z(c)},{default:o(()=>[n(i,{icon:"ep:plus"}),e[5]||(e[5]=u(" 加签 "))]),_:2},1032,["onClick"]),n(v,{type:"warning",onClick:p=>Y(c)},{default:o(()=>[n(i,{icon:"ep:back"}),e[6]||(e[6]=u(" 回退 "))]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),[[j,s(y)]])),128)),K((f(),k(X,{class:"box-card"},{header:o(()=>[B("span",Re,"申请信息【"+D(s(r).name)+"】",1)]),default:o(()=>[s(r)?.processDefinition?.formType===10?(f(),k(z,{key:0,offset:6,span:16},{default:o(()=>[n(ne,{ref_key:"fApi",ref:b,modelValue:s(C).value,"onUpdate:modelValue":e[0]||(e[0]=c=>s(C).value=c),option:s(C).option,rule:s(C).rule},null,8,["modelValue","option","rule"])]),_:1})):w("",!0),s(r)?.processDefinition?.formType===20?(f(),q("div",Ae,[n(s(P),{id:s(r).businessKey},null,8,["id"])])):w("",!0)]),_:1})),[[j,s(y)]]),n(he,{loading:s(U),tasks:s(d)},null,8,["loading","tasks"]),n(we,{id:`${s(x)}`,"bpmn-xml":s(I),loading:s(y),"process-instance":s(r),tasks:s(d)},null,8,["id","bpmn-xml","loading","process-instance","tasks"]),n(Fe,{ref_key:"taskUpdateAssigneeFormRef",ref:A,onSuccess:g},null,512),n(xe,{ref_key:"taskReturnDialogRef",ref:L,onSuccess:g},null,512),n(Ue,{ref_key:"taskDelegateForm",ref:S,onSuccess:g},null,512),n(Ve,{ref_key:"taskAddSignDialogForm",ref:N,onSuccess:g},null,512)]),_:1})}}});export{ts as default};
