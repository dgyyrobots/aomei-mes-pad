/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:21:26 
 */
import{d as Q,r as c,f as W,b as Z,g as i,h as ee,k as y,o as x,m as t,w as ae,a as o,j as a,c as le,F as te,n as oe,v as f,t as re,K as ne,y as se,_ as ue,N as de,c6 as U,bY as ie,dm as k,z as ce}from"./index-5TqN_QR1.js";import{c as me,D as pe}from"./dict-B2yk4gHf.js";import{a as fe,c as ge,u as _e}from"./index-EcVbsEQQ.js";import{g as ve}from"./index-D2TUv3j9.js";import{d as Ve}from"./tree-vSlcEeQq.js";const ke=Q({__name:"ExpressTemplateForm",emits:["success"],setup(Ce,{expose:F,emit:A}){const{t:P}=de(),h=ce(),D={...Ve,multiple:!0},g=c(!1),E=c(""),_=c(!1),w=c(""),r=c({id:void 0,name:"",chargeMode:1,sort:0,charges:[],frees:[]}),v=new Map,V=c({startCountTitle:"首件",extraCountTitle:"续件",freeCountTitle:"包邮件数"}),R=W({name:[{required:!0,message:"模板名称不能为空",trigger:"blur"}],chargeMode:[{required:!0,message:"配送计费方式不能为空",trigger:"blur"}],sort:[{required:!0,message:"分类排序不能为空",trigger:"blur"}]}),b=c();F({open:async(u,l)=>{g.value=!0,E.value=P(`action.${u}`),w.value=u,B();try{l&&(_.value=!0,r.value=await fe(l),V.value=v.get(r.value.chargeMode),r.value.charges.forEach(n=>{n.startPrice=U(n.startPrice),n.extraPrice=U(n.extraPrice)}),r.value.frees.forEach(n=>{n.freePrice=U(n.freePrice)}))}finally{_.value=!1}}});const S=A,q=async()=>{if(!(!b||!await b.value.validate())){_.value=!0;try{const l=ie(r.value);l.charges.forEach(n=>{n.startPrice=k(n.startPrice),n.extraPrice=k(n.extraPrice)}),l.frees.forEach(n=>{n.freePrice=k(n.freePrice)}),w.value==="create"?(await ge(l),h.success(P("common.createSuccess"))):(await _e(l),h.success(P("common.updateSuccess"))),g.value=!1,S("success")}finally{_.value=!1}}},B=()=>{r.value={id:void 0,name:"",chargeMode:1,charges:[{areaIds:[1],startCount:2,startPrice:5,extraCount:5,extraPrice:10}],frees:[],sort:0},V.value=v.get(1),b.value?.resetFields()},N=u=>{V.value=v.get(u)},T=c([]),Y=async()=>{v.set(1,{startCountTitle:"首件",extraCountTitle:"续件",freeCountTitle:"包邮件数"}),v.set(2,{startCountTitle:"首件重量(kg)",extraCountTitle:"续件重量(kg)",freeCountTitle:"包邮重量(kg)"}),v.set(3,{startCountTitle:"首件体积(m³)",extraCountTitle:"续件体积(m³)",freeCountTitle:"包邮体积(m³)"}),T.value=await ve()},L=()=>{r.value.charges.push({areaIds:[],startCount:1,startPrice:1,extraCount:1,extraPrice:1})},O=u=>{r.value.charges.splice(u,1)},j=()=>{r.value.frees.push({areaIds:[],freeCount:1,freePrice:1})},z=u=>{r.value.frees.splice(u,1)};return Z(()=>{Y()}),(u,l)=>{const n=i("el-input"),m=i("el-form-item"),G=i("el-radio"),H=i("el-radio-group"),M=i("el-cascader"),d=i("el-table-column"),p=i("el-input-number"),C=i("el-button"),I=i("el-table"),$=ne,K=i("el-form"),X=ue,J=ee("loading");return x(),y(X,{modelValue:o(g),"onUpdate:modelValue":l[6]||(l[6]=e=>se(g)?g.value=e:null),title:o(E),width:"1300px"},{footer:t(()=>[a(C,{disabled:o(_),type:"primary",onClick:q},{default:t(()=>l[11]||(l[11]=[f("确 定")])),_:1},8,["disabled"]),a(C,{onClick:l[5]||(l[5]=e=>g.value=!1)},{default:t(()=>l[12]||(l[12]=[f("取 消")])),_:1})]),default:t(()=>[ae((x(),y(K,{ref_key:"formRef",ref:b,"label-width":"80px",model:o(r),rules:o(R)},{default:t(()=>[a(m,{label:"模板名称",prop:"name"},{default:t(()=>[a(n,{modelValue:o(r).name,"onUpdate:modelValue":l[0]||(l[0]=e=>o(r).name=e),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"计费方式",prop:"chargeMode"},{default:t(()=>[a(H,{modelValue:o(r).chargeMode,"onUpdate:modelValue":l[1]||(l[1]=e=>o(r).chargeMode=e),onChange:N},{default:t(()=>[(x(!0),le(te,null,oe(o(me)(o(pe).EXPRESS_CHARGE_MODE),e=>(x(),y(G,{key:e.value,label:e.value},{default:t(()=>[f(re(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"运费",prop:"charges"},{default:t(()=>[a(I,{border:"",data:o(r).charges,style:{width:"100%"}},{default:t(()=>[a(d,{align:"center",label:"区域",width:"360"},{default:t(({row:e})=>[a(M,{modelValue:e.areaIds,"onUpdate:modelValue":s=>e.areaIds=s,class:"w-1/1",clearable:"","collapse-tags":"",filterable:"",options:o(T),placeholder:"请选择地区",props:D},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(d,{align:"center",label:o(V).startCountTitle,prop:"startCount",width:"180"},{default:t(({row:e})=>[a(p,{modelValue:e.startCount,"onUpdate:modelValue":s=>e.startCount=s,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(d,{align:"center",label:"运费(元)",prop:"startPrice",width:"180"},{default:t(({row:e})=>[a(p,{modelValue:e.startPrice,"onUpdate:modelValue":s=>e.startPrice=s,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{align:"center",label:o(V).extraCountTitle,prop:"extraCount",width:"180"},{default:t(({row:e})=>[a(p,{modelValue:e.extraCount,"onUpdate:modelValue":s=>e.extraCount=s,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(d,{align:"center",label:"续费(元)",prop:"extraPrice",width:"180"},{default:t(({row:e})=>[a(p,{modelValue:e.extraPrice,"onUpdate:modelValue":s=>e.extraPrice=s,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{align:"center",label:"操作"},{default:t(e=>[a(C,{link:"",type:"danger",onClick:s=>O(e.$index)},{default:t(()=>l[7]||(l[7]=[f("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(m,null,{default:t(()=>[a(C,{plain:"",type:"primary",onClick:l[2]||(l[2]=e=>L())},{default:t(()=>[a($,{class:"mr-5px",icon:"ep:plus"}),l[8]||(l[8]=f(" 添加区域 "))]),_:1})]),_:1}),a(m,{label:"包邮区域",prop:"frees"},{default:t(()=>[a(I,{border:"",data:o(r).frees,style:{width:"100%"}},{default:t(()=>[a(d,{align:"center",label:"区域",width:"360"},{default:t(({row:e})=>[a(M,{modelValue:e.areaIds,"onUpdate:modelValue":s=>e.areaIds=s,class:"w-1/1",clearable:"","collapse-tags":"",filterable:"",options:o(T),placeholder:"请选择商品分类",props:D},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(d,{align:"center",label:o(V).freeCountTitle,prop:"freeCount"},{default:t(({row:e})=>[a(p,{modelValue:e.freeCount,"onUpdate:modelValue":s=>e.freeCount=s,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(d,{align:"center",label:"包邮金额（元）",prop:"freePrice"},{default:t(({row:e})=>[a(p,{modelValue:e.freePrice,"onUpdate:modelValue":s=>e.freePrice=s,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{align:"center",label:"操作"},{default:t(e=>[a(C,{link:"",type:"danger",onClick:s=>z(e.$index)},{default:t(()=>l[9]||(l[9]=[f("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(m,null,{default:t(()=>[a(C,{plain:"",type:"primary",onClick:l[3]||(l[3]=e=>j())},{default:t(()=>[a($,{class:"mr-5px",icon:"ep:plus"}),l[10]||(l[10]=f(" 添加区域 "))]),_:1})]),_:1}),a(m,{label:"排序",prop:"sort"},{default:t(()=>[a(p,{modelValue:o(r).sort,"onUpdate:modelValue":l[4]||(l[4]=e=>o(r).sort=e),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[J,o(_)]])]),_:1},8,["modelValue","title"])}}});export{ke as _};
