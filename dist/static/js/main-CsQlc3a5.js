/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 15:23:48 
 */
import{_ as D}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DmvxiVVs.js";import{R as S}from"./TabNews-BpFHoGA2.js";import P from"./main-CwCV0xyx.js";import q from"./MsgList-uylCAIRR.js";import{V as C,d as L,r as o,f as M,b as O,g as U,h as E,k as A,o as d,m as R,i as v,w as T,c as f,l as b,j as I,a as t,y as J,v as X,z as $,X as z,A as F}from"./index-C8VsLzxx.js";import{g as G}from"./index-BhjxnVHu.js";const K=i=>C.get({url:"/mp/message/page",params:i}),Q=i=>C.post({url:"/mp/message/send",data:i}),Y=""+new URL("../jpg/profile-BiJdjH9E.jpg",import.meta.url).href,Z={key:0},ee={key:1,class:"el-table__empty-block"},ae={class:"msg-send"},te=L({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(i){const V=$(),_=i,p=o(-1),m=o(!1),y=o(!0),u=o([]),n=M({pageNo:1,pageSize:14,accountId:p}),c=M({nickname:"用户",avatar:Y,accountId:p}),h=o(!1),a=o({type:S.Text,accountId:-1,articles:[]}),N=o(null),l=o(null);O(async()=>{const e=await G(_.userId);c.nickname=e.nickname?.length>0?e.nickname:c.nickname,c.avatar=c.avatar?.length>0?e.avatar:c.avatar,p.value=e.accountId,a.value.accountId=e.accountId,H()});const j=async()=>{if(!t(a))return;a.value.type===S.News&&a.value.articles&&a.value.articles.length>1&&(a.value.articles=[a.value.articles[0]],V.success("图文消息条数限制在 1 条以内，已默认发送第一条"));const e=await Q({userId:_.userId,...a.value});h.value=!1,u.value=[...u.value,e],await x(),N.value?.clear()},B=()=>{n.pageNo++,w(n,null)},w=async(e,s=null)=>{m.value=!0;const k=await K(Object.assign({pageNo:e.pageNo,pageSize:e.pageSize,userId:_.userId,accountId:e.accountId},s)),g=l.value?.scrollHeight??0,r=k.list.reverse();u.value=[...r,...u.value],m.value=!1,(r.length<n.pageSize||r.length===0)&&(y.value=!1),n.pageNo=e.pageNo,n.pageSize=e.pageSize,n.pageNo===1?await x():r.length!==0&&(await z(),g!==0&&l.value&&(l.value.scrollTop=l.value.scrollHeight-g-100))},H=()=>{w(n)},x=async()=>{await z(),l.value&&(l.value.scrollTop=l.value.scrollHeight)};return(e,s)=>{const k=U("el-button"),g=D,r=E("loading");return d(),A(g,null,{default:R(()=>[v("div",{ref_key:"msgDivRef",ref:l,class:"msg-div"},[T(v("div",null,null,512),[[r,t(m)]]),t(m)?b("",!0):(d(),f("div",Z,[t(y)?(d(),f("div",{key:0,class:"el-table__empty-block",onClick:B},s[1]||(s[1]=[v("span",{class:"el-table__empty-text"},"点击加载更多",-1)]))):b("",!0),t(y)?b("",!0):(d(),f("div",ee,s[2]||(s[2]=[v("span",{class:"el-table__empty-text"},"没有更多了",-1)])))])),I(q,{"account-id":t(p),list:t(u),user:t(c)},null,8,["account-id","list","user"])],512),T((d(),f("div",ae,[I(t(P),{ref_key:"replySelectRef",ref:N,modelValue:t(a),"onUpdate:modelValue":s[0]||(s[0]=W=>J(a)?a.value=W:null)},null,8,["modelValue"]),I(k,{class:"send-but",type:"success",onClick:j},{default:R(()=>s[3]||(s[3]=[X("发送(S)")])),_:1})])),[[r,t(h)]])]),_:1})}}}),se=F(te,[["__scopeId","data-v-c16b3155"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as W,K as g,ue as m};
