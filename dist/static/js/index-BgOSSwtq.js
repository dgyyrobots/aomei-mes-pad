/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 13:49:10 
 */
import{_ as Y}from"./ContentWrap.vue_vue_type_script_setup_true_lang-58zNwBTb.js";import{_ as Z}from"./index-hVfLpCoZ.js";import ee from"./MenuEditor-B-32st4e.js";import te from"./MenuPreviewer-m6HPTxAg.js";import{V as k,d as le,r as a,g as I,h as L,c as g,o as y,j as r,m as _,a as s,w as T,i as f,t as ne,y as $,k as q,v as B,F as ae,z as se,A as oe}from"./index-BW9ifGp0.js";import{h as re}from"./tree-vSlcEeQq.js";import{_ as ie}from"./main.vue_vue_type_script_setup_true_lang-CTcNI6Uc.js";import"./main-CdoaZNbW.js";import"./TabNews-CIYBWQFi.js";import"./main-BfKBHo14.js";import"./main-BhgkI9vm.js";import"./main-CK_1MZ9A.js";import"./main.vue_vue_type_script_setup_true_lang-PkHWekHU.js";import"./index-CbkmbD5O.js";import"./index-o23WMxSp.js";import"./TabText.vue_vue_type_script_setup_true_lang-DgESlPdF.js";import"./TabImage-CgVPo3jQ.js";import"./useUpload-BGl72F0U.js";import"./TabVoice-BdT_g26X.js";import"./TabVideo-CyKufzo0.js";import"./TabMusic.vue_vue_type_script_setup_true_lang-CYKbG75y.js";import"./vuedraggable.umd-BkbMntcv.js";import"./index-BL7mIi5o.js";const ue=p=>k.get({url:`/mp/menu/list?accountId=${p}`}),ce=(p,o)=>k.post({url:"/mp/menu/save",data:{accountId:p,menus:o}}),de=p=>k.delete({url:`/mp/menu/delete?accountId=${p}`}),pe={class:"clearfix public-account-management"},me={class:"left"},ve={class:"weixin-hd"},ye={class:"weixin-title"},_e={class:"clearfix weixin-menu"},fe={class:"save_div"},he={key:0,class:"right"},Me={key:1,class:"right"},w="__MENU_NOT_SELECTED__",ge=le({name:"MpMenu",__name:"index",setup(p){const o=se(),i=a(!1),m=a(-1),E=a(""),u=a([]),h=a(w),x=a(-1),M=a(!1),b=a(!0),c=a({}),n=a({grand:"0",x:0,y:0}),F=a(!1),P=(t,e)=>{m.value=t,E.value=e,U()},U=async()=>{i.value=!1;try{const t=await ue(m.value),e=O(t);u.value=re(e,"id")}finally{i.value=!1}},A=()=>{R(),U()},O=t=>{if(!t)return[];const e=[];return t.forEach(l=>{const v={...l};v.reply={type:l.replyMessageType,accountId:l.accountId,content:l.replyContent,mediaId:l.replyMediaId,url:l.replyMediaUrl,title:l.replyTitle,description:l.replyDescription,thumbMediaId:l.replyThumbMediaId,thumbMediaUrl:l.replyThumbMediaUrl,articles:l.replyArticles,musicUrl:l.replyMusicUrl,hqMusicUrl:l.replyHqMusicUrl},e.push(v)}),e},R=()=>{h.value=w,x.value=-1,M.value=!1,c.value={},n.value={grand:"0",x:0,y:0},F.value=!1},j=(t,e)=>{M.value=!0,c.value=t,n.value.grand="1",n.value.x=e,b.value=!0,h.value=`${e}`,x.value=e},H=(t,e,l)=>{M.value=!0,c.value=t,n.value.grand="2",n.value.x=e,n.value.y=l,b.value=!1,h.value=`${e}-${l}`},z=async()=>{try{await o.confirm("确定要删除吗?"),n.value.grand==="1"?u.value.splice(n.value.x,1):n.value.grand==="2"&&u.value[n.value.x].children?.splice(n.value.y,1),o.notifySuccess("删除成功"),c.value={},M.value=!1,h.value=w}catch(t){console.log(t)}},Q=async()=>{try{await o.confirm("确定要保存吗?"),i.value=!0,await ce(m.value,G()),U(),o.notifySuccess("发布成功")}finally{i.value=!1}},W=async()=>{try{await o.confirm("确定要删除吗?"),i.value=!0,await de(m.value),A(),o.notifySuccess("清空成功")}finally{i.value=!1}},G=()=>{const t=[];return u.value.forEach(e=>{const l=V(e);t.push(l),!(!e.children||e.children.length<=0)&&(l.children=[],e.children.forEach(v=>{l.children.push(V(v))}))}),t},V=t=>{const e={...t,children:void 0,reply:void 0};return e.replyMessageType=t.reply.type,e.replyContent=t.reply.content,e.replyMediaId=t.reply.mediaId,e.replyMediaUrl=t.reply.url,e.replyTitle=t.reply.title,e.replyDescription=t.reply.description,e.replyThumbMediaId=t.reply.thumbMediaId,e.replyThumbMediaUrl=t.reply.thumbMediaUrl,e.replyArticles=t.reply.articles,e.replyMusicUrl=t.reply.musicUrl,e.replyHqMusicUrl=t.reply.hqMusicUrl,e};return(t,e)=>{const l=Z,v=I("el-form-item"),J=I("el-form"),D=Y,N=I("el-button"),S=L("hasPermi"),K=L("loading");return y(),g(ae,null,[r(l,{title:"公众号菜单",url:"https://doc.iocoder.cn/mp/menu/"}),r(D,null,{default:_(()=>[r(J,{ref:"queryFormRef",class:"-mb-15px",inline:!0,"label-width":"68px"},{default:_(()=>[r(v,{label:"公众号",prop:"accountId"},{default:_(()=>[r(s(ie),{onChange:P})]),_:1})]),_:1},512)]),_:1}),r(D,null,{default:_(()=>[T((y(),g("div",pe,[f("div",me,[f("div",ve,[f("div",ye,ne(s(E)),1)]),f("div",_e,[r(te,{modelValue:s(u),"onUpdate:modelValue":e[0]||(e[0]=d=>$(u)?u.value=d:null),"account-id":s(m),"active-index":s(h),"parent-index":s(x),onMenuClicked:e[1]||(e[1]=(d,C)=>j(d,C)),onSubmenuClicked:e[2]||(e[2]=(d,C,X)=>H(d,C,X))},null,8,["modelValue","account-id","active-index","parent-index"])]),f("div",fe,[T((y(),q(N,{class:"save_btn",type:"success",onClick:Q},{default:_(()=>e[4]||(e[4]=[B("保存并发布菜单")])),_:1})),[[S,["mp:menu:save"]]]),T((y(),q(N,{class:"save_btn",type:"danger",onClick:W},{default:_(()=>e[5]||(e[5]=[B("清空菜单")])),_:1})),[[S,["mp:menu:delete"]]])])]),s(M)?(y(),g("div",he,[r(ee,{modelValue:s(c),"onUpdate:modelValue":e[3]||(e[3]=d=>$(c)?c.value=d:null),"account-id":s(m),"is-parent":s(b),onDelete:z},null,8,["modelValue","account-id","is-parent"])])):(y(),g("div",Me,e[6]||(e[6]=[f("p",null,"请选择菜单配置",-1)])))])),[[K,s(i)]])]),_:1})],64)}}}),He=oe(ge,[["__scopeId","data-v-142d6781"]]);export{He as default};
