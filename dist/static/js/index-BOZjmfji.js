/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 10:14:51 
 */
import{d as h,r as c,by as j,O as U,d8 as E,ae as z,z as F,b as W,g as i,c as x,o as p,j as a,m as n,i as t,a as l,v as y,t as _,y as k,F as O,n as T,k as A,x as P}from"./index-BuFigy1A.js";import{g as q}from"./index-CvbGONMe.js";const G={class:"flex"},H={class:"flex items-center"},K={class:"flex"},Q={class:"max-h-80 overflow-auto"},X={class:"flex items-center"},te=h({name:"InfraWebSocket",__name:"index",setup(Y){const b=F(),f=c(`${"undefined/infra/ws".replace("http","ws")}?token=${j()}`),u=U(()=>V.value==="OPEN"),I=U(()=>u.value?"success":"red"),{status:V,data:d,send:D,close:B,open:J}=E(f.value,{autoReconnect:!1,heartbeat:!0}),v=c([]);z(()=>{if(d.value)try{if(d.value==="pong")return;const r=JSON.parse(d.value),e=r.type,o=JSON.parse(r.content);if(!e){b.error(`未知的消息类型：${d.value}`);return}if(e==="demo-message-receive"){o.single?v.value.push({text:`【单发】用户编号(${o.fromUserId})：${o.text}`,time:new Date().getTime()}):v.value.push({text:`【群发】用户编号(${o.fromUserId})：${o.text}`,time:new Date().getTime()});return}if(e==="notice-push"){v.value.push({text:`【系统通知】：${o.title}`,time:new Date().getTime()});return}b.error(`未处理消息：${d.value}`)}catch(r){b.error(`处理消息发生异常：${d.value}`),console.error(r)}});const m=c(""),g=c(""),L=()=>{const r=JSON.stringify({text:m.value,toUserId:g.value}),e=JSON.stringify({type:"demo-message-send",content:r});D(e),m.value=""},M=()=>{u.value?B():J()},$=c([]);return W(async()=>{$.value=await q()}),(r,e)=>{const o=i("el-tag"),w=i("el-input"),S=i("el-button"),C=i("el-option"),R=i("el-select"),N=i("el-card");return p(),x("div",G,[a(N,{class:"w-1/2",gutter:12,shadow:"always"},{header:n(()=>e[3]||(e[3]=[t("div",{class:"card-header"},[t("span",null,"连接")],-1)])),default:n(()=>[t("div",H,[e[4]||(e[4]=t("span",{class:"mr-4 text-lg font-medium"},"连接状态:",-1)),a(o,{color:l(I)},{default:n(()=>[y(_(l(V)),1)]),_:1},8,["color"])]),e[7]||(e[7]=t("hr",{class:"my-4"},null,-1)),t("div",K,[a(w,{modelValue:l(f),"onUpdate:modelValue":e[0]||(e[0]=s=>k(f)?f.value=s:null),disabled:""},{prepend:n(()=>e[5]||(e[5]=[y("服务地址")])),_:1},8,["modelValue"]),a(S,{type:l(u)?"danger":"primary",onClick:M},{default:n(()=>[y(_(l(u)?"关闭连接":"开启连接"),1)]),_:1},8,["type"])]),e[8]||(e[8]=t("p",{class:"mt-4 text-lg font-medium"},"消息输入框",-1)),e[9]||(e[9]=t("hr",{class:"my-4"},null,-1)),a(w,{modelValue:l(m),"onUpdate:modelValue":e[1]||(e[1]=s=>k(m)?m.value=s:null),autosize:{minRows:2,maxRows:4},clearable:"",disabled:!l(u),placeholder:"请输入你要发送的消息",type:"textarea"},null,8,["modelValue","disabled"]),a(R,{modelValue:l(g),"onUpdate:modelValue":e[2]||(e[2]=s=>k(g)?g.value=s:null),class:"mt-4",placeholder:"请选择发送人"},{default:n(()=>[a(C,{key:"",label:"所有人",value:""}),(p(!0),x(O,null,T(l($),s=>(p(),A(C,{key:s.id,label:s.nickname,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(S,{block:"",class:"ml-2 mt-4",disabled:!l(u),type:"primary",onClick:L},{default:n(()=>e[6]||(e[6]=[y("发送")])),_:1},8,["disabled"])]),_:1}),a(N,{class:"w-1/2",gutter:12,shadow:"always"},{header:n(()=>e[10]||(e[10]=[t("div",{class:"card-header"},[t("span",null,"消息记录")],-1)])),default:n(()=>[t("div",Q,[t("ul",null,[(p(!0),x(O,null,T(l(v).reverse(),s=>(p(),x("li",{key:s.time,class:"mt-2"},[t("div",X,[e[11]||(e[11]=t("span",{class:"text-primary mr-2 font-medium"},"收到消息:",-1)),t("span",null,_(l(P)(s.time)),1)]),t("div",null,_(s.text),1)]))),128))])])]),_:1})])}}});export{te as default};
