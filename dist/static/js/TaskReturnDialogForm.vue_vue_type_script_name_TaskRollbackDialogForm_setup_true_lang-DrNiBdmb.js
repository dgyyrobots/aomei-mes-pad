/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:21:26 
 */
import{d as T,r as s,g as r,h as U,k as p,o as f,_ as q,a as o,y as N,m as a,w as $,j as i,c as j,n as z,F as E,v as y,z as I}from"./index-5TqN_QR1.js";import{b as M,c as A}from"./index-BO_WKHcb.js";const P=T({__name:"TaskReturnDialogForm",emits:["success"],setup(G,{expose:b,emit:V}){const _=I(),n=s(!1),u=s(!1),l=s({id:"",targetDefinitionKey:void 0,reason:""}),k=s({targetDefinitionKey:[{required:!0,message:"必须选择回退节点",trigger:"change"}],reason:[{required:!0,message:"回退理由不能为空",trigger:"blur"}]}),d=s(),c=s([]);b({open:async m=>{if(c.value=await M({taskId:m}),c.value.length===0)return _.warning("当前没有可回退的节点"),!1;n.value=!0,K(),l.value.id=m}});const D=V,w=async()=>{if(!(!d||!await d.value.validate())){u.value=!0;try{await A(l.value),_.success("回退成功"),n.value=!1,D("success")}finally{u.value=!1}}},K=()=>{l.value={id:"",targetDefinitionKey:void 0,reason:""},d.value?.resetFields()};return(m,e)=>{const x=r("el-option"),F=r("el-select"),v=r("el-form-item"),R=r("el-input"),C=r("el-form"),g=r("el-button"),L=q,B=U("loading");return f(),p(L,{modelValue:o(n),"onUpdate:modelValue":e[3]||(e[3]=t=>N(n)?n.value=t:null),title:"回退",width:"500"},{footer:a(()=>[i(g,{disabled:o(u),type:"primary",onClick:w},{default:a(()=>e[4]||(e[4]=[y("确 定")])),_:1},8,["disabled"]),i(g,{onClick:e[2]||(e[2]=t=>n.value=!1)},{default:a(()=>e[5]||(e[5]=[y("取 消")])),_:1})]),default:a(()=>[$((f(),p(C,{ref_key:"formRef",ref:d,"label-width":"110px",model:o(l),rules:o(k)},{default:a(()=>[i(v,{label:"退回节点",prop:"targetDefinitionKey"},{default:a(()=>[i(F,{modelValue:o(l).targetDefinitionKey,"onUpdate:modelValue":e[0]||(e[0]=t=>o(l).targetDefinitionKey=t),clearable:"",style:{width:"100%"}},{default:a(()=>[(f(!0),j(E,null,z(o(c),t=>(f(),p(x,{key:t.definitionKey,label:t.name,value:t.definitionKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(v,{label:"回退理由",prop:"reason"},{default:a(()=>[i(R,{modelValue:o(l).reason,"onUpdate:modelValue":e[1]||(e[1]=t=>o(l).reason=t),clearable:"",placeholder:"请输入回退理由"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[B,o(u)]])]),_:1},8,["modelValue"])}}});export{P as _};
