/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{_ as A}from"./XButton-BTFQ9ZCN.js";import{d as H,ax as W,u as Y,r as f,O as G,a as e,f as N,Y as J,g as p,w as K,$ as Q,o as _,k as S,m as n,j as o,l as y,N as Z,c as F,t as I,bW as ee,z as oe,ar as ne,as as te,an as V,bX as ae,aq as le,A as se}from"./index-BdmDrM2Y.js";import{u as h}from"./useIcon-BX3bcp5f.js";import{u as ie,L as re,_ as me,a as de}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-tjW5Ezly.js";import{r as x}from"./formRules-wW3jWK7m.js";const ce={key:1,class:"getMobileCode",style:{cursor:"pointer"}},pe=H({name:"MobileForm",__name:"MobileForm",setup(ue){const{t:l}=Z(),L=oe(),M=W(),{currentRoute:B,push:E}=Y(),v=f(),u=f(!1),T=h({icon:"ep:house"}),P=h({icon:"ep:cellphone"}),$=h({icon:"ep:circle-check"}),{validForm:q}=de(v),{handleBackLogin:D,getLoginState:O}=ie(),R=G(()=>e(O)===re.MOBILE),U={tenantName:[x],mobileNumber:[x],code:[x]},t=N({codeImg:"",tenantEnable:"true",token:"",loading:{signIn:!1},loginForm:{uuid:"",tenantName:"芋道源码",mobileNumber:"",code:""}}),c=N({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),s=f(0),g=f(""),j=async()=>{await k(),c.smsCode.mobile=t.loginForm.mobileNumber,await ee(c.smsCode).then(async()=>{L.success(l("login.SmsSendMsg")),s.value=60;const i=setInterval(()=>{s.value=s.value-1,s.value<=0&&clearInterval(i)},1e3)})};J(()=>B.value,i=>{g.value=i?.query?.redirect},{immediate:!0});const k=async()=>{if(t.tenantEnable==="true"){const i=await ne(t.loginForm.tenantName);te(i)}},z=async()=>{await k(),await q()&&(V.service({lock:!0,text:"正在加载系统中...",background:"rgba(0, 0, 0, 0.7)"}),u.value=!0,c.loginSms.mobile=t.loginForm.mobileNumber,c.loginSms.code=t.loginForm.code,await ae(c.loginSms).then(async a=>{le(a),g.value||(g.value="/"),E({path:g.value||M.addRouters[0].path})}).catch(()=>{}).finally(()=>{u.value=!1,setTimeout(()=>{V.service().close()},400)}))};return(i,a)=>{const d=p("el-form-item"),r=p("el-col"),b=p("el-input"),w=p("el-row"),C=A,X=p("el-form");return K((_(),S(X,{ref_key:"formSmsLogin",ref:v,class:"login-form","label-position":"top","label-width":"120px",model:e(t).loginForm,rules:U,size:"large"},{default:n(()=>[o(w,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:n(()=>[o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(me,{style:{width:"100%"}})]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[e(t).tenantEnable==="true"?(_(),S(d,{key:0,prop:"tenantName"},{default:n(()=>[o(b,{modelValue:e(t).loginForm.tenantName,"onUpdate:modelValue":a[0]||(a[0]=m=>e(t).loginForm.tenantName=m),link:"",placeholder:e(l)("login.tenantNamePlaceholder"),"prefix-icon":e(T),type:"primary"},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):y("",!0)]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,{prop:"mobileNumber"},{default:n(()=>[o(b,{modelValue:e(t).loginForm.mobileNumber,"onUpdate:modelValue":a[1]||(a[1]=m=>e(t).loginForm.mobileNumber=m),placeholder:e(l)("login.mobileNumberPlaceholder"),"prefix-icon":e(P)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,{prop:"code"},{default:n(()=>[o(w,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:n(()=>[o(r,{span:24},{default:n(()=>[o(b,{modelValue:e(t).loginForm.code,"onUpdate:modelValue":a[2]||(a[2]=m=>e(t).loginForm.code=m),placeholder:e(l)("login.codePlaceholder"),"prefix-icon":e($)},{append:n(()=>[e(s)<=0?(_(),F("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:j},I(e(l)("login.getSmsCode")),1)):y("",!0),e(s)>0?(_(),F("span",ce,I(e(s))+"秒后可重新获取",1)):y("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(C,{class:"w-[100%]",loading:e(u),title:e(l)("login.login"),type:"primary",onClick:a[3]||(a[3]=m=>z())},null,8,["loading","title"])]),_:1})]),_:1}),o(r,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(C,{class:"w-[100%]",loading:e(u),title:e(l)("login.backLogin"),onClick:a[4]||(a[4]=m=>e(D)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[Q,e(R)]])}}}),he=se(pe,[["__scopeId","data-v-808218b5"]]);export{he as default};
