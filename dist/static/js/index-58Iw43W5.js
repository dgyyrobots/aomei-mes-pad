/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 15:23:48 
 */
import{_ as H}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DmvxiVVs.js";import{_ as M}from"./BasicInfoForm.vue_vue_type_script_setup_true_lang-CFJpKbAm.js";import{_ as z}from"./DescriptionForm.vue_vue_type_script_setup_true_lang-CW3R7Pbo.js";import{_ as G}from"./OtherSettingsForm.vue_vue_type_script_setup_true_lang-D9uJTxT6.js";import{g as L,c as O,u as W}from"./spu-DDGlO0pM.js";import{d as X,u as q,H as A,ac as J,r as l,b as K,g as f,h as Q,w as Y,a,o as C,k as I,m as c,j as s,y as g,l as Z,v as R,b_ as u,b$ as _,bX as ee,c0 as v,z as oe,N as re}from"./index-C8VsLzxx.js";import"./Descriptions-Di95dqE4.js";import"./Descriptions.vue_vue_type_script_setup_true_lang-D8jJDAJb.js";import"./DictTag.vue_vue_type_script_lang-lHf-rDoT.js";import"./color-B5phLuB-.js";import"./dict-_inVRzR5.js";import"./UploadImgs-Cw5zoJN3.js";import"./UploadImgs.vue_vue_type_script_setup_true_lang-ptdx9Yy4.js";import"./UploadImg-BGTH0mL0.js";import"./index-BmvROlHs.js";import"./ProductAttributes.vue_vue_type_script_setup_true_lang-DOxj9eU6.js";import"./property-DkQkyhkB.js";import"./ProductPropertyAddForm.vue_vue_type_script_setup_true_lang-klrVU1ie.js";import"./spu.data-K8je4ekn.js";import"./brand-By6PpiJX.js";import"./category-BnYvgNqf.js";import"./index-Ska_e5Tw.js";import"./tree-vSlcEeQq.js";import"./index-CoaCw99V.js";import"./SkuList.vue_vue_type_script_setup_true_lang-beduimZc.js";import"./UploadFile.vue_vue_type_script_setup_true_lang-DXsitNSp.js";import"./useCrudSchemas-DawCX4vQ.js";import"./formRules-BJqKeLXr.js";import"./style.css_vue_type_style_index_0_src_true_lang-C6OrDJtm.js";import"./locale-Bz9mcxDh.js";import"./ActivityOrdersSort.vue_vue_type_script_setup_true_lang-4ZP2yJfx.js";const $e=X({name:"ProductSpuForm",__name:"index",setup(ae){const{t:k}=re(),P=oe(),{push:U,currentRoute:D}=q(),{params:y,name:T}=A(),{delView:V}=J(),p=l(!1),t=l("basicInfo"),d=l(!1),b=l(),B=l(),w=l(),m=l({name:"",categoryId:void 0,keyword:"",unit:void 0,picUrl:"",sliderPicUrls:[],introduction:"",deliveryTemplateId:void 0,brandId:void 0,specType:!1,subCommissionType:!1,skus:[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}],description:"",sort:0,giveIntegral:0,virtualSalesCount:0,recommendHot:!1,recommendBenefit:!1,recommendBest:!1,recommendNew:!1,recommendGood:!1,activityOrders:[]}),x=async()=>{T==="ProductSpuDetail"&&(d.value=!0);const i=y.id;if(i){p.value=!0;try{const o=await L(i);o.skus?.forEach(e=>{d.value?(e.price=u(e.price),e.marketPrice=u(e.marketPrice),e.costPrice=u(e.costPrice),e.firstBrokeragePrice=u(e.firstBrokeragePrice),e.secondBrokeragePrice=u(e.secondBrokeragePrice)):(e.price=_(e.price),e.marketPrice=_(e.marketPrice),e.costPrice=_(e.costPrice),e.firstBrokeragePrice=_(e.firstBrokeragePrice),e.secondBrokeragePrice=_(e.secondBrokeragePrice))}),m.value=o}finally{p.value=!1}}},F=async()=>{p.value=!0;try{await a(b)?.validate(),await a(B)?.validate(),await a(w)?.validate();const i=ee(a(m.value));i.skus.forEach(r=>{r.name=i.name,r.price=v(r.price),r.marketPrice=v(r.marketPrice),r.costPrice=v(r.costPrice),r.firstBrokeragePrice=v(r.firstBrokeragePrice),r.secondBrokeragePrice=v(r.secondBrokeragePrice)});const o=[];i.sliderPicUrls.forEach(r=>{typeof r=="object"?o.push(r.url):o.push(r)}),i.sliderPicUrls=o;const e=i;y.id?(await W(e),P.success(k("common.updateSuccess"))):(await O(e),P.success(k("common.createSuccess"))),N()}finally{p.value=!1}},N=()=>{V(a(D)),U({name:"ProductSpu"})};return K(async()=>{await x()}),(i,o)=>{const e=f("el-tab-pane"),S=f("el-tabs"),r=f("el-button"),$=f("el-form-item"),h=f("el-form"),E=H,j=Q("loading");return Y((C(),I(E,null,{default:c(()=>[s(S,{modelValue:a(t),"onUpdate:modelValue":o[3]||(o[3]=n=>g(t)?t.value=n:null)},{default:c(()=>[s(e,{label:"商品信息",name:"basicInfo"},{default:c(()=>[s(M,{ref_key:"basicInfoRef",ref:b,activeName:a(t),"onUpdate:activeName":o[0]||(o[0]=n=>g(t)?t.value=n:null),"is-detail":a(d),"prop-form-data":a(m)},null,8,["activeName","is-detail","prop-form-data"])]),_:1}),s(e,{label:"商品详情",name:"description"},{default:c(()=>[s(z,{ref_key:"descriptionRef",ref:B,activeName:a(t),"onUpdate:activeName":o[1]||(o[1]=n=>g(t)?t.value=n:null),"is-detail":a(d),"prop-form-data":a(m)},null,8,["activeName","is-detail","prop-form-data"])]),_:1}),s(e,{label:"其他设置",name:"otherSettings"},{default:c(()=>[s(G,{ref_key:"otherSettingsRef",ref:w,activeName:a(t),"onUpdate:activeName":o[2]||(o[2]=n=>g(t)?t.value=n:null),"is-detail":a(d),"prop-form-data":a(m)},null,8,["activeName","is-detail","prop-form-data"])]),_:1})]),_:1},8,["modelValue"]),s(h,null,{default:c(()=>[s($,{style:{float:"right"}},{default:c(()=>[a(d)?Z("",!0):(C(),I(r,{key:0,loading:a(p),type:"primary",onClick:F},{default:c(()=>o[4]||(o[4]=[R("保存")])),_:1},8,["loading"])),s(r,{onClick:N},{default:c(()=>o[5]||(o[5]=[R("返回")])),_:1})]),_:1})]),_:1})]),_:1})),[[j,a(p)]])}}});export{$e as default};
