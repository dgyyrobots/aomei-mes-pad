/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:52:22 
 */
import{V as Y,d as O,r as d,f as W,b as G,g as p,h as q,c as A,o as m,j as e,m as o,a,J as b,F as E,n as X,k as y,w as T,v as c,K as Z,i as ee,t as C,x as le,M as ae,z as te}from"./index-DMg0mq0e.js";import{_ as oe}from"./DictTag.vue_vue_type_script_lang-sQcOd7JH.js";import{_ as ne}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DPMk4m5L.js";import{_ as re}from"./index-B4jjJPyl.js";import{_ as se}from"./ApiAccessLogDetail.vue_vue_type_script_setup_true_lang-BFrEn_9V.js";import{c as pe,D as M}from"./dict-BEquckDR.js";import{d as ie}from"./download-U6qaYcnP.js";import"./color-B5phLuB-.js";const ue=_=>Y.get({url:"/infra/api-access-log/page",params:_}),de=_=>Y.download({url:"/infra/api-access-log/export-excel",params:_}),ve=O({name:"InfraApiAccessLog",__name:"index",setup(_){const K=te(),w=d(!0),k=d(0),D=d([]),n=W({pageNo:1,pageSize:10,userId:null,userType:null,applicationName:null,requestUrl:null,duration:null,resultCode:null,beginTime:[]}),N=d(),x=d(!1),v=async()=>{w.value=!0;try{const s=await ue(n);D.value=s.list,k.value=s.total}finally{w.value=!1}},u=()=>{n.pageNo=1,v()},L=()=>{N.value.resetFields(),u()},U=d(),R=s=>{U.value.open(s)},S=async()=>{try{await K.exportConfirm(),x.value=!0;const s=await de(n);ie.excel(s,"API 访问日志.xls")}catch(s){console.log(s)}finally{x.value=!1}};return G(()=>{v()}),(s,t)=>{const $=re,f=p("el-input"),i=p("el-form-item"),F=p("el-option"),z=p("el-select"),B=p("el-date-picker"),V=Z,g=p("el-button"),h=p("el-form"),I=ne,r=p("el-table-column"),H=oe,Q=p("el-table"),j=ae,P=q("hasPermi"),J=q("loading");return m(),A(E,null,[e($,{title:"系统日志",url:"https://doc.iocoder.cn/system-log/"}),e(I,null,{default:o(()=>[e(h,{ref_key:"queryFormRef",ref:N,class:"-mb-15px",inline:!0,"label-width":"68px",model:a(n)},{default:o(()=>[e(i,{label:"用户编号",prop:"userId"},{default:o(()=>[e(f,{modelValue:a(n).userId,"onUpdate:modelValue":t[0]||(t[0]=l=>a(n).userId=l),class:"!w-240px",clearable:"",placeholder:"请输入用户编号",onKeyup:b(u,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"用户类型",prop:"userType"},{default:o(()=>[e(z,{modelValue:a(n).userType,"onUpdate:modelValue":t[1]||(t[1]=l=>a(n).userType=l),class:"!w-240px",clearable:"",placeholder:"请选择用户类型"},{default:o(()=>[(m(!0),A(E,null,X(a(pe)(a(M).USER_TYPE),l=>(m(),y(F,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"应用名",prop:"applicationName"},{default:o(()=>[e(f,{modelValue:a(n).applicationName,"onUpdate:modelValue":t[2]||(t[2]=l=>a(n).applicationName=l),class:"!w-240px",clearable:"",placeholder:"请输入应用名",onKeyup:b(u,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"请求时间",prop:"beginTime"},{default:o(()=>[e(B,{modelValue:a(n).beginTime,"onUpdate:modelValue":t[3]||(t[3]=l=>a(n).beginTime=l),class:"!w-240px","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),e(i,{label:"执行时长",prop:"duration"},{default:o(()=>[e(f,{modelValue:a(n).duration,"onUpdate:modelValue":t[4]||(t[4]=l=>a(n).duration=l),class:"!w-240px",clearable:"",placeholder:"请输入执行时长",onKeyup:b(u,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"结果码",prop:"resultCode"},{default:o(()=>[e(f,{modelValue:a(n).resultCode,"onUpdate:modelValue":t[5]||(t[5]=l=>a(n).resultCode=l),class:"!w-240px",clearable:"",placeholder:"请输入结果码",onKeyup:b(u,["enter"])},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(g,{onClick:u},{default:o(()=>[e(V,{class:"mr-5px",icon:"ep:search"}),t[8]||(t[8]=c(" 搜索 "))]),_:1}),e(g,{onClick:L},{default:o(()=>[e(V,{class:"mr-5px",icon:"ep:refresh"}),t[9]||(t[9]=c(" 重置 "))]),_:1}),T((m(),y(g,{loading:a(x),plain:"",type:"success",onClick:S},{default:o(()=>[e(V,{class:"mr-5px",icon:"ep:download"}),t[10]||(t[10]=c(" 导出 "))]),_:1},8,["loading"])),[[P,["infra:api-error-log:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(I,null,{default:o(()=>[T((m(),y(Q,{data:a(D)},{default:o(()=>[e(r,{align:"center",label:"日志编号",prop:"id"}),e(r,{align:"center",label:"用户编号",prop:"userId"}),e(r,{align:"center",label:"用户类型",prop:"userType"},{default:o(l=>[e(H,{type:a(M).USER_TYPE,value:l.row.userType},null,8,["type","value"])]),_:1}),e(r,{align:"center",label:"应用名",prop:"applicationName"}),e(r,{align:"center",label:"请求方法",prop:"requestMethod",width:"80"}),e(r,{align:"center",label:"请求地址",prop:"requestUrl",width:"250"}),e(r,{align:"center",label:"请求时间",prop:"beginTime",width:"180"},{default:o(l=>[ee("span",null,C(a(le)(l.row.beginTime)),1)]),_:1}),e(r,{align:"center",label:"执行时长",prop:"duration",width:"180"},{default:o(l=>[c(C(l.row.duration)+" ms",1)]),_:1}),e(r,{align:"center",label:"操作结果",prop:"status"},{default:o(l=>[c(C(l.row.resultCode===0?"成功":"失败("+l.row.resultMsg+")"),1)]),_:1}),e(r,{align:"center",label:"操作"},{default:o(l=>[T((m(),y(g,{link:"",type:"primary",onClick:me=>R(l.row)},{default:o(()=>t[11]||(t[11]=[c("详细")])),_:2},1032,["onClick"])),[[P,["infra:api-access-log:query"]]])]),_:1})]),_:1},8,["data"])),[[J,a(w)]]),e(j,{limit:a(n).pageSize,"onUpdate:limit":t[6]||(t[6]=l=>a(n).pageSize=l),page:a(n).pageNo,"onUpdate:page":t[7]||(t[7]=l=>a(n).pageNo=l),total:a(k),onPagination:v},null,8,["limit","page","total"])]),_:1}),e(se,{ref_key:"detailRef",ref:U},null,512)],64)}}});export{ve as default};
