/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:10:14 
 */
import{_ as $}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CdI9J0YF.js";import{i as R,a as V,g as U,b as p,c as N,d as H,e as q,f as z,P as O,_ as K,h as X}from"./bpmn-embedded-CBs4kaBT.js";import{g as Y,u as Q,c as W}from"./index-ofkhM_3m.js";import{d as J,u as Z,H as ee,r as F,b as te,z as ne,k as j,o as L,m as ae,l as oe,j as ie,a as h,Q as ce,y as se}from"./index-BdC40rFX.js";import"./XTextButton-C_KQTULv.js";import"./XButton-BSRdyThe.js";import"./dict-D4wjFrBa.js";function G(t){return t.originalEvent||t.srcEvent}function re(){return/mac/i.test(navigator.platform)}function pe(t,i){return(G(t)||t).button===i}function le(t){return pe(t,0)}function de(t){var i=G(t)||t;return le(t)?re()?i.metaKey:i.ctrlKey:!1}function I(t,i,c,s,r,f,u,o,b,y,a,e){t=t||{},s.registerProvider(this),this._contextPad=s,this._modeling=r,this._elementFactory=f,this._connect=u,this._create=o,this._popupMenu=b,this._canvas=y,this._rules=a,this._translate=e,t.autoPlace!==!1&&(this._autoPlace=i.get("autoPlace",!1)),c.on("create.end",250,function(n){const v=n.context,E=v.shape;if(!de(n)||!s.isOpen(E))return;const _=s.getEntries(E);_.replace&&_.replace.action.click(n,E)})}I.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"];I.prototype.getContextPadEntries=function(t){const i=this._contextPad,c=this._modeling,s=this._elementFactory,r=this._connect,f=this._create,u=this._popupMenu,o=this._canvas,b=this._rules,y=this._autoPlace,a=this._translate,e={};if(t.type==="label")return e;const n=t.businessObject;function v(l,g){r.start(l,g)}function E(){c.removeElements([t])}function _(l){const m=o.getContainer(),P=i.getPad(l).html,k=m.getBoundingClientRect(),T=P.getBoundingClientRect(),S=T.top-k.top;return{x:T.left-k.left,y:S+T.height+5}}function d(l,g,m,P){typeof m!="string"&&(P=m,m=a("Append {type}",{type:l.replace(/^bpmn:/,"")}));function k(S,A){const D=s.createShape(p({type:l},P));f.start(S,D,{source:A})}return{group:"model",className:g,title:m,action:{dragstart:k,click:y?function(S,A){const D=s.createShape(p({type:l},P));y.append(A,D)}:k}}}function w(l){return function(g,m){c.splitLane(m,l),i.open(m,!0)}}if(R(n,["bpmn:Lane","bpmn:Participant"])&&V(n)){const l=U(t);p(e,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:a("Add Lane above"),action:{click:function(g,m){c.addLane(m,"top")}}}}),l.length<2&&(t.height>=120&&p(e,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:a("Divide into two Lanes"),action:{click:w(2)}}}),t.height>=180&&p(e,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:a("Divide into three Lanes"),action:{click:w(3)}}})),p(e,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:a("Add Lane below"),action:{click:function(g,m){c.addLane(m,"bottom")}}}})}N(n,"bpmn:FlowNode")&&(N(n,"bpmn:EventBasedGateway")?p(e,{"append.receive-task":d("bpmn:ReceiveTask","bpmn-icon-receive-task",a("Append ReceiveTask")),"append.message-intermediate-event":d("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",a("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":d("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",a("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":d("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",a("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":d("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",a("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):B(n,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?p(e,{"append.compensation-activity":d("bpmn:Task","bpmn-icon-task",a("Append compensation activity"),{isForCompensation:!0})}):!N(n,"bpmn:EndEvent")&&!n.isForCompensation&&!B(n,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!H(n)&&p(e,{"append.end-event":d("bpmn:EndEvent","bpmn-icon-end-event-none",a("Append EndEvent")),"append.gateway":d("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",a("Append Gateway")),"append.append-task":d("bpmn:UserTask","bpmn-icon-user-task",a("Append Task")),"append.intermediate-event":d("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",a("Append Intermediate/Boundary Event"))})),u.isEmpty(t,"bpmn-replace")||p(e,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"修改类型",action:{click:function(l,g){const m=p(_(g),{cursor:{x:l.x,y:l.y}});u.open(g,"bpmn-replace",m)}}}}),R(n,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&p(e,{"append.text-annotation":d("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:a(`Connect using ${n.isForCompensation?"":"Sequence/MessageFlow or "}Association`),action:{click:v,dragstart:v}}}),R(n,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&p(e,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:a("Connect using DataInputAssociation"),action:{click:v,dragstart:v}}}),N(n,"bpmn:Group")&&p(e,{"append.text-annotation":d("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let C=b.allowed("elements.delete",{elements:[t]});return q(C)&&(C=C[0]===t),C&&p(e,{delete:{group:"edit",className:"bpmn-icon-trash",title:a("Remove"),action:{click:E}}}),e};function B(t,i,c){const s=t.$instanceOf(i);let r=!1;const f=t.eventDefinitions||[];return z(f,function(u){u.$type===c&&(r=!0)}),s&&r}const me={__init__:["contextPadProvider"],contextPadProvider:["type",I]};function x(t,i,c,s,r,f,u,o){O.call(this,t,i,c,s,r,f,u,o,2e3)}const M=function(){};M.prototype=O.prototype;M.prototype.getPaletteEntries=function(){const t={},i=this._create,c=this._elementFactory,s=this._spaceTool,r=this._lassoTool,f=this._handTool,u=this._globalConnect,o=this._translate;function b(e,n,v,E,_){function d(C){const l=c.createShape(p({type:e},_));i.start(C,l)}const w=e.replace(/^bpmn:/,"");return{group:n,className:v,title:E||o("Create {type}",{type:w}),action:{dragstart:d,click:d}}}function y(e){const n=c.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),v=c.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:n});i.start(e,[n,v],{hints:{autoSelect:[v]}})}function a(e){i.start(e,c.createParticipantShape())}return p(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"激活抓手工具",action:{click:function(e){f.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:o("Activate the lasso tool"),action:{click:function(e){r.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:o("Activate the create/remove space tool"),action:{click:function(e){s.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:o("Activate the global connect tool"),action:{click:function(e){u.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":b("bpmn:StartEvent","event","bpmn-icon-start-event-none",o("Create StartEvent")),"create.intermediate-event":b("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",o("Create Intermediate/Boundary Event")),"create.end-event":b("bpmn:EndEvent","event","bpmn-icon-end-event-none",o("Create EndEvent")),"create.exclusive-gateway":b("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",o("Create Gateway")),"create.user-task":b("bpmn:UserTask","activity","bpmn-icon-user-task",o("Create User Task")),"create.data-object":b("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",o("Create DataObjectReference")),"create.data-store":b("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",o("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:o("Create expanded SubProcess"),action:{dragstart:y,click:y}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:o("Create Pool/Participant"),action:{dragstart:a,click:a}},"create.group":b("bpmn:Group","artifact","bpmn-icon-group",o("Create Group"))}),t};x.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];x.prototype=new M;x.prototype.constructor=x;const ue={__init__:["paletteProvider"],paletteProvider:["type",x]},_e=J({name:"BpmModelEditor",__name:"index",setup(t){const i=Z(),{query:c}=ee(),s=ne(),r=F(void 0),f=F(null),u=F({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[me,ue]}),o=F(),b=e=>{setTimeout(()=>{f.value=e},10)},y=async e=>{const n={...o.value,bpmnXml:e};n.id?(await Q(n),s.success("修改成功")):(await W(n),s.success("新增成功")),a()},a=()=>{i.push({path:"/bpm/manager/model"})};return te(async()=>{const e=c.modelId;if(!e){s.error("缺少模型 modelId 编号");return}const n=await Y(e);r.value=n.bpmnXml,o.value={...n,bpmnXml:void 0}}),(e,n)=>{const v=$;return L(),j(v,null,{default:ae(()=>[h(r)!==void 0?(L(),j(h(K),ce({key:"designer"},h(u),{ref:"processDesigner",modelValue:h(r),"onUpdate:modelValue":n[0]||(n[0]=E=>se(r)?r.value=E:null),"additional-model":h(u).additionalModel,keyboard:"",value:h(r),onInitFinished:b,onSave:y}),null,16,["modelValue","additional-model","value"])):oe("",!0),ie(h(X),{key:"penal","bpmn-modeler":h(f),class:"process-panel",model:h(o),prefix:h(u).prefix},null,8,["bpmn-modeler","model","prefix"])]),_:1})}}});export{_e as default};
