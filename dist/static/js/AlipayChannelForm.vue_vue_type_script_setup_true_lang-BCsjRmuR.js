/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-03 10:14:51 
 */
import{d as $,r as b,g as s,h as M,c as V,o as g,j as l,_ as L,a as o,y as J,m as a,w as j,k,l as K,v as d,F as Y,n as G,t as H,K as Q,z as W,N as X}from"./index-BuFigy1A.js";import{C as Z}from"./constants-BPQb3nxh.js";import{d as h,D as ee}from"./dict-Ve5yp9Dm.js";import{g as le,c as te,u as ae}from"./index-BghWhNuk.js";const oe={key:0},re={key:1},c=".crt",me=$({name:"AlipayChannelForm",__name:"AlipayChannelForm",emits:["success"],setup(ne,{expose:F,emit:T}){const{t:U}=X(),C=W(),p=b(!1),P=b(""),m=b(!1),t=b({appId:"",code:"",status:void 0,feeRate:void 0,remark:"",config:{appId:"",serverUrl:null,signType:"",mode:null,privateKey:"",alipayPublicKey:"",appCertContent:"",alipayPublicCertContent:"",rootCertContent:""}}),q={feeRate:[{required:!0,message:"请输入渠道费率",trigger:"blur"}],status:[{required:!0,message:"渠道状态不能为空",trigger:"blur"}],"config.appId":[{required:!0,message:"请输入开放平台上创建的应用的 ID",trigger:"blur"}],"config.serverUrl":[{required:!0,message:"请传入网关地址",trigger:"blur"}],"config.signType":[{required:!0,message:"请传入签名算法类型",trigger:"blur"}],"config.mode":[{required:!0,message:"公钥类型不能为空",trigger:"blur"}],"config.privateKey":[{required:!0,message:"请输入商户私钥",trigger:"blur"}],"config.alipayPublicKey":[{required:!0,message:"请输入支付宝公钥字符串",trigger:"blur"}],"config.appCertContent":[{required:!0,message:"请上传商户公钥应用证书",trigger:"blur"}],"config.alipayPublicCertContent":[{required:!0,message:"请上传支付宝公钥证书",trigger:"blur"}],"config.rootCertContent":[{required:!0,message:"请上传指定根证书",trigger:"blur"}]},v=b();F({open:async(i,e)=>{p.value=!0,m.value=!0,S(i,e);try{const n=await le(i,e);n&&n.id&&(t.value=n,t.value.config=JSON.parse(n.config)),P.value=t.value.id?"编辑支付渠道":"创建支付渠道"}finally{m.value=!1}}});const A=T,I=async()=>{if(!(!v||!await v.value.validate())){m.value=!0;try{const e={...t.value};e.config=JSON.stringify(t.value.config),e.id?(await ae(e),C.success(U("common.updateSuccess"))):(await te(e),C.success(U("common.createSuccess"))),p.value=!1,A("success")}finally{m.value=!1}}},S=(i,e)=>{t.value={appId:i,code:e,status:Z.ENABLE,remark:"",feeRate:null,config:{appId:"",serverUrl:null,signType:"RSA2",mode:null,privateKey:"",alipayPublicKey:"",appCertContent:"",alipayPublicCertContent:"",rootCertContent:""}},v.value?.resetFields()},x=i=>{if(`.${i.name.split(".")[1]}`!==c)return C.error(`请上传指定格式"${c}"文件`),!1;const n=i.size/1024/1024<2;return n||C.error("文件大小超过 2MB"),n},D=i=>{const e=new FileReader;e.onload=n=>{t.value.config.appCertContent=n.target.result},e.readAsText(i.file)},z=i=>{const e=new FileReader;e.onload=n=>{t.value.config.alipayPublicCertContent=n.target.result},e.readAsText(i.file)},N=i=>{const e=new FileReader;e.onload=n=>{t.value.config.rootCertContent=n.target.result},e.readAsText(i.file)};return(i,e)=>{const n=s("el-input"),u=s("el-form-item"),f=s("el-radio"),w=s("el-radio-group"),_=Q,y=s("el-button"),R=s("el-upload"),B=s("el-form"),E=L,O=M("loading");return g(),V("div",null,[l(E,{modelValue:o(p),"onUpdate:modelValue":e[14]||(e[14]=r=>J(p)?p.value=r:null),title:o(P),width:"830px",onClosed:i.close},{footer:a(()=>[l(y,{disabled:o(m),type:"primary",onClick:I},{default:a(()=>e[24]||(e[24]=[d("确 定")])),_:1},8,["disabled"]),l(y,{onClick:e[13]||(e[13]=r=>p.value=!1)},{default:a(()=>e[25]||(e[25]=[d("取 消")])),_:1})]),default:a(()=>[j((g(),k(B,{ref_key:"formRef",ref:v,"form-rules":q,"label-width":"100px",model:o(t)},{default:a(()=>[l(u,{label:"渠道费率","label-width":"180px",prop:"feeRate"},{default:a(()=>[l(n,{modelValue:o(t).feeRate,"onUpdate:modelValue":e[0]||(e[0]=r=>o(t).feeRate=r),clearable:"",placeholder:"请输入渠道费率"},{append:a(()=>e[15]||(e[15]=[d("%")])),_:1},8,["modelValue"])]),_:1}),l(u,{label:"开放平台 APPID","label-width":"180px",prop:"config.appId"},{default:a(()=>[l(n,{modelValue:o(t).config.appId,"onUpdate:modelValue":e[1]||(e[1]=r=>o(t).config.appId=r),clearable:"",placeholder:"请输入开放平台 APPID"},null,8,["modelValue"])]),_:1}),l(u,{label:"渠道状态","label-width":"180px",prop:"status"},{default:a(()=>[l(w,{modelValue:o(t).status,"onUpdate:modelValue":e[2]||(e[2]=r=>o(t).status=r)},{default:a(()=>[(g(!0),V(Y,null,G(o(h)(o(ee).COMMON_STATUS),r=>(g(),k(f,{key:parseInt(r.value),label:parseInt(r.value)},{default:a(()=>[d(H(r.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"网关地址","label-width":"180px",prop:"config.serverUrl"},{default:a(()=>[l(w,{modelValue:o(t).config.serverUrl,"onUpdate:modelValue":e[3]||(e[3]=r=>o(t).config.serverUrl=r)},{default:a(()=>[l(f,{label:"https://openapi.alipay.com/gateway.do"},{default:a(()=>e[16]||(e[16]=[d("线上环境")])),_:1}),l(f,{label:"https://openapi-sandbox.dl.alipaydev.com/gateway.do"},{default:a(()=>e[17]||(e[17]=[d("沙箱环境")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"算法类型","label-width":"180px",prop:"config.signType"},{default:a(()=>[l(w,{modelValue:o(t).config.signType,"onUpdate:modelValue":e[4]||(e[4]=r=>o(t).config.signType=r)},{default:a(()=>[l(f,{key:"RSA2",label:"RSA2"},{default:a(()=>e[18]||(e[18]=[d("RSA2")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"公钥类型","label-width":"180px",prop:"config.mode"},{default:a(()=>[l(w,{modelValue:o(t).config.mode,"onUpdate:modelValue":e[5]||(e[5]=r=>o(t).config.mode=r)},{default:a(()=>[l(f,{key:"公钥模式",label:1},{default:a(()=>e[19]||(e[19]=[d("公钥模式")])),_:1}),l(f,{key:"证书模式",label:2},{default:a(()=>e[20]||(e[20]=[d("证书模式")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(t).config.mode===1?(g(),V("div",oe,[l(u,{label:"应用私钥","label-width":"180px",prop:"config.privateKey"},{default:a(()=>[l(n,{modelValue:o(t).config.privateKey,"onUpdate:modelValue":e[6]||(e[6]=r=>o(t).config.privateKey=r),autosize:{minRows:8,maxRows:8},clearable:"",placeholder:"请输入应用私钥",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),l(u,{label:"支付宝公钥","label-width":"180px",prop:"config.alipayPublicKey"},{default:a(()=>[l(n,{modelValue:o(t).config.alipayPublicKey,"onUpdate:modelValue":e[7]||(e[7]=r=>o(t).config.alipayPublicKey=r),autosize:{minRows:8,maxRows:8},clearable:"",placeholder:"请输入支付宝公钥",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1})])):K("",!0),o(t).config.mode===2?(g(),V("div",re,[l(u,{label:"应用私钥","label-width":"180px",prop:"config.privateKey"},{default:a(()=>[l(n,{modelValue:o(t).config.privateKey,"onUpdate:modelValue":e[8]||(e[8]=r=>o(t).config.privateKey=r),autosize:{minRows:8,maxRows:8},clearable:"",placeholder:"请输入应用私钥",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),l(u,{label:"商户公钥应用证书","label-width":"180px",prop:"config.appCertContent"},{default:a(()=>[l(n,{modelValue:o(t).config.appCertContent,"onUpdate:modelValue":e[9]||(e[9]=r=>o(t).config.appCertContent=r),autosize:{minRows:8,maxRows:8},placeholder:"请上传商户公钥应用证书",readonly:"",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),l(u,{label:"","label-width":"180px"},{default:a(()=>[l(R,{ref:"privateKeyContentFile",accept:c,action:"","before-upload":x,"http-request":D,limit:1},{default:a(()=>[l(y,{type:"primary"},{default:a(()=>[l(_,{class:"mr-5px",icon:"ep:upload"}),e[21]||(e[21]=d(" 点击上传 "))]),_:1})]),_:1},512)]),_:1}),l(u,{label:"支付宝公钥证书","label-width":"180px",prop:"config.alipayPublicCertContent"},{default:a(()=>[l(n,{modelValue:o(t).config.alipayPublicCertContent,"onUpdate:modelValue":e[10]||(e[10]=r=>o(t).config.alipayPublicCertContent=r),autosize:{minRows:8,maxRows:8},placeholder:"请上传支付宝公钥证书",readonly:"",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),l(u,{label:"","label-width":"180px"},{default:a(()=>[l(R,{ref:"privateCertContentFile",accept:c,action:"","before-upload":x,"http-request":z,limit:1},{default:a(()=>[l(y,{type:"primary"},{default:a(()=>[l(_,{class:"mr-5px",icon:"ep:upload"}),e[22]||(e[22]=d(" 点击上传 "))]),_:1})]),_:1},512)]),_:1}),l(u,{label:"根证书","label-width":"180px",prop:"config.rootCertContent"},{default:a(()=>[l(n,{modelValue:o(t).config.rootCertContent,"onUpdate:modelValue":e[11]||(e[11]=r=>o(t).config.rootCertContent=r),autosize:{minRows:8,maxRows:8},placeholder:"请上传根证书",readonly:"",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),l(u,{label:"","label-width":"180px"},{default:a(()=>[l(R,{ref:"privateCertContentFile",accept:c,action:"","before-upload":x,"http-request":N,limit:1},{default:a(()=>[l(y,{type:"primary"},{default:a(()=>[l(_,{class:"mr-5px",icon:"ep:upload"}),e[23]||(e[23]=d(" 点击上传 "))]),_:1})]),_:1},512)]),_:1})])):K("",!0),l(u,{label:"备注","label-width":"180px",prop:"remark"},{default:a(()=>[l(n,{modelValue:o(t).remark,"onUpdate:modelValue":e[12]||(e[12]=r=>o(t).remark=r),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[O,o(m)]])]),_:1},8,["modelValue","title","onClosed"])])}}});export{me as _};
