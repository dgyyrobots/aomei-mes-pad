/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{_ as ee,g as F}from"./Form-DvFkc2yb.js";import{d as Z,az as s,r as z,O as M,bX as te,a as t,bn as ne,g as ae,c as X,o as A,F as oe,j as g,l as v,aG as le,n as se,m as O,U as G,k as $,v as B,K as re,t as D,N as H,q as ie,b as ce,Y as I,w as de,h as ue,aS as ge,Q as W,P as me,bo as pe,dj as V,A as fe,f as he,T as Q,Z as Y,X as be}from"./index-lcC3l4R2.js";import{u as we}from"./useForm-ByOuXSn7.js";import{d as ye}from"./download-U6qaYcnP.js";const xe={key:0},Le=Z({name:"Search",__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:s.bool.def(!1),labelWidth:s.oneOfType([String,Number]).def("auto"),layout:s.string.validate(e=>["inline","bottom"].includes(e)).def("inline"),buttomPosition:s.string.validate(e=>["left","center","right"].includes(e)).def("center"),showSearch:s.bool.def(!0),showReset:s.bool.def(!0),expand:s.bool.def(!1),expandField:s.string.def(""),inline:s.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(e,{emit:a}){const{t:r}=H(),d=e,w=a,f=z(!0),b=M(()=>{let i=te(d.schema);if(d.expand&&d.expandField&&!t(f)){const S=ne(i,p=>p.field===d.expandField);if(S>-1){const p=i.length;i.splice(S+1,p)}}return d.layout==="inline"&&(i=i.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),i}),{register:x,elFormRef:m,methods:o}=we({model:d.model||{}}),l=async()=>{await t(m)?.validate(async i=>{if(i){const{getFormData:S}=o,p=await S();w("search",p)}})},L=async()=>{t(m)?.resetFields();const{getFormData:i}=o,S=await i();w("reset",S)},R=M(()=>({textAlign:d.buttomPosition})),N=()=>{t(m)?.resetFields(),f.value=!t(f)};return(i,S)=>{const p=re,C=ae("el-button"),U=ee;return A(),X(oe,null,[g(U,{class:"-mb-15px","hide-required-asterisk":"",inline:e.inline,"is-col":e.isCol,"is-custom":!1,"label-width":e.labelWidth,schema:t(b),onRegister:t(x)},le({action:O(()=>[e.layout==="inline"?(A(),X("div",xe,[e.showSearch?(A(),$(C,{key:0,onClick:l},{default:O(()=>[g(p,{class:"mr-5px",icon:"ep:search"}),B(" "+D(t(r)("common.query")),1)]),_:1})):v("",!0),e.showReset?(A(),$(C,{key:1,onClick:L},{default:O(()=>[g(p,{class:"mr-5px",icon:"ep:refresh"}),B(" "+D(t(r)("common.reset")),1)]),_:1})):v("",!0),e.expand?(A(),$(C,{key:2,text:"",onClick:N},{default:O(()=>[B(D(t(r)(t(f)?"common.shrink":"common.expand"))+" ",1),g(p,{icon:t(f)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):v("",!0),G(i.$slots,"actionMore")])):v("",!0)]),_:2},[se(Object.keys(i.$slots),q=>({name:q,fn:O(()=>[G(i.$slots,q)])}))]),1032,["inline","is-col","label-width","schema","onRegister"]),e.layout==="bottom"?(A(),X("div",{key:0,style:ie(t(R))},[e.showSearch?(A(),$(C,{key:0,type:"primary",onClick:l},{default:O(()=>[g(p,{class:"mr-5px",icon:"ep:search"}),B(" "+D(t(r)("common.query")),1)]),_:1})):v("",!0),e.showReset?(A(),$(C,{key:1,onClick:L},{default:O(()=>[g(p,{class:"mr-5px",icon:"ep:refresh-right"}),B(" "+D(t(r)("common.reset")),1)]),_:1})):v("",!0),e.expand?(A(),$(C,{key:2,text:"",onClick:N},{default:O(()=>[B(D(t(r)(t(f)?"common.shrink":"common.expand"))+" ",1),g(p,{icon:t(f)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):v("",!0),G(i.$slots,"actionMore")],4)):v("",!0)],64)}}}),Se=(e,a,r,d)=>{const w=a+1;return e?r*(d-1)+w:w},Pe=Z({name:"Table",props:{pageSize:s.number.def(10),currentPage:s.number.def(1),selection:s.bool.def(!1),showOverflowTooltip:s.bool.def(!0),columns:{type:Array,default:()=>[]},expand:s.bool.def(!1),pagination:{type:Object,default:()=>{}},reserveSelection:s.bool.def(!1),loading:s.bool.def(!1),reserveIndex:s.bool.def(!1),align:s.string.validate(e=>["left","center","right"].includes(e)).def("center"),headerAlign:s.string.validate(e=>["left","center","right"].includes(e)).def("center"),data:{type:Array,default:()=>[]}},emits:["update:pageSize","update:currentPage","register"],setup(e,{attrs:a,slots:r,emit:d,expose:w}){const f=z();ce(()=>{const n=t(f);d("register",n?.$parent,f)});const b=z(e.pageSize),x=z(e.currentPage),m=z({}),o=z({}),l=M(()=>{const n={...e};return Object.assign(n,t(o)),n}),L=(n={})=>{o.value=Object.assign(t(o),n),m.value=n},R=(n,P)=>{const{columns:T}=t(l);for(const h of P||T)for(const u of n)h.field===u.field?pe(h,u.path,u.value):h.children?.length&&R(n,h.children)},N=z([]),i=n=>{N.value=n};w({setProps:L,setColumn:R,selections:N});const S=M(()=>Object.assign({small:!1,background:!0,pagerCount:document.body.clientWidth<992?5:7,layout:"total, sizes, prev, pager, next, jumper",pageSizes:[10,20,30,50,100],disabled:!1,hideOnSinglePage:!1,total:10},t(l).pagination));I(()=>t(l).pageSize,n=>{b.value=n}),I(()=>t(l).currentPage,n=>{x.value=n}),I(()=>b.value,n=>{d("update:pageSize",n)}),I(()=>x.value,n=>{d("update:currentPage",n)});const p=M(()=>{const n={...a,...e};return delete n.columns,delete n.data,n}),C=()=>{const{selection:n,reserveSelection:P,align:T,headerAlign:h}=t(l);return n?g(V,{type:"selection",reserveSelection:P,align:T,headerAlign:h,width:"50"},null):void 0},U=()=>{const{align:n,headerAlign:P,expand:T}=t(l);return T?g(V,{type:"expand",align:n,headerAlign:P},{default:h=>F(r,"expand",h)}):void 0},q=n=>{const{align:P,headerAlign:T,showOverflowTooltip:h}=t(l);return n.map(u=>{const _={...u};return _.children&&delete _.children,g(V,W({showOverflowTooltip:h,align:P,headerAlign:T},_,{prop:u.field}),{default:k=>u.children&&u.children.length?K(u.children):F(r,u.field,k)||u?.formatter?.(k.row,k.column,k.row[u.field],k.$index)||k.row[u.field],header:F(r,`${u.field}-header`)})})},K=n=>{const{columns:P,reserveIndex:T,pageSize:h,currentPage:u,align:_,headerAlign:k,showOverflowTooltip:J}=t(l);return[U(),C()].concat((n||P).map(c=>{if(c.type==="index")return g(V,{type:"index",index:c.index?c.index:E=>Se(T,E,h,u),align:c.align||_,headerAlign:c.headerAlign||k,label:c.label,width:"65px"},null);{const E={...c};return E.children&&delete E.children,g(V,W({showOverflowTooltip:J,align:_,headerAlign:k},E,{prop:c.field}),{default:j=>c.children&&c.children.length?q(c.children):F(r,c.field,j)||c?.formatter?.(j.row,j.column,j.row[c.field],j.$index)||j.row[c.field],header:()=>F(r,`${c.field}-header`)||c.label})}}))};return()=>de(g("div",null,[g(ge,W({ref:f,data:t(l).data,"onSelection-change":i},t(p)),{default:()=>K(),append:()=>F(r,"append")}),t(l).pagination?g(me,W({pageSize:b.value,"onUpdate:pageSize":n=>b.value=n,currentPage:x.value,"onUpdate:currentPage":n=>x.value=n,class:"float-right mb-15px mt-15px"},t(S)),null):void 0]),[[ue("loading"),t(l).loading]])}}),Ce=fe(Pe,[["__scopeId","data-v-5d58df76"]]),{t:y}=H(),ve=e=>{const a=he({pageSize:10,currentPage:1,total:10,tableList:[],params:{...e?.defaultParams||{}},loading:!0,exportLoading:!1,currentRow:null}),r=M(()=>({...a.params,pageSize:a.pageSize,pageNo:a.currentPage}));I(()=>a.currentPage,()=>{m.getList()}),I(()=>a.pageSize,()=>{a.currentPage===1||(a.currentPage=1),m.getList()});const d=z(),w=z(),f=(o,l)=>{d.value=o,w.value=l},b=async()=>{await be();const o=t(d);return o||console.error("The table is not registered. Please use the register method to register"),o},x=async o=>{let l=1;o instanceof Array?(l=o.length,await Promise.all(o.map(async L=>{await(e?.delListApi&&e?.delListApi(L))}))):await(e?.delListApi&&e?.delListApi(o)),Y.success(y("common.delSuccess")),a.currentPage=(a.total%a.pageSize===l||a.pageSize===1)&&a.currentPage>1?a.currentPage-1:a.currentPage,await m.getList()},m={getList:async()=>{a.loading=!0;const o=await e?.getListApi(t(r)).finally(()=>{a.loading=!1});o&&(a.tableList=o.list,a.total=o.total??0)},setProps:async(o={})=>{(await b())?.setProps(o)},setColumn:async o=>{(await b())?.setColumn(o)},getSelections:async()=>(await b())?.selections||[],setSearchParams:o=>{a.params=Object.assign(a.params,{pageSize:a.pageSize,pageNo:1,...o}),a.currentPage!==1?a.currentPage=1:m.getList()},delList:async(o,l,L=!0)=>{const R=await b();if(l&&!R?.selections.length){Y.warning(y("common.delNoData"));return}L?Q.confirm(y("common.delMessage"),y("common.confirmTitle"),{confirmButtonText:y("common.ok"),cancelButtonText:y("common.cancel"),type:"warning"}).then(async()=>{await x(o)}):await x(o)},exportList:async o=>{a.exportLoading=!0,Q.confirm(y("common.exportMessage"),y("common.confirmTitle"),{confirmButtonText:y("common.ok"),cancelButtonText:y("common.cancel"),type:"warning"}).then(async()=>{const l=await e?.exportListApi?.(t(r));l&&ye.excel(l,o)}).finally(()=>{a.exportLoading=!1})}};return e?.props&&m.setProps(e.props),{register:f,elTableRef:w,tableObject:a,methods:m,tableMethods:m}};export{Le as _,Ce as a,ve as u};
