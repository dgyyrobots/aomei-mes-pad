/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{d as B,r as i,f as L,g as u,h as M,k as f,o as m,m as o,w as v,a as t,j as s,c as g,F as y,n as V,v as b,t as O,$ as k,y as Y,_ as z,z as A}from"./index-lcC3l4R2.js";import{g as G,s as H}from"./index-Nd01WPjP.js";import{g as J}from"./index-DNzgPDZI.js";import{c as K,D as Q}from"./dict-B7jb0IEc.js";const le=B({name:"SystemNotifyTemplateSendForm",__name:"NotifyTemplateSendForm",setup(W,{expose:C}){const P=A(),d=i(!1),p=i(!1),a=i({content:"",params:{},userId:void 0,userType:1,templateCode:"",templateParams:new Map}),T=L({userId:[{required:!0,message:"用户编号不能为空",trigger:"change"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),c=i(),w=i([]);C({open:async _=>{d.value=!0,D(),p.value=!0;try{const l=await G(_);a.value.content=l.content,a.value.params=l.params,a.value.templateCode=l.code,a.value.templateParams=l.params.reduce((r,n)=>(r[n]="",r),{}),T.templateParams=l.params.reduce((r,n)=>(r[n]={required:!0,message:`参数 ${n} 不能为空`,trigger:"blur"},r),{})}finally{p.value=!1}w.value=await J()}});const x=async()=>{if(!(!c||!await c.value.validate())){p.value=!0;try{const l=a.value,r=await H(l);r&&P.success(`提交发送成功！发送结果，见发送日志编号：${r}`),d.value=!1}finally{p.value=!1}}},D=()=>{a.value={content:"",params:{},mobile:"",templateCode:"",templateParams:new Map,userType:1},c.value?.resetFields()};return(_,l)=>{const r=u("el-input"),n=u("el-form-item"),U=u("el-radio"),F=u("el-radio-group"),S=u("el-option"),N=u("el-select"),R=u("el-form"),I=u("el-button"),$=z,E=M("loading");return m(),f($,{modelValue:t(d),"onUpdate:modelValue":l[5]||(l[5]=e=>Y(d)?d.value=e:null),"max-height":500,title:"测试发送"},{footer:o(()=>[s(I,{disabled:t(p),type:"primary",onClick:x},{default:o(()=>l[6]||(l[6]=[b("确 定")])),_:1},8,["disabled"]),s(I,{onClick:l[4]||(l[4]=e=>d.value=!1)},{default:o(()=>l[7]||(l[7]=[b("取 消")])),_:1})]),default:o(()=>[v((m(),f(R,{ref_key:"formRef",ref:c,"label-width":"140px",model:t(a),rules:t(T)},{default:o(()=>[s(n,{label:"模板内容",prop:"content"},{default:o(()=>[s(r,{modelValue:t(a).content,"onUpdate:modelValue":l[0]||(l[0]=e=>t(a).content=e),placeholder:"请输入模板内容",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),s(n,{label:"用户类型",prop:"userType"},{default:o(()=>[s(F,{modelValue:t(a).userType,"onUpdate:modelValue":l[1]||(l[1]=e=>t(a).userType=e)},{default:o(()=>[(m(!0),g(y,null,V(t(K)(t(Q).USER_TYPE),e=>(m(),f(U,{key:e.value,label:e.value},{default:o(()=>[b(O(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(s(n,{label:"接收人ID",prop:"userId"},{default:o(()=>[s(r,{modelValue:t(a).userId,"onUpdate:modelValue":l[2]||(l[2]=e=>t(a).userId=e),style:{width:"160px"}},null,8,["modelValue"])]),_:1},512),[[k,t(a).userType===1]]),v(s(n,{label:"接收人",prop:"userId"},{default:o(()=>[s(N,{modelValue:t(a).userId,"onUpdate:modelValue":l[3]||(l[3]=e=>t(a).userId=e),placeholder:"请选择接收人"},{default:o(()=>[(m(!0),g(y,null,V(t(w),e=>(m(),f(S,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},512),[[k,t(a).userType===2]]),(m(!0),g(y,null,V(t(a).params,e=>(m(),f(n,{key:e,label:"参数 {"+e+"}",prop:"templateParams."+e},{default:o(()=>[s(r,{modelValue:t(a).templateParams[e],"onUpdate:modelValue":q=>t(a).templateParams[e]=q,placeholder:"请输入 "+e+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])),[[E,t(p)]])]),_:1},8,["modelValue"])}}});export{le as _};
