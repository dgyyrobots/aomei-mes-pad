/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 13:49:10 
 */
import{d as E,r as p,f as Q,b as j,g as c,h as D,c as J,o as m,j as e,m as n,a,J as S,w as f,v as d,K as W,k as g,L as _,M as A,F as G,z as H,N as O}from"./index-BW9ifGp0.js";import{_ as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-58zNwBTb.js";import{_ as Y,a as Z,d as ee,e as te}from"./ContractForm.vue_vue_type_script_setup_true_lang-ZQw7qFG4.js";import{d as le}from"./download-U6qaYcnP.js";const ie=E({name:"CrmContract",__name:"index",setup(ae){const y=H(),{t:T}=O(),v=p(!0),I=p(0),P=p([]),o=Q({pageNo:1,pageSize:10,name:null,customerId:null,businessId:null,orderDate:[],no:null,discountPercent:null,productPrice:null}),V=p(),C=p(!1),u=async()=>{v.value=!0;try{const r=await Z(o);P.value=r.list,I.value=r.total}finally{v.value=!1}},b=()=>{o.pageNo=1,u()},z=()=>{V.value.resetFields(),b()},F=p(),N=(r,t)=>{F.value.open(r,t)},K=async r=>{try{await y.delConfirm(),await ee(r),y.success(T("common.delSuccess")),await u()}catch(t){console.log(t)}},L=async()=>{try{await y.exportConfirm(),C.value=!0;const r=await te(o);le.excel(r,"合同.xls")}catch(r){console.log(r)}finally{C.value=!1}};return j(()=>{u()}),(r,t)=>{const $=c("el-input"),k=c("el-form-item"),w=W,i=c("el-button"),R=c("el-form"),U=X,l=c("el-table-column"),q=c("el-table"),B=A,x=D("hasPermi"),M=D("loading");return m(),J(G,null,[e(U,null,{default:n(()=>[e(R,{ref_key:"queryFormRef",ref:V,class:"-mb-15px",inline:!0,"label-width":"68px",model:a(o)},{default:n(()=>[e(k,{label:"合同编号",prop:"no"},{default:n(()=>[e($,{modelValue:a(o).no,"onUpdate:modelValue":t[0]||(t[0]=s=>a(o).no=s),class:"!w-240px",clearable:"",placeholder:"请输入合同编号",onKeyup:S(b,["enter"])},null,8,["modelValue"])]),_:1}),e(k,{label:"合同名称",prop:"name"},{default:n(()=>[e($,{modelValue:a(o).name,"onUpdate:modelValue":t[1]||(t[1]=s=>a(o).name=s),class:"!w-240px",clearable:"",placeholder:"请输入合同名称",onKeyup:S(b,["enter"])},null,8,["modelValue"])]),_:1}),e(k,null,{default:n(()=>[e(i,{onClick:b},{default:n(()=>[e(w,{class:"mr-5px",icon:"ep:search"}),t[5]||(t[5]=d(" 搜索 "))]),_:1}),e(i,{onClick:z},{default:n(()=>[e(w,{class:"mr-5px",icon:"ep:refresh"}),t[6]||(t[6]=d(" 重置 "))]),_:1}),f((m(),g(i,{type:"primary",onClick:t[2]||(t[2]=s=>N("create"))},{default:n(()=>[e(w,{class:"mr-5px",icon:"ep:plus"}),t[7]||(t[7]=d(" 新增 "))]),_:1})),[[x,["crm:contract:create"]]]),f((m(),g(i,{loading:a(C),plain:"",type:"success",onClick:L},{default:n(()=>[e(w,{class:"mr-5px",icon:"ep:download"}),t[8]||(t[8]=d(" 导出 "))]),_:1},8,["loading"])),[[x,["crm:contract:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(U,null,{default:n(()=>[f((m(),g(q,{data:a(P),"show-overflow-tooltip":!0,stripe:!0},{default:n(()=>[e(l,{align:"center",label:"合同编号",prop:"id"}),e(l,{align:"center",label:"合同名称",prop:"name"}),e(l,{align:"center",label:"客户名称",prop:"customerId"}),e(l,{align:"center",label:"商机名称",prop:"businessId"}),e(l,{align:"center",label:"工作流名称",prop:"processInstanceId"}),e(l,{align:"center",formatter:a(_),label:"下单时间",prop:"orderDate",width:"180px"},null,8,["formatter"]),e(l,{align:"center",label:"负责人",prop:"ownerUserId"}),e(l,{align:"center",label:"合同编号",prop:"no"}),e(l,{align:"center",formatter:a(_),label:"开始时间",prop:"startTime",width:"180px"},null,8,["formatter"]),e(l,{align:"center",formatter:a(_),label:"结束时间",prop:"endTime",width:"180px"},null,8,["formatter"]),e(l,{align:"center",label:"合同金额",prop:"price"}),e(l,{align:"center",label:"整单折扣",prop:"discountPercent"}),e(l,{align:"center",label:"产品总金额",prop:"productPrice"}),e(l,{align:"center",label:"联系人",prop:"contactId"}),e(l,{align:"center",label:"公司签约人",prop:"signUserId"}),e(l,{align:"center",formatter:a(_),label:"最后跟进时间",prop:"contactLastTime",width:"180px"},null,8,["formatter"]),e(l,{align:"center",formatter:a(_),label:"创建时间",prop:"createTime",width:"180px"},null,8,["formatter"]),e(l,{align:"center",label:"备注",prop:"remark"}),e(l,{label:"操作",width:"120px"},{default:n(s=>[f((m(),g(i,{link:"",type:"primary",onClick:h=>N("update",s.row.id)},{default:n(()=>t[9]||(t[9]=[d("编辑")])),_:2},1032,["onClick"])),[[x,["crm:contract:update"]]]),f((m(),g(i,{link:"",type:"danger",onClick:h=>K(s.row.id)},{default:n(()=>t[10]||(t[10]=[d("删除")])),_:2},1032,["onClick"])),[[x,["crm:contract:delete"]]])]),_:1})]),_:1},8,["data"])),[[M,a(v)]]),e(B,{limit:a(o).pageSize,"onUpdate:limit":t[3]||(t[3]=s=>a(o).pageSize=s),page:a(o).pageNo,"onUpdate:page":t[4]||(t[4]=s=>a(o).pageNo=s),total:a(I),onPagination:u},null,8,["limit","page","total"])]),_:1}),e(Y,{ref_key:"formRef",ref:F,onSuccess:u},null,512)],64)}}});export{ie as default};
