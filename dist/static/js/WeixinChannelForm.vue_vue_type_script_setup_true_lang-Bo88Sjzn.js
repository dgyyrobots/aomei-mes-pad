/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-10 15:05:55 
 */
import{d as $,r as g,g as d,h as L,c as b,o as f,j as t,_ as M,a,y as J,m as o,w as W,k as K,l as U,v as p,F as j,n as Y,t as G,K as H,z as Q,N as X}from"./index-D3S9e4gi.js";import{C as Z}from"./constants-BPQb3nxh.js";import{d as ee,D as te}from"./dict-D5UmY5m8.js";import{g as le,c as ae,u as oe}from"./index-G5f4xq-j.js";const ne={key:0},ie={key:1},fe=$({name:"WeixinChannelForm",__name:"WeixinChannelForm",emits:["success"],setup(re,{expose:F,emit:h}){const{t:w}=X(),y=Q(),u=g(!1),x=g(""),m=g(!1),l=g({appId:"",code:"",status:void 0,feeRate:void 0,remark:"",config:{appId:"",mchId:"",apiVersion:"",mchKey:"",keyContent:"",privateKeyContent:"",privateCertContent:"",apiV3Key:""}}),q={feeRate:[{required:!0,message:"请输入渠道费率",trigger:"blur"}],status:[{required:!0,message:"渠道状态不能为空",trigger:"blur"}],"config.mchId":[{required:!0,message:"请传入商户号",trigger:"blur"}],"config.appId":[{required:!0,message:"请输入公众号APPID",trigger:"blur"}],"config.apiVersion":[{required:!0,message:"API版本不能为空",trigger:"blur"}],"config.mchKey":[{required:!0,message:"请输入商户密钥",trigger:"blur"}],"config.keyContent":[{required:!0,message:"请上传 apiclient_cert.p12 证书",trigger:"blur"}],"config.privateKeyContent":[{required:!0,message:"请上传 apiclient_key.pem 证书",trigger:"blur"}],"config.privateCertContent":[{required:!0,message:"请上传 apiclient_cert.pem证 书",trigger:"blur"}],"config.apiV3Key":[{required:!0,message:"请上传 api V3 密钥值",trigger:"blur"}]},v=g();F({open:async(r,e)=>{u.value=!0,m.value=!0,P(r,e);try{const i=await le(r,e);i&&i.id&&(l.value=i,l.value.config=JSON.parse(i.config)),x.value=l.value.id?"编辑支付渠道":"创建支付渠道"}finally{m.value=!1}}});const D=h,A=async()=>{if(!(!v||!await v.value.validate())){m.value=!0;try{const e={...l.value};e.config=JSON.stringify(l.value.config),e.id?(await oe(e),y.success(w("common.updateSuccess"))):(await ae(e),y.success(w("common.createSuccess"))),u.value=!1,D("success")}finally{m.value=!1}}},P=(r,e)=>{l.value={appId:r,code:e,status:Z.ENABLE,feeRate:void 0,remark:"",config:{appId:"",mchId:"",apiVersion:"",mchKey:"",keyContent:"",privateKeyContent:"",privateCertContent:"",apiV3Key:""}},v.value?.resetFields()},k=(r,e)=>{if(`.${r.name.split(".")[1]}`!==e)return y.error(`请上传指定格式"${e}"文件`),!1;const s=r.size/1024/1024<2;return s||y.error("文件大小超过 2MB"),s},S=r=>{k(r,".p12")},R=r=>{k(r,".pem")},z=r=>{const e=new FileReader;e.onload=i=>{l.value.config.privateKeyContent=i.target.result},e.readAsText(r.file)},B=r=>{const e=new FileReader;e.onload=i=>{l.value.config.privateCertContent=i.target.result},e.readAsText(r.file)},N=r=>{const e=new FileReader;e.onload=i=>{l.value.config.keyContent=i.target.result.split(",")[1]},e.readAsDataURL(r.file)};return(r,e)=>{const i=d("el-input"),s=d("el-form-item"),V=d("el-radio"),I=d("el-radio-group"),C=H,c=d("el-button"),_=d("el-upload"),T=d("el-form"),E=M,O=L("loading");return f(),b("div",null,[t(E,{modelValue:a(u),"onUpdate:modelValue":e[12]||(e[12]=n=>J(u)?u.value=n:null),title:a(x),width:"800px",onClose:r.close},{footer:o(()=>[t(c,{disabled:a(m),type:"primary",onClick:A},{default:o(()=>e[19]||(e[19]=[p("确 定")])),_:1},8,["disabled"]),t(c,{onClick:e[11]||(e[11]=n=>u.value=!1)},{default:o(()=>e[20]||(e[20]=[p("取 消")])),_:1})]),default:o(()=>[W((f(),K(T,{ref_key:"formRef",ref:v,"label-width":"120px",model:a(l),rules:q},{default:o(()=>[t(s,{label:"渠道费率","label-width":"180px",prop:"feeRate"},{default:o(()=>[t(i,{modelValue:a(l).feeRate,"onUpdate:modelValue":e[0]||(e[0]=n=>a(l).feeRate=n),clearable:"",placeholder:"请输入渠道费率",style:{width:"100%"}},{append:o(()=>e[13]||(e[13]=[p("%")])),_:1},8,["modelValue"])]),_:1}),t(s,{label:"公众号 APPID","label-width":"180px",prop:"config.appId"},{default:o(()=>[t(i,{modelValue:a(l).config.appId,"onUpdate:modelValue":e[1]||(e[1]=n=>a(l).config.appId=n),clearable:"",placeholder:"请输入公众号 APPID",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(s,{label:"商户号","label-width":"180px",prop:"config.mchId"},{default:o(()=>[t(i,{modelValue:a(l).config.mchId,"onUpdate:modelValue":e[2]||(e[2]=n=>a(l).config.mchId=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(s,{label:"渠道状态","label-width":"180px",prop:"status"},{default:o(()=>[t(I,{modelValue:a(l).status,"onUpdate:modelValue":e[3]||(e[3]=n=>a(l).status=n)},{default:o(()=>[(f(!0),b(j,null,Y(a(ee)(a(te).COMMON_STATUS),n=>(f(),K(V,{key:parseInt(n.value),label:parseInt(n.value)},{default:o(()=>[p(G(n.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"API 版本","label-width":"180px",prop:"config.apiVersion"},{default:o(()=>[t(I,{modelValue:a(l).config.apiVersion,"onUpdate:modelValue":e[4]||(e[4]=n=>a(l).config.apiVersion=n)},{default:o(()=>[t(V,{label:"v2"},{default:o(()=>e[14]||(e[14]=[p("v2")])),_:1}),t(V,{label:"v3"},{default:o(()=>e[15]||(e[15]=[p("v3")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(l).config.apiVersion==="v2"?(f(),b("div",ne,[t(s,{label:"商户密钥","label-width":"180px",prop:"config.mchKey"},{default:o(()=>[t(i,{modelValue:a(l).config.mchKey,"onUpdate:modelValue":e[5]||(e[5]=n=>a(l).config.mchKey=n),autosize:{minRows:8,maxRows:8},clearable:"",placeholder:"请输入商户密钥",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),t(s,{label:"apiclient_cert.p12 证书","label-width":"180px",prop:"config.keyContent"},{default:o(()=>[t(i,{modelValue:a(l).config.keyContent,"onUpdate:modelValue":e[6]||(e[6]=n=>a(l).config.keyContent=n),autosize:{minRows:8,maxRows:8},placeholder:"请上传 apiclient_cert.p12 证书",readonly:"",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),t(s,{label:"","label-width":"180px"},{default:o(()=>[t(_,{accept:".p12",action:"","before-upload":S,"http-request":N,limit:1},{default:o(()=>[t(c,{type:"primary"},{default:o(()=>[t(C,{class:"mr-5px",icon:"ep:upload"}),e[16]||(e[16]=p(" 点击上传 "))]),_:1})]),_:1})]),_:1})])):U("",!0),a(l).config.apiVersion==="v3"?(f(),b("div",ie,[t(s,{label:"API V3 密钥","label-width":"180px",prop:"config.apiV3Key"},{default:o(()=>[t(i,{modelValue:a(l).config.apiV3Key,"onUpdate:modelValue":e[7]||(e[7]=n=>a(l).config.apiV3Key=n),autosize:{minRows:8,maxRows:8},clearable:"",placeholder:"请输入 API V3 密钥",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),t(s,{label:"apiclient_key.pem 证书","label-width":"180px",prop:"config.privateKeyContent"},{default:o(()=>[t(i,{modelValue:a(l).config.privateKeyContent,"onUpdate:modelValue":e[8]||(e[8]=n=>a(l).config.privateKeyContent=n),autosize:{minRows:8,maxRows:8},placeholder:"请上传 apiclient_key.pem 证书",readonly:"",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),t(s,{label:"","label-width":"180px",prop:"privateKeyContentFile"},{default:o(()=>[t(_,{ref:"privateKeyContentFile",accept:".pem",action:"","before-upload":R,"http-request":z,limit:1},{default:o(()=>[t(c,{type:"primary"},{default:o(()=>[t(C,{class:"mr-5px",icon:"ep:upload"}),e[17]||(e[17]=p(" 点击上传 "))]),_:1})]),_:1},512)]),_:1}),t(s,{label:"apiclient_cert.pem证书","label-width":"180px",prop:"config.privateCertContent"},{default:o(()=>[t(i,{modelValue:a(l).config.privateCertContent,"onUpdate:modelValue":e[9]||(e[9]=n=>a(l).config.privateCertContent=n),autosize:{minRows:8,maxRows:8},placeholder:"请上传apiclient_cert.pem证书",readonly:"",style:{width:"100%"},type:"textarea"},null,8,["modelValue"])]),_:1}),t(s,{label:"","label-width":"180px",prop:"privateCertContentFile"},{default:o(()=>[t(_,{ref:"privateCertContentFile",accept:".pem",action:"","before-upload":R,"http-request":B,limit:1},{default:o(()=>[t(c,{type:"primary"},{default:o(()=>[t(C,{class:"mr-5px",icon:"ep:upload"}),e[18]||(e[18]=p(" 点击上传 "))]),_:1})]),_:1},512)]),_:1})])):U("",!0),t(s,{label:"备注","label-width":"180px",prop:"remark"},{default:o(()=>[t(i,{modelValue:a(l).remark,"onUpdate:modelValue":e[10]||(e[10]=n=>a(l).remark=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[O,a(m)]])]),_:1},8,["modelValue","title","onClose"])])}}});export{fe as _};
