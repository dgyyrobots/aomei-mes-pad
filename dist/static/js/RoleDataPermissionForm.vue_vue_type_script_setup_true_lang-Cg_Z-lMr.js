/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:21:26 
 */
import{d as j,r as u,f as z,g as d,h as K,k as y,o as v,m as o,w as q,l as G,a as t,j as s,v as r,t as b,c as H,F as J,n as Q,y as k,_ as W,z as X,N as Z}from"./index-5TqN_QR1.js";import{g as ee}from"./index-Bs4uKPQe.js";import{b as te}from"./index-DS9BJtuM.js";import{m as T}from"./constants-BPQb3nxh.js";import{c as ae,D as le}from"./dict-B2yk4gHf.js";import{d as oe,h as se}from"./tree-vSlcEeQq.js";const fe=j({name:"SystemRoleDataPermissionForm",__name:"RoleDataPermissionForm",emits:["success"],setup(ne,{expose:E,emit:I}){const{t:N}=Z(),R=X(),i=u(!1),_=u(!1),l=z({id:0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]}),g=u(),x=u([]),m=u(!1),p=u(),c=u(!1),f=u(!0);E({open:async n=>{i.value=!0,P(),x.value=se(await ee()),l.id=n.id,l.name=n.name,l.code=n.code,l.dataScope=n.dataScope,n.dataScopeDeptIds?.forEach(e=>{p.value.setChecked(e,!0,!1)})}});const w=I,F=async()=>{_.value=!0;try{const n={roleId:l.id,dataScope:l.dataScope,dataScopeDeptIds:l.dataScope!==T.DEPT_CUSTOM?[]:p.value.getCheckedKeys(!1)};await te(n),R.success(N("common.updateSuccess")),i.value=!1,w("success")}finally{_.value=!1}},P=()=>{c.value=!1,m.value=!1,f.value=!0,l.value={id:0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]},p.value?.setCheckedNodes([]),g.value?.resetFields()},U=()=>{p.value.setCheckedNodes(c.value?x.value:[])},M=()=>{const n=p.value?.store.nodesMap;for(const e in n)n[e].expanded!==m.value&&(n[e].expanded=m.value)};return(n,e)=>{const V=d("el-tag"),S=d("el-form-item"),O=d("el-option"),h=d("el-select"),A=d("el-form"),D=d("el-switch"),B=d("el-tree"),L=d("el-card"),C=d("el-button"),$=W,Y=K("loading");return v(),y($,{modelValue:t(i),"onUpdate:modelValue":e[6]||(e[6]=a=>k(i)?i.value=a:null),title:"菜单权限",width:"800"},{footer:o(()=>[s(C,{disabled:t(_),type:"primary",onClick:F},{default:o(()=>e[10]||(e[10]=[r("确 定")])),_:1},8,["disabled"]),s(C,{onClick:e[5]||(e[5]=a=>i.value=!1)},{default:o(()=>e[11]||(e[11]=[r("取 消")])),_:1})]),default:o(()=>[q((v(),y(A,{ref_key:"formRef",ref:g,"label-width":"80px",model:t(l)},{default:o(()=>[s(S,{label:"角色名称"},{default:o(()=>[s(V,null,{default:o(()=>[r(b(t(l).name),1)]),_:1})]),_:1}),s(S,{label:"角色标识"},{default:o(()=>[s(V,null,{default:o(()=>[r(b(t(l).code),1)]),_:1})]),_:1}),s(S,{label:"权限范围"},{default:o(()=>[s(h,{modelValue:t(l).dataScope,"onUpdate:modelValue":e[0]||(e[0]=a=>t(l).dataScope=a)},{default:o(()=>[(v(!0),H(J,null,Q(t(ae)(t(le).SYSTEM_DATA_SCOPE),a=>(v(),y(O,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[Y,t(_)]]),t(l).dataScope===t(T).DEPT_CUSTOM?(v(),y(S,{key:0,label:"权限范围",style:{display:"flex"}},{default:o(()=>[s(L,{class:"card",shadow:"never"},{header:o(()=>[e[7]||(e[7]=r(" 全选/全不选: ")),s(D,{modelValue:t(c),"onUpdate:modelValue":e[1]||(e[1]=a=>k(c)?c.value=a:null),"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:e[2]||(e[2]=a=>U())},null,8,["modelValue"]),e[8]||(e[8]=r(" 全部展开/折叠: ")),s(D,{modelValue:t(m),"onUpdate:modelValue":e[3]||(e[3]=a=>k(m)?m.value=a:null),"active-text":"展开","inactive-text":"折叠","inline-prompt":"",onChange:M},null,8,["modelValue"]),e[9]||(e[9]=r(" 父子联动(选中父节点，自动选择子节点): ")),s(D,{modelValue:t(f),"onUpdate:modelValue":e[4]||(e[4]=a=>k(f)?f.value=a:null),"active-text":"是","inactive-text":"否","inline-prompt":""},null,8,["modelValue"])]),default:o(()=>[s(B,{ref_key:"treeRef",ref:p,"check-strictly":!t(f),data:t(x),"default-expand-all":"","empty-text":"加载中，请稍后","node-key":"id",props:t(oe),"show-checkbox":""},null,8,["check-strictly","data","props"])]),_:1})]),_:1})):G("",!0)]),_:1},8,["modelValue"])}}});export{fe as _};
