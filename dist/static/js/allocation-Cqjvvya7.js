/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:21:26 
 */
import{V as W,W as el,O as Te,r as d,f as Ce,Y as Ge,b as Fe,g as s,h as Ne,k as y,o as f,m as l,w as x,j as e,c as Ue,F as Xe,n as Ze,J as Q,a as h,D as be,v as w,a0 as Le,$ as ye,t as _e,i as X,x as Re,M as Me,a7 as ll,d as ql,A as al,H as jl,X as Se,R as Ql,Z as O,E as Qe,G as Jl,a3 as Dl,l as re,a5 as Gl,a8 as Xl,T as Je,a6 as Zl}from"./index-5TqN_QR1.js";import{_ as El}from"./DictTag.vue_vue_type_script_lang-cZQMmgs8.js";import{D as Oe}from"./dict-B2yk4gHf.js";import{k as ea}from"./index-DPwoEynk.js";import"./color-B5phLuB-.js";const la=async g=>await W.get({url:"/mes/pro/task/page",params:g}),aa=async()=>await W.get({url:"/mes/pro/cess/list-all-simple"}),ta={class:"dialog-footer"},Ul={__name:"taskSelectSingle",props:{workorderId:{type:[Number,String],default:null},workorderCode:{type:String,default:null},processId:{type:[Number,String],default:null},processCode:{type:String,default:null},workstationId:{type:[Number,String],default:null},workstationCode:{type:String,default:null}},emits:["onSelected"],setup(g,{expose:K,emit:H}){const m=g,$=H,L=el(),T=Te(()=>L.currentSize==="mini"?"small":L.currentSize),n=d(!1),k=d(void 0),Z=d(void 0),ie=d(!0);d([]),d(!0),d(!0);const U=d(!0),J=d(0),M=d([]);d(""),d(!1);const se=d([]),le=d(null),A=Ce({pageNo:1,pageSize:10,taskCode:null,taskName:null,workorderId:m.workorderId,workorderCode:null,workorderName:null,workstationId:null,workstationCode:null,workstationName:null,processId:m.processId,processCode:null,processName:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,clientId:null,clientCode:null,clientName:null,clientNick:null,startTime:null,duration:null,endTime:null,colorCode:null,requestDate:null});Ce({}),Ce({workstationId:[{required:!0,message:"工作站不能为空",trigger:"blur"}],quantity:[{required:!0,message:"排产数量不能为空",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始生产日期",trigger:"blur"}],duration:[{required:!0,message:"清输入估算的生产用时",trigger:"blur"}]}),Ge(()=>m.workorderId,q=>{A.workorderId=q}),Fe(()=>{S(),N()});const S=()=>{ie.value=!0,la(A).then(q=>{M.value=q.list,J.value=q.total,ie.value=!1}).catch(()=>{ie.value=!1})},N=()=>{aa().then(q=>{se.value=q})},ae=()=>{A.pageNo=1,S()},b=()=>{le.value&&le.value.resetFields(),ae()},v=q=>{q&&(Z.value=q)},j=q=>{q&&(Z.value=q,$("onSelected",Z.value),n.value=!1)},te=q=>{q&&(Z.value=q)},oe=()=>{if(k.value==null||k.value===0){ll({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}$("onSelected",Z.value),n.value=!1};return K({showFlag:n,getList:S}),(q,c)=>{const P=s("el-option"),me=s("el-select"),pe=s("el-form-item"),ne=s("el-col"),fe=s("el-input"),C=s("el-button"),_=s("el-row"),r=s("el-form"),ue=s("el-radio"),E=s("el-table-column"),R=s("el-color-picker"),de=s("el-table"),ee=Me,ve=s("el-dialog"),G=Ne("hasPermi"),ce=Ne("loading");return f(),y(ve,{title:"生产任务选择",modelValue:n.value,"onUpdate:modelValue":c[7]||(c[7]=i=>n.value=i),modal:!1,width:"90%",center:""},{footer:l(()=>[X("div",ta,[e(C,{size:T.value,type:"primary",onClick:oe},{default:l(()=>c[13]||(c[13]=[w("确 定")])),_:1},8,["size"]),e(C,{size:T.value,onClick:c[6]||(c[6]=i=>n.value=!1)},{default:l(()=>c[14]||(c[14]=[w("取 消")])),_:1},8,["size"])])]),default:l(()=>[x(e(r,{model:A,ref_key:"queryFormRef",ref:le,size:T.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(_,null,{default:l(()=>[e(ne,{span:7},{default:l(()=>[e(pe,{label:"所属工序",prop:"processName"},{default:l(()=>[e(me,{style:{width:"220px"},modelValue:A.processId,"onUpdate:modelValue":c[0]||(c[0]=i=>A.processId=i),placeholder:"请选择工序"},{default:l(()=>[(f(!0),Ue(Xe,null,Ze(se.value,i=>(f(),y(P,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:6},{default:l(()=>[e(pe,{label:"所属工作站",prop:"workstationCode"},{default:l(()=>[e(fe,{modelValue:A.workstationCode,"onUpdate:modelValue":c[1]||(c[1]=i=>A.workstationCode=i),placeholder:"请输入工作站编号",clearable:"",onKeyup:Q(ae,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:6},{default:l(()=>[e(pe,{label:"任务编号",prop:"taskCode"},{default:l(()=>[e(fe,{modelValue:A.taskCode,"onUpdate:modelValue":c[2]||(c[2]=i=>A.taskCode=i),placeholder:"请输入生产任务编号",clearable:"",onKeyup:Q(ae,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:5},{default:l(()=>[e(pe,null,{default:l(()=>[e(C,{type:"primary",icon:h(be),size:T.value,onClick:ae},{default:l(()=>c[8]||(c[8]=[w("搜索")])),_:1},8,["icon","size"]),e(C,{icon:h(Le),size:T.value,onClick:b},{default:l(()=>c[9]||(c[9]=[w("重置")])),_:1},8,["icon","size"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),[[ye,U.value]]),x((f(),y(de,{size:T.value,data:M.value,onCurrentChange:v,onRowDblclick:j},{default:l(()=>[e(E,{width:"55",align:"center"},{default:l(i=>[e(ue,{modelValue:k.value,"onUpdate:modelValue":c[3]||(c[3]=F=>k.value=F),label:i.row.id,onChange:F=>te(i.row)},{default:l(()=>c[10]||(c[10]=[w(_e(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(E,{label:"任务编号",align:"center",width:"100px",prop:"taskCode","show-overflow-tooltip":!0}),e(E,{label:"任务名称",align:"center",width:"120px",prop:"taskName","show-overflow-tooltip":!0}),e(E,{label:"工作站编号",align:"center",width:"150px",prop:"workstationCode","show-overflow-tooltip":!0}),e(E,{label:"工作站名称",align:"center",width:"150px",prop:"workstationName","show-overflow-tooltip":!0}),e(E,{label:"排产数量",align:"center",prop:"quantity"}),e(E,{label:"已生产数量",align:"center",width:"100px",prop:"quantityProduced"}),e(E,{label:"开始生产时间",align:"center",prop:"startTime",width:"180"},{default:l(i=>[X("span",null,_e(h(Re)(i.row.startTime,"YYYY-MM-DD HH")),1)]),_:1}),e(E,{label:"生产时长",align:"center",prop:"duration"}),e(E,{label:"预计完成时间",align:"center",prop:"endTime",width:"180"},{default:l(i=>[X("span",null,_e(h(Re)(i.row.endTime,"YYYY-MM-DD HH")),1)]),_:1}),e(E,{label:"显示颜色",align:"center",prop:"colorCode"},{default:l(i=>[e(R,{modelValue:i.row.colorCode,"onUpdate:modelValue":F=>i.row.colorCode=F,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(E,{label:"操作",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:l(i=>[x((f(),y(C,{size:T.value,type:"primary",link:"",onClick:F=>q.handleUpdate(i.row)},{default:l(()=>c[11]||(c[11]=[w("修改")])),_:2},1032,["size","onClick"])),[[G,["pro:protask:edit"]]]),x((f(),y(C,{size:T.value,type:"primary",link:"",onClick:F=>q.handleDelete(i.row)},{default:l(()=>c[12]||(c[12]=[w("删除")])),_:2},1032,["size","onClick"])),[[G,["pro:protask:remove"]]])]),_:1})]),_:1},8,["size","data"])),[[ce,ie.value]]),x(e(ee,{total:J.value,page:A.pageNo,"onUpdate:page":c[4]||(c[4]=i=>A.pageNo=i),limit:A.pageSize,"onUpdate:limit":c[5]||(c[5]=i=>A.pageSize=i),onPagination:S},null,8,["total","page","limit"]),[[ye,J.value>0]])]),_:1},8,["modelValue"])}}},oa=async g=>await W.get({url:"/mes/wms/material-stock/page",params:g}),na=async()=>await W.get({url:"/mes/md-item-type/treeselect"}),Al=async()=>await W.get({url:"/wms/warehouse/getTreeList"}).then(g=>(g.data=(g.data||[]).map(K=>(K.children&&(K.children=K.children.map(H=>(H.children&&(H.children=H.children.map(m=>({...m,pId:m.id,pName:m.areaName,lId:m.locationId,areaId:m.id}))),{...H,wId:H.warehouseId,pId:H.id,pName:H.locationName,locationId:H.id}))),{...K,wId:K.id,pId:K.id,pName:K.warehouseName,warehouseId:K.id})),g)),ua={class:"head-container"},da={class:"head-container"},ra={class:"dialog-footer"},ia=ql({name:"WmstockMultiSelect",__name:"multi",emits:["onSelected"],setup(g,{expose:K,emit:H}){const m=el(),$=Te(()=>m.currentSize==="mini"?"small":m.currentSize),L=d(!1),T=d(!0),n=d([]),k=d([]),Z=d(!0),ie=d(!0),U=d(!0),J=d(0),M=d([]),se=d([]),le=d(),A=d(),S=d(),N=Ce({pageNo:1,pageSize:10,itemTypeId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,vendorId:null,vendorCode:null,vendorName:null,vendorNick:null,quantityOnhand:null,expireDate:null,warehouse:null}),ae={children:"children",label:"label"},b=d([]),v={multiple:!1,value:"pId",label:"pName"},j=async()=>{T.value=!0;try{const _=await oa(N);se.value=_.list,J.value=_.total}finally{T.value=!1}},te=async()=>{const _=await na();M.value=_},oe=(_,r)=>_?r.label.indexOf(_)!==-1:!0,q=_=>{N.itemTypeId=_.id,c()},c=()=>{N.pageNo=1,j()},P=()=>{S.value?.resetFields(),c()},me=_=>{n.value=_.map(r=>r.materialStockId),Z.value=_.length!==1,ie.value=!_.length,k.value=_},pe=()=>{if(!k.value.length){ll({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}C("onSelected",k.value),L.value=!1},ne=async()=>{const _=await Al();b.value=_,b.value.map(r=>{r.pId=r.id,r.pName=r.warehouseName,r.children.map(E=>{let R=JSON.stringify(E.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");E.children=JSON.parse(R)});let ue=JSON.stringify(r.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");r.children=JSON.parse(ue)})},fe=_=>{_&&(N.warehouseId=_[0],N.locationId=_[1],N.areaId=_[2])},C=H;return Fe(()=>{j(),te(),ne()}),K({showFlag:L}),(_,r)=>{const ue=s("el-input"),E=s("el-tree"),R=s("el-col"),de=s("el-form-item"),ee=s("el-cascader"),ve=s("el-date-picker"),G=s("el-button"),ce=s("el-form"),i=s("right-toolbar"),F=s("el-row"),B=s("el-table-column"),Pe=s("el-table"),We=s("el-dialog"),$e=Ne("loading");return f(),y(We,{title:"物料选择",modelValue:L.value,"onUpdate:modelValue":r[12]||(r[12]=D=>L.value=D),modal:!1,width:"92%",center:""},{footer:l(()=>[X("div",ra,[e(G,{size:h($),type:"primary",onClick:pe},{default:l(()=>r[15]||(r[15]=[w("确 定")])),_:1},8,["size"]),e(G,{size:h($),onClick:r[11]||(r[11]=D=>L.value=!1)},{default:l(()=>r[16]||(r[16]=[w("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(F,{gutter:14},{default:l(()=>[e(R,{span:4,xs:24},{default:l(()=>[X("div",ua,[e(ue,{modelValue:le.value,"onUpdate:modelValue":r[0]||(r[0]=D=>le.value=D),placeholder:"请输入分类名称",clearable:"",":size":h($),"prefix-icon":h(be),style:{"margin-bottom":"20px"}},null,8,["modelValue",":size","prefix-icon"])]),X("div",da,[e(E,{data:M.value,props:ae,"expand-on-click-node":!1,"filter-node-method":oe,ref_key:"treeRef",ref:A,"default-expand-all":"",onNodeClick:q},null,8,["data"])])]),_:1}),e(R,{span:20,xs:24},{default:l(()=>[x(e(ce,{model:N,ref_key:"queryFormRef",ref:S,":size":h($),inline:!0},{default:l(()=>[e(de,{label:"产品物料编码",prop:"itemCode"},{default:l(()=>[e(ue,{modelValue:N.itemCode,"onUpdate:modelValue":r[1]||(r[1]=D=>N.itemCode=D),placeholder:"请输入产品物料编码",clearable:"",onKeyup:Q(c,["enter"])},null,8,["modelValue"])]),_:1}),e(de,{label:"产品物料名称",prop:"itemName"},{default:l(()=>[e(ue,{modelValue:N.itemName,"onUpdate:modelValue":r[2]||(r[2]=D=>N.itemName=D),placeholder:"请输入产品物料名称",clearable:"",onKeyup:Q(c,["enter"])},null,8,["modelValue"])]),_:1}),e(de,{label:"入库批次号",prop:"batchCode"},{default:l(()=>[e(ue,{modelValue:N.batchCode,"onUpdate:modelValue":r[3]||(r[3]=D=>N.batchCode=D),placeholder:"请输入入库批次号",clearable:"",onKeyup:Q(c,["enter"])},null,8,["modelValue"])]),_:1}),e(de,{label:"仓库信息",prop:"warehouse"},{default:l(()=>[e(ee,{modelValue:N.warehouse,"onUpdate:modelValue":r[4]||(r[4]=D=>N.warehouse=D),options:b.value,props:v,onChange:fe},null,8,["modelValue","options"])]),_:1}),e(de,{label:"供应商编号",prop:"vendorCode"},{default:l(()=>[e(ue,{modelValue:N.vendorCode,"onUpdate:modelValue":r[5]||(r[5]=D=>N.vendorCode=D),placeholder:"请输入供应商编号",clearable:"",onKeyup:Q(c,["enter"])},null,8,["modelValue"])]),_:1}),e(de,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[e(ue,{modelValue:N.vendorName,"onUpdate:modelValue":r[6]||(r[6]=D=>N.vendorName=D),placeholder:"请输入供应商名称",clearable:"",onKeyup:Q(c,["enter"])},null,8,["modelValue"])]),_:1}),e(de,{label:"库存有效期",prop:"expireDate"},{default:l(()=>[e(ve,{clearable:"",modelValue:N.expireDate,"onUpdate:modelValue":r[7]||(r[7]=D=>N.expireDate=D),type:"date","value-format":"timestamp",placeholder:"请选择库存有效期"},null,8,["modelValue"])]),_:1}),e(de,null,{default:l(()=>[e(G,{type:"primary",icon:h(be),":size":h($),onClick:c},{default:l(()=>r[13]||(r[13]=[w("搜索")])),_:1},8,["icon",":size"]),e(G,{icon:h(Le),":size":h($),onClick:P},{default:l(()=>r[14]||(r[14]=[w("重置")])),_:1},8,["icon",":size"])]),_:1})]),_:1},8,["model",":size"]),[[ye,U.value]]),e(F,{gutter:10,class:"mb8"},{default:l(()=>[e(i,{showSearch:U.value,"onUpdate:showSearch":r[8]||(r[8]=D=>U.value=D),onQueryTable:j},null,8,["showSearch"])]),_:1}),x((f(),y(Pe,{size:h($),data:se.value,onSelectionChange:me},{default:l(()=>[e(B,{type:"selection",width:"55",align:"center"}),e(B,{label:"产品物料编码",width:"120px",align:"center",prop:"itemCode"}),e(B,{label:"产品物料名称",width:"150px",align:"center",prop:"itemName","show-overflow-tooltip":!0}),e(B,{label:"规格型号",align:"center",prop:"specification","show-overflow-tooltip":!0}),e(B,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(B,{label:"入库批次号",width:"100px",align:"center",prop:"batchCode","show-overflow-tooltip":!0}),e(B,{label:"仓库",align:"center",prop:"warehouseName"}),e(B,{label:"库区",align:"center",prop:"locationName"}),e(B,{label:"库位",align:"center",prop:"areaName"}),e(B,{label:"供应商编号",width:"100px",align:"center",prop:"vendorCode"}),e(B,{label:"供应商名称",width:"120px",align:"center",prop:"vendorName","show-overflow-tooltip":!0}),e(B,{label:"供应商简称",width:"100px",align:"center",prop:"vendorNick"}),e(B,{label:"在库数量",align:"center",prop:"quantityOnhand"}),e(B,{label:"库存有效期",align:"center",prop:"expireDate",width:"180"},{default:l(D=>[X("span",null,_e(h(Re)(D.row.expireDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["size","data"])),[[$e,T.value]]),x(e(Me,{total:J.value,page:N.pageNo,"onUpdate:page":r[9]||(r[9]=D=>N.pageNo=D),limit:N.pageSize,"onUpdate:limit":r[10]||(r[10]=D=>N.pageSize=D),onPagination:j},null,8,["total","page","limit"]),[[ye,J.value>0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),sa=al(ia,[["__scopeId","data-v-82c195e3"]]),pa=async g=>await W.get({url:"/mes/pro/workorder/page",params:g}),ca={class:"dialog-footer"},ma=ql({name:"WorkOrderSelectSingle",__name:"single",emits:["onSelected"],setup(g,{expose:K,emit:H}){const m=d(!1),$=d(!0),L=d(),T=d([]);d(!0),d(!0);const n=d(!0),k=d(0),Z=d([]),ie=d(),U=Ce({pageNo:1,pageSize:10,workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:"CONFIRMED"}),J=async()=>{$.value=!0;try{const b=await pa(U);Z.value=b.list,k.value=b.total}finally{$.value=!1}},M=()=>{J()},se=()=>{ie.value?.resetFields(),M()},le=b=>{b&&(T.value=b)},A=b=>{b&&(T.value=b)},S=b=>{b&&(T.value=b,ae("onSelected",T.value),m.value=!1)},N=()=>{if(!L.value){ll({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}ae("onSelected",T.value),m.value=!1},ae=H;return Fe(()=>{J()}),K({showFlag:m}),(b,v)=>{const j=s("el-input"),te=s("el-form-item"),oe=s("el-button"),q=s("el-form"),c=s("el-radio"),P=s("el-table-column"),me=El,pe=s("el-table"),ne=s("el-dialog"),fe=Ne("loading");return f(),y(ne,{title:"工单选择",modelValue:m.value,"onUpdate:modelValue":v[9]||(v[9]=C=>m.value=C),modal:!1,width:"90%",center:""},{footer:l(()=>[X("div",ca,[e(oe,{type:"primary",onClick:N},{default:l(()=>v[13]||(v[13]=[w("确 定")])),_:1}),e(oe,{onClick:v[8]||(v[8]=C=>m.value=!1)},{default:l(()=>v[14]||(v[14]=[w("取 消")])),_:1})])]),default:l(()=>[x(e(q,{model:U,ref_key:"queryFormRef",ref:ie,size:"small",inline:!0,"label-width":"68px"},{default:l(()=>[e(te,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(j,{modelValue:U.workorderCode,"onUpdate:modelValue":v[0]||(v[0]=C=>U.workorderCode=C),placeholder:"请输入工单编码",clearable:"",onKeyup:Q(M,["enter"])},null,8,["modelValue"])]),_:1}),e(te,{label:"工单名称",prop:"workorderName"},{default:l(()=>[e(j,{modelValue:U.workorderName,"onUpdate:modelValue":v[1]||(v[1]=C=>U.workorderName=C),placeholder:"请输入工单名称",clearable:"",onKeyup:Q(M,["enter"])},null,8,["modelValue"])]),_:1}),e(te,{label:"产品编号",prop:"productCode"},{default:l(()=>[e(j,{modelValue:U.productCode,"onUpdate:modelValue":v[2]||(v[2]=C=>U.productCode=C),placeholder:"请输入产品编号",clearable:"",onKeyup:Q(M,["enter"])},null,8,["modelValue"])]),_:1}),e(te,{label:"产品名称",prop:"productName"},{default:l(()=>[e(j,{modelValue:U.productName,"onUpdate:modelValue":v[3]||(v[3]=C=>U.productName=C),placeholder:"请输入产品名称",clearable:"",onKeyup:Q(M,["enter"])},null,8,["modelValue"])]),_:1}),e(te,{label:"客户名称",prop:"clientName"},{default:l(()=>[e(j,{modelValue:U.clientName,"onUpdate:modelValue":v[4]||(v[4]=C=>U.clientName=C),placeholder:"请输入客户名称",clearable:"",onKeyup:Q(M,["enter"])},null,8,["modelValue"])]),_:1}),e(te,null,{default:l(()=>[e(oe,{type:"primary",icon:h(be),size:"small",onClick:M},{default:l(()=>v[10]||(v[10]=[w("搜索")])),_:1},8,["icon"]),e(oe,{icon:h(Le),size:"small",onClick:se},{default:l(()=>v[11]||(v[11]=[w("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),[[ye,n.value]]),x((f(),y(pe,{data:Z.value,onCurrentChange:le,onRowDblclick:S},{default:l(()=>[e(P,{width:"55",align:"center"},{default:l(C=>[e(c,{modelValue:L.value,"onUpdate:modelValue":v[5]||(v[5]=_=>L.value=_),label:C.row.id,onChange:_=>A(C.row)},{default:l(()=>v[12]||(v[12]=[w(_e(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(P,{label:"工单编码",width:"180",prop:"workorderCode"}),e(P,{label:"工单名称",width:"200",align:"center",prop:"workorderName","show-overflow-tooltip":!0}),e(P,{label:"工单来源",align:"center",prop:"orderSource"},{default:l(C=>[e(me,{type:h(Oe).MES_WORKORDER_SOURCETYPE,value:C.row.orderSource},null,8,["type","value"])]),_:1}),e(P,{label:"订单编号",width:"140",align:"center",prop:"sourceCode"}),e(P,{label:"产品编号",width:"120",align:"center",prop:"productCode"}),e(P,{label:"产品名称",width:"200",align:"center",prop:"productName","show-overflow-tooltip":!0}),e(P,{label:"规格型号",align:"center",prop:"productSpc","show-overflow-tooltip":!0}),e(P,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(P,{label:"工单数量",align:"center",prop:"quantity"}),e(P,{label:"客户编码",align:"center",prop:"clientCode"}),e(P,{label:"客户名称",align:"center",prop:"clientName","show-overflow-tooltip":!0}),e(P,{label:"需求日期",align:"center",prop:"requestDate",width:"180"},{default:l(C=>[X("span",null,_e(h(Re)(C.row.requestDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["data"])),[[fe,$.value]]),x(e(Me,{total:k.value,page:U.pageNo,"onUpdate:page":v[6]||(v[6]=C=>U.pageNo=C),limit:U.pageSize,"onUpdate:limit":v[7]||(v[7]=C=>U.pageSize=C),onPagination:J},null,8,["total","page","limit"]),[[ye,k.value>0]])]),_:1},8,["modelValue"])}}}),fa=al(ma,[["__scopeId","data-v-295159c0"]]),va=async g=>await W.post({url:"/wms/allocated-header/create",data:g}),ga=async g=>await W.put({url:"/wms/allocated-header/update",data:g}),wa=async g=>await W.delete({url:`/wms/allocated-header/delete?id=${g}`}),Rl=async g=>await W.get({url:`/wms/allocated-header/get?id=${g}`}),ka=async g=>await W.get({url:"/wms/allocated-header/page",params:g}),ba=async g=>await W.download({url:"/wms/allocated-header/export-excel",params:g}),Ca=async g=>await W.post({url:"/wms/allocated-header/initBom",data:g}),_a=async g=>await W.put({url:`/wms/allocated-header/${g}`}),ya=async g=>await W.get({url:`/wms/allocated-header/finsh?id=${g}`}),ha=async g=>await W.post({url:"/wms/allocated-line/updateLine",data:g}),Na=async g=>await W.get({url:`/wms/allocated-header/createIssue?id=${g}`}),Ia=async g=>await W.get({url:`/mes/autocode/get/${g}`}),Va=async g=>await W.get({url:`/wms/allocated-record/getByHeaderId?id=${g}`}),Sa={class:"app-container"},za={key:0},xa={class:"dialog-footer"},Da={class:"dialog-footer"},Ua={__name:"allocation",setup(g,{expose:K}){const H=el(),m=Te(()=>H.currentSize==="mini"?"small":H.currentSize),$=d(null),L=d(null),T=jl(),n=d({id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),k=d({bindWorkorder:!1,status:"",allocatedDate:null,workorderCode:"",taskCode:"",clientCode:"",remark:"",workorderId:null,taskId:null}),Z=d(null),ie=d(500),U=d(null),J=d(null),M=d(null),se=d(null),le=d(!1),A=d(void 0),S=d([]),N=d([]),ae=Ce({multiple:!1,value:"pId",label:"pName"}),b=d(!0),v=d(!1),j=d([]),te=d([]),oe=d(!0),q=d(!0),c=d(!0),P=d(!0),me=d(!1),pe=d(!0),ne=d(0),fe=d([]),C=d(""),_=d(!1),r=Ce({pageNo:1,pageSize:20,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:[],status:null,remark:null,createTime:[],bindWorkorder:null}),ue=d(null),E=d([]),R=d([]),de=Ce({allocatedCode:[{required:!0,message:"调拨单编号不能为空",trigger:"blur"}],warehouseId:[{required:!0,message:"请指定调入仓库",trigger:"blur"}],locationId:[{required:!0,message:"请指定调入库区",trigger:"blur"}],areaId:[{required:!0,message:"请指定调入库位",trigger:"blur"}],workorderCode:[],taskCode:[]}),ee=d(!1),ve=d(!1),G=d(null),ce=d(null),i=Ce({}),F=d(null),B=Te(()=>A.value==="edit");Fe(()=>{ge(),Ml(),window.addEventListener("keydown",tl),document.addEventListener("click",D),Se(()=>{setTimeout(()=>{G.value&&G.value.focus()},1e3)}),window.addEventListener("resize",qe),qe()}),Ql(()=>{$e(),window.removeEventListener("resize",qe)}),Ge(()=>T.path,()=>{Se(()=>{qe()})}),Ge(()=>ee.value,t=>{t?Se(()=>{ze()}):F.value=null});const Pe=t=>{t?n.value.allocatedDate=new Date(t).getTime():t===null&&(n.value.allocatedDate=null)},We=t=>{t?k.value.allocatedDate=new Date(t).getTime():t===null&&(k.value.allocatedDate=null)},$e=()=>{window.removeEventListener("keydown",tl,!1),document.removeEventListener("click",D)},D=()=>{ee.value&&G.value&&ze()},tl=t=>{if(t.keyCode===13){if(!t.target.value)return;ce.value=t.target.value;var u=ce.value;if(typeof u=="string"&&u.includes("{")&&u.includes("}")){let p="";u=u.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),console.log(u,"newVal 111"),u=u.replace(/\uFEFF/g,"");try{u=Ll(u);const Y=JSON.parse(u);Y&&(F.value=Y.id,ce.value=null,p=Y.type,ze()),Ke(p)}catch{console.log('输入内容不包含完整的 "{" 和 "}"')}}else if(typeof u=="object"&&u.id){let p="";F.value=u.id,p=u.type,ce.value=null,ze(),Ke(p)}else console.log('输入内容不包含完整的 "{" 和 "}"')}},qe=()=>{Se(()=>{if(!Z.value)return;const t=window.innerHeight,a=Z.value.getBoundingClientRect().top,p=t-a-100;ie.value=Math.max(300,p)})},Ol=()=>{F.value=null,ce.value=null,ze()},Tl=t=>{j.value=t.map(a=>a.id),oe.value=t.length!==1,c.value=!t.length},Fl=t=>{ue.value?.toggleRowSelection(t)};function Ll(t){let a=0,u=!1,p=!1;for(let Y=0;Y<t.length;Y++){const I=t[Y];if(p){p=!1;continue}if(I==="\\"){p=!0;continue}if(I==='"'&&(u=!u),!u){if(I==="{")a++;else if(I==="}"&&(a--,a===0)){const Ie=t.slice(0,Y+1);try{return Ie}catch{throw new Error("Invalid JSON object")}}}}throw new Error("No valid JSON object found")}const ze=()=>{ee.value&&G.value&&Se(()=>{setTimeout(()=>{G.value&&G.value.focus()},300)})},ge=()=>{b.value=!0,ka(r).then(t=>{fe.value=t.list,ne.value=t.total,b.value=!1})},Ml=()=>{Al().then(t=>{N.value=t,N.value.map(a=>{a.pId=a.id,a.pName=a.warehouseName,a.children.map(u=>{u.pId=u.id,u.pName=u.locationName,u.children.map(p=>{p.pId=p.id,p.pName=p.areaName})})})})},Ye=()=>{_.value=!1,E.value=[],R.value=[],ee.value=!1,Ee()},Ee=()=>{Object.assign(n.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bomList:[]}),Object.assign(k.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),Object.keys(i).forEach(t=>{delete i[t]}),le.value=!1,E.value=[],S.value=[],L.value&&L.value.resetFields(),U.value&&U.value.resetFields()},he=()=>{r.pageNo=1,ge()},ol=()=>{$.value&&$.value.resetFields(),he()},nl=()=>{Ee(),_.value=!0,C.value="添加调拨单",A.value="add",S.value=[]},ul=t=>{Ee();const a=t.id;Rl(a).then(u=>{Object.assign(n.value,u),n.value.bindWorkorder=n.value.bindWorkorder==="true",S.value=[u.warehouseId,u.locationId,u.areaId],E.value=u.bomList,R.value=[],_.value=!0,C.value="修改调拨单",A.value="edit"})},dl=()=>{L.value.validate(t=>{if(t){if(n.value.bindWorkorder||(n.value.bindWorkorder=!1),n.value.warehouseId==null||n.value.locationId==null||n.value.areaId==null){O.error("请选择调拨仓库、库区、库位信息！");return}if(R.value.length===0&&n.value.bindWorkorder===!0){O.error("请选择需要调拨的BOM信息");return}if(n.value.bomList=R.value.map(a=>({...a,quantityAllocated:parseFloat(a.quantityAllocated)})),n.value.id!=null){ga(n.value).then(a=>{O.success("修改成功"),_.value=!1,ge()});return}n.value.bomList=R.value,va(n.value).then(a=>{O.success("新增成功"),_.value=!1,ge()})}})},rl=t=>{const a=t.id;Je.confirm('是否确认删除调拨单头编号为"'+a+'"的数据项?').then(()=>wa(a)).then(()=>{ge(),O.success("删除成功")}).catch(()=>{})},il=()=>{let t={...r};t.pageNo=void 0,t.pageSize=void 0,Je.confirm("是否确认导出所有调拨单头数据项?").then(()=>(me.value=!0,ba(t))).then(a=>{Zl.excel(a,"调拨单头.xls"),O.success("导出成功"),me.value=!1}).catch(()=>{})},He=t=>{t!==null?(n.value.warehouseId=t[0],n.value.locationId=t[1],n.value.areaId=t[2]):(n.value.warehouseId=null,n.value.locationId=null,n.value.areaId=null)},Be=()=>{J.value?J.value.showFlag=!0:O.warning("工单选择组件未加载完成，请稍后再试")},Pl=t=>{t!=null&&t!=null&&(n.value.workorderId=t.id,n.value.workorderCode=t.workorderCode,n.value.workorderName=t.workorderName,n.value.clientId=t.clientId,n.value.clientCode=t.clientCode,n.value.clientName=t.clientName),v.value=!0,Ca(n.value.workorderCode).then(a=>{E.value=a,v.value=!1})},sl=t=>{t?(b.value=!0,Ia("ALLOCATED_CODE").then(a=>{n.value.allocatedCode=a,b.value=!1})):n.value.allocatedCode=null},pl=t=>{Ee();const a=t.id||j.value;b.value=!0,ya(a).then(u=>{O.success("成功"),_.value=!1,b.value=!1,ge()}).catch(()=>{b.value=!1,ge()})},cl=t=>{R.value=t.map(a=>({...a}))},ml=t=>{fl(t.id,!1)},Wl=t=>{fl(t.id,!0)},fl=(t,a)=>{i.id=t,Se(()=>{U.value&&U.value.resetFields()}),Rl(t).then(u=>{Object.assign(i,u),i.bindWorkorder=i.bindWorkorder==="true",S.value=[u.warehouseId,u.locationId,u.areaId],S.value[0]=u.warehouseId,S.value[1]=u.locationId,S.value[2]=u.areaId,E.value=u.bomList}),Va(t).then(u=>{R.value=u}),ve.value=a,ee.value=!0},vl=()=>{if(!F.value){O.error("请扫描正确的单据信息!");return}Ke()},gl=()=>{se.value?(se.value.showFlag=!0,se.value.getList()):O.warning("库存选择组件未加载完成，请稍后再试")},wl=()=>{const t=te.value;R.value=R.value.filter(a=>!t.includes(a.id))},kl=t=>{te.value=t.map(a=>a.id),q.value=t.length!==1,P.value=!t.length},Ke=t=>{let a="";if(t&&(a=t),!S.value||!Array.isArray(S.value)||S.value.length<3||!S.value[0]||!S.value[1]||!S.value[2]){O.error("请选择调拨仓库、库区、库位信息！");return}if(!F.value){O.error("请输入或扫描单据信息!");return}const u=parseInt(F.value);if(isNaN(u)){O.error("单据ID格式不正确，请重新输入或扫描!");return}let p={id:u,type:a,method:"allocated",warehouseId:S.value[0],locationId:S.value[1],areaId:S.value[2]};b.value=!0,ea(p).then(Y=>{b.value=!1;let I=Y;I.quantityAllocated=I.quantityOnhand,R.value.some(V=>V.itemCode===I.itemCode&&V.batchCode===I.batchCode)?O.error("物料唯一码已存在，请勿添加重复项。"):(O.success("新增成功"),R.value.push(I))})},bl=async()=>{let t={headerId:i.id,bomList:R.value};b.value=!0;try{await ha(t),await _a(i.id),b.value=!1,ge(),O.success("出库成功"),ee.value=!1}catch{O.error("操作失败"),b.value=!1}},Cl=t=>{const a=parseFloat(t.quantityAllocated);if(isNaN(a)||a<=0){O.error("调拨数量必须为大于0的正数"),t.quantityAllocated="";return}const u=R.value.findIndex(p=>p.itemCode===t.itemCode);u!==-1&&(R.value[u]={...R.value[u],quantityAllocated:a})},je=()=>{M.value?(M.value.showFlag=!0,M.value.getList()):O.warning("任务选择组件未加载完成，请稍后再试")},$l=t=>{t!=null&&t!=null&&(n.value.taskId=t.id,n.value.taskCode=t.taskCode,n.value.taskName=t.taskName,n.value.workstationId=t.workstationId,n.value.workstationCode=t.workstationCode,n.value.workstationName=t.workstationName,n.value.processId=t.processId,n.value.processCode=t.processCode,n.value.processName=t.processName)},Yl=t=>{t!=null&&t!=null&&(i.taskId=t.id,i.taskCode=t.taskCode,i.taskName=t.taskName,i.workstationId=t.workstationId,i.workstationCode=t.workstationCode,i.workstationName=t.workstationName,i.processId=t.processId,i.processCode=t.processCode,i.processName=t.processName)},Hl=t=>{if(t!=null&&t!=null)for(let a=0;a<t.length;a++){let u=t[a];u.quantityAllocated=u.quantityOnhand,R.value.some(Y=>Y.itemCode===u.itemCode&&Y.batchCode===u.batchCode)?O.error("物料唯一码已存在，请勿添加重复项。"):R.value.push(u)}},_l=t=>{n.value.bindWorkorder=t,L.value&&L.value.validate()},yl=()=>{Je.confirm("确认生成领料单吗?").then(()=>{b.value=!0;const t=j.value;Na(t).then(()=>{b.value=!1,ge(),O.success("领料单创建成功"),ee.value=!1}).catch(a=>{O.error("领料单创建失败"),b.value=!1})}).catch(()=>{O.info("已取消")})};return K({queryParams:r,showSearch:pe,loading:b,list:fe,total:ne,single:oe,multiple:c,exportLoading:me,handleQuery:he,resetQuery:ol,handleAdd:nl,handleUpdate:ul,handleDelete:rl,handleExport:il,handleFinsh:pl,handleIssue:yl,handleExecute:ml,form:n,rules:de,autoGenFlag:le,optType:A,warehouseInfo:S,warehouseOptions:N,warehouseProps:ae,bomList:E,allocatedList:R,bomLoadding:v,open:_,title:C,isEdit:B,handleAutoGenChange:sl,handleWarehouseChanged:He,handleWorkorderSelect:Be,handleTaskSelect:je,handleBindWorkorderChange:_l,handleBomSelectionChange:cl,handleQuantityChange:Cl,submitForm:dl,cancel:Ye,executeDialogVisible:ee,executeForm:i,purchaseId:F,allocatedSingle:q,allocatedHandleAdd:vl,allocatedHandleBatchAdd:gl,allocatedHandleDelete:wl,allocatedHandleSelectionChange:kl,executeAllocated:bl}),(t,a)=>{const u=s("el-input"),p=s("el-form-item"),Y=s("el-date-picker"),I=s("el-button"),Ie=s("el-form"),V=s("el-col"),we=s("el-row"),z=s("el-table-column"),Bl=El,xe=s("el-table"),Kl=Me,hl=s("el-switch"),Nl=s("el-cascader"),Il=s("el-option"),Vl=s("el-select"),Ae=s("el-divider"),Sl=s("el-card"),zl=s("el-dialog"),ke=Ne("hasPermi"),De=Ne("loading"),xl=Ne("dialogDrag");return f(),Ue("div",Sa,[x(e(Ie,{model:r,ref_key:"queryForm",ref:$,size:m.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(p,{label:"调拨单号",prop:"allocatedCode"},{default:l(()=>[e(u,{modelValue:r.allocatedCode,"onUpdate:modelValue":a[0]||(a[0]=o=>r.allocatedCode=o),placeholder:"请输入调拨单编号",clearable:"",onKeyup:Q(he,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(u,{modelValue:r.allocatedName,"onUpdate:modelValue":a[1]||(a[1]=o=>r.allocatedName=o),placeholder:"请输入调拨单名称",clearable:"",onKeyup:Q(he,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(u,{modelValue:r.workorderCode,"onUpdate:modelValue":a[2]||(a[2]=o=>r.workorderCode=o),placeholder:"请输入生产工单编码",clearable:"",onKeyup:Q(he,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"仓库名称",prop:"warehouseName"},{default:l(()=>[e(u,{modelValue:r.warehouseName,"onUpdate:modelValue":a[3]||(a[3]=o=>r.warehouseName=o),placeholder:"请输入仓库名称",clearable:"",onKeyup:Q(he,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(Y,{modelValue:r.allocatedDate,"onUpdate:modelValue":a[4]||(a[4]=o=>r.allocatedDate=o),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),e(p,null,{default:l(()=>[e(I,{type:"primary",icon:h(be),onClick:he},{default:l(()=>a[30]||(a[30]=[w("搜索")])),_:1},8,["icon"]),e(I,{icon:h(Le),onClick:ol},{default:l(()=>a[31]||(a[31]=[w("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[ye,pe.value]]),e(we,{gutter:10,class:"mb8"},{default:l(()=>[e(V,{span:1.5},{default:l(()=>[x((f(),y(I,{type:"primary",icon:h(Qe),size:m.value,onClick:nl},{default:l(()=>a[32]||(a[32]=[w("新增 ")])),_:1},8,["icon","size"])),[[ke,["wms:allocated-header:create"]]])]),_:1}),e(V,{span:1.5},{default:l(()=>[x((f(),y(I,{type:"warning",plain:"",icon:h(Jl),size:m.value,onClick:il,loading:me.value},{default:l(()=>a[33]||(a[33]=[w("导出 ")])),_:1},8,["icon","size","loading"])),[[ke,["wms:allocated-header:export"]]])]),_:1}),e(V,{span:1.5},{default:l(()=>[x((f(),y(I,{type:"success",plain:"",icon:h(Dl),size:m.value,onClick:pl,disabled:oe.value},{default:l(()=>a[34]||(a[34]=[w("完成 ")])),_:1},8,["icon","size","disabled"])),[[ke,["wms:allocated-header:finsh"]]])]),_:1}),e(V,{span:1.5},{default:l(()=>[x((f(),y(I,{plain:"",icon:h(Dl),size:m.value,onClick:yl,disabled:oe.value},{default:l(()=>a[35]||(a[35]=[w("生成领料单 ")])),_:1},8,["icon","size","disabled"])),[[ke,["wms:allocated-header:createIssue"]]])]),_:1})]),_:1}),X("div",{class:"table-container",ref_key:"tableContainerRef",ref:Z},[x((f(),y(xe,{ref_key:"multipleTableRef",ref:ue,height:ie.value,data:fe.value,size:m.value,class:"touch-scroll-table",onSelectionChange:Tl,onRowClick:Fl},{default:l(()=>[ve.value?re("",!0):(f(),y(z,{key:0,type:"selection",width:"55",align:"center"})),e(z,{label:"调拨单编号",align:"center",prop:"allocatedCode"}),e(z,{label:"调拨单名称",align:"center",prop:"allocatedName"}),e(z,{label:"生产工单",align:"center",prop:"workorderCode"}),e(z,{label:"调拨日期",align:"center",prop:"allocatedDate"},{default:l(o=>[X("span",null,_e(h(Re)(o.row.allocatedDate,"YYYY-MM-DD")),1)]),_:1}),e(z,{label:"单据状态",align:"center",prop:"status"},{default:l(o=>[e(Bl,{type:h(Oe).MES_ALLOCATED_STATUS,value:o.row.status},null,8,["type","value"])]),_:1}),e(z,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[o.row.status!="FINISHED"?x((f(),y(I,{key:0,size:m.value,type:"text",onClick:Ve=>ml(o.row)},{default:l(()=>a[36]||(a[36]=[w("执行领出")])),_:2},1032,["size","onClick"])),[[ke,["wms:allocated-header:allocated"]]]):re("",!0),x((f(),y(I,{size:m.value,type:"text",onClick:Ve=>ul(o.row)},{default:l(()=>a[37]||(a[37]=[w("修改 ")])),_:2},1032,["size","onClick"])),[[ke,["wms:allocated-header:update"]]]),x((f(),y(I,{size:m.value,type:"text",onClick:Ve=>rl(o.row)},{default:l(()=>a[38]||(a[38]=[w("删除 ")])),_:2},1032,["size","onClick"])),[[ke,["wms:allocated-header:delete"]]]),x((f(),y(I,{size:m.value,type:"text",onClick:Ve=>Wl(o.row)},{default:l(()=>a[39]||(a[39]=[w("详情")])),_:2},1032,["size","onClick"])),[[ke,["wms:allocated-header:allocated"]]])]),_:1})]),_:1},8,["height","data","size"])),[[De,b.value]]),x(e(Kl,{total:ne.value,page:r.pageNo,"onUpdate:page":a[5]||(a[5]=o=>r.pageNo=o),limit:r.pageSize,"onUpdate:limit":a[6]||(a[6]=o=>r.pageSize=o),onPagination:ge},null,8,["total","page","limit"]),[[ye,ne.value>0]])],512),x((f(),y(zl,{title:C.value,modelValue:_.value,"onUpdate:modelValue":a[17]||(a[17]=o=>_.value=o),width:"90%","append-to-body":""},{footer:l(()=>[X("div",xa,[e(I,{size:m.value,type:"primary",onClick:dl},{default:l(()=>a[42]||(a[42]=[w("确 定")])),_:1},8,["size"]),e(I,{size:m.value,onClick:Ye},{default:l(()=>a[43]||(a[43]=[w("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(Ie,{ref_key:"formRef",ref:L,size:m.value,model:n.value,rules:de},{default:l(()=>[e(we,null,{default:l(()=>[e(V,{span:8},{default:l(()=>[e(p,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(u,{disabled:B.value,modelValue:n.value.allocatedCode,"onUpdate:modelValue":a[7]||(a[7]=o=>n.value.allocatedCode=o),placeholder:"请输入调拨单编号"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(V,{span:4},{default:l(()=>[e(p,null,{default:l(()=>[A.value!="view"&&n.value.status=="PREPARE"?(f(),y(hl,{key:0,modelValue:le.value,"onUpdate:modelValue":a[8]||(a[8]=o=>le.value=o),"active-color":"#13ce66","active-text":"自动生成",onChange:sl},null,8,["modelValue"])):re("",!0)]),_:1})]),_:1}),e(V,{span:12},{default:l(()=>[e(p,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(u,{disabled:"",modelValue:n.value.allocatedName,"onUpdate:modelValue":a[9]||(a[9]=o=>n.value.allocatedName=o),placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(we,null,{default:l(()=>[e(V,{span:8},{default:l(()=>[e(p,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(Y,{clearable:"",modelValue:n.value.allocatedDate,"onUpdate:modelValue":a[10]||(a[10]=o=>n.value.allocatedDate=o),type:"date",onChange:Pe,placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:8},{default:l(()=>[e(p,{label:"领料仓库"},{default:l(()=>[e(Nl,{modelValue:S.value,"onUpdate:modelValue":a[11]||(a[11]=o=>S.value=o),options:N.value,props:ae,placeholder:"请选择",onChange:He},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(V,{span:8},{default:l(()=>[e(p,{label:"单据状态",prop:"status"},{default:l(()=>[e(Vl,{modelValue:n.value.status,"onUpdate:modelValue":a[12]||(a[12]=o=>n.value.status=o),disabled:""},{default:l(()=>[(f(!0),Ue(Xe,null,Ze(h(Oe).MES_ALLOCATED_STATUS,o=>(f(),y(Il,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(we,null,{default:l(()=>[e(V,{span:2}),e(V,{span:6},{default:l(()=>[e(p,{"label-width":"80"},{default:l(()=>[A.value!="view"&&n.value.status=="PREPARE"?(f(),y(hl,{key:0,style:{"margin-left":"10%"},modelValue:n.value.bindWorkorder,"onUpdate:modelValue":a[13]||(a[13]=o=>n.value.bindWorkorder=o),"active-color":"#13ce66","inactive-text":"绑定工单",onChange:_l},null,8,["modelValue"])):re("",!0)]),_:1})]),_:1}),n.value&&n.value.bindWorkorder?(f(),y(V,{key:0,span:8},{default:l(()=>[e(p,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(u,{modelValue:n.value.workorderCode,"onUpdate:modelValue":a[14]||(a[14]=o=>n.value.workorderCode=o),placeholder:"请选择生产工单"},{append:l(()=>[e(I,{icon:h(be),onClick:Be},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(fa,{ref_key:"woSelectRef",ref:J,onOnSelected:Pl},null,512)]),_:1})):re("",!0),n.value&&n.value.bindWorkorder?(f(),y(V,{key:1,span:8},{default:l(()=>[e(p,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(u,{modelValue:n.value.taskCode,"onUpdate:modelValue":a[15]||(a[15]=o=>n.value.taskCode=o),placeholder:"请选择生产任务"},{append:l(()=>[e(I,{icon:h(be),onClick:je},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Ul,{ref_key:"taskSelectRef",ref:M,workorderId:n.value.workorderId,onOnSelected:$l},null,8,["workorderId"])]),_:1})):re("",!0)]),_:1}),e(we,null,{default:l(()=>[e(V,{span:24},{default:l(()=>[e(p,{label:"备注",prop:"remark"},{default:l(()=>[e(u,{modelValue:n.value.remark,"onUpdate:modelValue":a[16]||(a[16]=o=>n.value.remark=o),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"]),n.value&&n.value.bindWorkorder?(f(),Ue("div",za,[e(Ae,{"content-position":"center"},{default:l(()=>a[40]||(a[40]=[w("物料信息")])),_:1}),e(Sl,{shadow:"always",class:"box-card"},{default:l(()=>[x((f(),y(xe,{size:m.value,"max-height":"300",data:E.value,onSelectionChange:cl},{default:l(()=>[e(z,{type:"selection",width:"65",align:"center"}),e(z,{label:"物料编码",align:"center",prop:"itemCode"}),e(z,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(z,{width:"210",label:"需求数量",align:"center",prop:"quantityAllocated"}),e(z,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[De,v.value]])]),_:1}),e(Ae,{"content-position":"center"},{default:l(()=>a[41]||(a[41]=[w("调拨信息")])),_:1}),e(Sl,{shadow:"always",class:"box-card"},{default:l(()=>[x((f(),y(xe,{size:m.value,"max-height":"300",data:R.value,"row-key":"itemCode"},{default:l(()=>[e(z,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(z,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(z,{width:"220",label:"调拨数量",align:"center",prop:"quantityAllocated"},{default:l(o=>[e(u,{modelValue:o.row.quantityAllocated,"onUpdate:modelValue":Ve=>o.row.quantityAllocated=Ve,type:"number",placeholder:"请输入数量",onBlur:Ve=>Cl(o.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(z,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[De,v.value]])]),_:1})])):re("",!0)]),_:1},8,["title","modelValue"])),[[xl]]),x((f(),y(zl,{title:ve.value?"详情":"执行出库",class:"execute-dialog",modelValue:ee.value,"onUpdate:modelValue":a[29]||(a[29]=o=>ee.value=o),width:"92%","append-to-body":""},{footer:l(()=>[X("span",Da,[e(I,{size:m.value,onClick:Ye},{default:l(()=>a[51]||(a[51]=[w("取 消")])),_:1},8,["size"]),ve.value?re("",!0):(f(),y(I,{key:0,size:m.value,type:"primary",onClick:bl},{default:l(()=>a[52]||(a[52]=[w("确 定")])),_:1},8,["size"]))])]),default:l(()=>[e(Ie,{size:m.value,ref_key:"executeFormRef",ref:U,model:k.value,"label-width":"100px"},{default:l(()=>[e(we,null,{default:l(()=>[e(V,{span:8},{default:l(()=>[e(p,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(u,{modelValue:k.value.allocatedCode,"onUpdate:modelValue":a[18]||(a[18]=o=>k.value.allocatedCode=o),disabled:"",placeholder:"请输入调拨单编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:l(()=>[e(p,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(u,{modelValue:k.value.allocatedName,"onUpdate:modelValue":a[19]||(a[19]=o=>k.value.allocatedName=o),disabled:"",placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(we,null,{default:l(()=>[e(V,{span:8},{default:l(()=>[e(p,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(Y,{clearable:"",modelValue:k.value.allocatedDate,"onUpdate:modelValue":a[20]||(a[20]=o=>k.value.allocatedDate=o),disabled:"",type:"date",onChange:We,placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:8},{default:l(()=>[e(p,{label:"领料仓库"},{default:l(()=>[e(Nl,{disabled:"",modelValue:S.value,"onUpdate:modelValue":a[21]||(a[21]=o=>S.value=o),options:N.value,props:ae,onChange:He},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(V,{span:8},{default:l(()=>[e(p,{label:"单据状态",prop:"status"},{default:l(()=>[e(Vl,{disabled:"",modelValue:k.value.status,"onUpdate:modelValue":a[22]||(a[22]=o=>k.value.status=o)},{default:l(()=>[(f(!0),Ue(Xe,null,Ze(h(Oe).MES_ALLOCATED_STATUS,o=>(f(),y(Il,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),k.value.bindWorkorder?(f(),y(we,{key:0},{default:l(()=>[e(V,{span:8},{default:l(()=>[e(p,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(u,{disabled:"",modelValue:k.value.workorderCode,"onUpdate:modelValue":a[23]||(a[23]=o=>k.value.workorderCode=o),placeholder:"请选择生产工单"},{append:l(()=>[e(I,{disabled:"",icon:h(be),onClick:Be},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(V,{span:8},{default:l(()=>[e(p,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(u,{disabled:"",modelValue:k.value.taskCode,"onUpdate:modelValue":a[24]||(a[24]=o=>k.value.taskCode=o),placeholder:"请选择生产任务"},{append:l(()=>[e(I,{disabled:"",icon:h(be),onClick:je},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Ul,{ref_key:"taskSelectRef",ref:M,workorderId:k.value.workorderId,onOnSelected:Yl},null,8,["workorderId"])]),_:1}),e(V,{span:8},{default:l(()=>[e(p,{label:"客户编号"},{default:l(()=>[e(u,{disabled:"",modelValue:k.value.clientCode,"onUpdate:modelValue":a[25]||(a[25]=o=>k.value.clientCode=o),placeholder:"请选择生产工单"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):re("",!0),e(we,null,{default:l(()=>[e(V,{span:24},{default:l(()=>[e(p,{label:"备注",prop:"remark"},{default:l(()=>[e(u,{disabled:"",modelValue:k.value.remark,"onUpdate:modelValue":a[26]||(a[26]=o=>k.value.remark=o),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),k.value.bindWorkorder?(f(),y(Ae,{key:1,"content-position":"center"},{default:l(()=>a[44]||(a[44]=[w("BOM信息")])),_:1})):re("",!0),k.value.bindWorkorder?x((f(),y(xe,{key:2,size:m.value,"max-height":"200",data:E.value,style:{width:"100%"}},{default:l(()=>[e(z,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(z,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(z,{label:"需求数量",align:"center",prop:"quantityAllocated"}),e(z,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[De,v.value]]):re("",!0),e(Ae,{"content-position":"center"},{default:l(()=>a[45]||(a[45]=[w("调拨信息")])),_:1}),ve.value?re("",!0):(f(),y(we,{key:3,gutter:10},{default:l(()=>[e(V,{span:8},{default:l(()=>[e(p,{label:"单据信息",prop:"purchaseId"},{default:l(()=>[e(u,{readonly:"",modelValue:F.value,"onUpdate:modelValue":a[27]||(a[27]=o=>F.value=o),placeholder:"请输入"},null,8,["modelValue"]),x(X("input",{ref_key:"scannerInput",ref:G,"onUpdate:modelValue":a[28]||(a[28]=o=>ce.value=o),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"1",height:"1","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[Gl,ce.value]]),a[46]||(a[46]=X("span",null,"支持扫码枪扫描, 无法扫码时点击重置按钮",-1))]),_:1})]),_:1}),e(V,{span:4},{default:l(()=>[e(I,{type:"primary",round:"",onClick:Ol},{default:l(()=>a[47]||(a[47]=[w("重置")])),_:1})]),_:1}),e(V,{span:2.5},{default:l(()=>[e(I,{type:"primary",style:{"margin-right":"10px"},icon:h(Qe),size:m.value,onClick:vl},{default:l(()=>a[48]||(a[48]=[w("新增")])),_:1},8,["icon","size"])]),_:1}),e(V,{span:2.5},{default:l(()=>[x((f(),y(I,{type:"primary",style:{"margin-right":"10px"},icon:h(Qe),size:m.value,onClick:gl},{default:l(()=>a[49]||(a[49]=[w("批量新增")])),_:1},8,["icon","size"])),[[ke,["wms:allocated-header:batchAdd"]]])]),_:1}),e(sa,{ref_key:"stockSelectRef",ref:se,onOnSelected:Hl},null,512),e(V,{span:2.5},{default:l(()=>[e(I,{type:"danger",icon:h(Xl),size:m.value,disabled:q.value,onClick:wl},{default:l(()=>a[50]||(a[50]=[w("删除")])),_:1},8,["icon","size","disabled"])]),_:1})]),_:1})),x((f(),y(xe,{size:m.value,data:R.value,onSelectionChange:kl},{default:l(()=>[ve.value?re("",!0):(f(),y(z,{key:0,type:"selection",width:"55",align:"center"})),e(z,{label:"序号",width:"55",align:"center"},{default:l(o=>[w(_e(o.$index+1),1)]),_:1}),e(z,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(z,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(z,{label:"调拨数量","show-overflow-tooltip":!0,align:"center",prop:"quantityAllocated"}),e(z,{width:"70",label:"单位",align:"center",prop:"unitOfMeasure"}),e(z,{label:"批次号","show-overflow-tooltip":!0,align:"center",prop:"batchCode"}),e(z,{label:"调拨标识","show-overflow-tooltip":!0,width:"90",align:"center",prop:"allocatedFlag"}),e(z,{label:"仓库名称","show-overflow-tooltip":!0,align:"center",prop:"warehouseName"}),e(z,{label:"库区名称","show-overflow-tooltip":!0,align:"center",prop:"locationName"}),e(z,{label:"库位名称","show-overflow-tooltip":!0,align:"center",prop:"areaName"})]),_:1},8,["size","data"])),[[De,b.value]])]),_:1},8,["size","model"])]),_:1},8,["title","modelValue"])),[[xl]])])}}},Ta=al(Ua,[["__scopeId","data-v-4692ec1a"]]);export{Ta as default};
