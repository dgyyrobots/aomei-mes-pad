/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{d as K,r as g,f as Q,g as v,h as W,k as i,o as a,m as u,w as Z,a as l,j as r,l as m,c as E,F as I,n as x,v as d,t as L,y as h,_ as ee,N as te,c0 as U,c1 as _,z as le,X as oe}from"./index-BdmDrM2Y.js";import{c as w,D as O}from"./dict-Cm-9nniQ.js";import{a as ue,c as re,u as ae}from"./couponTemplate-C-4FGSfk.js";import{h as T,e as V,f as S}from"./constants-BPQb3nxh.js";import ie from"./SpuShowcase-DGojRRCe.js";import{_ as de}from"./ProductCategorySelect.vue_vue_type_script_setup_true_lang-BRpW5N8P.js";const fe=K({name:"CouponTemplateForm",__name:"CouponTemplateForm",emits:["success"],setup(se,{expose:N,emit:F}){const{t:k}=te(),D=le(),y=g(!1),R=g(""),f=g(!1),q=g(""),t=g({id:void 0,name:void 0,discountType:V.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:S.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:T.ALL.scope,productScopeValues:[],productCategoryIds:[],productSpuIds:[]}),Y=Q({name:[{required:!0,message:"优惠券名称不能为空",trigger:"blur"}],discountType:[{required:!0,message:"优惠券类型不能为空",trigger:"change"}],discountPrice:[{required:!0,message:"优惠券面额不能为空",trigger:"blur"}],discountPercent:[{required:!0,message:"优惠券折扣不能为空",trigger:"blur"}],discountLimitPrice:[{required:!0,message:"最多优惠不能为空",trigger:"blur"}],usePrice:[{required:!0,message:"满多少元可以使用不能为空",trigger:"blur"}],takeType:[{required:!0,message:"领取方式不能为空",trigger:"change"}],totalCount:[{required:!0,message:"发放数量不能为空",trigger:"blur"}],takeLimitCount:[{required:!0,message:"每人限领个数不能为空",trigger:"blur"}],validityType:[{required:!0,message:"有效期类型不能为空",trigger:"change"}],validTimes:[{required:!0,message:"固定日期不能为空",trigger:"change"}],fixedStartTerm:[{required:!0,message:"开始领取天数不能为空",trigger:"blur"}],fixedEndTerm:[{required:!0,message:"开始领取天数不能为空",trigger:"blur"}],productScope:[{required:!0,message:"商品范围不能为空",trigger:"blur"}],productSpuIds:[{required:!0,message:"商品不能为空",trigger:"blur"}],productCategoryIds:[{required:!0,message:"分类不能为空",trigger:"blur"}]}),b=g();N({open:async(n,e)=>{if(y.value=!0,R.value=k(`action.${n}`),q.value=n,B(),e){f.value=!0;try{const p=await ue(e);t.value={...p,discountPrice:U(p.discountPrice),discountPercent:p.discountPercent!==void 0?p.discountPercent/10:void 0,discountLimitPrice:U(p.discountLimitPrice),usePrice:U(p.usePrice),validTimes:[p.validStartTime,p.validEndTime]},await G()}finally{f.value=!1}}}});const M=F,$=async()=>{if(!(!b||!await b.value.validate())){f.value=!0;try{const e={...t.value,discountPrice:_(t.value.discountPrice),discountPercent:t.value.discountPercent!==void 0?t.value.discountPercent*10:void 0,discountLimitPrice:_(t.value.discountLimitPrice),usePrice:_(t.value.usePrice),validStartTime:t.value.validTimes&&t.value.validTimes.length===2?t.value.validTimes[0]:void 0,validEndTime:t.value.validTimes&&t.value.validTimes.length===2?t.value.validTimes[1]:void 0};j(e),q.value==="create"?(await re(e),D.success(k("common.createSuccess"))):(await ae(e),D.success(k("common.updateSuccess"))),y.value=!1,M("success")}finally{f.value=!1}}},B=()=>{t.value={id:void 0,name:void 0,discountType:V.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:S.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:T.ALL.scope,productScopeValues:[],productSpuIds:[],productCategoryIds:[]},b.value?.resetFields()},G=async()=>{switch(t.value.productScope){case T.SPU.scope:t.value.productSpuIds=t.value.productScopeValues;break;case T.CATEGORY.scope:await oe(()=>{let n=t.value.productScopeValues;Array.isArray(n)&&n.length>0&&(n=n[0]),t.value.productCategoryIds=n});break}};function j(n){switch(t.value.productScope){case T.SPU.scope:n.productScopeValues=t.value.productSpuIds;break;case T.CATEGORY.scope:n.productScopeValues=Array.isArray(t.value.productCategoryIds)?t.value.productCategoryIds:[t.value.productCategoryIds];break}}return(n,e)=>{const p=v("el-input"),s=v("el-form-item"),P=v("el-radio"),C=v("el-radio-group"),c=v("el-input-number"),z=v("el-date-picker"),X=v("el-form"),A=v("el-button"),H=ee,J=W("loading");return a(),i(H,{modelValue:l(y),"onUpdate:modelValue":e[17]||(e[17]=o=>h(y)?y.value=o:null),title:l(R)},{footer:u(()=>[r(A,{disabled:l(f),type:"primary",onClick:$},{default:u(()=>e[29]||(e[29]=[d("确 定")])),_:1},8,["disabled"]),r(A,{onClick:e[16]||(e[16]=o=>y.value=!1)},{default:u(()=>e[30]||(e[30]=[d("取 消")])),_:1})]),default:u(()=>[Z((a(),i(X,{ref_key:"formRef",ref:b,"label-width":"140px",model:l(t),rules:l(Y)},{default:u(()=>[r(s,{label:"优惠券名称",prop:"name"},{default:u(()=>[r(p,{modelValue:l(t).name,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).name=o),placeholder:"请输入优惠券名称"},null,8,["modelValue"])]),_:1}),r(s,{label:"优惠劵类型",prop:"productScope"},{default:u(()=>[r(C,{modelValue:l(t).productScope,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).productScope=o)},{default:u(()=>[(a(!0),E(I,null,x(l(w)(l(O).PROMOTION_PRODUCT_SCOPE),o=>(a(),i(P,{key:o.value,label:o.value},{default:u(()=>[d(L(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(t).productScope===l(T).SPU.scope?(a(),i(s,{key:0,label:"商品",prop:"productSpuIds"},{default:u(()=>[r(ie,{modelValue:l(t).productSpuIds,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).productSpuIds=o)},null,8,["modelValue"])]),_:1})):m("",!0),l(t).productScope===l(T).CATEGORY.scope?(a(),i(s,{key:1,label:"分类",prop:"productCategoryIds"},{default:u(()=>[r(de,{modelValue:l(t).productCategoryIds,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).productCategoryIds=o)},null,8,["modelValue"])]),_:1})):m("",!0),r(s,{label:"优惠类型",prop:"discountType"},{default:u(()=>[r(C,{modelValue:l(t).discountType,"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).discountType=o)},{default:u(()=>[(a(!0),E(I,null,x(l(w)(l(O).PROMOTION_DISCOUNT_TYPE),o=>(a(),i(P,{key:o.value,label:o.value},{default:u(()=>[d(L(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(t).discountType===l(V).PRICE.type?(a(),i(s,{key:2,label:"优惠券面额",prop:"discountPrice"},{default:u(()=>[r(c,{modelValue:l(t).discountPrice,"onUpdate:modelValue":e[5]||(e[5]=o=>l(t).discountPrice=o),class:"mr-2 !w-400px",min:0,placeholder:"请输入优惠金额，单位：元",precision:2},null,8,["modelValue"]),e[18]||(e[18]=d(" 元 "))]),_:1})):m("",!0),l(t).discountType===l(V).PERCENT.type?(a(),i(s,{key:3,label:"优惠券折扣",prop:"discountPercent"},{default:u(()=>[r(c,{modelValue:l(t).discountPercent,"onUpdate:modelValue":e[6]||(e[6]=o=>l(t).discountPercent=o),class:"mr-2 !w-400px",max:9.9,min:1,placeholder:"优惠券折扣不能小于 1 折，且不可大于 9.9 折",precision:1},null,8,["modelValue"]),e[19]||(e[19]=d(" 折 "))]),_:1})):m("",!0),l(t).discountType===l(V).PERCENT.type?(a(),i(s,{key:4,label:"最多优惠",prop:"discountLimitPrice"},{default:u(()=>[r(c,{modelValue:l(t).discountLimitPrice,"onUpdate:modelValue":e[7]||(e[7]=o=>l(t).discountLimitPrice=o),class:"mr-2 !w-400px",min:0,placeholder:"请输入最多优惠",precision:2},null,8,["modelValue"]),e[20]||(e[20]=d(" 元 "))]),_:1})):m("",!0),r(s,{label:"满多少元可以使用",prop:"usePrice"},{default:u(()=>[r(c,{modelValue:l(t).usePrice,"onUpdate:modelValue":e[8]||(e[8]=o=>l(t).usePrice=o),class:"mr-2 !w-400px",min:0,placeholder:"无门槛请设为 0",precision:2},null,8,["modelValue"]),e[21]||(e[21]=d(" 元 "))]),_:1}),r(s,{label:"领取方式",prop:"takeType"},{default:u(()=>[r(C,{modelValue:l(t).takeType,"onUpdate:modelValue":e[9]||(e[9]=o=>l(t).takeType=o)},{default:u(()=>[(a(),i(P,{key:1,label:1},{default:u(()=>e[22]||(e[22]=[d("直接领取")])),_:1})),(a(),i(P,{key:2,label:2},{default:u(()=>e[23]||(e[23]=[d("指定发放")])),_:1}))]),_:1},8,["modelValue"])]),_:1}),l(t).takeType===1?(a(),i(s,{key:5,label:"发放数量",prop:"totalCount"},{default:u(()=>[r(c,{modelValue:l(t).totalCount,"onUpdate:modelValue":e[10]||(e[10]=o=>l(t).totalCount=o),class:"mr-2 !w-400px",min:-1,placeholder:"发放数量，没有之后不能领取或发放，-1 为不限制",precision:0},null,8,["modelValue"]),e[24]||(e[24]=d(" 张 "))]),_:1})):m("",!0),l(t).takeType===1?(a(),i(s,{key:6,label:"每人限领个数",prop:"takeLimitCount"},{default:u(()=>[r(c,{modelValue:l(t).takeLimitCount,"onUpdate:modelValue":e[11]||(e[11]=o=>l(t).takeLimitCount=o),class:"mr-2 !w-400px",min:-1,placeholder:"设置为 -1 时，可无限领取",precision:0},null,8,["modelValue"]),e[25]||(e[25]=d(" 张 "))]),_:1})):m("",!0),r(s,{label:"有效期类型",prop:"validityType"},{default:u(()=>[r(C,{modelValue:l(t).validityType,"onUpdate:modelValue":e[12]||(e[12]=o=>l(t).validityType=o)},{default:u(()=>[(a(!0),E(I,null,x(l(w)(l(O).PROMOTION_COUPON_TEMPLATE_VALIDITY_TYPE),o=>(a(),i(P,{key:o.value,label:o.value},{default:u(()=>[d(L(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(t).validityType===l(S).DATE.type?(a(),i(s,{key:7,label:"固定日期",prop:"validTimes"},{default:u(()=>[r(z,{modelValue:l(t).validTimes,"onUpdate:modelValue":e[13]||(e[13]=o=>l(t).validTimes=o),"default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)],style:{width:"240px"},type:"datetimerange","value-format":"x"},null,8,["modelValue","default-time"])]),_:1})):m("",!0),l(t).validityType===l(S).TERM.type?(a(),i(s,{key:8,label:"领取日期",prop:"fixedStartTerm"},{default:u(()=>[e[26]||(e[26]=d(" 第 ")),r(c,{modelValue:l(t).fixedStartTerm,"onUpdate:modelValue":e[14]||(e[14]=o=>l(t).fixedStartTerm=o),class:"mx-2",min:0,placeholder:"0 为今天生效",precision:0},null,8,["modelValue"]),e[27]||(e[27]=d(" 至 ")),r(c,{modelValue:l(t).fixedEndTerm,"onUpdate:modelValue":e[15]||(e[15]=o=>l(t).fixedEndTerm=o),class:"mx-2",min:0,placeholder:"请输入结束天数",precision:0},null,8,["modelValue"]),e[28]||(e[28]=d(" 天有效 "))]),_:1})):m("",!0)]),_:1},8,["model","rules"])),[[J,l(f)]])]),_:1},8,["modelValue","title"])}}});export{fe as _};
