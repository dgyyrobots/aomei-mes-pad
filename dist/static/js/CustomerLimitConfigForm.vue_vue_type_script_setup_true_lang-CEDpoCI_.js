/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-08 15:23:48 
 */
import{V as v,d as q,r as u,f as B,g as f,h as K,k as b,o as y,_ as P,a,y as j,m as i,w as z,j as r,l as X,v as M,N as G,z as H,bX as J}from"./index-C8VsLzxx.js";import{g as W}from"./index-CyExe2pa.js";import{d as h,h as Z}from"./tree-vSlcEeQq.js";import{a as ee}from"./index-Dn2rRtuI.js";var U=(o=>(o[o.CUSTOMER_QUANTITY_LIMIT=1]="CUSTOMER_QUANTITY_LIMIT",o[o.CUSTOMER_LOCK_LIMIT=2]="CUSTOMER_LOCK_LIMIT",o))(U||{});const ue=async o=>await v.get({url:"/crm/customer-limit-config/page",params:o}),te=async o=>await v.get({url:`/crm/customer-limit-config/get?id=${o}`}),ae=async o=>await v.post({url:"/crm/customer-limit-config/create",data:o}),le=async o=>await v.put({url:"/crm/customer-limit-config/update",data:o}),de=async o=>await v.delete({url:`/crm/customer-limit-config/delete?id=${o}`}),me=q({__name:"CustomerLimitConfigForm",emits:["success"],setup(o,{expose:x,emit:E}){const{t:I}=G(),V=H(),m=u(!1),w=u(""),c=u(!1),T=u(""),s=u({id:void 0,type:void 0,userIds:void 0,deptIds:void 0,maxCount:void 0,dealCountEnabled:!1}),R=B({type:[{required:!0,message:"规则类型不能为空",trigger:"change"}],maxCount:[{required:!0,message:"数量上限不能为空",trigger:"blur"}]}),g=u(),_=u(),C=u();x({open:async(l,e,t)=>{if(m.value=!0,w.value=I(`action.${l}`),T.value=l,N(),await O(),await $(),e){c.value=!0;try{s.value=await te(e)}finally{c.value=!1}}else s.value.type=t}});const S=E,D=async()=>{if(!(!g||!await g.value.validate())){c.value=!0;try{const e=s.value;T.value==="create"?(await ae(e),V.success(I("common.createSuccess"))):(await le(e),V.success(I("common.updateSuccess"))),m.value=!1,S("success")}finally{c.value=!1}}},N=()=>{s.value={id:void 0,type:void 0,userIds:void 0,deptIds:void 0,maxCount:void 0,dealCountEnabled:!1},g.value?.resetFields()},O=async()=>{const l=await W();_.value=[],_.value.push(...Z(l))},$=async()=>{const l=await ee();C.value=[],C.value=J(a(_));const e={};l.forEach(t=>{t.dept&&(e[t.deptId]||(e[t.deptId]=[]),e[t.deptId].push(t))}),L(C.value,e)},L=(l,e)=>{for(let t=0;t<l.length;t++){if(l[t].isUser)continue;const d=e[l[t].id];d&&(l[t].children||(l[t].children=[]),l[t].children.push(...d.map(p=>({id:p.id,name:`${p.username}-${p.nickname}`,isUser:!0,disabled:p.status===1})))),l[t].children&&l[t].children.length!==0&&L(l[t].children,e),l[t].disabled=!0,l[t].id="null"}};return(l,e)=>{const t=f("el-tree-select"),d=f("el-form-item"),p=f("el-input-number"),A=f("el-switch"),F=f("el-form"),k=f("el-button"),Q=P,Y=K("loading");return y(),b(Q,{modelValue:a(m),"onUpdate:modelValue":e[5]||(e[5]=n=>j(m)?m.value=n:null),title:a(w)},{footer:i(()=>[r(k,{disabled:a(c),type:"primary",onClick:D},{default:i(()=>e[6]||(e[6]=[M("确 定")])),_:1},8,["disabled"]),r(k,{onClick:e[4]||(e[4]=n=>m.value=!1)},{default:i(()=>e[7]||(e[7]=[M("取 消")])),_:1})]),default:i(()=>[z((y(),b(F,{ref_key:"formRef",ref:g,"label-width":"200px",model:a(s),rules:a(R)},{default:i(()=>[r(d,{label:"规则适用人群",prop:"userIds"},{default:i(()=>[r(t,{modelValue:a(s).userIds,"onUpdate:modelValue":e[0]||(e[0]=n=>a(s).userIds=n),"check-on-click-node":"",data:a(C),filterable:"",multiple:"","node-key":"id",placeholder:"请选择规则适用人群",props:a(h)},null,8,["modelValue","data","props"])]),_:1}),r(d,{label:"规则适用部门",prop:"deptIds"},{default:i(()=>[r(t,{modelValue:a(s).deptIds,"onUpdate:modelValue":e[1]||(e[1]=n=>a(s).deptIds=n),"check-strictly":"",data:a(_),filterable:"",multiple:"","node-key":"id",placeholder:"请选择规则适用部门",props:a(h)},null,8,["modelValue","data","props"])]),_:1}),r(d,{label:a(s).type===a(U).CUSTOMER_QUANTITY_LIMIT?"拥有客户数上限":"锁定客户数上限",prop:"maxCount"},{default:i(()=>[r(p,{modelValue:a(s).maxCount,"onUpdate:modelValue":e[2]||(e[2]=n=>a(s).maxCount=n),placeholder:"请输入数量上限"},null,8,["modelValue"])]),_:1},8,["label"]),a(s).type===a(U).CUSTOMER_QUANTITY_LIMIT?(y(),b(d,{key:0,label:"成交客户是否占用拥有客户数",prop:"dealCountEnabled"},{default:i(()=>[r(A,{modelValue:a(s).dealCountEnabled,"onUpdate:modelValue":e[3]||(e[3]=n=>a(s).dealCountEnabled=n)},null,8,["modelValue"])]),_:1})):X("",!0)]),_:1},8,["model","rules"])),[[Y,a(c)]])]),_:1},8,["modelValue","title"])}}});export{U as L,me as _,de as d,ue as g};
