/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-14 11:54:00 
 */
import{V as W,d as Ze,r as u,f as he,b as Le,g as i,h as ye,k,o as c,m as l,w as x,j as e,J as Z,c as Ne,F as qe,n as Re,a as V,D as Ce,v as f,a0 as We,$ as we,t as _e,M as Ae,i as B,a6 as el,A as Pe,l as ne,W as Rl,O as Xe,x as ll,H as jl,X as ze,R as Jl,Y as xl,Z as K,E as Je,G as Gl,a7 as Dl,a4 as Xl,a8 as Zl,T as Ge,a5 as ea}from"./index-BdmDrM2Y.js";import{_ as Al}from"./DictTag.vue_vue_type_script_lang-bjcRCBWf.js";import{D as Oe}from"./dict-Cm-9nniQ.js";import{k as la}from"./index-DCe4u-nz.js";import"./color-B5phLuB-.js";const aa=async d=>await W.get({url:"/mes/pro/task/page",params:d}),Pl=async()=>await W.get({url:"/mes/pro/cess/list-all-simple"}),ta=async d=>await W.get({url:"/mes/md-workstation/page",params:d}),oa=async()=>await W.get({url:"/mes/md-workshop/list-all-simple"}),na={class:"dialog-footer"},ra=Ze({name:"WorkstationSelect",__name:"simpletableSingle",props:{processId:{}},emits:["onSelected"],setup(d,{expose:m,emit:Q}){const g=d,w=u(!1),R=u(!0),J=u(),n=u([]);u(!0),u(!0);const _=u(!0),G=u(0),re=u([]),D=u([]),M=u([]),$=u(),F=he({pageNo:1,pageSize:10,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:g.processId,processCode:null,processName:null,enableFlag:null});he({workstationId:null,workstationCode:null,workstationName:null,workstationAddress:null,workshopId:null,workshopCode:null,workshopName:null,processId:null,processCode:null,processName:null,enableFlag:"Y",remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null});const E=async()=>{R.value=!0;try{const O=await ta(F);re.value=O.list,G.value=O.total}finally{R.value=!1}},ae=async()=>{const O=await oa();D.value=O},A=async()=>{const O=await Pl();M.value=O},h=()=>{F.pageNo=1,E()},pe=()=>{$.value?.resetFields(),h()},b=O=>{O&&(n.value=O)},v=O=>{O&&(n.value=O)},N=O=>{O&&(n.value=O,te("onSelected",n.value),w.value=!1)},ee=()=>{if(!J.value){el({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}te("onSelected",n.value),w.value=!1},te=Q;return Le(()=>{E(),ae(),A()}),m({showFlag:w}),(O,C)=>{const Y=i("el-input"),ue=i("el-form-item"),ce=i("el-col"),me=i("el-option"),fe=i("el-select"),I=i("el-button"),y=i("el-row"),s=i("el-form"),de=i("el-radio"),L=i("el-table-column"),T=i("el-table"),se=i("el-dialog"),oe=ye("loading");return c(),k(se,{title:"工作站选择",modelValue:w.value,"onUpdate:modelValue":C[7]||(C[7]=U=>w.value=U),modal:!1,width:"80%",center:""},{footer:l(()=>[B("div",na,[e(I,{type:"primary",onClick:ee},{default:l(()=>C[11]||(C[11]=[f("确 定")])),_:1}),e(I,{onClick:C[6]||(C[6]=U=>w.value=!1)},{default:l(()=>C[12]||(C[12]=[f("取 消")])),_:1})])]),default:l(()=>[x(e(s,{model:F,ref_key:"queryFormRef",ref:$,size:"small",inline:!0,"label-width":"90px"},{default:l(()=>[e(y,null,{default:l(()=>[e(ce,{span:7},{default:l(()=>[e(ue,{label:"工作站编号",prop:"workstationCode"},{default:l(()=>[e(Y,{modelValue:F.workstationCode,"onUpdate:modelValue":C[0]||(C[0]=U=>F.workstationCode=U),placeholder:"请输入工作站编号",clearable:"",onKeyup:Z(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(ce,{span:7},{default:l(()=>[e(ue,{label:"所属工序",prop:"processName"},{default:l(()=>[e(fe,{modelValue:F.processId,"onUpdate:modelValue":C[1]||(C[1]=U=>F.processId=U),placeholder:"请选择工序"},{default:l(()=>[(c(!0),Ne(qe,null,Re(M.value,U=>(c(),k(me,{key:U.id,label:U.name,value:U.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ce,{span:7},{default:l(()=>[e(ue,{label:"所在车间",prop:"workshopName"},{default:l(()=>[e(fe,{modelValue:F.workshopId,"onUpdate:modelValue":C[2]||(C[2]=U=>F.workshopId=U),placeholder:"请选择车间"},{default:l(()=>[(c(!0),Ne(qe,null,Re(D.value,U=>(c(),k(me,{key:U.id,label:U.name,value:U.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ce,{span:3},{default:l(()=>[e(ue,null,{default:l(()=>[e(I,{type:"primary",icon:V(Ce),size:"small",onClick:h},{default:l(()=>C[8]||(C[8]=[f("搜索")])),_:1},8,["icon"]),e(I,{icon:V(We),size:"small",onClick:pe},{default:l(()=>C[9]||(C[9]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(ce,{span:24})]),_:1})]),_:1},8,["model"]),[[we,_.value]]),x((c(),k(T,{data:re.value,onCurrentChange:b,onRowDblclick:N},{default:l(()=>[e(L,{width:"55",align:"center"},{default:l(U=>[e(de,{modelValue:J.value,"onUpdate:modelValue":C[3]||(C[3]=le=>J.value=le),label:U.row.id,onChange:le=>v(U.row)},{default:l(()=>C[10]||(C[10]=[f(_e(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(L,{label:"工作站编号",align:"center",prop:"workstationCode"}),e(L,{label:"工作站名称",align:"center",prop:"workstationName"}),e(L,{label:"工作站地点",align:"center",prop:"workstationAddress"}),e(L,{label:"所在车间名称",align:"center",prop:"workshopName"}),e(L,{label:"所属工序",align:"center",prop:"processName"}),e(L,{label:"备注",align:"center",prop:"remark"})]),_:1},8,["data"])),[[oe,R.value]]),x(e(Ae,{total:G.value,page:F.pageNo,"onUpdate:page":C[4]||(C[4]=U=>F.pageNo=U),limit:F.pageSize,"onUpdate:limit":C[5]||(C[5]=U=>F.pageSize=U),onPagination:E},null,8,["total","page","limit"]),[[we,G.value>0]])]),_:1},8,["modelValue"])}}}),ua=Pe(ra,[["__scopeId","data-v-848b7f87"]]),da={name:"ProtaskSelect",components:{WorkstationSelect:ua},props:{workorderId:null,workorderCode:null,processId:null,processCode:null,workstationId:null,workstationCode:null},watch:{workorderId(d){this.queryParams.workorderId=d}},data(){return{showFlag:!1,selectedTaskId:void 0,selectedRow:void 0,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,protaskList:[],title:"",open:!1,queryParams:{pageNo:1,pageSize:10,taskCode:null,taskName:null,workorderId:this.workorderId,workorderCode:null,workorderName:null,workstationId:null,workstationCode:null,workstationName:null,processId:this.processId,processCode:null,processName:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,clientId:null,clientCode:null,clientName:null,clientNick:null,startTime:null,duration:null,endTime:null,colorCode:null,requestDate:null},form:{},rules:{workstationId:[{required:!0,message:"工作站不能为空",trigger:"blur"}],quantity:[{required:!0,message:"排产数量不能为空",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始生产日期",trigger:"blur"}],duration:[{required:!0,message:"清输入估算的生产用时",trigger:"blur"}]}}},created(){this.getList(),this.getProcess()},methods:{getList(){this.loading=!0,aa(this.queryParams).then(d=>{this.protaskList=d.list,this.total=d.total,this.loading=!1})},getProcess(){Pl().then(d=>{this.processOptions=d})},handleQuery(){this.queryParams.pageNo=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleCurrent(d){d&&(this.selectedRow=d)},handleRowDbClick(d){d&&(this.selectedRow=d,this.$emit("onSelected",this.selectedRow),this.showFlag=!1)},handleRowChange(d){d&&(this.selectedRow=d)},confirmSelect(){if(this.selectedTaskId==null||this.selectedTaskId==0){this.$notify({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}this.$emit("onSelected",this.selectedRow),this.showFlag=!1}}},sa={"slot-scope":"scope"},ia={"slot-scope":"scope"},pa={"slot-scope":"scope"},ca={"slot-scope":"scope"},ma={slot:"footer",class:"dialog-footer"};function fa(d,m,Q,g,w,R){const J=i("el-option"),n=i("el-select"),_=i("el-form-item"),G=i("el-col"),re=i("el-input"),D=i("el-row"),M=i("el-button"),$=i("el-form"),F=i("el-radio"),E=i("el-table-column"),ae=i("el-color-picker"),A=i("el-table"),h=Ae,pe=i("el-dialog"),b=ye("hasPermi"),v=ye("loading");return w.showFlag?(c(),k(pe,{key:0,title:"生产任务选择",visible:w.showFlag,modal:!1,width:"80%",center:""},{default:l(()=>[x(e($,{model:w.queryParams,ref:"queryForm",size:"small",inline:!0,"label-width":"100px"},{default:l(()=>[e(D,null,{default:l(()=>[e(G,{span:8},{default:l(()=>[e(_,{label:"所属工序",prop:"processName"},{default:l(()=>[e(n,{modelValue:w.queryParams.processId,"onUpdate:modelValue":m[0]||(m[0]=N=>w.queryParams.processId=N),placeholder:"请选择工序"},{default:l(()=>[(c(!0),Ne(qe,null,Re(d.processOptions,N=>(c(),k(J,{key:N.processId,label:N.processName,value:N.processId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(G,{span:8},{default:l(()=>[e(_,{label:"所属工作站",prop:"workstationCode"},{default:l(()=>[e(re,{modelValue:w.queryParams.workstationCode,"onUpdate:modelValue":m[1]||(m[1]=N=>w.queryParams.workstationCode=N),placeholder:"请输入工作站编号",clearable:"",onKeyup:Z(R.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(G,{span:8},{default:l(()=>[e(_,{label:"任务编号",prop:"taskCode"},{default:l(()=>[e(re,{modelValue:w.queryParams.taskCode,"onUpdate:modelValue":m[2]||(m[2]=N=>w.queryParams.taskCode=N),placeholder:"请输入生产任务编号",clearable:"",onKeyup:Z(R.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:l(()=>[e(G,{span:8},{default:l(()=>[e(_,null,{default:l(()=>[e(M,{type:"primary",icon:"el-icon-search",size:"mini",onClick:R.handleQuery},{default:l(()=>m[8]||(m[8]=[f("搜索")])),_:1},8,["onClick"]),e(M,{icon:"el-icon-refresh",size:"mini",onClick:R.resetQuery},{default:l(()=>m[9]||(m[9]=[f("重置")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),[[we,w.showSearch]]),x((c(),k(A,{data:w.protaskList,onCurrentChange:R.handleCurrent,onRowDblclick:R.handleRowDbClick},{default:l(()=>[e(E,{width:"55",align:"center"},{default:l(N=>[e(F,{modelValue:w.selectedTaskId,"onUpdate:modelValue":m[3]||(m[3]=ee=>w.selectedTaskId=ee),label:N.row.id,onChange:ee=>R.handleRowChange(N.row)},{default:l(()=>m[10]||(m[10]=[f(_e(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(E,{label:"任务编号",align:"center",width:"100px",prop:"taskCode","show-overflow-tooltip":!0}),e(E,{label:"任务名称",align:"center",width:"120px",prop:"taskName","show-overflow-tooltip":!0}),e(E,{label:"工作站编号",align:"center",width:"150px",prop:"workstationCode","show-overflow-tooltip":!0}),e(E,{label:"工作站名称",align:"center",width:"150px",prop:"workstationName","show-overflow-tooltip":!0}),e(E,{label:"排产数量",align:"center",prop:"quantity"}),e(E,{label:"已生产数量",align:"center",width:"100px",prop:"quantityProduced"}),e(E,{label:"开始生产时间",align:"center",prop:"startTime",width:"180"},{default:l(()=>[B("template",sa,[B("span",null,_e(d.parseTime(d.scope.row.startTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(E,{label:"生产时长",align:"center",prop:"duration"}),e(E,{label:"预计完成时间",align:"center",prop:"endTime",width:"180"},{default:l(()=>[B("template",ia,[B("span",null,_e(d.parseTime(d.scope.row.endTime,"{y}-{m}-{d} {h}")),1)])]),_:1}),e(E,{label:"显示颜色",align:"center",prop:"colorCode"},{default:l(()=>[B("template",pa,[e(ae,{modelValue:d.scope.row.colorCode,"onUpdate:modelValue":m[4]||(m[4]=N=>d.scope.row.colorCode=N),disabled:""},null,8,["modelValue"])])]),_:1}),e(E,{label:"操作",align:"center",width:"100px","class-name":"small-padding fixed-width"},{default:l(()=>[B("template",ca,[x((c(),k(M,{size:"mini",type:"text",icon:"el-icon-edit",onClick:m[5]||(m[5]=N=>d.handleUpdate(d.scope.row))},{default:l(()=>m[11]||(m[11]=[f("修改")])),_:1})),[[b,["pro:protask:edit"]]]),x((c(),k(M,{size:"mini",type:"text",icon:"el-icon-delete",onClick:m[6]||(m[6]=N=>d.handleDelete(d.scope.row))},{default:l(()=>m[12]||(m[12]=[f("删除")])),_:1})),[[b,["pro:protask:remove"]]])])]),_:1})]),_:1},8,["data","onCurrentChange","onRowDblclick"])),[[v,w.loading]]),x(e(h,{total:w.total,page:w.queryParams.pageNo,limit:w.queryParams.pageSize,onPagination:R.getList},null,8,["total","page","limit","onPagination"]),[[we,w.total>0]]),B("div",ma,[e(M,{type:"primary",onClick:R.confirmSelect},{default:l(()=>m[13]||(m[13]=[f("确 定")])),_:1},8,["onClick"]),e(M,{onClick:m[7]||(m[7]=N=>w.showFlag=!1)},{default:l(()=>m[14]||(m[14]=[f("取 消")])),_:1})])]),_:1},8,["visible"])):ne("",!0)}const Ul=Pe(da,[["render",fa]]),va=async d=>await W.get({url:"/mes/wms/material-stock/page",params:d}),ga=async()=>await W.get({url:"/mes/md-item-type/treeselect"}),Tl=async()=>await W.get({url:"/wms/warehouse/getTreeList"}).then(d=>(d.data=(d.data||[]).map(m=>(m.children&&(m.children=m.children.map(Q=>(Q.children&&(Q.children=Q.children.map(g=>({...g,pId:g.id,pName:g.areaName,lId:g.locationId,areaId:g.id}))),{...Q,wId:Q.warehouseId,pId:Q.id,pName:Q.locationName,locationId:Q.id}))),{...m,wId:m.id,pId:m.id,pName:m.warehouseName,warehouseId:m.id})),d)),wa={class:"head-container"},ka={class:"head-container"},ba={class:"dialog-footer"},Ca=Ze({name:"WmstockMultiSelect",__name:"multi",emits:["onSelected"],setup(d,{expose:m,emit:Q}){const g=Rl(),w=Xe(()=>g.currentSize==="mini"?"small":g.currentSize),R=u(!1),J=u(!0),n=u([]),_=u([]),G=u(!0),re=u(!0),D=u(!0),M=u(0),$=u([]),F=u([]),E=u(),ae=u(),A=u(),h=he({pageNo:1,pageSize:10,itemTypeId:null,itemId:null,itemCode:null,itemName:null,specification:null,unitOfMeasure:null,batchCode:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,vendorId:null,vendorCode:null,vendorName:null,vendorNick:null,quantityOnhand:null,expireDate:null,warehouse:null}),pe={children:"children",label:"label"},b=u([]),v={multiple:!1,value:"pId",label:"pName"},N=async()=>{J.value=!0;try{const y=await va(h);F.value=y.list,M.value=y.total}finally{J.value=!1}},ee=async()=>{const y=await ga();$.value=y},te=(y,s)=>y?s.label.indexOf(y)!==-1:!0,O=y=>{h.itemTypeId=y.id,C()},C=()=>{h.pageNo=1,N()},Y=()=>{A.value?.resetFields(),C()},ue=y=>{n.value=y.map(s=>s.materialStockId),G.value=y.length!==1,re.value=!y.length,_.value=y},ce=()=>{if(!_.value.length){el({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}I("onSelected",_.value),R.value=!1},me=async()=>{const y=await Tl();b.value=y,b.value.map(s=>{s.pId=s.id,s.pName=s.warehouseName,s.children.map(L=>{let T=JSON.stringify(L.children).replace(/locationId/g,"lId").replace(/areaId/g,"pId").replace(/areaName/g,"pName");L.children=JSON.parse(T)});let de=JSON.stringify(s.children).replace(/warehouseId/g,"wId").replace(/locationId/g,"pId").replace(/locationName/g,"pName");s.children=JSON.parse(de)})},fe=y=>{y&&(h.warehouseId=y[0],h.locationId=y[1],h.areaId=y[2])},I=Q;return Le(()=>{N(),ee(),me()}),m({showFlag:R}),(y,s)=>{const de=i("el-input"),L=i("el-tree"),T=i("el-col"),se=i("el-form-item"),oe=i("el-cascader"),U=i("el-date-picker"),le=i("el-button"),ke=i("el-form"),H=i("right-toolbar"),ie=i("el-row"),X=i("el-table-column"),Me=i("el-table"),He=i("el-dialog"),Ke=ye("loading");return c(),k(He,{title:"物料选择",modelValue:R.value,"onUpdate:modelValue":s[12]||(s[12]=P=>R.value=P),modal:!1,width:"92%",center:""},{footer:l(()=>[B("div",ba,[e(le,{size:V(w),type:"primary",onClick:ce},{default:l(()=>s[15]||(s[15]=[f("确 定")])),_:1},8,["size"]),e(le,{size:V(w),onClick:s[11]||(s[11]=P=>R.value=!1)},{default:l(()=>s[16]||(s[16]=[f("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(ie,{gutter:14},{default:l(()=>[e(T,{span:4,xs:24},{default:l(()=>[B("div",wa,[e(de,{modelValue:E.value,"onUpdate:modelValue":s[0]||(s[0]=P=>E.value=P),placeholder:"请输入分类名称",clearable:"",":size":V(w),"prefix-icon":V(Ce),style:{"margin-bottom":"20px"}},null,8,["modelValue",":size","prefix-icon"])]),B("div",ka,[e(L,{data:$.value,props:pe,"expand-on-click-node":!1,"filter-node-method":te,ref_key:"treeRef",ref:ae,"default-expand-all":"",onNodeClick:O},null,8,["data"])])]),_:1}),e(T,{span:20,xs:24},{default:l(()=>[x(e(ke,{model:h,ref_key:"queryFormRef",ref:A,":size":V(w),inline:!0},{default:l(()=>[e(se,{label:"产品物料编码",prop:"itemCode"},{default:l(()=>[e(de,{modelValue:h.itemCode,"onUpdate:modelValue":s[1]||(s[1]=P=>h.itemCode=P),placeholder:"请输入产品物料编码",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(se,{label:"产品物料名称",prop:"itemName"},{default:l(()=>[e(de,{modelValue:h.itemName,"onUpdate:modelValue":s[2]||(s[2]=P=>h.itemName=P),placeholder:"请输入产品物料名称",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(se,{label:"入库批次号",prop:"batchCode"},{default:l(()=>[e(de,{modelValue:h.batchCode,"onUpdate:modelValue":s[3]||(s[3]=P=>h.batchCode=P),placeholder:"请输入入库批次号",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(se,{label:"仓库信息",prop:"warehouse"},{default:l(()=>[e(oe,{modelValue:h.warehouse,"onUpdate:modelValue":s[4]||(s[4]=P=>h.warehouse=P),options:b.value,props:v,onChange:fe},null,8,["modelValue","options"])]),_:1}),e(se,{label:"供应商编号",prop:"vendorCode"},{default:l(()=>[e(de,{modelValue:h.vendorCode,"onUpdate:modelValue":s[5]||(s[5]=P=>h.vendorCode=P),placeholder:"请输入供应商编号",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(se,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[e(de,{modelValue:h.vendorName,"onUpdate:modelValue":s[6]||(s[6]=P=>h.vendorName=P),placeholder:"请输入供应商名称",clearable:"",onKeyup:Z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(se,{label:"库存有效期",prop:"expireDate"},{default:l(()=>[e(U,{clearable:"",modelValue:h.expireDate,"onUpdate:modelValue":s[7]||(s[7]=P=>h.expireDate=P),type:"date","value-format":"timestamp",placeholder:"请选择库存有效期"},null,8,["modelValue"])]),_:1}),e(se,null,{default:l(()=>[e(le,{type:"primary",icon:V(Ce),":size":V(w),onClick:C},{default:l(()=>s[13]||(s[13]=[f("搜索")])),_:1},8,["icon",":size"]),e(le,{icon:V(We),":size":V(w),onClick:Y},{default:l(()=>s[14]||(s[14]=[f("重置")])),_:1},8,["icon",":size"])]),_:1})]),_:1},8,["model",":size"]),[[we,D.value]]),e(ie,{gutter:10,class:"mb8"},{default:l(()=>[e(H,{showSearch:D.value,"onUpdate:showSearch":s[8]||(s[8]=P=>D.value=P),onQueryTable:N},null,8,["showSearch"])]),_:1}),x((c(),k(Me,{size:V(w),data:F.value,onSelectionChange:ue},{default:l(()=>[e(X,{type:"selection",width:"55",align:"center"}),e(X,{label:"产品物料编码",width:"120px",align:"center",prop:"itemCode"}),e(X,{label:"产品物料名称",width:"150px",align:"center",prop:"itemName","show-overflow-tooltip":!0}),e(X,{label:"规格型号",align:"center",prop:"specification","show-overflow-tooltip":!0}),e(X,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(X,{label:"入库批次号",width:"100px",align:"center",prop:"batchCode","show-overflow-tooltip":!0}),e(X,{label:"仓库",align:"center",prop:"warehouseName"}),e(X,{label:"库区",align:"center",prop:"locationName"}),e(X,{label:"库位",align:"center",prop:"areaName"}),e(X,{label:"供应商编号",width:"100px",align:"center",prop:"vendorCode"}),e(X,{label:"供应商名称",width:"120px",align:"center",prop:"vendorName","show-overflow-tooltip":!0}),e(X,{label:"供应商简称",width:"100px",align:"center",prop:"vendorNick"}),e(X,{label:"在库数量",align:"center",prop:"quantityOnhand"}),e(X,{label:"库存有效期",align:"center",prop:"expireDate",width:"180"},{default:l(P=>[B("span",null,_e(V(ll)(P.row.expireDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["size","data"])),[[Ke,J.value]]),x(e(Ae,{total:M.value,page:h.pageNo,"onUpdate:page":s[9]||(s[9]=P=>h.pageNo=P),limit:h.pageSize,"onUpdate:limit":s[10]||(s[10]=P=>h.pageSize=P),onPagination:N},null,8,["total","page","limit"]),[[we,M.value>0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),_a=Pe(Ca,[["__scopeId","data-v-82c195e3"]]),ha=async d=>await W.get({url:"/mes/pro/workorder/page",params:d}),ya={class:"dialog-footer"},Ia=Ze({name:"WorkOrderSelectSingle",__name:"single",emits:["onSelected"],setup(d,{expose:m,emit:Q}){const g=u(!1),w=u(!0),R=u(),J=u([]);u(!0),u(!0);const n=u(!0),_=u(0),G=u([]),re=u(),D=he({pageNo:1,pageSize:10,workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:"CONFIRMED"}),M=async()=>{w.value=!0;try{const b=await ha(D);G.value=b.list,_.value=b.total}finally{w.value=!1}},$=()=>{M()},F=()=>{re.value?.resetFields(),$()},E=b=>{b&&(J.value=b)},ae=b=>{b&&(J.value=b)},A=b=>{b&&(J.value=b,pe("onSelected",J.value),g.value=!1)},h=()=>{if(!R.value){el({title:"提示",type:"warning",message:"请至少选择一条数据!"});return}pe("onSelected",J.value),g.value=!1},pe=Q;return Le(()=>{M()}),m({showFlag:g}),(b,v)=>{const N=i("el-input"),ee=i("el-form-item"),te=i("el-button"),O=i("el-form"),C=i("el-radio"),Y=i("el-table-column"),ue=Al,ce=i("el-table"),me=i("el-dialog"),fe=ye("loading");return c(),k(me,{title:"工单选择",modelValue:g.value,"onUpdate:modelValue":v[9]||(v[9]=I=>g.value=I),modal:!1,width:"80%",center:""},{footer:l(()=>[B("div",ya,[e(te,{type:"primary",onClick:h},{default:l(()=>v[13]||(v[13]=[f("确 定")])),_:1}),e(te,{onClick:v[8]||(v[8]=I=>g.value=!1)},{default:l(()=>v[14]||(v[14]=[f("取 消")])),_:1})])]),default:l(()=>[x(e(O,{model:D,ref_key:"queryFormRef",ref:re,size:"small",inline:!0,"label-width":"68px"},{default:l(()=>[e(ee,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(N,{modelValue:D.workorderCode,"onUpdate:modelValue":v[0]||(v[0]=I=>D.workorderCode=I),placeholder:"请输入工单编码",clearable:"",onKeyup:Z($,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"工单名称",prop:"workorderName"},{default:l(()=>[e(N,{modelValue:D.workorderName,"onUpdate:modelValue":v[1]||(v[1]=I=>D.workorderName=I),placeholder:"请输入工单名称",clearable:"",onKeyup:Z($,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"产品编号",prop:"productCode"},{default:l(()=>[e(N,{modelValue:D.productCode,"onUpdate:modelValue":v[2]||(v[2]=I=>D.productCode=I),placeholder:"请输入产品编号",clearable:"",onKeyup:Z($,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"产品名称",prop:"productName"},{default:l(()=>[e(N,{modelValue:D.productName,"onUpdate:modelValue":v[3]||(v[3]=I=>D.productName=I),placeholder:"请输入产品名称",clearable:"",onKeyup:Z($,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,{label:"客户名称",prop:"clientName"},{default:l(()=>[e(N,{modelValue:D.clientName,"onUpdate:modelValue":v[4]||(v[4]=I=>D.clientName=I),placeholder:"请输入客户名称",clearable:"",onKeyup:Z($,["enter"])},null,8,["modelValue"])]),_:1}),e(ee,null,{default:l(()=>[e(te,{type:"primary",icon:V(Ce),size:"small",onClick:$},{default:l(()=>v[10]||(v[10]=[f("搜索")])),_:1},8,["icon"]),e(te,{icon:V(We),size:"small",onClick:F},{default:l(()=>v[11]||(v[11]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),[[we,n.value]]),x((c(),k(ce,{data:G.value,onCurrentChange:E,onRowDblclick:A},{default:l(()=>[e(Y,{width:"55",align:"center"},{default:l(I=>[e(C,{modelValue:R.value,"onUpdate:modelValue":v[5]||(v[5]=y=>R.value=y),label:I.row.id,onChange:y=>ae(I.row)},{default:l(()=>v[12]||(v[12]=[f(_e(""))])),_:2},1032,["modelValue","label","onChange"])]),_:1}),e(Y,{label:"工单编码",width:"180",prop:"workorderCode"}),e(Y,{label:"工单名称",width:"200",align:"center",prop:"workorderName","show-overflow-tooltip":!0}),e(Y,{label:"工单来源",align:"center",prop:"orderSource"},{default:l(I=>[e(ue,{type:V(Oe).MES_WORKORDER_SOURCETYPE,value:I.row.orderSource},null,8,["type","value"])]),_:1}),e(Y,{label:"订单编号",width:"140",align:"center",prop:"sourceCode"}),e(Y,{label:"产品编号",width:"120",align:"center",prop:"productCode"}),e(Y,{label:"产品名称",width:"200",align:"center",prop:"productName","show-overflow-tooltip":!0}),e(Y,{label:"规格型号",align:"center",prop:"productSpc","show-overflow-tooltip":!0}),e(Y,{label:"单位",align:"center",prop:"unitOfMeasure"}),e(Y,{label:"工单数量",align:"center",prop:"quantity"}),e(Y,{label:"客户编码",align:"center",prop:"clientCode"}),e(Y,{label:"客户名称",align:"center",prop:"clientName","show-overflow-tooltip":!0}),e(Y,{label:"需求日期",align:"center",prop:"requestDate",width:"180"},{default:l(I=>[B("span",null,_e(V(ll)(I.row.requestDate,"YYYY-MM-DD")),1)]),_:1})]),_:1},8,["data"])),[[fe,w.value]]),x(e(Ae,{total:_.value,page:D.pageNo,"onUpdate:page":v[6]||(v[6]=I=>D.pageNo=I),limit:D.pageSize,"onUpdate:limit":v[7]||(v[7]=I=>D.pageSize=I),onPagination:M},null,8,["total","page","limit"]),[[we,_.value>0]])]),_:1},8,["modelValue"])}}}),Na=Pe(Ia,[["__scopeId","data-v-85cb79ad"]]),Va=async d=>await W.post({url:"/wms/allocated-header/create",data:d}),Sa=async d=>await W.put({url:"/wms/allocated-header/update",data:d}),za=async d=>await W.delete({url:`/wms/allocated-header/delete?id=${d}`}),ql=async d=>await W.get({url:`/wms/allocated-header/get?id=${d}`}),xa=async d=>await W.get({url:"/wms/allocated-header/page",params:d}),Da=async d=>await W.download({url:"/wms/allocated-header/export-excel",params:d}),Ua=async d=>await W.post({url:"/wms/allocated-header/initBom",data:d}),qa=async d=>await W.put({url:`/wms/allocated-header/${d}`}),Ra=async d=>await W.get({url:`/wms/allocated-header/finsh?id=${d}`}),Aa=async d=>await W.post({url:"/wms/allocated-line/updateLine",data:d}),Pa=async d=>await W.get({url:`/wms/allocated-header/createIssue?id=${d}`}),Ta=async d=>await W.get({url:`/mes/autocode/get/${d}`}),Ea=async d=>await W.get({url:`/wms/allocated-record/getByHeaderId?id=${d}`}),Fa={class:"app-container"},Oa={key:0},La={class:"dialog-footer"},Wa={class:"dialog-footer"},Ma={__name:"allocation",setup(d,{expose:m}){const Q=Rl(),g=Xe(()=>Q.currentSize==="mini"?"small":Q.currentSize),w=u(null),R=u(null),J=jl(),n=u({id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),_=u({bindWorkorder:!1,status:"",allocatedDate:null,workorderCode:"",taskCode:"",clientCode:"",remark:"",workorderId:null,taskId:null}),G=u(null),re=u(500),D=u(null),M=u(null),$=u(null),F=u(null),E=u(!1),ae=u(void 0),A=u([]),h=u([]),pe=he({multiple:!1,value:"pId",label:"pName"}),b=u(!0),v=u(!1),N=u([]),ee=u([]),te=u(!0),O=u(!0),C=u(!0),Y=u(!0),ue=u(!1),ce=u(!0),me=u(0),fe=u([]),I=u(""),y=u(!1),s=he({pageNo:1,pageSize:20,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:[],status:null,remark:null,createTime:[],bindWorkorder:null}),de=u(null),L=u([]),T=u([]),se=he({allocatedCode:[{required:!0,message:"调拨单编号不能为空",trigger:"blur"}],warehouseId:[{required:!0,message:"请指定调入仓库",trigger:"blur"}],locationId:[{required:!0,message:"请指定调入库区",trigger:"blur"}],areaId:[{required:!0,message:"请指定调入库位",trigger:"blur"}],workorderCode:[],taskCode:[]}),oe=u(!1),U=u(!1),le=u(null),ke=u(null),H=he({}),ie=u(null),X=Xe(()=>ae.value==="edit");Le(()=>{ve(),Wl(),window.addEventListener("keydown",al),document.addEventListener("click",P),ze(()=>{setTimeout(()=>{le.value&&le.value.focus()},1e3)}),window.addEventListener("resize",Te),Te()}),Jl(()=>{Ke(),window.removeEventListener("resize",Te)}),xl(()=>J.path,()=>{ze(()=>{Te()})}),xl(()=>oe.value,t=>{t?ze(()=>{xe()}):ie.value=null});const Me=t=>{t?n.value.allocatedDate=new Date(t).getTime():t===null&&(n.value.allocatedDate=null)},He=t=>{t?_.value.allocatedDate=new Date(t).getTime():t===null&&(_.value.allocatedDate=null)},Ke=()=>{window.removeEventListener("keydown",al,!1),document.removeEventListener("click",P)},P=()=>{oe.value&&le.value&&xe()},al=t=>{if(t.keyCode===13){if(!t.target.value)return;ke.value=t.target.value;var r=ke.value;if(typeof r=="string"&&r.includes("{")&&r.includes("}")){let p="";r=r.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),console.log(r,"newVal 111"),r=r.replace(/\uFEFF/g,"");try{r=Ll(r);const j=JSON.parse(r);j&&(ie.value=j.id,ke.value=null,p=j.type,xe()),$e(p)}catch{console.log('输入内容不包含完整的 "{" 和 "}"')}}else if(typeof r=="object"&&r.id){let p="";ie.value=r.id,p=r.type,ke.value=null,xe(),$e(p)}else console.log('输入内容不包含完整的 "{" 和 "}"')}},Te=()=>{ze(()=>{if(!G.value)return;const t=window.innerHeight,a=G.value.getBoundingClientRect().top,p=t-a-100;re.value=Math.max(300,p)})},El=()=>{ie.value=null,ke.value=null,xe()},Fl=t=>{N.value=t.map(a=>a.id),te.value=t.length!==1,C.value=!t.length},Ol=t=>{de.value?.toggleRowSelection(t)};function Ll(t){let a=0,r=!1,p=!1;for(let j=0;j<t.length;j++){const S=t[j];if(p){p=!1;continue}if(S==="\\"){p=!0;continue}if(S==='"'&&(r=!r),!r){if(S==="{")a++;else if(S==="}"&&(a--,a===0)){const Ve=t.slice(0,j+1);try{return Ve}catch{throw new Error("Invalid JSON object")}}}}throw new Error("No valid JSON object found")}const xe=()=>{oe.value&&le.value&&ze(()=>{setTimeout(()=>{le.value&&le.value.focus()},300)})},ve=()=>{b.value=!0,xa(s).then(t=>{fe.value=t.list,me.value=t.total,b.value=!1})},Wl=()=>{Tl().then(t=>{h.value=t,h.value.map(a=>{a.pId=a.id,a.pName=a.warehouseName,a.children.map(r=>{r.pId=r.id,r.pName=r.locationName,r.children.map(p=>{p.pId=p.id,p.pName=p.areaName})})})})},Be=()=>{y.value=!1,L.value=[],T.value=[],oe.value=!1,Ee()},Ee=()=>{Object.assign(n.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bomList:[]}),Object.assign(_.value,{id:null,allocatedCode:null,allocatedName:null,workstationId:null,workstationCode:null,workstationName:null,workorderId:null,workorderCode:null,taskId:null,taskCode:null,clientId:null,clientCode:null,clientName:null,clientNick:null,warehouseId:null,warehouseCode:null,warehouseName:null,locationId:null,locationCode:null,locationName:null,areaId:null,areaCode:null,areaName:null,allocatedDate:null,status:"PREPARE",remark:null,bindWorkorder:!1}),Object.keys(H).forEach(t=>{delete H[t]}),E.value=!1,L.value=[],A.value=[],R.value&&R.value.resetFields(),D.value&&D.value.resetFields()},Ie=()=>{s.pageNo=1,ve()},tl=()=>{w.value&&w.value.resetFields(),Ie()},ol=()=>{Ee(),y.value=!0,I.value="添加调拨单",ae.value="add",A.value=[]},nl=t=>{Ee();const a=t.id;ql(a).then(r=>{Object.assign(n.value,r),n.value.bindWorkorder=n.value.bindWorkorder==="true",A.value=[r.warehouseId,r.locationId,r.areaId],L.value=r.bomList,T.value=[],y.value=!0,I.value="修改调拨单",ae.value="edit"})},rl=()=>{R.value.validate(t=>{if(t){if(n.value.bindWorkorder||(n.value.bindWorkorder=!1),n.value.warehouseId==null||n.value.locationId==null||n.value.areaId==null){K.error("请选择调拨仓库、库区、库位信息！");return}if(T.value.length===0&&n.value.bindWorkorder===!0){K.error("请选择需要调拨的BOM信息");return}if(n.value.bomList=T.value.map(a=>({...a,quantityAllocated:parseFloat(a.quantityAllocated)})),n.value.id!=null){Sa(n.value).then(a=>{K.success("修改成功"),y.value=!1,ve()});return}n.value.bomList=T.value,Va(n.value).then(a=>{K.success("新增成功"),y.value=!1,ve()})}})},ul=t=>{const a=t.id;Ge.confirm('是否确认删除调拨单头编号为"'+a+'"的数据项?').then(()=>za(a)).then(()=>{ve(),K.success("删除成功")}).catch(()=>{})},dl=()=>{let t={...s};t.pageNo=void 0,t.pageSize=void 0,Ge.confirm("是否确认导出所有调拨单头数据项?").then(()=>(ue.value=!0,Da(t))).then(a=>{ea.excel(a,"调拨单头.xls"),K.success("导出成功"),ue.value=!1}).catch(()=>{})},Ye=t=>{t!==null?(n.value.warehouseId=t[0],n.value.locationId=t[1],n.value.areaId=t[2]):(n.value.warehouseId=null,n.value.locationId=null,n.value.areaId=null)},Qe=()=>{M.value.showFlag=!0},Ml=t=>{t!=null&&t!=null&&(n.value.workorderId=t.id,n.value.workorderCode=t.workorderCode,n.value.workorderName=t.workorderName,n.value.clientId=t.clientId,n.value.clientCode=t.clientCode,n.value.clientName=t.clientName),v.value=!0,Ua(n.value.workorderCode).then(a=>{L.value=a,v.value=!1})},sl=t=>{t?(b.value=!0,Ta("ALLOCATED_CODE").then(a=>{n.value.allocatedCode=a,b.value=!1})):n.value.allocatedCode=null},il=t=>{Ee();const a=t.id||N.value;b.value=!0,Ra(a).then(r=>{K.success("成功"),y.value=!1,b.value=!1,ve()}).catch(()=>{b.value=!1,ve()})},pl=t=>{T.value=t.map(a=>({...a}))},cl=t=>{ml(t.id,!1)},Hl=t=>{ml(t.id,!0)},ml=(t,a)=>{H.id=t,ze(()=>{D.value&&D.value.resetFields()}),ql(t).then(r=>{Object.assign(H,r),H.bindWorkorder=H.bindWorkorder==="true",A.value=[r.warehouseId,r.locationId,r.areaId],A.value[0]=r.warehouseId,A.value[1]=r.locationId,A.value[2]=r.areaId,L.value=r.bomList}),Ea(t).then(r=>{T.value=r}),U.value=a,oe.value=!0},fl=()=>{if(!ie.value){K.error("请扫描正确的单据信息!");return}$e()},vl=()=>{F.value.showFlag=!0,F.value.getList()},gl=()=>{const t=ee.value;T.value=T.value.filter(a=>!t.includes(a.id))},wl=t=>{ee.value=t.map(a=>a.id),O.value=t.length!==1,Y.value=!t.length},$e=t=>{let a="";if(t&&(a=t),!A.value||!Array.isArray(A.value)||A.value.length<3||!A.value[0]||!A.value[1]||!A.value[2]){K.error("请选择调拨仓库、库区、库位信息！");return}if(!ie.value){K.error("请输入或扫描单据信息!");return}const r=parseInt(ie.value);if(isNaN(r)){K.error("单据ID格式不正确，请重新输入或扫描!");return}let p={id:r,type:a,method:"allocated",warehouseId:A.value[0],locationId:A.value[1],areaId:A.value[2]};b.value=!0,la(p).then(j=>{b.value=!1;let S=j;S.quantityAllocated=S.quantityOnhand,T.value.some(z=>z.itemCode===S.itemCode&&z.batchCode===S.batchCode)?K.error("物料唯一码已存在，请勿添加重复项。"):(K.success("新增成功"),T.value.push(S))})},kl=async()=>{let t={headerId:H.id,bomList:T.value};b.value=!0;try{await Aa(t),await qa(H.id),b.value=!1,ve(),K.success("出库成功"),oe.value=!1}catch{K.error("操作失败"),b.value=!1}},bl=t=>{const a=parseFloat(t.quantityAllocated);if(isNaN(a)||a<=0){K.error("调拨数量必须为大于0的正数"),t.quantityAllocated="";return}const r=T.value.findIndex(p=>p.itemCode===t.itemCode);r!==-1&&(T.value[r]={...T.value[r],quantityAllocated:a})},je=()=>{$.value.showFlag=!0,$.value.getList()},Kl=t=>{t!=null&&t!=null&&(n.value.taskId=t.id,n.value.taskCode=t.taskCode,n.value.taskName=t.taskName,n.value.workstationId=t.workstationId,n.value.workstationCode=t.workstationCode,n.value.workstationName=t.workstationName,n.value.processId=t.processId,n.value.processCode=t.processCode,n.value.processName=t.processName)},Bl=t=>{t!=null&&t!=null&&(H.taskId=t.id,H.taskCode=t.taskCode,H.taskName=t.taskName,H.workstationId=t.workstationId,H.workstationCode=t.workstationCode,H.workstationName=t.workstationName,H.processId=t.processId,H.processCode=t.processCode,H.processName=t.processName)},Yl=t=>{if(t!=null&&t!=null)for(let a=0;a<t.length;a++){let r=t[a];r.quantityAllocated=r.quantityOnhand,T.value.some(j=>j.itemCode===r.itemCode&&j.batchCode===r.batchCode)?K.error("物料唯一码已存在，请勿添加重复项。"):T.value.push(r)}},Cl=t=>{n.value.bindWorkorder=t,R.value&&R.value.validate()},_l=()=>{Ge.confirm("确认生成领料单吗?").then(()=>{b.value=!0;const t=N.value;Pa(t).then(()=>{b.value=!1,ve(),K.success("领料单创建成功"),oe.value=!1}).catch(a=>{K.error("领料单创建失败"),b.value=!1})}).catch(()=>{K.info("已取消")})};return m({queryParams:s,showSearch:ce,loading:b,list:fe,total:me,single:te,multiple:C,exportLoading:ue,handleQuery:Ie,resetQuery:tl,handleAdd:ol,handleUpdate:nl,handleDelete:ul,handleExport:dl,handleFinsh:il,handleIssue:_l,handleExecute:cl,form:n,rules:se,autoGenFlag:E,optType:ae,warehouseInfo:A,warehouseOptions:h,warehouseProps:pe,bomList:L,allocatedList:T,bomLoadding:v,open:y,title:I,isEdit:X,handleAutoGenChange:sl,handleWarehouseChanged:Ye,handleWorkorderSelect:Qe,handleTaskSelect:je,handleBindWorkorderChange:Cl,handleBomSelectionChange:pl,handleQuantityChange:bl,submitForm:rl,cancel:Be,executeDialogVisible:oe,executeForm:H,purchaseId:ie,allocatedSingle:O,allocatedHandleAdd:fl,allocatedHandleBatchAdd:vl,allocatedHandleDelete:gl,allocatedHandleSelectionChange:wl,executeAllocated:kl}),(t,a)=>{const r=i("el-input"),p=i("el-form-item"),j=i("el-date-picker"),S=i("el-button"),Ve=i("el-form"),z=i("el-col"),ge=i("el-row"),q=i("el-table-column"),Ql=Al,De=i("el-table"),$l=Ae,hl=i("el-switch"),yl=i("el-cascader"),Il=i("el-option"),Nl=i("el-select"),Fe=i("el-divider"),Vl=i("el-card"),Sl=i("el-dialog"),be=ye("hasPermi"),Ue=ye("loading"),zl=ye("dialogDrag");return c(),Ne("div",Fa,[x(e(Ve,{model:s,ref:"queryFormRef",size:g.value,inline:!0,"label-width":"100px"},{default:l(()=>[e(p,{label:"调拨单号",prop:"allocatedCode"},{default:l(()=>[e(r,{modelValue:s.allocatedCode,"onUpdate:modelValue":a[0]||(a[0]=o=>s.allocatedCode=o),placeholder:"请输入调拨单编号",clearable:"",onKeyup:Z(Ie,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(r,{modelValue:s.allocatedName,"onUpdate:modelValue":a[1]||(a[1]=o=>s.allocatedName=o),placeholder:"请输入调拨单名称",clearable:"",onKeyup:Z(Ie,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"工单编码",prop:"workorderCode"},{default:l(()=>[e(r,{modelValue:s.workorderCode,"onUpdate:modelValue":a[2]||(a[2]=o=>s.workorderCode=o),placeholder:"请输入生产工单编码",clearable:"",onKeyup:Z(Ie,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"仓库名称",prop:"warehouseName"},{default:l(()=>[e(r,{modelValue:s.warehouseName,"onUpdate:modelValue":a[3]||(a[3]=o=>s.warehouseName=o),placeholder:"请输入仓库名称",clearable:"",onKeyup:Z(Ie,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(j,{modelValue:s.allocatedDate,"onUpdate:modelValue":a[4]||(a[4]=o=>s.allocatedDate=o),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),e(p,null,{default:l(()=>[e(S,{type:"primary",icon:V(Ce),onClick:Ie},{default:l(()=>a[30]||(a[30]=[f("搜索")])),_:1},8,["icon"]),e(S,{icon:V(We),onClick:tl},{default:l(()=>a[31]||(a[31]=[f("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[we,ce.value]]),e(ge,{gutter:10,class:"mb8"},{default:l(()=>[e(z,{span:1.5},{default:l(()=>[x((c(),k(S,{type:"primary",icon:V(Je),size:g.value,onClick:ol},{default:l(()=>a[32]||(a[32]=[f("新增 ")])),_:1},8,["icon","size"])),[[be,["wms:allocated-header:create"]]])]),_:1}),e(z,{span:1.5},{default:l(()=>[x((c(),k(S,{type:"warning",plain:"",icon:V(Gl),size:g.value,onClick:dl,loading:ue.value},{default:l(()=>a[33]||(a[33]=[f("导出 ")])),_:1},8,["icon","size","loading"])),[[be,["wms:allocated-header:export"]]])]),_:1}),e(z,{span:1.5},{default:l(()=>[x((c(),k(S,{type:"success",plain:"",icon:V(Dl),size:g.value,onClick:il,disabled:te.value},{default:l(()=>a[34]||(a[34]=[f("完成 ")])),_:1},8,["icon","size","disabled"])),[[be,["wms:allocated-header:finsh"]]])]),_:1}),e(z,{span:1.5},{default:l(()=>[x((c(),k(S,{plain:"",icon:V(Dl),size:g.value,onClick:_l,disabled:te.value},{default:l(()=>a[35]||(a[35]=[f("生成领料单 ")])),_:1},8,["icon","size","disabled"])),[[be,["wms:allocated-header:createIssue"]]])]),_:1})]),_:1}),B("div",{class:"table-container",ref_key:"tableContainerRef",ref:G},[x((c(),k(De,{ref_key:"multipleTableRef",ref:de,height:re.value,data:fe.value,size:g.value,class:"touch-scroll-table",onSelectionChange:Fl,onRowClick:Ol},{default:l(()=>[U.value?ne("",!0):(c(),k(q,{key:0,type:"selection",width:"55",align:"center"})),e(q,{label:"调拨单编号",align:"center",prop:"allocatedCode"}),e(q,{label:"调拨单名称",align:"center",prop:"allocatedName"}),e(q,{label:"生产工单",align:"center",prop:"workorderCode"}),e(q,{label:"调拨日期",align:"center",prop:"allocatedDate"},{default:l(o=>[B("span",null,_e(V(ll)(o.row.allocatedDate,"YYYY-MM-DD")),1)]),_:1}),e(q,{label:"单据状态",align:"center",prop:"status"},{default:l(o=>[e(Ql,{type:V(Oe).MES_ALLOCATED_STATUS,value:o.row.status},null,8,["type","value"])]),_:1}),e(q,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[o.row.status!="FINISHED"?x((c(),k(S,{key:0,size:g.value,type:"text",onClick:Se=>cl(o.row)},{default:l(()=>a[36]||(a[36]=[f("执行领出")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:allocated"]]]):ne("",!0),x((c(),k(S,{size:g.value,type:"text",onClick:Se=>nl(o.row)},{default:l(()=>a[37]||(a[37]=[f("修改 ")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:update"]]]),x((c(),k(S,{size:g.value,type:"text",onClick:Se=>ul(o.row)},{default:l(()=>a[38]||(a[38]=[f("删除 ")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:delete"]]]),x((c(),k(S,{size:g.value,type:"text",onClick:Se=>Hl(o.row)},{default:l(()=>a[39]||(a[39]=[f("详情")])),_:2},1032,["size","onClick"])),[[be,["wms:allocated-header:allocated"]]])]),_:1})]),_:1},8,["height","data","size"])),[[Ue,b.value]]),x(e($l,{total:me.value,page:s.pageNo,"onUpdate:page":a[5]||(a[5]=o=>s.pageNo=o),limit:s.pageSize,"onUpdate:limit":a[6]||(a[6]=o=>s.pageSize=o),onPagination:ve},null,8,["total","page","limit"]),[[we,me.value>0]])],512),x((c(),k(Sl,{title:I.value,modelValue:y.value,"onUpdate:modelValue":a[17]||(a[17]=o=>y.value=o),width:"80%","append-to-body":""},{footer:l(()=>[B("div",La,[e(S,{size:g.value,type:"primary",onClick:rl},{default:l(()=>a[42]||(a[42]=[f("确 定")])),_:1},8,["size"]),e(S,{size:g.value,onClick:Be},{default:l(()=>a[43]||(a[43]=[f("取 消")])),_:1},8,["size"])])]),default:l(()=>[e(Ve,{ref_key:"formRef",ref:R,size:g.value,model:n.value,rules:se},{default:l(()=>[e(ge,null,{default:l(()=>[e(z,{span:8},{default:l(()=>[e(p,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(r,{disabled:X.value,modelValue:n.value.allocatedCode,"onUpdate:modelValue":a[7]||(a[7]=o=>n.value.allocatedCode=o),placeholder:"请输入调拨单编号"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(z,{span:4},{default:l(()=>[e(p,null,{default:l(()=>[ae.value!="view"&&n.value.status=="PREPARE"?(c(),k(hl,{key:0,modelValue:E.value,"onUpdate:modelValue":a[8]||(a[8]=o=>E.value=o),"active-color":"#13ce66","active-text":"自动生成",onChange:sl},null,8,["modelValue"])):ne("",!0)]),_:1})]),_:1}),e(z,{span:12},{default:l(()=>[e(p,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(r,{disabled:"",modelValue:n.value.allocatedName,"onUpdate:modelValue":a[9]||(a[9]=o=>n.value.allocatedName=o),placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge,null,{default:l(()=>[e(z,{span:8},{default:l(()=>[e(p,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(j,{clearable:"",modelValue:n.value.allocatedDate,"onUpdate:modelValue":a[10]||(a[10]=o=>n.value.allocatedDate=o),type:"date",onChange:Me,placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(z,{span:8},{default:l(()=>[e(p,{label:"领料仓库"},{default:l(()=>[e(yl,{modelValue:A.value,"onUpdate:modelValue":a[11]||(a[11]=o=>A.value=o),options:h.value,props:pe,placeholder:"请选择",onChange:Ye},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(z,{span:8},{default:l(()=>[e(p,{label:"单据状态",prop:"status"},{default:l(()=>[e(Nl,{modelValue:n.value.status,"onUpdate:modelValue":a[12]||(a[12]=o=>n.value.status=o),disabled:""},{default:l(()=>[(c(!0),Ne(qe,null,Re(V(Oe).MES_ALLOCATED_STATUS,o=>(c(),k(Il,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge,null,{default:l(()=>[e(z,{span:2}),e(z,{span:6},{default:l(()=>[e(p,{"label-width":"80"},{default:l(()=>[ae.value!="view"&&n.value.status=="PREPARE"?(c(),k(hl,{key:0,style:{"margin-left":"10%"},modelValue:n.value.bindWorkorder,"onUpdate:modelValue":a[13]||(a[13]=o=>n.value.bindWorkorder=o),"active-color":"#13ce66","inactive-text":"绑定工单",onChange:Cl},null,8,["modelValue"])):ne("",!0)]),_:1})]),_:1}),n.value&&n.value.bindWorkorder?(c(),k(z,{key:0,span:8},{default:l(()=>[e(p,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(r,{modelValue:n.value.workorderCode,"onUpdate:modelValue":a[14]||(a[14]=o=>n.value.workorderCode=o),placeholder:"请选择生产工单"},{append:l(()=>[e(S,{icon:V(Ce),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Na,{ref_key:"woSelectRef",ref:M,onOnSelected:Ml},null,512)]),_:1})):ne("",!0),n.value&&n.value.bindWorkorder?(c(),k(z,{key:1,span:8},{default:l(()=>[e(p,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(r,{modelValue:n.value.taskCode,"onUpdate:modelValue":a[15]||(a[15]=o=>n.value.taskCode=o),placeholder:"请选择生产任务"},{append:l(()=>[e(S,{icon:V(Ce),onClick:je},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Ul,{ref:"taskSelectRef",workorderId:n.value.workorderId,onOnSelected:Kl},null,8,["workorderId"])]),_:1})):ne("",!0)]),_:1}),e(ge,null,{default:l(()=>[e(z,{span:24},{default:l(()=>[e(p,{label:"备注",prop:"remark"},{default:l(()=>[e(r,{modelValue:n.value.remark,"onUpdate:modelValue":a[16]||(a[16]=o=>n.value.remark=o),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["size","model","rules"]),n.value&&n.value.bindWorkorder?(c(),Ne("div",Oa,[e(Fe,{"content-position":"center"},{default:l(()=>a[40]||(a[40]=[f("物料信息")])),_:1}),e(Vl,{shadow:"always",class:"box-card"},{default:l(()=>[x((c(),k(De,{size:g.value,"max-height":"300",data:L.value,onSelectionChange:pl},{default:l(()=>[e(q,{type:"selection",width:"65",align:"center"}),e(q,{label:"物料编码",align:"center",prop:"itemCode"}),e(q,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(q,{width:"210",label:"需求数量",align:"center",prop:"quantityAllocated"}),e(q,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ue,v.value]])]),_:1}),e(Fe,{"content-position":"center"},{default:l(()=>a[41]||(a[41]=[f("调拨信息")])),_:1}),e(Vl,{shadow:"always",class:"box-card"},{default:l(()=>[x((c(),k(De,{size:g.value,"max-height":"300",data:T.value,"row-key":"itemCode"},{default:l(()=>[e(q,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(q,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(q,{width:"220",label:"调拨数量",align:"center",prop:"quantityAllocated"},{default:l(o=>[e(r,{modelValue:o.row.quantityAllocated,"onUpdate:modelValue":Se=>o.row.quantityAllocated=Se,type:"number",placeholder:"请输入数量",onBlur:Se=>bl(o.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(q,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ue,v.value]])]),_:1})])):ne("",!0)]),_:1},8,["title","modelValue"])),[[zl]]),x((c(),k(Sl,{title:U.value?"详情":"执行出库",class:"execute-dialog",modelValue:oe.value,"onUpdate:modelValue":a[29]||(a[29]=o=>oe.value=o),width:"92%","append-to-body":""},{footer:l(()=>[B("span",Wa,[e(S,{size:g.value,onClick:Be},{default:l(()=>a[51]||(a[51]=[f("取 消")])),_:1},8,["size"]),U.value?ne("",!0):(c(),k(S,{key:0,size:g.value,type:"primary",onClick:kl},{default:l(()=>a[52]||(a[52]=[f("确 定")])),_:1},8,["size"]))])]),default:l(()=>[e(Ve,{size:g.value,ref_key:"executeFormRef",ref:D,model:_.value,"label-width":"100px"},{default:l(()=>[e(ge,null,{default:l(()=>[e(z,{span:8},{default:l(()=>[e(p,{label:"调拨单编号",prop:"allocatedCode"},{default:l(()=>[e(r,{modelValue:_.value.allocatedCode,"onUpdate:modelValue":a[18]||(a[18]=o=>_.value.allocatedCode=o),disabled:"",placeholder:"请输入调拨单编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(z,{span:12},{default:l(()=>[e(p,{label:"调拨单名称",prop:"allocatedName"},{default:l(()=>[e(r,{modelValue:_.value.allocatedName,"onUpdate:modelValue":a[19]||(a[19]=o=>_.value.allocatedName=o),disabled:"",placeholder:"请输入调拨单名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge,null,{default:l(()=>[e(z,{span:8},{default:l(()=>[e(p,{label:"调拨日期",prop:"allocatedDate"},{default:l(()=>[e(j,{clearable:"",modelValue:_.value.allocatedDate,"onUpdate:modelValue":a[20]||(a[20]=o=>_.value.allocatedDate=o),disabled:"",type:"date",onChange:He,placeholder:"选择调拨日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(z,{span:8},{default:l(()=>[e(p,{label:"领料仓库"},{default:l(()=>[e(yl,{disabled:"",modelValue:A.value,"onUpdate:modelValue":a[21]||(a[21]=o=>A.value=o),options:h.value,props:pe,onChange:Ye},null,8,["modelValue","options","props"])]),_:1})]),_:1}),e(z,{span:8},{default:l(()=>[e(p,{label:"单据状态",prop:"status"},{default:l(()=>[e(Nl,{disabled:"",modelValue:_.value.status,"onUpdate:modelValue":a[22]||(a[22]=o=>_.value.status=o)},{default:l(()=>[(c(!0),Ne(qe,null,Re(V(Oe).MES_ALLOCATED_STATUS,o=>(c(),k(Il,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),_.value.bindWorkorder?(c(),k(ge,{key:0},{default:l(()=>[e(z,{span:8},{default:l(()=>[e(p,{label:"生产工单",prop:"workorderCode"},{default:l(()=>[e(r,{disabled:"",modelValue:_.value.workorderCode,"onUpdate:modelValue":a[23]||(a[23]=o=>_.value.workorderCode=o),placeholder:"请选择生产工单"},{append:l(()=>[e(S,{disabled:"",icon:V(Ce),onClick:Qe},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(z,{span:8},{default:l(()=>[e(p,{label:"生产任务",prop:"taskCode"},{default:l(()=>[e(r,{disabled:"",modelValue:_.value.taskCode,"onUpdate:modelValue":a[24]||(a[24]=o=>_.value.taskCode=o),placeholder:"请选择生产任务"},{append:l(()=>[e(S,{disabled:"",icon:V(Ce),onClick:je},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(Ul,{ref:"taskSelectRef",workorderId:_.value.workorderId,onOnSelected:Bl},null,8,["workorderId"])]),_:1}),e(z,{span:8},{default:l(()=>[e(p,{label:"客户编号"},{default:l(()=>[e(r,{disabled:"",modelValue:_.value.clientCode,"onUpdate:modelValue":a[25]||(a[25]=o=>_.value.clientCode=o),placeholder:"请选择生产工单"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):ne("",!0),e(ge,null,{default:l(()=>[e(z,{span:24},{default:l(()=>[e(p,{label:"备注",prop:"remark"},{default:l(()=>[e(r,{disabled:"",modelValue:_.value.remark,"onUpdate:modelValue":a[26]||(a[26]=o=>_.value.remark=o),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),_.value.bindWorkorder?(c(),k(Fe,{key:1,"content-position":"center"},{default:l(()=>a[44]||(a[44]=[f("BOM信息")])),_:1})):ne("",!0),_.value.bindWorkorder?x((c(),k(De,{key:2,size:g.value,"max-height":"200",data:L.value,style:{width:"100%"}},{default:l(()=>[e(q,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(q,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(q,{label:"需求数量",align:"center",prop:"quantityAllocated"}),e(q,{width:"80",label:"单位",align:"center",prop:"unitOfMeasure"})]),_:1},8,["size","data"])),[[Ue,v.value]]):ne("",!0),e(Fe,{"content-position":"center"},{default:l(()=>a[45]||(a[45]=[f("调拨信息")])),_:1}),U.value?ne("",!0):(c(),k(ge,{key:3,gutter:10},{default:l(()=>[e(z,{span:8},{default:l(()=>[e(p,{label:"单据信息",prop:"purchaseId"},{default:l(()=>[e(r,{readonly:"",modelValue:ie.value,"onUpdate:modelValue":a[27]||(a[27]=o=>ie.value=o),placeholder:"请输入"},null,8,["modelValue"]),x(B("input",{ref_key:"scannerInput",ref:le,"onUpdate:modelValue":a[28]||(a[28]=o=>ke.value=o),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"1",height:"1","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[Xl,ke.value]]),a[46]||(a[46]=B("span",null,"支持扫码枪扫描, 无法扫码时点击重置按钮",-1))]),_:1})]),_:1}),e(z,{span:4},{default:l(()=>[e(S,{type:"primary",round:"",onClick:El},{default:l(()=>a[47]||(a[47]=[f("重置")])),_:1})]),_:1}),e(z,{span:2.5},{default:l(()=>[e(S,{type:"primary",style:{"margin-right":"10px"},icon:V(Je),size:g.value,onClick:fl},{default:l(()=>a[48]||(a[48]=[f("新增")])),_:1},8,["icon","size"])]),_:1}),e(z,{span:2.5},{default:l(()=>[x((c(),k(S,{type:"primary",style:{"margin-right":"10px"},icon:V(Je),size:g.value,onClick:vl},{default:l(()=>a[49]||(a[49]=[f("批量新增")])),_:1},8,["icon","size"])),[[be,["wms:allocated-header:batchAdd"]]])]),_:1}),e(_a,{ref_key:"stockSelectRef",ref:F,onOnSelected:Yl},null,512),e(z,{span:2.5},{default:l(()=>[e(S,{type:"danger",icon:V(Zl),size:g.value,disabled:O.value,onClick:gl},{default:l(()=>a[50]||(a[50]=[f("删除")])),_:1},8,["icon","size","disabled"])]),_:1})]),_:1})),x((c(),k(De,{size:g.value,data:T.value,onSelectionChange:wl},{default:l(()=>[U.value?ne("",!0):(c(),k(q,{key:0,type:"selection",width:"55",align:"center"})),e(q,{label:"序号",width:"55",align:"center"},{default:l(o=>[f(_e(o.$index+1),1)]),_:1}),e(q,{label:"物料编码","show-overflow-tooltip":!0,align:"center",prop:"itemCode"}),e(q,{label:"物料名称","show-overflow-tooltip":!0,align:"center",prop:"itemName"}),e(q,{label:"调拨数量","show-overflow-tooltip":!0,align:"center",prop:"quantityAllocated"}),e(q,{width:"70",label:"单位",align:"center",prop:"unitOfMeasure"}),e(q,{label:"批次号","show-overflow-tooltip":!0,align:"center",prop:"batchCode"}),e(q,{label:"调拨标识","show-overflow-tooltip":!0,width:"90",align:"center",prop:"allocatedFlag"}),e(q,{label:"仓库名称","show-overflow-tooltip":!0,align:"center",prop:"warehouseName"}),e(q,{label:"库区名称","show-overflow-tooltip":!0,align:"center",prop:"locationName"}),e(q,{label:"库位名称","show-overflow-tooltip":!0,align:"center",prop:"areaName"})]),_:1},8,["size","data"])),[[Ue,b.value]])]),_:1},8,["size","model"])]),_:1},8,["title","modelValue"])),[[zl]])])}}},$a=Pe(Ma,[["__scopeId","data-v-ae78d7b9"]]);export{$a as default};
