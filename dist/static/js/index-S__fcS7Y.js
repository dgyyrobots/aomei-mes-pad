/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:10:14 
 */
import{V as io,W as po,O as Te,r as f,f as Y,b as mo,X as ne,R as fo,Y as co,Z as s,g as S,h as ue,c as ye,o as T,w as y,j as o,$ as Oe,m as l,J as $,a as E,D as vo,v as g,a0 as go,k as b,a1 as be,a2 as No,G as _o,a3 as To,a4 as yo,i as R,t as De,x as Oo,C as Pe,M as bo,F as Do,n as Po,a5 as So,T as x,a6 as wo}from"./index-BdC40rFX.js";import{_ as Eo}from"./DictTag.vue_vue_type_script_lang-BKaaD_BY.js";import{g as Ro,a as Io,b as Se,c as Lo,e as Co,r as Vo,d as zo,u as ho,f as Ao,s as ko,h as xo,i as Uo,j as Fo}from"./index-C4-jGAeO.js";import"./CLodopfuncs2-DO7GswBP.js";import{l as Mo}from"./index-TKlTgF_V.js";import{D as we}from"./dict-D4wjFrBa.js";import"./color-B5phLuB-.js";const qo=async()=>await io.get({url:"/wms/warehouse/getTreeList"}),Xo={class:"app-container"},Yo={class:"dialog-footer"},Bo={class:"dialog-footer"},Qo={style:{"text-align":"right","margin-top":"20px"}},jo={class:"dialog-footer"},Ho={class:"dialog-footer"},ll={__name:"index",setup(Go){const re=po(),p=Te(()=>re.currentSize==="mini"?"small":re.currentSize),h=f(null),U=f(null),D=f(!0),J=f(!1),K=f(!0),B=f(0),Z=f([]),F=f([]),Q=f(""),ee=f(!0),se=f(!0),M=f(!1),L=f(!1),ie=f([]),i=f([]),C=f(1),A=f(!1),q=f(!1),de=f(null),j=f(null),pe=f(null),Ee=f(null),Re=f(null),me=f(null),Ie=f(null),_=Y({pageNo:1,pageSize:10,purchaseId:null,goodsNumber:null,goodsName:null,goodsSpecs:null,company:null,monovalent:null,quantity:null,taxes:null,total:null,categoryName:null,brandName:null,createTime:[]}),m=Y({}),N=Y({}),c=Y({poNo:"",goodsNumber:"",receiveNum:"",unitOfMeasure:""}),O=f([]),P=Y({splitQuantity:"",splitCount:""}),oe=f([]),Le={multiple:!1,value:"pId",label:"pName"},fe={poNo:[{required:!0,message:"采购单号不能为空",trigger:"blur"}],goodsNumber:[{required:!0,message:"商品编号不能为空",trigger:"blur"}],company:[{required:!0,message:"商品单位不能为空",trigger:"blur"}],quantity:[{required:!0,message:"采购数量不能为空",trigger:"blur"}],receiveNum:[{required:!0,message:"收货数量不能为空",trigger:"blur"}],unitOfMeasure:[{required:!0,message:"收货单位不能为空",trigger:"blur"}]};Te(()=>i.value.length>0);const Ce=()=>{N.poNo="",h.value=null,X()},w=async()=>{D.value=!0;try{const a=await Io(_);Z.value=a.list,B.value=a.total}finally{D.value=!1}},k=()=>{_.pageNo=1,Z.value=[],B.value=0,w()},Ve=()=>{de.value?.resetFields(),Object.assign(_,{pageNo:1,pageSize:10,poNo:void 0,goodsNumber:void 0,goodsName:void 0,goodsSpecs:void 0,company:void 0,monovalent:void 0,quantity:void 0,taxes:void 0,total:void 0,categoryName:void 0,brandName:void 0,createTime:[]}),k()},ze=a=>{i.value=a,ee.value=a.length!==1,se.value=!a.length},he=a=>{me.value?.toggleRowSelection(a)},le=()=>{M.value=!1,L.value=!1,F.value=[],A.value=!1,C.value=1,ce()},ce=()=>{Object.assign(m,{id:void 0,purchaseId:void 0,goodsNumber:void 0,goodsName:void 0,goodsSpecs:void 0,company:void 0,monovalent:void 0,quantity:void 0,taxes:void 0,total:void 0,categoryName:void 0,brandName:void 0}),Object.assign(N,{id:void 0,purchaseId:void 0,goodsNumber:void 0,goodsName:void 0,goodsSpecs:void 0,company:void 0,monovalent:void 0,quantity:void 0,taxes:void 0,total:void 0,categoryName:void 0,brandName:void 0}),j.value?.resetFields(),pe.value?.resetFields()},X=()=>{L.value&&U.value&&ne(()=>{U.value.focus(),isFocused.value=!0})};mo(()=>{w(),Qe(),window.addEventListener("keydown",ve),document.addEventListener("click",()=>{L.value&&X()}),ne(()=>{setTimeout(X,500)})}),fo(()=>{Ae()});const Ae=()=>{window.removeEventListener("keydown",ve,!1)};co(()=>L.value,a=>{a?ne(()=>{setTimeout(()=>{U.value&&(U.value.focus(),console.log("设置焦点成功"))},300)}):N.poNo=null});const ve=a=>{if(!a.target.value)return;if(a.keyCode===13){h.value=a.target.value;var t=h.value;if(typeof t=="string"&&t.includes("{")&&t.includes("}")){t=t.replace(/"/g,'"').replace(/"/g,'"').replace(/：/g,":").replace(/，/g,","),console.log(t,"newVal 111"),t=t.replace(/\uFEFF/g,""),t=ke(t);const u=JSON.parse(t);try{u&&u.po_no&&(h.value=null,N.poNo=u.po_no,ae(),X())}catch{s.error("扫描结果不是有效的 JSON 字符串")}}else typeof t=="object"&&t.po_no?(N.poNo=t.po_no,h.value=null,ae(),X()):console.log('输入内容不包含完整的 "{" 和 "}"')}};function ke(a){let e=0,t=!1,u=!1;for(let r=0;r<a.length;r++){const I=a[r];if(u){u=!1;continue}if(I==="\\"){u=!0;continue}if(I==='"'&&(t=!t),!t){if(I==="{")e++;else if(I==="}"&&(e--,e===0)){const v=a.slice(0,r+1);try{return v}catch{throw new Error("Invalid JSON object")}}}}throw new Error("No valid JSON object found")}const xe=async a=>{ce();const e=a.id||i.value[0].id;if(a.status!=0){s.error("该单据已入库，禁止修改！");return}try{const t=await Mo();ie.value=t;const u=await Se(e);u.unitOfMeasure=u.unitOfMeasure||u.company,m.receiveNum||(m.receiveNum=m.quantity,m.unitOfMeasure=m.company),Object.assign(m,u),M.value=!0,Q.value="修改采购商品明细"}catch(t){console.error("获取数据失败:",t)}},Ue=async()=>{if(j.value)try{await j.value.validate(),m.id!=null?(await ho(m),s.success("收货成功")):(await Ao(m),s.success("新增成功")),M.value=!1,w()}catch(a){console.error("提交失败:",a)}},Fe=async a=>{const e=a.id;try{await x.confirm('是否确认删除采购商品明细编号为"'+e+'"的数据项?'),await zo(e),w(),s.success("删除成功")}catch(t){console.error("删除失败:",t)}},Me=async()=>{const a={..._};delete a.pageNo,delete a.pageSize;try{await x.confirm("是否确认导出所有采购商品明细数据项?"),J.value=!0;const e=await Co(a);console.log("response",e),wo.excel(e,"采购商品明细.xls"),s.success("导出成功")}catch(e){console.error("导出失败:",e)}finally{J.value=!1}},qe=async()=>{try{const a=await Lo(i.value[0].poNo);if(!a){s.error("采购单: "+i.value[0].poNo+"存在未配置单位与收货数量的明细信息，请先配置后打印！");return}if(!Array.isArray(a.data)){console.error("结果不是一个数组: ",a);return}await x.confirm("确认打印？"),console.log("开始循环: "+a),LODOP.PRINT_INITA(0,0,150,100),LODOP.SET_PRINT_PAGESIZE(2,"","","热敏纸");for(const e of a.data){console.log("数据解析: ",e),LODOP.NEWPAGE(),LODOP.ADD_PRINT_RECT(8,5,150*3.71-10,100*3.71-10,0,1),LODOP.SET_PRINT_STYLE("FontSize",18),LODOP.SET_PRINT_STYLE("FontName","Microsoft YaHei"),LODOP.SET_PRINT_STYLE("Bold",1),LODOP.SET_PRINT_STYLE("Horient",2),LODOP.ADD_PRINT_TEXT(13,0,150,30,"入库单标签"),LODOP.SET_PRINT_STYLE("FontSize",14),LODOP.SET_PRINT_STYLE("Bold",0),LODOP.SET_PRINT_STYLE("Horient",0),LODOP.ADD_PRINT_TEXT(65,15,120,35,"条码编号:"),LODOP.ADD_PRINT_TEXT(65,120,280,35,e.id),LODOP.ADD_PRINT_TEXT(110,15,120,35,"采购料号:"),LODOP.ADD_PRINT_TEXT(110,120,280,35,e.goodsNumber),LODOP.ADD_PRINT_TEXT(155,15,120,35,"物料名称:"),LODOP.ADD_PRINT_TEXT(155,120,280,35,e.goodsName+e.goodsSpecs),LODOP.ADD_PRINT_TEXT(200,15,120,35,"采购单号:"),LODOP.ADD_PRINT_TEXT(200,120,280,35,e.poNo),LODOP.ADD_PRINT_TEXT(245,15,120,35,"收货数量:"),LODOP.ADD_PRINT_TEXT(245,120,280,35,e.receiveNum+e.unitOfMeasure),LODOP.ADD_PRINT_TEXT(290,15,120,35,"批次号:"),LODOP.ADD_PRINT_TEXT(290,120,280,35,e.batchCode),LODOP.ADD_PRINT_TEXT(335,15,120,35,"收货日期:");const t=new Date(e.receiveTime).toISOString().slice(0,19).replace("T"," ");LODOP.ADD_PRINT_TEXT(335,120,280,35,t);const u={id:e.id,type:"purchase",po_no:e.poNo};LODOP.ADD_PRINT_BARCODE(220,390,170,170,"QRCode",JSON.stringify(u))}LODOP.SET_PRINT_MODE("AUTO_CLOSE_PREWINDOW",1),LODOP.PREVIEW(),await Be(i.value[0].poNo)}catch(a){console.error("打印失败:",a)}},Xe=async()=>{try{for(let a=0;a<i.value.length;a++){if(!i.value[a].receiveNum){s.error("请先确认第"+(a+1)+"行的收货数量");return}if(!i.value[a].unitOfMeasure){s.error("请先确认第"+(a+1)+"行的收货单位");return}if(i[a].status===0){s.error("请先对第"+(a+1)+"行的物料进行收货");return}}await x.confirm("确认批量打印？"),LODOP.PRINT_INITA(0,0,150,100),LODOP.SET_PRINT_PAGESIZE(2,"","","热敏纸");for(const a of i.value.map(e=>e.id)){const t=await Se(a);LODOP.NEWPAGE(),LODOP.ADD_PRINT_RECT(8,5,150*3.71-10,100*3.71-10,0,1),LODOP.SET_PRINT_STYLE("FontSize",18),LODOP.SET_PRINT_STYLE("FontName","Microsoft YaHei"),LODOP.SET_PRINT_STYLE("Bold",1),LODOP.SET_PRINT_STYLE("Horient",2),LODOP.ADD_PRINT_TEXT(13,0,150,30,"入库单标签"),LODOP.SET_PRINT_STYLE("FontSize",14),LODOP.SET_PRINT_STYLE("Bold",0),LODOP.SET_PRINT_STYLE("Horient",0),LODOP.ADD_PRINT_TEXT(65,15,120,35,"条码编号:"),LODOP.ADD_PRINT_TEXT(65,120,280,35,t.id),LODOP.ADD_PRINT_TEXT(110,15,120,35,"采购料号:"),LODOP.ADD_PRINT_TEXT(110,120,280,35,t.goodsNumber),LODOP.ADD_PRINT_TEXT(155,15,120,35,"物料名称:"),LODOP.ADD_PRINT_TEXT(155,120,280,35,t.goodsName+t.goodsSpecs),LODOP.ADD_PRINT_TEXT(200,15,120,35,"采购单号:"),LODOP.ADD_PRINT_TEXT(200,120,280,35,t.poNo),LODOP.ADD_PRINT_TEXT(245,15,120,35,"收货数量:"),LODOP.ADD_PRINT_TEXT(245,120,280,35,t.receiveNum+t.unitOfMeasure),LODOP.ADD_PRINT_TEXT(290,15,120,35,"批次号:"),LODOP.ADD_PRINT_TEXT(290,120,280,35,t.batchCode),LODOP.ADD_PRINT_TEXT(335,15,120,35,"收货日期:");const u=new Date(t.receiveTime).toISOString().slice(0,19).replace("T"," ");LODOP.ADD_PRINT_TEXT(335,120,280,35,u);const r={id:t.id,type:"purchase",po_no:t.poNo};LODOP.ADD_PRINT_BARCODE(220,390,170,170,"QRCode",JSON.stringify(r))}LODOP.SET_PRINT_MODE("AUTO_CLOSE_PREWINDOW",1),LODOP.PREVIEW(),await Ye()}catch(a){console.error("批量打印失败:",a)}},Ye=async()=>{try{await Uo(i.value),s.success("打印成功"),w()}catch(a){console.error("更新状态失败:",a)}},Be=async a=>{try{await Fo(a),s.success("打印成功"),w()}catch(e){console.error("批量更新状态失败:",e)}},Qe=async()=>{try{const a=await qo();oe.value=a,oe.value.map(e=>{e.pId=e.id,e.pName=e.warehouseName,e.children.map(t=>{t.pId=t.id,t.pName=t.locationName,t.children.map(u=>{u.pId=u.id,u.pName=u.areaName})})})}catch(a){console.error("获取仓库列表失败:",a)}},je=a=>{a!=null&&(N.warehouseId=a[0],N.locationId=a[1],N.areaId=a[2])},He=()=>{L.value=!0,Q.value="一键入库"},Ge=async()=>{try{for(const t of F.value)if(t.status===0){s.error("存在未打印的单据, 物料号: "+t.goodsNumber+"，请先打印条码!");return}if(!N.wareHouse){s.error("请选择要入库的位置!");return}const a={poNo:N.poNo,warehouseId:N.warehouseId,locationId:N.locationId,areaId:N.areaId};D.value=!0;const e=await ko(a);if(e!=="success"){s.error("入库失败, 请联系系统管理员, 问题如下: "+e);return}L.value=!1,w(),N.poNo="",F.value=[],s.success("入库成功")}catch(a){console.error("入库失败:",a)}finally{D.value=!1}},ae=async()=>{if(N.poNo){D.value=!0;try{const a=await Ro(N);F.value=a}finally{D.value=!1}}},We=a=>{scanResult.value=a},$e=()=>{if(i.value.length===0){s.warning("请选择至少一项进行拆分");return}if(!i.value[0].receiveNum){s.warning("请先填写收货数量");return}Object.assign(c,{id:i.value[0].id,poNo:i.value[0].poNo,goodsNumber:i.value[0].goodsNumber,receiveNum:i.value[0].receiveNum,unitOfMeasure:i.value[0].unitOfMeasure}),O.value=i.value.map(a=>({index:C.value,poNo:a.poNo,goodsNumber:a.goodsNumber,unitOfMeasure:a.unitOfMeasure,quantity:""})),A.value=!0},Je=()=>{const a=parseFloat(c.receiveNum);if(O.value.reduce((u,r)=>u+(parseFloat(r.quantity)||0),0)>=a){s.error("拆分数量总和不能超过采购数量");return}C.value+=1;const t={index:C.value,poNo:c.poNo,goodsNumber:c.goodsNumber,unitOfMeasure:c.unitOfMeasure,quantity:""};O.value.push(t)},Ke=async()=>{try{await x.confirm("是否基于当前采购数量"+c.receiveNum+"追加拆分行?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=parseFloat(c.receiveNum),e=[];let t=0;for(let u=0;u<a;u++)e.push({index:u+1,poNo:c.poNo,goodsNumber:c.goodsNumber,unitOfMeasure:c.unitOfMeasure,quantity:1}),t++;C.value=t+1,O.value=e}catch{}},Ze=a=>{O.value.splice(a,1),O.value.forEach((e,t)=>{e.index=t+1}),O.value.length>0?a.value=Math.max(...O.value.map(e=>e.index)):a.value=0},eo=async()=>{const a=O.value.reduce((t,u)=>t+(parseFloat(u.quantity)||0),0).toFixed(4);if(parseFloat(a)>parseFloat(c.receiveNum)){s.error("拆分数量总和不能超过采购数量");return}for(const t of O.value)if(!t.quantity||parseFloat(t.quantity)===0){s.error("拆分行的数量禁止为空或0");return}const e={id:c.id,poNo:c.poNo,goodsNumber:c.goodsNumber,splitDetails:O.value};D.value=!0;try{await xo(e),A.value=!1,w(),C.value=1,s.success("拆分成功")}catch(t){console.error("拆分失败:",t)}finally{D.value=!1}},oo=()=>{if(i.value.length===0){s.warning("请选择至少一项进行拆分");return}if(!i.value[0].receiveNum){s.warning("请先填写收货数量");return}q.value=!0},lo=()=>{if(!P.splitQuantity||!P.splitCount){s.error("拆分数量和拆分个数不能为空");return}const a=parseFloat(P.splitQuantity),e=parseInt(P.splitCount,10);if(a*e>i.value[0].receiveNum){s.error("拆分数量乘以拆分个数不能大于当前的入库数量");return}O.value=[];for(let t=0;t<e;t++)O.value.push({index:t+1,poNo:i.value[0].poNo,goodsNumber:i.value[0].goodsNumber,unitOfMeasure:i.value[0].unitOfMeasure,quantity:a});C.value=O.value.length+1,q.value=!1,A.value=!0,P.splitQuantity="",P.splitCount=""},ao=()=>{q.value=!1,P.splitQuantity="",P.splitCount=""},to=()=>{if(i.value.length===0){s.warning("请选择至少一项进行收货");return}for(let e=0;e<i.value.length;e++)if(!i.value[e].receiveNum){s.warning(`请先填写第${e+1}行收货数量!`);return}const a={list:i.value};x.confirm("确定收货吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{D.value=!0,Vo(a).then(e=>{if(e!=="success"){s.error(`收货失败, 请联系系统管理员, 问题如下: ${e}`);return}D.value=!1,w(),C.value=1,s.success("收货成功")}).catch(e=>{console.error("收货操作失败:",e),s.error("收货操作失败，请稍后重试")}).finally(()=>{D.value=!1})}).catch(()=>{})};return(a,e)=>{const t=S("el-input"),u=S("el-form-item"),r=S("el-button"),I=S("el-form"),v=S("el-col"),ge=S("right-toolbar"),V=S("el-row"),d=S("el-table-column"),Ne=Eo,te=S("el-table"),no=bo,uo=S("el-option"),ro=S("el-select"),H=S("el-dialog"),so=S("el-cascader"),z=ue("hasPermi"),_e=ue("loading"),G=ue("dialogDrag");return T(),ye("div",Xo,[y(o(I,{model:_,ref_key:"queryFormRef",ref:de,size:p.value,inline:!0},{default:l(()=>[o(u,{label:"采购单号",prop:"poNo"},{default:l(()=>[o(t,{modelValue:_.poNo,"onUpdate:modelValue":e[0]||(e[0]=n=>_.poNo=n),placeholder:"请输入采购单号",clearable:"",onKeyup:$(k,["enter"])},null,8,["modelValue"])]),_:1}),o(u,{label:"商品编号",prop:"goodsNumber"},{default:l(()=>[o(t,{modelValue:_.goodsNumber,"onUpdate:modelValue":e[1]||(e[1]=n=>_.goodsNumber=n),placeholder:"请输入商品编号",clearable:"",onKeyup:$(k,["enter","native"])},null,8,["modelValue"])]),_:1}),o(u,{label:"商品名称",prop:"goodsName"},{default:l(()=>[o(t,{modelValue:_.goodsName,"onUpdate:modelValue":e[2]||(e[2]=n=>_.goodsName=n),placeholder:"请输入商品名称",clearable:"",onKeyup:$(k,["enter","native"])},null,8,["modelValue"])]),_:1}),o(u,{label:"供应商名称",prop:"vendorName"},{default:l(()=>[o(t,{modelValue:_.vendorName,"onUpdate:modelValue":e[3]||(e[3]=n=>_.vendorName=n),placeholder:"请输入",clearable:"",onKeyup:$(k,["enter","native"])},null,8,["modelValue"])]),_:1}),o(u,null,{default:l(()=>[o(r,{type:"primary",icon:E(vo),onClick:k},{default:l(()=>e[29]||(e[29]=[g("搜索")])),_:1},8,["icon"]),o(r,{icon:E(go),onClick:Ve},{default:l(()=>e[30]||(e[30]=[g("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model","size"]),[[Oe,K.value]]),o(V,{gutter:10,class:"mb8"},{default:l(()=>[o(v,{span:1.5},{default:l(()=>[y((T(),b(r,{type:"primary",plain:"",icon:E(be),size:p.value,disabled:se.value,onClick:Xe},{default:l(()=>e[31]||(e[31]=[g("批量打印")])),_:1},8,["icon","size","disabled"])),[[z,["purchase:goods:print"]]])]),_:1}),o(v,{span:1.5},{default:l(()=>[y((T(),b(r,{type:"primary",plain:"",icon:E(be),size:p.value,disabled:ee.value,onClick:qe},{default:l(()=>e[32]||(e[32]=[g("单据打印")])),_:1},8,["icon","size","disabled"])),[[z,["purchase:goods:print"]]])]),_:1}),o(v,{span:1.5},{default:l(()=>[y((T(),b(r,{type:"warning",plain:"",icon:E(No),size:p.value,onClick:He},{default:l(()=>e[33]||(e[33]=[g("一键入库")])),_:1},8,["icon","size"])),[[z,["purchase:goods:warehousing"]]])]),_:1}),o(v,{span:1.5},{default:l(()=>[y((T(),b(r,{type:"warning",plain:"",icon:E(_o),size:p.value,onClick:Me,loading:J.value},{default:l(()=>e[34]||(e[34]=[g("导出")])),_:1},8,["icon","size","loading"])),[[z,["purchase:goods:export"]]])]),_:1}),o(v,{span:1.5},{default:l(()=>[y((T(),b(r,{type:"primary",plain:"",icon:E(To),size:p.value,onClick:to},{default:l(()=>e[35]||(e[35]=[g("收货")])),_:1},8,["icon","size"])),[[z,["purchase:goods:split"]]])]),_:1}),o(v,{span:1.5},{default:l(()=>[y((T(),b(r,{type:"primary",plain:"",icon:E(yo),size:p.value,disabled:ee.value,onClick:$e},{default:l(()=>e[36]||(e[36]=[g("拆分")])),_:1},8,["icon","size","disabled"])),[[z,["purchase:goods:split"]]])]),_:1}),o(ge,{showSearch:K.value,"onUpdate:showSearch":e[4]||(e[4]=n=>K.value=n),onQueryTable:w},null,8,["showSearch"])]),_:1}),y((T(),b(te,{data:Z.value,onSelectionChange:ze,size:p.value,ref_key:"multipleTableRef",ref:me,onRowClick:he},{default:l(()=>[o(d,{type:"selection",width:"55",align:"center"}),o(d,{label:"单据编码",align:"center",prop:"id"}),o(d,{label:"采购单号",align:"center",prop:"poNo"}),o(d,{label:"商品编号",align:"center",prop:"goodsNumber"}),o(d,{"show-overflow-tooltip":!0,label:"商品名称",align:"center",prop:"goodsName"}),o(d,{"show-overflow-tooltip":!0,label:"商品规格",align:"center",prop:"goodsSpecs"}),o(d,{label:"供应商编号",align:"center",prop:"vendorCode"}),o(d,{label:"供应商名称",align:"center",prop:"vendorName"}),o(d,{label:"商品单位",align:"center",prop:"company"}),o(d,{label:"采购数量",align:"center",prop:"quantity"}),o(d,{label:"收货数量",align:"center",prop:"receiveNum"}),o(d,{label:"创建时间",align:"center",prop:"createTime",width:"180",formatter:a.dateFormatter},{default:l(n=>[R("span",null,De(E(Oo)(n.row.createTime,"YYYY-MM-DD HH:mm")),1)]),_:1},8,["formatter"]),o(d,{label:"入库状态",prop:"status",width:"80"},{default:l(n=>[o(Ne,{type:E(we).PURCHASE_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),o(d,{width:"150",fixed:"right",label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(n=>[y((T(),b(r,{size:p.value,type:"text",onClick:Pe(W=>xe(n.row),["stop"])},{default:l(()=>e[37]||(e[37]=[g("修改")])),_:2},1032,["size","onClick"])),[[z,["purchase:goods:update"]]]),y((T(),b(r,{size:p.value,type:"text",onClick:Pe(W=>Fe(n.row),["stop"])},{default:l(()=>e[38]||(e[38]=[g("删除")])),_:2},1032,["size","onClick"])),[[z,["purchase:goods:delete"]]])]),_:1})]),_:1},8,["data","size"])),[[_e,D.value]]),y(o(no,{size:"currentSize",total:B.value,page:_.pageNo,"onUpdate:page":e[5]||(e[5]=n=>_.pageNo=n),limit:_.pageSize,"onUpdate:limit":e[6]||(e[6]=n=>_.pageSize=n),onPagination:w},null,8,["total","page","limit"]),[[Oe,B.value>0]]),y((T(),b(H,{title:Q.value,modelValue:M.value,"onUpdate:modelValue":e[16]||(e[16]=n=>M.value=n),width:"65%","append-to-body":""},{footer:l(()=>[R("div",Yo,[o(r,{size:p.value,type:"primary",onClick:Ue},{default:l(()=>e[39]||(e[39]=[g("确 定")])),_:1},8,["size"]),o(r,{size:p.value,onClick:le},{default:l(()=>e[40]||(e[40]=[g("取 消")])),_:1},8,["size"])])]),default:l(()=>[o(I,{ref_key:"formRef",ref:j,model:m,rules:fe,size:p.value},{default:l(()=>[o(V,{gutter:20},{default:l(()=>[o(v,{span:12},{default:l(()=>[o(u,{label:"采购单号",prop:"poNo"},{default:l(()=>[o(t,{disabled:"",modelValue:m.poNo,"onUpdate:modelValue":e[7]||(e[7]=n=>m.poNo=n),placeholder:"请输入采购单号"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"商品编号",prop:"goodsNumber"},{default:l(()=>[o(t,{disabled:"",modelValue:m.goodsNumber,"onUpdate:modelValue":e[8]||(e[8]=n=>m.goodsNumber=n),placeholder:"请输入商品编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(V,{gutter:20},{default:l(()=>[o(v,{span:12},{default:l(()=>[o(u,{label:"商品名称",prop:"goodsName"},{default:l(()=>[o(t,{disabled:"",modelValue:m.goodsName,"onUpdate:modelValue":e[9]||(e[9]=n=>m.goodsName=n),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"商品规格",prop:"goodsSpecs"},{default:l(()=>[o(t,{disabled:"",modelValue:m.goodsSpecs,"onUpdate:modelValue":e[10]||(e[10]=n=>m.goodsSpecs=n),placeholder:"请输入商品规格"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(V,{gutter:20},{default:l(()=>[o(v,{span:12},{default:l(()=>[o(u,{label:"商品单位",prop:"company"},{default:l(()=>[o(t,{disabled:"",modelValue:m.company,"onUpdate:modelValue":e[11]||(e[11]=n=>m.company=n),placeholder:"请输入商品单位"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"采购数量",prop:"quantity"},{default:l(()=>[o(t,{disabled:"",modelValue:m.quantity,"onUpdate:modelValue":e[12]||(e[12]=n=>m.quantity=n),placeholder:"请输入采购数量"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(V,{gutter:20},{default:l(()=>[o(v,{span:12},{default:l(()=>[o(u,{label:"收货数量",prop:"receiveNum"},{default:l(()=>[o(t,{modelValue:m.receiveNum,"onUpdate:modelValue":e[13]||(e[13]=n=>m.receiveNum=n),placeholder:"请输入收货数量"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"收货单位"},{default:l(()=>[o(ro,{filterable:"",clearable:"",onFocus:e[14]||(e[14]=n=>n.target.blur()),modelValue:m.unitOfMeasure,"onUpdate:modelValue":e[15]||(e[15]=n=>m.unitOfMeasure=n),width:"100%",placeholder:"请选择"},{default:l(()=>[(T(!0),ye(Do,null,Po(ie.value,n=>(T(),b(uo,{key:n.measureCode,label:n.measureName,value:n.measureCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"])]),_:1},8,["title","modelValue"])),[[G]]),y((T(),b(H,{title:Q.value,modelValue:L.value,"onUpdate:modelValue":e[20]||(e[20]=n=>L.value=n),width:"75%","append-to-body":""},{footer:l(()=>[R("div",Bo,[o(r,{size:p.value,type:"primary",onClick:Ge},{default:l(()=>e[43]||(e[43]=[g("确 定")])),_:1},8,["size"]),o(r,{size:p.value,onClick:le},{default:l(()=>e[44]||(e[44]=[g("取 消")])),_:1},8,["size"])])]),default:l(()=>[o(I,{ref_key:"wareFormRef",ref:pe,model:N,rules:fe,size:p.value},{default:l(()=>[o(V,{gutter:20},{default:l(()=>[o(v,{span:8},{default:l(()=>[o(u,{label:"采购单号",prop:"poNo"},{default:l(()=>[o(t,{modelValue:N.poNo,"onUpdate:modelValue":e[17]||(e[17]=n=>N.poNo=n),placeholder:"请输入采购单号",onBlur:ae,onInput:We},null,8,["modelValue"]),y(R("input",{ref_key:"scannerInput",ref:U,"onUpdate:modelValue":e[18]||(e[18]=n=>h.value=n),placeholder:"请输入",style:{position:"absolute",opacity:"0",width:"0",height:"0","z-index":"-1","-webkit-user-select":"none"},inputmode:"none",autofocus:""},null,512),[[So,h.value]]),e[41]||(e[41]=R("span",null,"支持扫码枪扫描, 无法扫码时点击重置按钮",-1))]),_:1})]),_:1}),o(v,{span:4},{default:l(()=>[o(r,{type:"primary",round:"",onClick:Ce},{default:l(()=>e[42]||(e[42]=[g("重置")])),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"仓库信息",prop:"goodsNumber"},{default:l(()=>[o(so,{modelValue:N.wareHouse,"onUpdate:modelValue":e[19]||(e[19]=n=>N.wareHouse=n),options:oe.value,props:Le,onChange:je},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),y((T(),b(te,{data:F.value,height:"500",size:p.value},{default:l(()=>[o(d,{label:"商品编号",align:"center",prop:"goodsNumber"}),o(d,{label:"商品名称",align:"center",prop:"goodsName"}),o(d,{label:"商品规格",align:"center",prop:"goodsSpecs"}),o(d,{label:"供应商编号",align:"center",prop:"vendorCode"}),o(d,{label:"商品单位",align:"center",prop:"company"}),o(d,{label:"采购数量",align:"center",prop:"quantity"}),o(d,{label:"收货数量",align:"center",prop:"receiveNum"}),o(d,{label:"创建时间",align:"center",prop:"createTime"},{default:l(n=>[R("span",null,De(a.parseTime(n.row.createTime)),1)]),_:1}),o(d,{label:"入库状态",prop:"status",width:"80"},{default:l(n=>[o(Ne,{type:E(we).PURCHASE_STATUS,value:n.row.status},null,8,["type","value"])]),_:1})]),_:1},8,["data","size"])),[[_e,D.value]])]),_:1},8,["model","size"]),R("div",null,[R("video",{ref_key:"videoCameraRef",ref:Ie,style:{display:"none"}},null,512)])]),_:1},8,["title","modelValue"])),[[G]]),y((T(),b(H,{title:"拆分详情",modelValue:A.value,"onUpdate:modelValue":e[25]||(e[25]=n=>A.value=n),width:"90%","append-to-body":""},{footer:l(()=>[R("div",jo,[o(r,{size:p.value,onClick:le},{default:l(()=>e[49]||(e[49]=[g("取消")])),_:1},8,["size"]),o(r,{size:p.value,type:"primary",onClick:eo},{default:l(()=>e[50]||(e[50]=[g("确定拆分")])),_:1},8,["size"])])]),default:l(()=>[o(I,{ref_key:"splitFormRef",ref:Ee,model:c,size:p.value},{default:l(()=>[o(V,{gutter:20},{default:l(()=>[o(v,{span:12},{default:l(()=>[o(u,{label:"采购单号",prop:"poNo"},{default:l(()=>[o(t,{disabled:"",modelValue:c.poNo,"onUpdate:modelValue":e[21]||(e[21]=n=>c.poNo=n),placeholder:"请输入采购单号"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"商品编号",prop:"goodsNumber"},{default:l(()=>[o(t,{disabled:"",modelValue:c.goodsNumber,"onUpdate:modelValue":e[22]||(e[22]=n=>c.goodsNumber=n),placeholder:"请输入商品编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(V,{gutter:20},{default:l(()=>[o(v,{span:12},{default:l(()=>[o(u,{label:"入库数量",prop:"quantity"},{default:l(()=>[o(t,{disabled:"",modelValue:c.receiveNum,"onUpdate:modelValue":e[23]||(e[23]=n=>c.receiveNum=n),placeholder:"请输入采购数量"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:12},{default:l(()=>[o(u,{label:"入库单位",prop:"unitOfMeasure"},{default:l(()=>[o(t,{disabled:"",modelValue:c.unitOfMeasure,"onUpdate:modelValue":e[24]||(e[24]=n=>c.unitOfMeasure=n),placeholder:"请输入采购数量"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),R("div",Qo,[o(r,{size:p.value,type:"primary",onClick:oo},{default:l(()=>e[45]||(e[45]=[g("按条件拆分")])),_:1},8,["size"]),o(r,{size:p.value,type:"primary",onClick:Ke},{default:l(()=>e[46]||(e[46]=[g("按数量拆分")])),_:1},8,["size"]),o(r,{size:p.value,type:"primary",onClick:Je},{default:l(()=>e[47]||(e[47]=[g("新增")])),_:1},8,["size"])]),o(te,{data:O.value,style:{width:"100%"},"max-height":"400",size:p.value},{default:l(()=>[o(d,{prop:"index",label:"序号",width:"60"}),o(d,{prop:"poNo",label:"采购单号",width:"180"}),o(d,{prop:"goodsNumber",label:"物料料号",width:"180"}),o(d,{prop:"unitOfMeasure",label:"物料单位",width:"180"}),o(d,{prop:"quantity",label:"数量"},{default:l(n=>[o(t,{modelValue:n.row.quantity,"onUpdate:modelValue":W=>n.row.quantity=W,type:"number",placeholder:"请输入数量"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{label:"操作",width:"100"},{default:l(n=>[o(r,{size:p.value,type:"text",icon:"el-icon-delete",onClick:W=>Ze(n.$index)},{default:l(()=>e[48]||(e[48]=[g("删除")])),_:2},1032,["size","onClick"])]),_:1})]),_:1},8,["data","size"])]),_:1},8,["modelValue"])),[[G]]),y((T(),b(H,{title:"按条件拆分",modelValue:q.value,"onUpdate:modelValue":e[28]||(e[28]=n=>q.value=n),width:"50%","append-to-body":""},{footer:l(()=>[R("div",Ho,[o(r,{onClick:ao,size:p.value},{default:l(()=>e[51]||(e[51]=[g("取消")])),_:1},8,["size"]),o(r,{type:"primary",onClick:lo,size:p.value},{default:l(()=>e[52]||(e[52]=[g("确定")])),_:1},8,["size"])])]),default:l(()=>[o(I,{ref_key:"splitConditionFormRef",ref:Re,model:P,size:p.value},{default:l(()=>[o(u,{label:"拆分条数"},{default:l(()=>[o(t,{modelValue:P.splitCount,"onUpdate:modelValue":e[26]||(e[26]=n=>P.splitCount=n),type:"number",step:"1",placeholder:"请输入拆分条数"},null,8,["modelValue"])]),_:1}),o(u,{label:"拆分数量"},{default:l(()=>[o(t,{modelValue:P.splitQuantity,"onUpdate:modelValue":e[27]||(e[27]=n=>P.splitQuantity=n),type:"number",step:"0.001",placeholder:"请输入拆分数量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","size"])]),_:1},8,["modelValue"])),[[G]])])}}};export{ll as default};
