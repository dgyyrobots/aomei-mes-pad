/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-11 15:04:23 
 */
import{d as M,r as i,g as m,h as P,k as _,o as g,m as n,j as o,w as T,i as R,a as e,v,K,M as L,y as Q,_ as j,z as A}from"./index-lcC3l4R2.js";import{s as E}from"./coupon-CV1q1Veb.js";import{g as G}from"./couponTemplate-7NpDJDJ9.js";import{g as H}from"./constants-BPQb3nxh.js";import{d as J,u as O,v as W,r as X}from"./formatter-rvE1iX1R.js";const se=M({name:"PromotionCouponSendForm",__name:"CouponSendForm",setup(Y,{expose:N}){const h=A(),y=i(0),b=i([]),d=i(!1),u=i(!1),p=i(!1),a=i({pageNo:1,pageSize:10,name:null,canTakeTypes:[H.ADMIN.type]}),w=i();let C=[];N({open:s=>{C=s,k(),p.value=!0}});const x=async()=>{d.value=!0;try{const s=await G(a.value);b.value=s.list,y.value=s.total}finally{d.value=!1}},c=()=>{a.value.pageNo=1,x()},k=()=>{w?.value?.resetFields(),c()},S=async s=>{try{u.value=!0,await E({templateId:s,userIds:C}),h.success("发送成功"),p.value=!1}finally{u.value=!1}};return(s,t)=>{const z=m("el-input"),V=m("el-form-item"),F=K,f=m("el-button"),D=m("el-form"),r=m("el-table-column"),U=m("el-table"),$=L,q=j,B=P("hasPermi"),I=P("loading");return g(),_(q,{modelValue:e(p),"onUpdate:modelValue":t[3]||(t[3]=l=>Q(p)?p.value=l:null),"append-to-body":!0,title:"发送优惠券",width:"70%"},{default:n(()=>[o(D,{ref_key:"queryFormRef",ref:w,class:"-mb-15px",inline:!0,"label-width":"82px",model:e(a)},{default:n(()=>[o(V,{label:"优惠券名称",prop:"name"},{default:n(()=>[o(z,{modelValue:e(a).name,"onUpdate:modelValue":t[0]||(t[0]=l=>e(a).name=l),class:"!w-240px",clearable:"",placeholder:"请输入优惠劵名",onKeyup:c},null,8,["modelValue"])]),_:1}),o(V,null,{default:n(()=>[o(f,{onClick:c},{default:n(()=>[o(F,{class:"mr-5px",icon:"ep:search"}),t[4]||(t[4]=v(" 搜索 "))]),_:1}),o(f,{onClick:k},{default:n(()=>[o(F,{class:"mr-5px",icon:"ep:refresh"}),t[5]||(t[5]=v(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"]),T((g(),_(U,{data:e(b),"show-overflow-tooltip":""},{default:n(()=>[o(r,{align:"center",label:"优惠券名称","min-width":"60",prop:"name"}),o(r,{align:"center",formatter:e(J),label:"优惠金额 / 折扣","min-width":"60",prop:"discount"},null,8,["formatter"]),o(r,{align:"center",formatter:e(O),label:"最低消费","min-width":"60",prop:"usePrice"},null,8,["formatter"]),o(r,{align:"center",formatter:e(W),label:"有效期限","min-width":"140",prop:"validityType"},null,8,["formatter"]),o(r,{align:"center",formatter:e(X),label:"剩余数量","min-width":"60"},null,8,["formatter"]),o(r,{align:"center",fixed:"right",label:"操作","min-width":"60px"},{default:n(l=>[T((g(),_(f,{disabled:e(u),link:"",loading:e(u),type:"primary",onClick:ee=>S(l.row.id)},{default:n(()=>t[6]||(t[6]=[v(" 发送 ")])),_:2},1032,["disabled","loading","onClick"])),[[B,["member:level:update"]]])]),_:1})]),_:1},8,["data"])),[[I,e(d)]]),o($,{limit:e(a).pageSize,"onUpdate:limit":t[1]||(t[1]=l=>e(a).pageSize=l),page:e(a).pageNo,"onUpdate:page":t[2]||(t[2]=l=>e(a).pageNo=l),total:e(y),onPagination:x},null,8,["limit","page","total"]),t[7]||(t[7]=R("div",{class:"clear-both"},null,-1))]),_:1},8,["modelValue"])}}});export{se as _};
