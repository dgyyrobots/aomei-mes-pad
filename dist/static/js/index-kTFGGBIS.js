/*!  build: Vue Shop Vite 
     copyright: https://vue-admin-beautiful.com/shop-vite  
     time: 2025-04-15 10:21:26 
 */
import{d as W,u as h,r as w,f as X,b as Z,g as u,h as A,c as _,o as s,j as l,m as n,a,J as L,F as f,n as C,k as p,w as S,v as y,K as ee,i as le,t as ae,L as Y,l as te,M as ne,T as oe,N as se,z as re}from"./index-5TqN_QR1.js";import{_ as ue}from"./DictTag.vue_vue_type_script_lang-cZQMmgs8.js";import{_ as pe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-fpmIiri3.js";import{c as E,D as d}from"./dict-B2yk4gHf.js";import{b as ie,a as me}from"./index-DX3pdFb-.js";import"./color-B5phLuB-.js";const ve=W({name:"BpmProcessInstance",__name:"index",setup(ce){const I=h(),$=re(),{t:N}=se(),k=w(!0),B=w(0),M=w([]),o=X({pageNo:1,pageSize:10,name:"",processDefinitionId:void 0,category:void 0,status:void 0,result:void 0,createTime:[]}),U=w(),b=async()=>{k.value=!0;try{const i=await ie(o);M.value=i.list,B.value=i.total}finally{k.value=!1}},g=()=>{o.pageNo=1,b()},q=()=>{U.value.resetFields(),g()},F=()=>{I.push({name:"BpmProcessInstanceCreate"})},z=i=>{I.push({name:"BpmProcessInstanceDetail",query:{id:i.id}})},K=async i=>{const{value:t}=await oe.prompt("请输入取消原因","取消流程",{confirmButtonText:N("common.ok"),cancelButtonText:N("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});await me(i.id,t),$.success("取消成功"),await b()};return Z(()=>{b()}),(i,t)=>{const R=u("el-input"),m=u("el-form-item"),T=u("el-option"),P=u("el-select"),G=u("el-date-picker"),V=ee,c=u("el-button"),H=u("el-form"),O=pe,r=u("el-table-column"),x=ue,Q=u("el-table"),j=ne,D=A("hasPermi"),J=A("loading");return s(),_(f,null,[l(O,null,{default:n(()=>[l(H,{ref_key:"queryFormRef",ref:U,class:"-mb-15px",inline:!0,"label-width":"68px",model:a(o)},{default:n(()=>[l(m,{label:"流程名称",prop:"name"},{default:n(()=>[l(R,{modelValue:a(o).name,"onUpdate:modelValue":t[0]||(t[0]=e=>a(o).name=e),class:"!w-240px",clearable:"",placeholder:"请输入流程名称",onKeyup:L(g,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"所属流程",prop:"processDefinitionId"},{default:n(()=>[l(R,{modelValue:a(o).processDefinitionId,"onUpdate:modelValue":t[1]||(t[1]=e=>a(o).processDefinitionId=e),class:"!w-240px",clearable:"",placeholder:"请输入流程定义的编号",onKeyup:L(g,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"流程分类",prop:"category"},{default:n(()=>[l(P,{modelValue:a(o).category,"onUpdate:modelValue":t[2]||(t[2]=e=>a(o).category=e),class:"!w-240px",clearable:"",placeholder:"请选择流程分类"},{default:n(()=>[(s(!0),_(f,null,C(a(E)(a(d).BPM_MODEL_CATEGORY),e=>(s(),p(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:n(()=>[l(P,{modelValue:a(o).status,"onUpdate:modelValue":t[3]||(t[3]=e=>a(o).status=e),class:"!w-240px",clearable:"",placeholder:"请选择状态"},{default:n(()=>[(s(!0),_(f,null,C(a(E)(a(d).BPM_PROCESS_INSTANCE_STATUS),e=>(s(),p(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"结果",prop:"result"},{default:n(()=>[l(P,{modelValue:a(o).result,"onUpdate:modelValue":t[4]||(t[4]=e=>a(o).result=e),class:"!w-240px",clearable:"",placeholder:"请选择结果"},{default:n(()=>[(s(!0),_(f,null,C(a(E)(a(d).BPM_PROCESS_INSTANCE_RESULT),e=>(s(),p(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"提交时间",prop:"createTime"},{default:n(()=>[l(G,{modelValue:a(o).createTime,"onUpdate:modelValue":t[5]||(t[5]=e=>a(o).createTime=e),class:"!w-240px","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),l(m,null,{default:n(()=>[l(c,{onClick:g},{default:n(()=>[l(V,{class:"mr-5px",icon:"ep:search"}),t[8]||(t[8]=y(" 搜索 "))]),_:1}),l(c,{onClick:q},{default:n(()=>[l(V,{class:"mr-5px",icon:"ep:refresh"}),t[9]||(t[9]=y(" 重置 "))]),_:1}),S((s(),p(c,{plain:"",type:"primary",onClick:F},{default:n(()=>[l(V,{class:"mr-5px",icon:"ep:plus"}),t[10]||(t[10]=y(" 发起流程 "))]),_:1})),[[D,["bpm:process-instance:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),l(O,null,{default:n(()=>[S((s(),p(Q,{data:a(M)},{default:n(()=>[l(r,{align:"center",label:"流程编号",prop:"id",width:"300px"}),l(r,{align:"center",label:"流程名称",prop:"name"}),l(r,{align:"center",label:"流程分类",prop:"category"},{default:n(e=>[l(x,{type:a(d).BPM_MODEL_CATEGORY,value:e.row.category},null,8,["type","value"])]),_:1}),l(r,{align:"center",label:"当前审批任务",prop:"tasks"},{default:n(e=>[(s(!0),_(f,null,C(e.row.tasks,v=>(s(),p(c,{key:v.id,link:"",type:"primary"},{default:n(()=>[le("span",null,ae(v.name),1)]),_:2},1024))),128))]),_:1}),l(r,{label:"状态",prop:"status"},{default:n(e=>[l(x,{type:a(d).BPM_PROCESS_INSTANCE_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),l(r,{label:"结果",prop:"result"},{default:n(e=>[l(x,{type:a(d).BPM_PROCESS_INSTANCE_RESULT,value:e.row.result},null,8,["type","value"])]),_:1}),l(r,{align:"center",formatter:a(Y),label:"提交时间",prop:"createTime",width:"180"},null,8,["formatter"]),l(r,{align:"center",formatter:a(Y),label:"结束时间",prop:"endTime",width:"180"},null,8,["formatter"]),l(r,{align:"center",label:"操作"},{default:n(e=>[S((s(),p(c,{link:"",type:"primary",onClick:v=>z(e.row)},{default:n(()=>t[11]||(t[11]=[y("详情")])),_:2},1032,["onClick"])),[[D,["bpm:process-instance:cancel"]]]),e.row.result===1?S((s(),p(c,{key:0,link:"",type:"primary",onClick:v=>K(e.row)},{default:n(()=>t[12]||(t[12]=[y(" 取消 ")])),_:2},1032,["onClick"])),[[D,["bpm:process-instance:query"]]]):te("",!0)]),_:1})]),_:1},8,["data"])),[[J,a(k)]]),l(j,{limit:a(o).pageSize,"onUpdate:limit":t[6]||(t[6]=e=>a(o).pageSize=e),page:a(o).pageNo,"onUpdate:page":t[7]||(t[7]=e=>a(o).pageNo=e),total:a(B),onPagination:b},null,8,["limit","page","total"])]),_:1})],64)}}});export{ve as default};
